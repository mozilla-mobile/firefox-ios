(()=>{var e={461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{IOSAppConstants:()=>i,default:()=>n});const i=Object.freeze({platform:"ios",prefs:{"extensions.formautofill.creditCards.heuristics.mode":1,"extensions.formautofill.creditCards.heuristics.fathom.confidenceThreshold":.5,"extensions.formautofill.creditCards.heuristics.fathom.highConfidenceThreshold":.95,"extensions.formautofill.creditCards.heuristics.fathom.testConfidence":0,"extensions.formautofill.creditCards.heuristics.fathom.types":"cc-number,cc-name","extensions.formautofill.loglevel":"Warn","extensions.formautofill.addresses.supported":"off","extensions.formautofill.creditCards.supported":"detect","browser.search.region":"US","extensions.formautofill.creditCards.supportedCountries":"US,CA,GB,FR,DE","extensions.formautofill.addresses.enabled":!1,"extensions.formautofill.addresses.capture.enabled":!1,"extensions.formautofill.addresses.capture.v2.enabled":!1,"extensions.formautofill.addresses.supportedCountries":"","extensions.formautofill.creditCards.enabled":!0,"extensions.formautofill.reauth.enabled":!0,"extensions.formautofill.creditCards.hideui":!1,"extensions.formautofill.supportRTL":!1,"extensions.formautofill.creditCards.ignoreAutocompleteOff":!0,"extensions.formautofill.addresses.ignoreAutocompleteOff":!0,"extensions.formautofill.heuristics.enabled":!0,"extensions.formautofill.section.enabled":!0,"extensions.formautofill.heuristics.visibilityCheckThreshold":0,"extensions.formautofill.heuristics.interactivityCheckMode":"focusability","extensions.formautofill.focusOnAutofill":!1},validAutocompleteFields:["off","on","name","honorific-prefix","given-name","additional-name","family-name","honorific-suffix","nickname","email","username","new-password","current-password","one-time-code","organization-title","organization","street-address","address-line1","address-line2","address-line3","address-level4","address-level3","address-level2","address-level1","country","country-name","postal-code","cc-name","cc-given-name","cc-additional-name","cc-family-name","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc","cc-type","transaction-currency","transaction-amount","language","bday","bday-day","bday-month","bday-year","sex","tel","tel-country-code","tel-national","tel-area-code","tel-local","tel-extension","impp","url","photo"]}),n=i},377:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CreditCard:()=>a,NETWORK_NAMES:()=>n});const i=Object.freeze(["amex","cartebancaire","diners","discover","jcb","mastercard","mir","unionpay","visa"]),n={"american express":"amex","master card":"mastercard","union pay":"unionpay"},s=[{type:"amex",start:34,end:34,len:15},{type:"amex",start:37,end:37,len:15},{type:"cartebancaire",start:4035,end:4035,len:16},{type:"cartebancaire",start:4360,end:4360,len:16},{type:"diners",start:300,end:305,len:[14,19]},{type:"diners",start:3095,end:3095,len:[14,19]},{type:"diners",start:36,end:36,len:[14,19]},{type:"diners",start:38,end:39,len:[14,19]},{type:"discover",start:6011,end:6011,len:[16,19]},{type:"discover",start:622126,end:622925,len:[16,19]},{type:"discover",start:624e3,end:626999,len:[16,19]},{type:"discover",start:628200,end:628899,len:[16,19]},{type:"discover",start:64,end:65,len:[16,19]},{type:"jcb",start:3528,end:3589,len:[16,19]},{type:"mastercard",start:2221,end:2720,len:16},{type:"mastercard",start:51,end:55,len:16},{type:"mir",start:2200,end:2204,len:16},{type:"unionpay",start:62,end:62,len:[16,19]},{type:"unionpay",start:81,end:81,len:[16,19]},{type:"visa",start:4,end:4,len:16}].sort(((e,t)=>t.start-e.start));class a{constructor({name:e,number:t,expirationString:r,expirationMonth:i,expirationYear:n,network:s,ccv:l,encryptedNumber:o}){this._name=e,this._unmodifiedNumber=t,this._encryptedNumber=o,this._ccv=l,this.number=t;let{month:d,year:c}=a.normalizeExpiration({expirationString:r,expirationMonth:i,expirationYear:n});this._expirationMonth=d,this._expirationYear=c,this.network=s}set name(e){this._name=e}set expirationMonth(e){this._expirationMonth=void 0!==e?a.normalizeExpirationMonth(e):void 0}get expirationMonth(){return this._expirationMonth}set expirationYear(e){this._expirationYear=void 0!==e?a.normalizeExpirationYear(e):void 0}get expirationYear(){return this._expirationYear}set expirationString(e){let{month:t,year:r}=a.parseExpirationString(e);this.expirationMonth=t,this.expirationYear=r}set ccv(e){this._ccv=e}get number(){return this._number}set number(e){if(e){let t=a.normalizeCardNumber(e);t=t.match(/^\d{12,}$/)?t:"",this._number=t}else this._number="";if(e&&!this.isValidNumber())throw this._number="",new Error("Invalid credit card number")}get network(){return this._network}set network(e){this._network=e||void 0}isValidNumber(){if(!this._number)return!1;const e=a.normalizeCardNumber(this._number),t=e.length;if(t<12||t>19)return!1;if(!/^\d+$/.test(e))return!1;let r=0;for(let i=0;i<t;i++){let n=parseInt(e[t-i-1],10);i%2==1&&(n*=2,n>9&&(n-=9)),r+=n}return r%10==0}static normalizeCardNumber(e){return e?e.replace(/[\-\s]/g,""):null}static getType(e){if(!e)return null;for(let t=0;t<s.length;t++){const r=s[t];if("number"==typeof r.len){if(r.len!=e.length)continue}else if(e.length<r.len[0]||e.length>r.len[1])continue;const i=Math.floor(Math.log10(r.start))+1,n=parseInt(e.substring(0,i),10);if(n>=r.start&&n<=r.end)return r.type}return null}static getNetworkFromName(e){if(!e)return null;let t=e.trim().toLowerCase().normalize("NFKC");if(i.includes(t))return t;for(let e in n)if(t.includes(e))return n[e];return null}isValid(){if(!this.isValidNumber())return!1;let e=new Date,t=e.getFullYear();if(this._expirationYear>t)return!0;let r=e.getMonth()+1;return this._expirationYear==t&&this._expirationMonth>=r}get maskedNumber(){return a.getMaskedNumber(this._number)}get longMaskedNumber(){return a.getLongMaskedNumber(this._number)}static getLabelInfo({number:e,name:t,month:r,year:i,type:n}){let s=["number"];return t&&s.push("name"),r&&i&&s.push("expiration"),{id:`credit-card-label-${s.join("-")}-2`,args:{number:a.getMaskedNumber(e),name:t,month:r?.toString(),year:i?.toString(),type:n}}}static getLabel({number:e,name:t}){let r=[];return e&&r.push(a.getMaskedNumber(e)),t&&r.push(t),r.join(", ")}static normalizeExpirationMonth(e){if(e=parseInt(e,10),!(isNaN(e)||e<1||e>12))return e}static normalizeExpirationYear(e){if(e=parseInt(e,10),!(isNaN(e)||e<0))return e<100&&(e+=2e3),e}static parseExpirationString(e){let t=[{regex:/(?:^|\D)(\d{2})(\d{2})(?!\d)/},{regex:/(?:^|\D)(\d{4})[-/](\d{1,2})(?!\d)/,yearIndex:0,monthIndex:1},{regex:/(?:^|\D)(\d{1,2})[-/](\d{4})(?!\d)/,yearIndex:1,monthIndex:0},{regex:/(?:^|\D)(\d{1,2})[-/](\d{1,2})(?!\d)/},{regex:/(?:^|\D)(\d{2})(\d{2})(?!\d)/}];e=e.replaceAll(" ","");for(let r of t){let t,i,n=r.regex.exec(e);if(!n)continue;const s=[parseInt(n[1],10),parseInt(n[2],10)];if(r.yearIndex&&r.monthIndex?(t=s[r.yearIndex],i=s[r.monthIndex]):(i=s[0],i>12?(t=s[0],i=s[1]):t=s[1]),i>=1&&i<=12&&(t<100||t>2e3))return{month:i,year:t}}return{month:void 0,year:void 0}}static normalizeExpiration({expirationString:e,expirationMonth:t,expirationYear:r}){let i={};return!e||t&&r||(i=a.parseExpirationString(e)),{month:a.normalizeExpirationMonth(i.month||t),year:a.normalizeExpirationYear(i.year||r)}}static formatMaskedNumber(e){return"*".repeat(4)+e.substr(-4)}static getMaskedNumber(e){return"*".repeat(4)+" "+e.substr(-4)}static getLongMaskedNumber(e){return"*".repeat(e.length-4)+e.substr(-4)}static getCreditCardLogo(e){const t="chrome://formautofill/content/",r=t+"third-party/";switch(e){case"amex":return r+"cc-logo-amex.png";case"cartebancaire":return r+"cc-logo-cartebancaire.png";case"diners":return r+"cc-logo-diners.svg";case"discover":return r+"cc-logo-discover.png";case"jcb":return r+"cc-logo-jcb.svg";case"mastercard":return r+"cc-logo-mastercard.svg";case"mir":return r+"cc-logo-mir.svg";case"unionpay":return r+"cc-logo-unionpay.svg";case"visa":return r+"cc-logo-visa.svg";default:return t+"icon-credit-card-generic.svg"}}static isValidNumber(e){try{new a({number:e})}catch(e){return!1}return!0}static isValidNetwork(e){return i.includes(e)}static getSupportedNetworks(){return i}static getNetworkL10nId(e){return this.isValidNetwork(e)?`autofill-card-network-${e}`:null}}},121:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CreditCardRecord:()=>s});var i=r(377),n=r(54);class s{static normalizeFields(e){this.#e(e),this.#t(e),this.#r(e),this.#i(e)}static#e(e){(e["cc-given-name"]||e["cc-additional-name"]||e["cc-family-name"])&&(e["cc-name"]||(e["cc-name"]=n.FormAutofillNameUtils.joinNameParts({given:e["cc-given-name"],middle:e["cc-additional-name"],family:e["cc-family-name"]}))),delete e["cc-given-name"],delete e["cc-additional-name"],delete e["cc-family-name"]}static#t(e){if(!("cc-number"in e))return;if(!i.CreditCard.isValidNumber(e["cc-number"]))return void delete e["cc-number"];const t=new i.CreditCard({number:e["cc-number"]});e["cc-number"]=t.number}static#r(e){let t=i.CreditCard.normalizeExpiration({expirationMonth:e["cc-exp-month"],expirationYear:e["cc-exp-year"],expirationString:e["cc-exp"]});e["cc-exp-month"]=t.month??"",e["cc-exp-year"]=t.year??"",delete e["cc-exp"]}static#i(e){e["cc-type"]=i.CreditCard.getType(e["cc-number"])??""}}},783:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CreditCardRulesets:()=>ue,default:()=>me});var i=r(716),n=r(564),s=r(494),a=r(377),l=r(359),o=r(877);function d(e){return(0,i.element)(e)}var c={RULES:{"cc-name":void 0,"cc-number":void 0,"cc-exp-month":void 0,"cc-exp-year":void 0,"cc-exp":void 0,"cc-type":void 0},RULE_SETS:[{"cc-name":"account.*holder.*name|^(kredit)?(karten|konto)inhaber|^(name).*karte|nom.*(titulaire|détenteur)|(titulaire|détenteur).*(carte)|titolare.*carta|posiadacz.*karty|nombre.*(titular|tarjeta)|naam.*op.*kaart|cc-?name|card-?name|cardholder-?name|(^nom$)|card.?(?:holder|owner)|name.*(\\b)?on(\\b)?.*card|(?:card|cc).?name|cc.?full.?name|(?:card|cc).?owner|nom.*carte|nome.*cart|名前|Имя.*карты|信用卡开户名|开户名|持卡人姓名|持卡人姓名","cc-number":"(cc|kk)nr|(kredit)?(karten)(nummer|nr)|numero.*carta|(numero|número|numéro).*(carte)|numer.*karty|(número|numero).*tarjeta|kaartnummer|cc-?number|cc-?num|card-?number|card-?num|cc-?no|card-?no|numero-?carte|num-?carte|cb-?num|(add)?(?:card|cc|acct).?(?:number|#|no|num)|カード番号|Номер.*карты|信用卡号|信用卡号码|信用卡卡號|카드","cc-exp":"mm\\s*(/|\\|-)\\s*(yy|jj|aa)|(month|mois)\\s*(/|\\|-|et)\\s*(year|année)|(^cc-?exp$)|(^card-?exp$)|(^cc-?expiration$)|(^card-?expiration$)|(^cc-?ex$)|(^card-?ex$)|(^card-?expire$)|(^card-?expiry$)|(^validite$)|(^expiration$)|(^expiry$)|mm-?yy|mm-?yyyy|yy-?mm|yyyy-?mm|expiration-?date|payment-?card-?expiration|(^payment-?cc-?date$)|expir|exp.*date|^expfield$|ablaufdatum|gueltig|gültig|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты","cc-exp-month":"(cc|kk)month|(^exp-?month$)|(^cc-?exp-?month$)|(^cc-?month$)|(^card-?month$)|(^cc-?mo$)|(^card-?mo$)|(^exp-?mo$)|(^card-?exp-?mo$)|(^cc-?exp-?mo$)|(^card-?expiration-?month$)|(^expiration-?month$)|(^cc-?mm$)|(^cc-?m$)|(^card-?mm$)|(^card-?m$)|(^card-?exp-?mm$)|(^cc-?exp-?mm$)|(^exp-?mm$)|(^exp-?m$)|(^expire-?month$)|(^expire-?mo$)|(^expiry-?month$)|(^expiry-?mo$)|(^card-?expire-?month$)|(^card-?expire-?mo$)|(^card-?expiry-?month$)|(^card-?expiry-?mo$)|(^mois-?validite$)|(^mois-?expiration$)|(^m-?validite$)|(^m-?expiration$)|(^expiry-?date-?field-?month$)|(^expiration-?date-?month$)|(^expiration-?date-?mm$)|(^exp-?mon$)|(^validity-?mo$)|(^exp-?date-?mo$)|(^cb-?date-?mois$)|(^date-?m$)|exp.*mo|ccmonth|cardmonth|addmonth|monat|月","cc-exp-year":"(cc|kk)year|(^exp-?year$)|(^cc-?exp-?year$)|(^cc-?year$)|(^card-?year$)|(^cc-?yr$)|(^card-?yr$)|(^exp-?yr$)|(^card-?exp-?yr$)|(^cc-?exp-?yr$)|(^card-?expiration-?year$)|(^expiration-?year$)|(^cc-?yy$)|(^cc-?y$)|(^card-?yy$)|(^card-?y$)|(^card-?exp-?yy$)|(^cc-?exp-?yy$)|(^exp-?yy$)|(^exp-?y$)|(^cc-?yyyy$)|(^card-?yyyy$)|(^card-?exp-?yyyy$)|(^cc-?exp-?yyyy$)|(^expire-?year$)|(^expire-?yr$)|(^expiry-?year$)|(^expiry-?yr$)|(^card-?expire-?year$)|(^card-?expire-?yr$)|(^card-?expiry-?year$)|(^card-?expiry-?yr$)|(^an-?validite$)|(^an-?expiration$)|(^annee-?validite$)|(^annee-?expiration$)|(^expiry-?date-?field-?year$)|(^expiration-?date-?year$)|(^cb-?date-?ann$)|(^expiration-?date-?yy$)|(^expiration-?date-?yyyy$)|(^validity-?year$)|(^exp-?date-?year$)|(^date-?y$)|(add)?year|jahr|年|有效期","cc-type":"type|Kartenmarke|(^cc-?type$)|(^card-?type$)|(^card-?brand$)|(^cc-?brand$)|(^cb-?type$)"}],_getRule(e){let t=[];this.RULE_SETS.forEach((r=>{r[e]&&t.push(`(${r[e]})`.normalize("NFKC"))}));const r=new RegExp(t.join("|"),"iu");return Object.defineProperty(this.RULES,e,{get:void 0}),Object.defineProperty(this.RULES,e,{value:r}),r},init(){Object.keys(this.RULES).forEach((e=>Object.defineProperty(this.RULES,e,{get:()=>c._getRule(e)})))}};c.init();const u=/^mm$|\(mm\)/i,m=/^(yy|yyyy)$|\(yy\)|\(yyyy\)/i,h=/month/i,f=/year/i,p=/mm\s*(\/|\\)\s*yy/i,y=/visa(-|\s)checkout/i,g=new RegExp(a.CreditCard.getSupportedNetworks().concat(Object.keys(a.NETWORK_NAMES)).join("|"),"gui"),x=/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yy(?:[^y]|$)/i,b=/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yyyy(?:[^y]|$)/i,E=/^dwfrm/i,F=/bml/i,_=/^\{\{.*\}\}$/,C=/first/i,S=/last/i,A=/gift/i,L=/subscription/i;function M(e,t){const r=function(e){return e.getAutocompleteInfo()}(e);return r.fieldName===t}function N(e){const t=l.FormLikeFactory.createFromField(e);return Array.from(t.elements).filter((e=>s.FormAutofillUtils.isCreditCardOrAddressFieldType(e)))}function v(e,t){const r=function(e){const t=N(e),r=t.indexOf(e);return t[r+1]}(e);return!!r&&t(r)}function w(e,t){const r=function(e){const t=N(e),r=t.indexOf(e);return t[r-1]}(e);return!!r&&t(r)}function I(e){return v(e.element,(e=>M(e,"cc-exp-year")))}function R(e){return w(e.element,(e=>M(e,"cc-exp-month")))}function T(e,t){for(const r of[e.id,e.name])if(t.test(r))return!0;return!1}function D(e){return{*[Symbol.iterator](){const t=o.LabelUtils.findLabelElements(e);for(let e of t)yield*o.LabelUtils.extractLabelStrings(e)}}}function $(e,t){const r=D(e);for(const e of r)if(t.test(e))return!0;const i=e.parentElement;return!!i&&("TD"===i.tagName&&i.parentElement?t.test(i.parentElement.textContent):!("DD"!==i.tagName||!i.previousElementSibling)&&t.test(i.previousElementSibling.textContent))}function O(e,t){const r=e.previousElementSibling;if(null!==r&&"LABEL"===r.tagName)return t.test(r.textContent);const i=e.nextElementSibling;return null!==i&&"LABEL"===i.tagName&&t.test(i.textContent)}function U(e,t){const r=e.getAttribute("aria-label");return!!r&&t.test(r)}function k(e,t){const r=e.getAttribute("placeholder");return!!r&&t.test(r)}function P(e,t){return v(e,(e=>T(e,t)))}function z(e,t){return v(e,(e=>$(e,t)))}function j(e,t){return v(e,(e=>k(e,t)))}function H(e,t){return v(e,(e=>U(e,t)))}function G(e,t){return w(e,(e=>T(e,t)))}function V(e,t){return w(e,(e=>$(e,t)))}function B(e,t){return w(e,(e=>k(e,t)))}function Y(e,t){return w(e,(e=>U(e,t)))}function W(e){const t=e.element;if("SELECT"===t.tagName)for(let e of t.querySelectorAll("option"))if(a.CreditCard.getNetworkFromName(e.value)||a.CreditCard.getNetworkFromName(e.text))return!0;return!1}function X(e){const t=e.element,r=t.type;if(r&&"radio"===r){const e=t.value.match(g);if(e)return 1===e.length;const r=D(t);let i=0;for(const e of r){const t=e.match(g);if(t){if(t.length>1)return!1;i++}}if(i>0)return 1===i;const n=t.textContent.match(g);if(n)return 1===n.length}return!1}function K(e,t){return e.some(((r,i)=>t.every(((t,r)=>t===e[i+r]))))}function q(e){if("SELECT"!==e.tagName)return!1;const t=[...e.options],r=Array(12).fill(1).map(((e,t)=>e+t));return!(t.length<12||t.length>13)&&(K(t.map((e=>+e.value)),r)||K(t.map((e=>+e.label)),r))}function J(e){if("SELECT"!==e.tagName)return!1;const t=[...e.options],r=(new Date).getFullYear(),i=Array(3).fill(0).map(((e,t)=>e+r+t));return K(t.map((e=>+e.value)),i)||K(t.map((e=>+e.label)),i)}function Q(e){return v(e.element,J)}function Z(e){return w(e.element,q)}function ee(e,t){const r=e.element;return t(r,x)||t(r,b)}function te(e,t){return e.element.maxLength===t}function re(e){const t=e.element.getAttribute("role");return!!t&&"menu"===t}function ie(e){return T(e.element,E)&&T(e.element,F)}function ne(e){const t=e.element.getAttribute("value");return!!t&&_.test(t)}function se(e){const t=e.element.type;return!!t&&!["text","tel","number"].includes(t)}function ae(e){return T(e.element,C)&&T(e.element,S)}function*le(e,t){for(const[r,n]of Object.entries(t))yield(0,i.rule)((0,i.type)(e),(0,i.score)(n),{name:r})}function oe(e,t){return(0,i.ruleset)([(0,i.rule)(d("input:not([type]), input[type=text], input[type=textbox], input[type=email], input[type=tel], input[type=number], input[type=month], select, button"),(0,i.type)("typicalCandidates")),(0,i.rule)((0,i.type)("typicalCandidates"),(0,i.type)("cc-number")),...le("cc-number",{idOrNameMatchNumberRegExp:e=>T(e.element,c.RULES["cc-number"]),labelsMatchNumberRegExp:e=>$(e.element,c.RULES["cc-number"]),closestLabelMatchesNumberRegExp:e=>O(e.element,c.RULES["cc-number"]),placeholderMatchesNumberRegExp:e=>k(e.element,c.RULES["cc-number"]),ariaLabelMatchesNumberRegExp:e=>U(e.element,c.RULES["cc-number"]),idOrNameMatchGift:e=>T(e.element,A),labelsMatchGift:e=>$(e.element,A),placeholderMatchesGift:e=>k(e.element,A),ariaLabelMatchesGift:e=>U(e.element,A),idOrNameMatchSubscription:e=>T(e.element,L),idOrNameMatchDwfrmAndBml:ie,hasTemplatedValue:ne,inputTypeNotNumbery:se}),(0,i.rule)((0,i.type)("cc-number"),(0,i.out)("cc-number")),(0,i.rule)((0,i.type)("typicalCandidates"),(0,i.type)("cc-name")),...le("cc-name",{idOrNameMatchNameRegExp:e=>T(e.element,c.RULES["cc-name"]),labelsMatchNameRegExp:e=>$(e.element,c.RULES["cc-name"]),closestLabelMatchesNameRegExp:e=>O(e.element,c.RULES["cc-name"]),placeholderMatchesNameRegExp:e=>k(e.element,c.RULES["cc-name"]),ariaLabelMatchesNameRegExp:e=>U(e.element,c.RULES["cc-name"]),idOrNameMatchFirst:e=>T(e.element,C),labelsMatchFirst:e=>$(e.element,C),placeholderMatchesFirst:e=>k(e.element,C),ariaLabelMatchesFirst:e=>U(e.element,C),idOrNameMatchLast:e=>T(e.element,S),labelsMatchLast:e=>$(e.element,S),placeholderMatchesLast:e=>k(e.element,S),ariaLabelMatchesLast:e=>U(e.element,S),idOrNameMatchSubscription:e=>T(e.element,L),idOrNameMatchFirstAndLast:ae,idOrNameMatchDwfrmAndBml:ie,hasTemplatedValue:ne}),(0,i.rule)((0,i.type)("cc-name"),(0,i.out)("cc-name")),(0,i.rule)(d("input:not([type]), input[type=text], input[type=textbox], input[type=email], input[type=tel], input[type=number], input[type=radio], select, button"),(0,i.type)("cc-type")),...le("cc-type",{idOrNameMatchTypeRegExp:e=>T(e.element,c.RULES["cc-type"]),labelsMatchTypeRegExp:e=>$(e.element,c.RULES["cc-type"]),closestLabelMatchesTypeRegExp:e=>O(e.element,c.RULES["cc-type"]),idOrNameMatchVisaCheckout:e=>T(e.element,y),ariaLabelMatchesVisaCheckout:e=>U(e.element,y),isSelectWithCreditCardOptions:W,isRadioWithCreditCardText:X,idOrNameMatchSubscription:e=>T(e.element,L),idOrNameMatchDwfrmAndBml:ie,hasTemplatedValue:ne}),(0,i.rule)((0,i.type)("cc-type"),(0,i.out)("cc-type")),(0,i.rule)((0,i.type)("typicalCandidates"),(0,i.type)("cc-exp")),...le("cc-exp",{labelsMatchExpRegExp:e=>$(e.element,c.RULES["cc-exp"]),closestLabelMatchesExpRegExp:e=>O(e.element,c.RULES["cc-exp"]),placeholderMatchesExpRegExp:e=>k(e.element,c.RULES["cc-exp"]),labelsMatchExpWith2Or4DigitYear:e=>ee(e,$),placeholderMatchesExpWith2Or4DigitYear:e=>ee(e,k),labelsMatchMMYY:e=>$(e.element,p),placeholderMatchesMMYY:e=>k(e.element,p),maxLengthIs7:e=>te(e,7),idOrNameMatchSubscription:e=>T(e.element,L),idOrNameMatchDwfrmAndBml:ie,hasTemplatedValue:ne,isExpirationMonthLikely:e=>q(e.element),isExpirationYearLikely:e=>J(e.element),idOrNameMatchMonth:e=>T(e.element,h),idOrNameMatchYear:e=>T(e.element,f),idOrNameMatchExpMonthRegExp:e=>T(e.element,c.RULES["cc-exp-month"]),idOrNameMatchExpYearRegExp:e=>T(e.element,c.RULES["cc-exp-year"]),idOrNameMatchValidation:e=>T(e.element,/validate|validation/i)}),(0,i.rule)((0,i.type)("cc-exp"),(0,i.out)("cc-exp")),(0,i.rule)((0,i.type)("typicalCandidates"),(0,i.type)("cc-exp-month")),...le("cc-exp-month",{idOrNameMatchExpMonthRegExp:e=>T(e.element,c.RULES["cc-exp-month"]),labelsMatchExpMonthRegExp:e=>$(e.element,c.RULES["cc-exp-month"]),closestLabelMatchesExpMonthRegExp:e=>O(e.element,c.RULES["cc-exp-month"]),placeholderMatchesExpMonthRegExp:e=>k(e.element,c.RULES["cc-exp-month"]),ariaLabelMatchesExpMonthRegExp:e=>U(e.element,c.RULES["cc-exp-month"]),idOrNameMatchMonth:e=>T(e.element,h),labelsMatchMonth:e=>$(e.element,h),placeholderMatchesMonth:e=>k(e.element,h),ariaLabelMatchesMonth:e=>U(e.element,h),nextFieldIdOrNameMatchExpYearRegExp:e=>P(e.element,c.RULES["cc-exp-year"]),nextFieldLabelsMatchExpYearRegExp:e=>z(e.element,c.RULES["cc-exp-year"]),nextFieldPlaceholderMatchExpYearRegExp:e=>j(e.element,c.RULES["cc-exp-year"]),nextFieldAriaLabelMatchExpYearRegExp:e=>H(e.element,c.RULES["cc-exp-year"]),nextFieldIdOrNameMatchYear:e=>P(e.element,f),nextFieldLabelsMatchYear:e=>z(e.element,f),nextFieldPlaceholderMatchesYear:e=>j(e.element,f),nextFieldAriaLabelMatchesYear:e=>H(e.element,f),nextFieldMatchesExpYearAutocomplete:I,isExpirationMonthLikely:e=>q(e.element),nextFieldIsExpirationYearLikely:Q,maxLengthIs2:e=>te(e,2),placeholderMatchesMM:e=>k(e.element,u),roleIsMenu:re,idOrNameMatchSubscription:e=>T(e.element,L),idOrNameMatchDwfrmAndBml:ie,hasTemplatedValue:ne}),(0,i.rule)((0,i.type)("cc-exp-month"),(0,i.out)("cc-exp-month")),(0,i.rule)((0,i.type)("typicalCandidates"),(0,i.type)("cc-exp-year")),...le("cc-exp-year",{idOrNameMatchExpYearRegExp:e=>T(e.element,c.RULES["cc-exp-year"]),labelsMatchExpYearRegExp:e=>$(e.element,c.RULES["cc-exp-year"]),closestLabelMatchesExpYearRegExp:e=>O(e.element,c.RULES["cc-exp-year"]),placeholderMatchesExpYearRegExp:e=>k(e.element,c.RULES["cc-exp-year"]),ariaLabelMatchesExpYearRegExp:e=>U(e.element,c.RULES["cc-exp-year"]),idOrNameMatchYear:e=>T(e.element,f),labelsMatchYear:e=>$(e.element,f),placeholderMatchesYear:e=>k(e.element,f),ariaLabelMatchesYear:e=>U(e.element,f),previousFieldIdOrNameMatchExpMonthRegExp:e=>G(e.element,c.RULES["cc-exp-month"]),previousFieldLabelsMatchExpMonthRegExp:e=>V(e.element,c.RULES["cc-exp-month"]),previousFieldPlaceholderMatchExpMonthRegExp:e=>B(e.element,c.RULES["cc-exp-month"]),previousFieldAriaLabelMatchExpMonthRegExp:e=>Y(e.element,c.RULES["cc-exp-month"]),previousFieldIdOrNameMatchMonth:e=>G(e.element,h),previousFieldLabelsMatchMonth:e=>V(e.element,h),previousFieldPlaceholderMatchesMonth:e=>B(e.element,h),previousFieldAriaLabelMatchesMonth:e=>Y(e.element,h),previousFieldMatchesExpMonthAutocomplete:R,isExpirationYearLikely:e=>J(e.element),previousFieldIsExpirationMonthLikely:Z,placeholderMatchesYYOrYYYY:e=>k(e.element,m),roleIsMenu:re,idOrNameMatchSubscription:e=>T(e.element,L),idOrNameMatchDwfrmAndBml:ie,hasTemplatedValue:ne}),(0,i.rule)((0,i.type)("cc-exp-year"),(0,i.out)("cc-exp-year"))],e,t)}const de={"cc-number":[["idOrNameMatchNumberRegExp",7.679469585418701],["labelsMatchNumberRegExp",5.122580051422119],["closestLabelMatchesNumberRegExp",2.1256935596466064],["placeholderMatchesNumberRegExp",9.471800804138184],["ariaLabelMatchesNumberRegExp",6.067715644836426],["idOrNameMatchGift",-22.946273803710938],["labelsMatchGift",-7.852959632873535],["placeholderMatchesGift",-2.355496406555176],["ariaLabelMatchesGift",-2.940307855606079],["idOrNameMatchSubscription",.11255314946174622],["idOrNameMatchDwfrmAndBml",-.0006645023822784424],["hasTemplatedValue",-.11370040476322174],["inputTypeNotNumbery",-3.750155210494995]],"cc-name":[["idOrNameMatchNameRegExp",7.496212959289551],["labelsMatchNameRegExp",6.081472873687744],["closestLabelMatchesNameRegExp",2.600574254989624],["placeholderMatchesNameRegExp",5.750874042510986],["ariaLabelMatchesNameRegExp",5.162227153778076],["idOrNameMatchFirst",-6.742659091949463],["labelsMatchFirst",-.5234538912773132],["placeholderMatchesFirst",-3.4615235328674316],["ariaLabelMatchesFirst",-1.3145145177841187],["idOrNameMatchLast",-12.561869621276855],["labelsMatchLast",-.27417105436325073],["placeholderMatchesLast",-1.434966802597046],["ariaLabelMatchesLast",-2.9319725036621094],["idOrNameMatchFirstAndLast",24.123435974121094],["idOrNameMatchSubscription",.08349418640136719],["idOrNameMatchDwfrmAndBml",.01882520318031311],["hasTemplatedValue",.182317852973938]],"cc-type":[["idOrNameMatchTypeRegExp",2.0581533908843994],["labelsMatchTypeRegExp",1.0784518718719482],["closestLabelMatchesTypeRegExp",.6995877623558044],["idOrNameMatchVisaCheckout",-3.320356845855713],["ariaLabelMatchesVisaCheckout",-3.4196767807006836],["isSelectWithCreditCardOptions",10.337477684020996],["isRadioWithCreditCardText",4.530318737030029],["idOrNameMatchSubscription",-3.7206356525421143],["idOrNameMatchDwfrmAndBml",-.08782318234443665],["hasTemplatedValue",.1772511601448059]],"cc-exp":[["labelsMatchExpRegExp",7.588159561157227],["closestLabelMatchesExpRegExp",1.41484534740448],["placeholderMatchesExpRegExp",8.759064674377441],["labelsMatchExpWith2Or4DigitYear",-3.876218795776367],["placeholderMatchesExpWith2Or4DigitYear",2.8364884853363037],["labelsMatchMMYY",8.836017608642578],["placeholderMatchesMMYY",-.5231751799583435],["maxLengthIs7",1.3565447330474854],["idOrNameMatchSubscription",.1779913753271103],["idOrNameMatchDwfrmAndBml",.21037884056568146],["hasTemplatedValue",.14900512993335724],["isExpirationMonthLikely",-3.223409652709961],["isExpirationYearLikely",-2.536919593811035],["idOrNameMatchMonth",-3.6893014907836914],["idOrNameMatchYear",-3.108184337615967],["idOrNameMatchExpMonthRegExp",-2.264357089996338],["idOrNameMatchExpYearRegExp",-2.7957723140716553],["idOrNameMatchValidation",-2.29402756690979]],"cc-exp-month":[["idOrNameMatchExpMonthRegExp",.2787344455718994],["labelsMatchExpMonthRegExp",1.298413634300232],["closestLabelMatchesExpMonthRegExp",-11.206244468688965],["placeholderMatchesExpMonthRegExp",1.2605619430541992],["ariaLabelMatchesExpMonthRegExp",1.1330018043518066],["idOrNameMatchMonth",6.1464314460754395],["labelsMatchMonth",.7051732540130615],["placeholderMatchesMonth",.7463492751121521],["ariaLabelMatchesMonth",1.8244760036468506],["nextFieldIdOrNameMatchExpYearRegExp",.06347066164016724],["nextFieldLabelsMatchExpYearRegExp",-.1692247837781906],["nextFieldPlaceholderMatchExpYearRegExp",1.0434566736221313],["nextFieldAriaLabelMatchExpYearRegExp",1.751156210899353],["nextFieldIdOrNameMatchYear",-.532447338104248],["nextFieldLabelsMatchYear",1.3248541355133057],["nextFieldPlaceholderMatchesYear",.604235827922821],["nextFieldAriaLabelMatchesYear",1.5364223718643188],["nextFieldMatchesExpYearAutocomplete",6.285938262939453],["isExpirationMonthLikely",13.117807388305664],["nextFieldIsExpirationYearLikely",7.182341575622559],["maxLengthIs2",4.477289199829102],["placeholderMatchesMM",14.403288841247559],["roleIsMenu",5.770959854125977],["idOrNameMatchSubscription",-.043085768818855286],["idOrNameMatchDwfrmAndBml",.02823038399219513],["hasTemplatedValue",.07234494388103485]],"cc-exp-year":[["idOrNameMatchExpYearRegExp",5.426016807556152],["labelsMatchExpYearRegExp",1.3240209817886353],["closestLabelMatchesExpYearRegExp",-8.702284812927246],["placeholderMatchesExpYearRegExp",.9059725999832153],["ariaLabelMatchesExpYearRegExp",.5550334453582764],["idOrNameMatchYear",5.362994194030762],["labelsMatchYear",2.7185044288635254],["placeholderMatchesYear",.7883157134056091],["ariaLabelMatchesYear",.311492383480072],["previousFieldIdOrNameMatchExpMonthRegExp",1.8155208826065063],["previousFieldLabelsMatchExpMonthRegExp",-.46133187413215637],["previousFieldPlaceholderMatchExpMonthRegExp",1.0374903678894043],["previousFieldAriaLabelMatchExpMonthRegExp",-.5901495814323425],["previousFieldIdOrNameMatchMonth",-5.960310935974121],["previousFieldLabelsMatchMonth",.6495584845542908],["previousFieldPlaceholderMatchesMonth",.7198042273521423],["previousFieldAriaLabelMatchesMonth",3.4590985774993896],["previousFieldMatchesExpMonthAutocomplete",2.986003875732422],["isExpirationYearLikely",4.021566390991211],["previousFieldIsExpirationMonthLikely",9.298635482788086],["placeholderMatchesYYOrYYYY",10.457176208496094],["roleIsMenu",1.1051956415176392],["idOrNameMatchSubscription",.000688597559928894],["idOrNameMatchDwfrmAndBml",.15687309205532074],["hasTemplatedValue",-.19141331315040588]]},ce=[["cc-number",-4.948795795440674],["cc-name",-5.3578081130981445],["cc-type",-5.979659557342529],["cc-exp",-5.849575996398926],["cc-exp-month",-8.844199180603027],["cc-exp-year",-6.499860763549805]];var ue={init(){n.XPCOMUtils.defineLazyPreferenceGetter(this,"supportedTypes","extensions.formautofill.creditCards.heuristics.fathom.types",null,null,(e=>e.split(",")));for(const e of this.types)this[e]=oe([...de[e]],ce)},get types(){return this.supportedTypes}};ue.init();const me=ue},173:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FieldDetail:()=>i,FieldScanner:()=>n,default:()=>s});class i{elementWeakRef=null;identifier="";fieldName=null;reason=null;section="";addressType="";contactType="";part=null;confidence=null;constructor(e,t=null,{autocompleteInfo:r={},confidence:i=null}={}){this.elementWeakRef=new WeakRef(e),this.identifier=`${e.id}/${e.name}`,this.fieldName=t,r?(this.reason="autocomplete",this.section=r.section,this.addressType=r.addressType,this.contactType=r.contactType):i?(this.reason="fathom",this.confidence=i):this.reason="regex-heuristic"}get element(){return this.elementWeakRef.deref()}get sectionName(){return this.section||this.addressType}}class n{#n=null;#s=null;#a=0;fieldDetails=[];constructor(e,t){this.#n=new WeakRef(e),this.#s=t}get#l(){return this.#n.deref()}get parsingIndex(){return this.#a}get parsingFinished(){return this.parsingIndex>=this.#l.length}set parsingIndex(e){if(e>this.#l.length)throw new Error("The parsing index is out of range.");this.#a=e}getFieldDetailByIndex(e){if(e>=this.#l.length)return null;if(e<this.fieldDetails.length)return this.fieldDetails[e];for(let t=this.fieldDetails.length;t<e+1;t++)this.pushDetail();return this.fieldDetails[e]}pushDetail(){const e=this.fieldDetails.length;if(e>=this.#l.length)throw new Error("Try to push the non-existing element info.");const t=this.#l[e],[r,n,s]=this.#s(t),a=new i(t,r,{autocompleteInfo:n,confidence:s});this.fieldDetails.push(a)}updateFieldName(e,t,r=!1){if(e>=this.fieldDetails.length)throw new Error("Try to update the non-existing field detail.");const i=this.fieldDetails[e];i.fieldName!=t&&(r||"autocomplete"!=i.reason)&&(this.fieldDetails[e].fieldName=t,this.fieldDetails[e].reason="update-heuristic")}elementExisting(e){return e<this.#l.length}}const s=n},394:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofill:()=>i.FormAutofill,default:()=>n});var i=r(116);i.FormAutofill.defineLogGetter=(e,t)=>({info:()=>{},error:()=>{},warn:()=>{},debug:()=>{}});const n=i.FormAutofill},116:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofill:()=>c});var i=r(564);const n="extensions.formautofill.addresses.enabled",s="extensions.formautofill.addresses.capture.enabled",a="extensions.formautofill.addresses.capture.v2.enabled",l="extensions.formautofill.creditCards.enabled",o="extensions.formautofill.creditCards.ignoreAutocompleteOff",d="extensions.formautofill.addresses.ignoreAutocompleteOff",c={ENABLED_AUTOFILL_ADDRESSES_PREF:n,ENABLED_AUTOFILL_ADDRESSES_CAPTURE_PREF:s,ENABLED_AUTOFILL_ADDRESSES_CAPTURE_V2_PREF:a,ENABLED_AUTOFILL_CREDITCARDS_PREF:l,ENABLED_AUTOFILL_CREDITCARDS_REAUTH_PREF:"extensions.formautofill.reauth.enabled",AUTOFILL_CREDITCARDS_AUTOCOMPLETE_OFF_PREF:o,AUTOFILL_ADDRESSES_AUTOCOMPLETE_OFF_PREF:d,_region:null,get DEFAULT_REGION(){return this._region||i.Region.home||"US"},set DEFAULT_REGION(e){this._region=e},_isSupportedRegion:(e,t)=>"on"==e||"detect"==e&&!(!c.supportRTL&&Services.locale.isAppLocaleRTL)&&t.includes(c.browserSearchRegion),isAutofillAddressesAvailableInCountry:e=>c._addressAutofillSupportedCountries.includes(e),get isAutofillEnabled(){return this.isAutofillAddressesEnabled||this.isAutofillCreditCardsEnabled},get isAutofillCreditCardsAvailable(){return this._isSupportedRegion(c._isAutofillCreditCardsAvailable,c._creditCardAutofillSupportedCountries)},get isAutofillAddressesAvailable(){return this._isSupportedRegion(c._isAutofillAddressesAvailable,c._addressAutofillSupportedCountries)},get isAutofillCreditCardsEnabled(){return this.isAutofillCreditCardsAvailable&&c._isAutofillCreditCardsEnabled},get isAutofillCreditCardsLocked(){return Services.prefs.prefIsLocked(l)},get isAutofillAddressesEnabled(){return this.isAutofillAddressesAvailable&&c._isAutofillAddressesEnabled},get isAutofillAddressesLocked(){return Services.prefs.prefIsLocked(n)},defineLogGetter(e,t){e.debug=function(){"debug"==c.logLevel.toLowerCase()&&this.log.debug(...arguments)};let{ConsoleAPI:r}=ChromeUtils.importESModule("resource://gre/modules/Console.sys.mjs");return new r({maxLogLevelPref:"extensions.formautofill.loglevel",prefix:t})}};i.XPCOMUtils.defineLazyPreferenceGetter(c,"browserSearchRegion","browser.search.region",c.DEFAULT_REGION),i.XPCOMUtils.defineLazyPreferenceGetter(c,"logLevel","extensions.formautofill.loglevel","Warn"),i.XPCOMUtils.defineLazyPreferenceGetter(c,"_isAutofillAddressesAvailable","extensions.formautofill.addresses.supported"),i.XPCOMUtils.defineLazyPreferenceGetter(c,"_isAutofillAddressesEnabled",n),i.XPCOMUtils.defineLazyPreferenceGetter(c,"isAutofillAddressesCaptureEnabled",s),i.XPCOMUtils.defineLazyPreferenceGetter(c,"isAutofillAddressesCaptureV2Enabled",a),i.XPCOMUtils.defineLazyPreferenceGetter(c,"_isAutofillCreditCardsAvailable","extensions.formautofill.creditCards.supported"),i.XPCOMUtils.defineLazyPreferenceGetter(c,"_isAutofillCreditCardsEnabled",l),i.XPCOMUtils.defineLazyPreferenceGetter(c,"isAutofillCreditCardsHideUI","extensions.formautofill.creditCards.hideui"),i.XPCOMUtils.defineLazyPreferenceGetter(c,"_addressAutofillSupportedCountries","extensions.formautofill.addresses.supportedCountries",null,(e=>e.split(","))),i.XPCOMUtils.defineLazyPreferenceGetter(c,"_creditCardAutofillSupportedCountries","extensions.formautofill.creditCards.supportedCountries",null,null,(e=>e.split(","))),i.XPCOMUtils.defineLazyPreferenceGetter(c,"supportRTL","extensions.formautofill.supportRTL"),i.XPCOMUtils.defineLazyPreferenceGetter(c,"creditCardsAutocompleteOff",o),i.XPCOMUtils.defineLazyPreferenceGetter(c,"addressesAutocompleteOff",d),ChromeUtils.defineLazyGetter(c,"countries",(()=>{let e=Services.intl.getAvailableLocaleDisplayNames("region"),t=Services.intl.getRegionDisplayNames(void 0,e),r=new Map;for(let i=0;i<e.length;i++)r.set(e[i].toUpperCase(),t[i]);return r}))},233:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillChild:()=>a,default:()=>l});var i=r(494),n=r(498),s=r(121);class a{constructor(e){this.onFocusIn=this.onFocusIn.bind(this),this.onSubmit=this.onSubmit.bind(this),this.callbacks=e,this.fieldDetailsManager=new n.FormStateManager,document.addEventListener("focusin",this.onFocusIn),document.addEventListener("submit",this.onSubmit)}_doIdentifyAutofillFields(e){this.fieldDetailsManager.updateActiveInput(e);const t=this.fieldDetailsManager.identifyAutofillFields(e),r=this.fieldDetailsManager.activeFieldDetail?.fieldName;if(!t?.find((t=>t.element===e)))return;const n=this.transformToFieldNamesWithValues(t);i.FormAutofillUtils.isAddressField(r)?this.callbacks.address.autofill(n):i.FormAutofillUtils.isCreditCardField(r)&&(s.CreditCardRecord.normalizeFields(n),this.callbacks.creditCard.autofill(n))}transformToFieldNamesWithValues(e){return e?.reduce(((e,t)=>({...e,[t.fieldName]:t.element.value})),{})}onFocusIn(e){const t=e.target;this.fieldDetailsManager.updateActiveInput(t),i.FormAutofillUtils.isCreditCardOrAddressFieldType(t)&&this._doIdentifyAutofillFields(t)}onSubmit(e){this.fieldDetailsManager.activeHandler.onFormSubmitted();const t=this.fieldDetailsManager.activeHandler.createRecords();if(t.creditCard){const e=t.creditCard.map((e=>(s.CreditCardRecord.normalizeFields(e.record),e.record)));this.callbacks.creditCard.submit(e)}}fillFormFields(e){this.fieldDetailsManager.activeHandler.autofillFormFields(e)}}const l=a},675:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillExtras:()=>i,default:()=>n});class i{isFocusable(e){let t=window.getComputedStyle(e);return!("hidden"===e.type||null===e.offsetParent||"hidden"===t.visibility||"none"===t.display||"0"===t.opacity||e.hasAttribute("hidden"))}focusNextInputField(){let e=[...document.getElementsByTagName("input")];e=e.filter(this.isFocusable);const t=document.activeElement,r=e.indexOf(t);r<e.length-1&&e[r+1].focus()}focusPreviousInputField(){let e=[...document.getElementsByTagName("input")];e=e.filter(this.isFocusable);const t=document.activeElement,r=e.indexOf(t);r>0&&e[r-1].focus()}}const n=i},81:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillHandler:()=>l});var i=r(394),n=r(494);const s={};ChromeUtils.defineESModuleGetters(s,{FormAutofillAddressSection:"resource://gre/modules/shared/FormAutofillSection.sys.mjs",FormAutofillCreditCardSection:"resource://gre/modules/shared/FormAutofillSection.sys.mjs",FormAutofillHeuristics:"resource://gre/modules/shared/FormAutofillHeuristics.sys.mjs",FormLikeFactory:"resource://gre/modules/FormLikeFactory.sys.mjs",FormSection:"resource://gre/modules/shared/FormAutofillHeuristics.sys.mjs"});const{FIELD_STATES:a}=n.FormAutofillUtils;class l{window=null;winUtils=null;form=null;sections=[];#o=null;#d=new WeakMap;#c=new WeakMap;fieldDetails=null;constructor(e,t=(()=>{}),r=(()=>{})){this._updateForm(e),this.window=this.form.rootElement.ownerGlobal,this.winUtils=this.window.windowUtils,this.FIELD_STATE_ENUM={[a.NORMAL]:null,[a.AUTO_FILLED]:"autofill",[a.PREVIEW]:"-moz-autofill-preview"},this.onFormSubmitted=()=>{t(this.form,this.window,this)},this.onAutofillCallback=r,ChromeUtils.defineLazyGetter(this,"log",(()=>i.FormAutofill.defineLogGetter(this,"FormAutofillHandler")))}handleEvent(e){if("input"===e.type){if(!e.isTrusted)return;const t=e.target,r=this.getFieldDetailByElement(t),i=n.FormAutofillUtils.isCreditCardField(r.fieldName);if(!HTMLSelectElement.isInstance(t)&&i&&""===t.value&&this.onAutofillCallback(),this.getFilledStateByElement(t)==a.NORMAL)return;this.changeFieldState(r,a.NORMAL),this.getSectionByElement(r.element)?.clearFilled(r)}}set focusedInput(e){const t=this.getSectionByElement(e);t&&(this.#o=t,this.#o.focusedInput=e)}getSectionByElement(e){const t=this.#d.get(e)??this.sections.find((t=>t.getFieldDetailByElement(e)));return t?(this.#d.set(e,t),t):null}getFieldDetailByElement(e){for(const t of this.sections){const r=t.getFieldDetailByElement(e);if(r)return r}return null}get activeSection(){return this.#o}updateFormIfNeeded(e){let t;const r=()=>(t||(t=s.FormLikeFactory.createFromField(e)),t);return(e.form??r()).elements.length!=this.form.elements.length?(this.log.debug("The count of form elements is changed."),this._updateForm(r()),!0):!this.form.elements.includes(e)&&(this.log.debug("The element can not be found in the current form."),this._updateForm(r()),!0)}_updateForm(e){this.form=e,this.fieldDetails=null,this.sections=[],this.#d=new WeakMap}collectFormFields(e=!0){const t=s.FormAutofillHeuristics.getFormInfo(this.form),r=[];for(const i of t){const t=i.fieldDetails.filter((e=>!["cc-csc"].includes(e.fieldName)));if(!t.length)continue;let n;n=i.type==s.FormSection.ADDRESS?new s.FormAutofillAddressSection(t,this):new s.FormAutofillCreditCardSection(t,this),!n.isEnabled()||e&&!n.isValidSection()||(this.sections.push(n),r.push(...n.fieldDetails))}return this.fieldDetails=r,r}#u(){return this.sections.some((e=>e.isFilled()))}getFilledStateByElement(e){return this.#c.get(e)}changeFieldState(e,t){const r=e.element;if(!r)return void this.log.warn(e.fieldName,"is unreachable while changing state");if(!(t in this.FIELD_STATE_ENUM))return void this.log.warn(e.fieldName,"is trying to change to an invalid state");if(this.#c.get(r)==t)return;let i=null;for(const[e,n]of Object.entries(this.FIELD_STATE_ENUM))n&&(e==t?i=n:this.winUtils.removeManuallyManagedState(r,n));i&&this.winUtils.addManuallyManagedState(r,i),t==a.AUTO_FILLED&&r.addEventListener("input",this,{mozSystemGroup:!0}),this.#c.set(r,t)}async autofillFormFields(e){const t=!this.#u();await this.activeSection.autofillFields(e);const r=e=>{e.isTrusted&&("reset"==e.type&&this.sections.map((e=>e.resetFieldStates())),this.#u()||(this.form.rootElement.removeEventListener("input",r,{mozSystemGroup:!0}),this.form.rootElement.removeEventListener("reset",r,{mozSystemGroup:!0})))};t&&(this.log.debug("register change handler for filled form:",this.form),this.form.rootElement.addEventListener("input",r,{mozSystemGroup:!0}),this.form.rootElement.addEventListener("reset",r,{mozSystemGroup:!0}))}createRecords(){const e={address:[],creditCard:[]};for(const t of this.sections){const r=t.createRecord();if(r)if(t instanceof s.FormAutofillAddressSection)e.address.push(r);else{if(!(t instanceof s.FormAutofillCreditCardSection))throw new Error("Unknown section type");e.creditCard.push(r)}}return e}}},588:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillHeuristics:()=>d,FormSection:()=>o,default:()=>c});var i=r(394),n=r(697);const s={};ChromeUtils.defineESModuleGetters(s,{CreditCard:"resource://gre/modules/CreditCard.sys.mjs",CreditCardRulesets:"resource://gre/modules/shared/CreditCardRuleset.sys.mjs",FieldScanner:"resource://gre/modules/shared/FieldScanner.sys.mjs",FormAutofillUtils:"resource://gre/modules/shared/FormAutofillUtils.sys.mjs",LabelUtils:"resource://gre/modules/shared/LabelUtils.sys.mjs"}),ChromeUtils.defineLazyGetter(s,"log",(()=>i.FormAutofill.defineLogGetter(s,"FormAutofillHeuristics")));const a=["address-level3","address-level2","address-level1","tel","postal-code","email","street-address"],l={"cc-number":4};class o{static ADDRESS="address";static CREDIT_CARD="creditCard";#m=[];#h="";constructor(e){if(!e.length)throw new TypeError("A section should contain at least one field");e.forEach((e=>this.addField(e)));const t=e[0].fieldName;if(s.FormAutofillUtils.isAddressField(t))this.type=o.ADDRESS;else{if(!s.FormAutofillUtils.isCreditCardField(t))throw new Error("Unknown field type to create a section.");this.type=o.CREDIT_CARD}}get fieldDetails(){return this.#m}get name(){return this.#h}addField(e){this.#h||=e.sectionName,this.#m.push(e)}}const d={RULES:n.HeuristicsRegExp.getRules(),LABEL_RULES:n.HeuristicsRegExp.getLabelRules(),CREDIT_CARD_FIELDNAMES:[],ADDRESS_FIELDNAMES:[],_matchContiguousSubArray:(e,t)=>e.some(((r,i)=>t.every(((t,r)=>t==e[i+r])))),_isExpirationMonthLikely(e){if(!HTMLSelectElement.isInstance(e))return!1;const t=[...e.options],r=Array(12).fill(1).map(((e,t)=>e+t));return!(t.length<12||t.length>13)&&(this._matchContiguousSubArray(t.map((e=>+e.value)),r)||this._matchContiguousSubArray(t.map((e=>+e.label)),r))},_isExpirationYearLikely(e){if(!HTMLSelectElement.isInstance(e))return!1;const t=[...e.options],r=(new Date).getFullYear(),i=Array(3).fill(0).map(((e,t)=>e+r+t));return this._matchContiguousSubArray(t.map((e=>+e.value)),i)||this._matchContiguousSubArray(t.map((e=>+e.label)),i)},_parsePhoneFields(e,t){let r;const i=this.PHONE_FIELD_GRAMMARS;function n(e){return!i[e][0]}const a=e.parsingIndex;for(let t=0;t<i.length;){const s=e.parsingIndex;let a=t;for(let t=0;a<i.length&&!n(a)&&e.elementExisting(s+t);a++,t++){const[r,,n]=i[a],l=e.getFieldDetailByIndex(s+t);if(!l||l.fieldName!=r||"autocomplete"==l.reason)break;const o=l.element;if(n&&(!o.maxLength||n<o.maxLength))break}if(n(a)){r={ruleFrom:t,ruleTo:a};break}for(;t<i.length&&!n(t++););}if(r){const{ruleFrom:t,ruleTo:n}=r;for(let r=t;r<n;r++)e.updateFieldName(e.parsingIndex,i[r][1]),e.parsingIndex++}const l=e.getFieldDetailByIndex(e.parsingIndex);if(l&&"autocomplete"!=l.reason){const t=e.getFieldDetailByIndex(e.parsingIndex-1);if(t&&"tel"==s.FormAutofillUtils.getCategoryFromFieldName(t.fieldName)){const t=new RegExp("\\bext|ext\\b|extension|ramal","iug");this._matchRegexp(l.element,t)&&(e.updateFieldName(e.parsingIndex,"tel-extension"),e.parsingIndex++)}}return a!=e.parsingIndex},_parseStreetAddressFields(e,t){const r=["street-address","address-line1","address-line2","address-line3"],i=[];for(let t=e.parsingIndex;!e.parsingFinished;t++){const n=e.getFieldDetailByIndex(t);if(!r.includes(n?.fieldName))break;i.push(n)}if(!i.length)return!1;switch(i.length){case 1:"autocomplete"!=i[0].reason&&["address-line2","address-line3"].includes(i[0].fieldName)&&e.updateFieldName(e.parsingIndex,"address-line1");break;case 2:"autocomplete"==i[0].reason?"street-address"!=i[0].fieldName||"address-line2"!=i[1].fieldName&&"autocomplete"==i[1].reason||e.updateFieldName(e.parsingIndex,"address-line1",!0):e.updateFieldName(e.parsingIndex,"address-line1"),e.updateFieldName(e.parsingIndex+1,"address-line2");break;default:e.updateFieldName(e.parsingIndex,"address-line1"),e.updateFieldName(e.parsingIndex+1,"address-line2"),e.updateFieldName(e.parsingIndex+2,"address-line3")}return e.parsingIndex+=i.length,!0},_parseAddressFields(e,t){const r=["address-level1","address-level2"];if(!r.includes(t.fieldName))return!1;const i=[];for(let t=e.parsingIndex;!e.parsingFinished;t++){const n=e.getFieldDetailByIndex(t);if(!r.includes(n?.fieldName))break;i.push(n)}if(!i.length)return!1;if(1==i.length&&"address-level2"==i[0].fieldName){const t=e.getFieldDetailByIndex(e.parsingIndex-1);if(t&&!t.fieldName&&HTMLSelectElement.isInstance(t.element))return e.updateFieldName(e.parsingIndex-1,"address-level1"),e.parsingIndex+=1,!0;const r=e.getFieldDetailByIndex(e.parsingIndex+1);if(r&&!r.fieldName&&HTMLSelectElement.isInstance(r.element))return e.updateFieldName(e.parsingIndex+1,"address-level1"),e.parsingIndex+=2,!0}return e.parsingIndex+=i.length,!0},_parseCreditCardExpiryFields(e,t){const r=["cc-exp","cc-exp-month","cc-exp-year"];if(!r.includes(t.fieldName))return!1;const i=[];for(let t=e.parsingIndex;;t++){const n=e.getFieldDetailByIndex(t);if(!r.includes(n?.fieldName))break;i.push(n)}if(1==i.length&&"cc-exp"==i[0].fieldName||2==i.length&&"cc-exp-month"==i[0].fieldName&&"cc-exp-year"==i[1].fieldName)return e.parsingIndex+=i.length,!0;const n=new Set;for(let t=e.parsingIndex-1;;t--){const r=e.getFieldDetailByIndex(t);if("creditCard"!=s.FormAutofillUtils.getCategoryFromFieldName(r?.fieldName))break;n.add(r.fieldName)}if(["cc-number","cc-name"].some((e=>n.has(e)))&&!["cc-exp","cc-exp-month","cc-exp-year"].some((e=>n.has(e))))return 1==i.length?e.updateFieldName(e.parsingIndex,"cc-exp"):2==i.length&&(e.updateFieldName(e.parsingIndex,"cc-exp-month"),e.updateFieldName(e.parsingIndex+1,"cc-exp-year")),e.parsingIndex+=i.length,!0;for(let t=0;t<i.length;t++)e.updateFieldName(e.parsingIndex+t,null);return!1},_parseCreditCardNameFields(e,t){const r=["name","given-name","additional-name","family-name"];if(!r.includes(t.fieldName))return!1;const i=[];for(let t=e.parsingIndex;;t++){const n=e.getFieldDetailByIndex(t);if(!r.includes(n?.fieldName))break;i.push(n)}const n=new Set;for(let t=e.parsingIndex-1;;t--){const r=e.getFieldDetailByIndex(t);if("creditCard"!=s.FormAutofillUtils.getCategoryFromFieldName(r?.fieldName))break;n.add(r.fieldName)}if(["cc-number"].some((e=>n.has(e)))&&!["cc-name","cc-given-name","cc-family-name","cc-csc"].some((e=>n.has(e)))){if(1==i.length)e.updateFieldName(e.parsingIndex,"cc-name"),e.parsingIndex+=1;else for(const t of i)e.updateFieldName(e.parsingIndex,`cc-${t.fieldName}`),e.parsingIndex+=1;return!0}return!1},getFormInfo(e){let t=this.getFormElements(e);const r=new s.FieldScanner(t,(e=>this.inferFieldInfo(e,t)));for(;!r.parsingFinished;){const e=r.parsingIndex,t=r.getFieldDetailByIndex(r.parsingIndex);this._parsePhoneFields(r,t)||this._parseStreetAddressFields(r,t)||this._parseAddressFields(r,t)||this._parseCreditCardExpiryFields(r,t)||this._parseCreditCardNameFields(r,t)||e==r.parsingIndex&&r.parsingIndex++}s.LabelUtils.clearLabelMap();const i=r.fieldDetails;return[...this._classifySections(i.filter((e=>s.FormAutofillUtils.isAddressField(e.fieldName)))),...this._classifySections(i.filter((e=>s.FormAutofillUtils.isCreditCardField(e.fieldName))))].sort(((e,t)=>i.indexOf(e.fieldDetails[0])-i.indexOf(t.fieldDetails[0])))},getFormElements(e){let t=Array.from(e.elements).filter((e=>s.FormAutofillUtils.isCreditCardOrAddressFieldType(e)));const r=s.FormAutofillUtils.interactivityCheckMode;if("focusability"==r)t=t.filter((e=>s.FormAutofillUtils.isFieldFocusable(e)));else if("visibility"==r){const e=t.length<s.FormAutofillUtils.visibilityCheckThreshold;e||s.log.debug(`Skip running visibility check, because of too many elements (${t.length})`),t=t.filter((t=>s.FormAutofillUtils.isFieldVisible(t,e)))}return t},_classifySections(e){let t=[];for(let r=0;r<e.length;r++){const i=e[r].fieldName,n=e[r].sectionName,[s]=t.slice(-1);let d=null;if(s&&n){if(n)for(let e=t.length-1;e>=0;e--)if(!t[e].name||t[e].name==n){d=t[e];break}}else d=s;if(d){let t=!0;if(d.fieldDetails.find((e=>e.fieldName==i))){const[n]=d.fieldDetails.slice(-1);if(n.fieldName==i)if(a.includes(i))t=!1;else if(i in l){const s=l[i];n.part?n.part<s&&(t=!1,e[r].part=n.part+1):(2==s||e.slice(r+1,r+s-1).every((e=>e.fieldName==i)))&&(n.part=1,e[r].part=2,t=!1)}}else t=!1;if(!t){d.addField(e[r]);continue}}t.push(new o([e[r]]))}return t},_getPossibleFieldNames(e){let t=[];const r="off"==e.autocomplete||"off"==e.form?.autocomplete;if(r&&!i.FormAutofill.creditCardsAutocompleteOff||t.push(...this.CREDIT_CARD_FIELDNAMES),r&&!i.FormAutofill.addressesAutocompleteOff||t.push(...this.ADDRESS_FIELDNAMES),HTMLSelectElement.isInstance(e)){const e=["address-level1","address-level2","country","cc-exp-month","cc-exp-year","cc-exp","cc-type"];t=t.filter((t=>e.includes(t)))}return t},inferFieldInfo(e,t=[]){const r=e.getAutocompleteInfo();if(r?.fieldName&&!["on","off"].includes(r.fieldName))return[r.fieldName,r,null];const n=this._getPossibleFieldNames(e);if("email"==e.type&&n.includes("email"))return["email",null,null];if(s.FormAutofillUtils.isFathomCreditCardsEnabled()){const r=n.filter((e=>s.CreditCardRulesets.types.includes(e))),[i,a]=this.getFathomField(e,r,t);if(i)return[i,null,a]}if(HTMLSelectElement.isInstance(e)){if(this._isExpirationMonthLikely(e))return["cc-exp-month",null,null];if(this._isExpirationYearLikely(e))return["cc-exp-year",null,null];const t=Array.from(e.querySelectorAll("option"));if(t.find((e=>s.CreditCard.getNetworkFromName(e.value)||s.CreditCard.getNetworkFromName(e.text))))return["cc-type",null,null];const r=Array.from(i.FormAutofill.countries.values());if(t.length>=2&&t.slice(0,2).every((e=>r.includes(e.value)||r.includes(e.text))))return["country",null,null]}return[this._findMatchedFieldName(e,n),null,null]},getFathomField(e,t,r=[]){if(!t.length)return[null,null];if(!this._fathomConfidences?.get(e)){this._fathomConfidences=new Map,r=r.includes(e)?r:[e];const t=this.getFormAutofillConfidences(r);for(let e=0;e<r.length;e++)this._fathomConfidences.set(r[e],t[e])}const i=this._fathomConfidences.get(e);if(!i)return[null,null];let n=null,a=s.FormAutofillUtils.ccFathomConfidenceThreshold;for(let[e,r]of Object.entries(i))t.includes(e)&&r>a&&(a=r,n=e);return n?(s.FormAutofillUtils.ccFathomTestConfidence>0&&(a=s.FormAutofillUtils.ccFathomTestConfidence),[n,a]):[null,null]},getFormAutofillConfidences:e=>s.FormAutofillUtils.ccHeuristicsMode==s.FormAutofillUtils.CC_FATHOM_NATIVE?ChromeUtils.getFormAutofillConfidences(e).map((e=>{let t={};for(let[r,i]of Object.entries(e))t[s.FormAutofillUtils.formAutofillConfidencesKeyToCCFieldType(r)]=i;return t})):e.map((e=>{const t={};return s.CreditCardRulesets.types.map((r=>{t[r]=function(t){const r=s.CreditCardRulesets[t].against(e).get(t);return r.length?r[0].scoreFor(t):0}(r)})),t})),_getElementStrings:e=>[e.id,e.name,e.placeholder?.trim()],_getElementLabelStrings:e=>({*[Symbol.iterator](){const t=s.LabelUtils.findLabelElements(e);for(let e of t)yield*s.LabelUtils.extractLabelStrings(e);const r=e.getAttribute("aria-label");r&&(yield*[r])}}),testRegex(e,t){const r=t?.matchAll(e);if(!r)return!1;const i=[];for(const e of r)i.push(...e.filter((t=>t!==e?.groups?.neg)).filter(Boolean));return i?.length>0},_findMatchedFieldName(e,t){if(!t.length)return null;let r=t.find((t=>this._matchRegexp(e,this.RULES[t])));return r||(r=t.find((t=>{const r=this.LABEL_RULES[t];return this._matchRegexp(e,r,{attribute:!1})}))),r},_matchRegexp(e,t,{attribute:r=!0,label:i=!0}={}){if(!t)return!1;if(r&&this._getElementStrings(e).find((e=>this.testRegex(t,e?.toLowerCase()))))return!0;if(i){const r=this._getElementLabelStrings(e);for(const e of r)if(this.testRegex(t,e?.toLowerCase()))return!0}return!1},PHONE_FIELD_GRAMMARS:[["tel","tel-country-code",3],["tel","tel-area-code",3],["tel","tel-local-prefix",3],["tel","tel-local-suffix",4],[null,null,0],["tel","tel-area-code",0],["tel","tel-local-prefix",3],["tel","tel-local-suffix",4],[null,null,0]]};ChromeUtils.defineLazyGetter(d,"CREDIT_CARD_FIELDNAMES",(()=>Object.keys(d.RULES).filter((e=>s.FormAutofillUtils.isCreditCardField(e))))),ChromeUtils.defineLazyGetter(d,"ADDRESS_FIELDNAMES",(()=>Object.keys(d.RULES).filter((e=>s.FormAutofillUtils.isAddressField(e)))));const c=d},54:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillNameUtils:()=>i});var i={NAME_PREFIXES:["1lt","1st","2lt","2nd","3rd","admiral","capt","captain","col","cpt","dr","gen","general","lcdr","lt","ltc","ltg","ltjg","maj","major","mg","mr","mrs","ms","pastor","prof","rep","reverend","rev","sen","st"],NAME_SUFFIXES:["b.a","ba","d.d.s","dds","i","ii","iii","iv","ix","jr","m.a","m.d","ma","md","ms","ph.d","phd","sr","v","vi","vii","viii","x"],FAMILY_NAME_PREFIXES:["d'","de","del","der","di","la","le","mc","san","st","ter","van","von"],COMMON_CJK_MULTI_CHAR_SURNAMES:["남궁","사공","서문","선우","제갈","황보","독고","망절","欧阳","令狐","皇甫","上官","司徒","诸葛","司马","宇文","呼延","端木","張簡","歐陽","諸葛","申屠","尉遲","司馬","軒轅","夏侯"],KOREAN_MULTI_CHAR_SURNAMES:["강전","남궁","독고","동방","망절","사공","서문","선우","소봉","어금","장곡","제갈","황목","황보"],WHITESPACE:["\t","\n","\v","\f","\r"," ",""," "," "," "," "," "," "," "," "," "," "," "," "," ","\u2028","\u2029"," "," ","　"],MIDDLE_DOT:["・","·"],CJK_RANGE:["ᄀ-ᇿ","぀-ゟ","゠-ヿ","ㄅ-ㄬ","㄰-㆏","ㇰ-ㇿ","㈀-㋿","㐀-䶿","一-鿿","ꥠ-꥿","가-힯","ힰ-퟿","＀-￯"],HANGUL_RANGE:["ᄀ-ᇿ","㄰-㆏","ꥠ-꥿","가-힯","ힰ-퟿"],_dataLoaded:!1,_containsString(e,t){let r=t.replace(/\.$/,"").toLowerCase();return e.includes(r)},_stripPrefixes(e){for(let t in e)if(!this._containsString(this.NAME_PREFIXES,e[t]))return e.slice(t);return[]},_stripSuffixes(e){for(let t=e.length-1;t>=0;t--)if(!this._containsString(this.NAME_SUFFIXES,e[t]))return e.slice(0,t+1);return[]},_isCJKName(e){if(!e)return!1;let t=!1,r=0;for(let i of e){let e=this.MIDDLE_DOT.includes(i),n=!e&&this.reCJK.test(i);if(!n&&!e&&!this.WHITESPACE.includes(i))return!1;n&&!t&&r++,t=n}return r>0&&r<3},_splitCJKName(e){let t=new RegExp("^["+this.HANGUL_RANGE.join("")+this.WHITESPACE.join("")+"]+$","u"),r={given:"",middle:"",family:""};if(1==e.length){let i=e[0],n=0;n=(t.test(i)&&i.length>3?this.KOREAN_MULTI_CHAR_SURNAMES:this.COMMON_CJK_MULTI_CHAR_SURNAMES).some((e=>i.startsWith(e)))?2:1,r.family=i.substr(0,n),r.given=i.substr(n)}else{if(2!=e.length)return null;r.family=e[0],r.given=e[1]}return r},init(){this._dataLoaded||(this._dataLoaded=!0,this.reCJK=new RegExp("["+this.CJK_RANGE.join("")+"]","u"))},splitName(e){let t={given:"",middle:"",family:""};if(!e)return t;let r=e.trim().split(/[ ,\u3000\u30FB\u00B7]+/);if(r=this._stripPrefixes(r),this._isCJKName(e)){let e=this._splitCJKName(r);if(e)return e}if(r.length>2&&(r=this._stripSuffixes(r)),!r.length)return t.given=e,t;if(1==r.length)return t.given=r[0],t;let i=[r.pop()];for(;r.length;){let e=r[r.length-1];if(!this._containsString(this.FAMILY_NAME_PREFIXES,e))break;i.unshift(e),r.pop()}return t.family=i.join(" "),r.length>=2&&(t.middle=r.pop()),t.given=r.join(" "),t},joinNameParts({given:e,middle:t,family:r}){return this._isCJKName(e)&&this._isCJKName(r)&&!t?r+e:[e,t,r].filter((e=>e&&e.length)).join(" ")}};i.init()},193:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillAddressSection:()=>i.FormAutofillAddressSection,FormAutofillCreditCardSection:()=>i.FormAutofillCreditCardSection,FormAutofillSection:()=>i.FormAutofillSection});var i=r(411);i.FormAutofillSection.SHOULD_FOCUS_ON_AUTOFILL=!1},411:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormAutofillAddressSection:()=>d,FormAutofillCreditCardSection:()=>c,FormAutofillSection:()=>o});var i=r(564),n=r(494),s=r(394);const a={};ChromeUtils.defineESModuleGetters(a,{AutofillTelemetry:"resource://autofill/AutofillTelemetry.sys.mjs",CreditCard:"resource://gre/modules/CreditCard.sys.mjs",FormAutofillNameUtils:"resource://gre/modules/shared/FormAutofillNameUtils.sys.mjs",LabelUtils:"resource://gre/modules/shared/LabelUtils.sys.mjs"});const{FIELD_STATES:l}=n.FormAutofillUtils;class o{static SHOULD_FOCUS_ON_AUTOFILL=!0;#f=null;#m=[];constructor(e,t){this.#m=e,this.isValidSection()&&(this.handler=t,this.filledRecordGUID=null,ChromeUtils.defineLazyGetter(this,"reauthPasswordPromptMessage",(()=>{const e=n.FormAutofillUtils.brandBundle.GetStringFromName("brandShortName"),t=i.AppConstants.platform.replace("macosx","macos");return n.FormAutofillUtils.stringBundle.formatStringFromName(`useCreditCardPasswordPrompt.${t}`,[e])})),ChromeUtils.defineLazyGetter(this,"log",(()=>s.FormAutofill.defineLogGetter(this,"FormAutofillHandler"))),this._cacheValue={allFieldNames:null,matchingSelectOption:null},this.flowId=Services.uuid.generateUUID().toString(),this.log.debug("Creating new credit card section with flowId =",this.flowId))}get fieldDetails(){return this.#m}isValidSection(){throw new TypeError("isValidSection method must be overrided")}isEnabled(){throw new TypeError("isEnabled method must be overrided")}isRecordCreatable(e){throw new TypeError("isRecordCreatable method must be overridden")}applyTransformers(e){}preparePreviewProfile(e){}async prepareFillingProfile(e){return!0}getFilledValueFromProfile(e,t){return t[`${e.fieldName}-formatted`]||t[e.fieldName]}computeFillingValue(e,t,r){return e}set focusedInput(e){this.#f=e}getFieldDetailByElement(e){return this.fieldDetails.find((t=>t.element==e))}getFieldDetailByName(e){return this.fieldDetails.find((t=>t.fieldName==e))}get allFieldNames(){return this._cacheValue.allFieldNames||(this._cacheValue.allFieldNames=this.fieldDetails.map((e=>e.fieldName))),this._cacheValue.allFieldNames}matchSelectOptions(e){this._cacheValue.matchingSelectOption||(this._cacheValue.matchingSelectOption=new WeakMap);for(let t in e){let r=this.getFieldDetailByName(t);if(!r)continue;let i=r.element;if(!HTMLSelectElement.isInstance(i))continue;let s=this._cacheValue.matchingSelectOption.get(i)||{},a=e[t];if(s[a]&&s[a].deref())continue;let l=n.FormAutofillUtils.findSelectOption(i,e,t);l?(s[a]=new WeakRef(l),this._cacheValue.matchingSelectOption.set(i,s)):(s[a]&&(delete s[a],this._cacheValue.matchingSelectOption.set(i,s)),delete e[t])}}adaptFieldMaxLength(e){for(let t in e){let r=this.getFieldDetailByName(t);if(!r)continue;let i=r.element;if(!i)continue;let n=i.maxLength;if(!(void 0===n||n<0||e[t].toString().length<=n))if(n)switch(typeof e[t]){case"string":if("cc-exp"==t&&5==n){const r=("0"+e["cc-exp-month"].toString()).slice(-2),i=e["cc-exp-year"].toString().slice(-2);e[t]=`${r}/${i}`}else e[t]="cc-number"==t?e[t].substr(e[t].length-n):e[t].substr(0,n);break;case"number":n<1&&(n=1),e[t]=e[t]%Math.pow(10,n)}else delete e[t],delete e[`${t}-formatted`]}}fillFieldValue(e,t){n.FormAutofillUtils.focusOnAutofill&&e.focus({preventScroll:!0}),HTMLInputElement.isInstance(e)?e.setUserInput(t):HTMLSelectElement.isInstance(e)&&(e.value=t,e.dispatchEvent(new e.ownerGlobal.Event("input",{bubbles:!0})),e.dispatchEvent(new e.ownerGlobal.Event("change",{bubbles:!0})))}getAdaptedProfiles(e){for(let t of e)this.applyTransformers(t);return e}async autofillFields(e){if(!this.#f)throw new Error("No focused input.");if(!this.getFieldDetailByElement(this.#f))throw new Error("No fieldDetail for the focused input.");if(!await this.prepareFillingProfile(e))return this.log.debug("profile cannot be filled"),!1;this.filledRecordGUID=e.guid;for(const t of this.fieldDetails){const r=t.element;if(!n.FormAutofillUtils.isFieldAutofillable(r))continue;r.previewValue="";const i=this.getFilledValueFromProfile(t,e);if(HTMLInputElement.isInstance(r)&&i)r!=this.#f&&(r==this.#f||r.value&&r.value!=r.defaultValue)&&this.handler.getFilledStateByElement(r)!=l.AUTO_FILLED||(this.fillFieldValue(r,i),this.handler.changeFieldState(t,l.AUTO_FILLED));else if(HTMLSelectElement.isInstance(r)){let e=this._cacheValue.matchingSelectOption.get(r)||{},n=e[i]&&e[i].deref();if(!n)continue;n.selected||(n.selected=!0,this.fillFieldValue(r,n.value)),this.handler.changeFieldState(t,l.AUTO_FILLED)}}return this.#f.focus({preventScroll:!0}),a.AutofillTelemetry.recordFormInteractionEvent("filled",this,{profile:e}),!0}previewFormFields(e){this.preparePreviewProfile(e);for(const t of this.fieldDetails){let r=t.element;if(!n.FormAutofillUtils.isFieldAutofillable(r))continue;let i=e[`${t.fieldName}-formatted`]||e[t.fieldName]||"";if(HTMLSelectElement.isInstance(r)){if(i){const e=(this._cacheValue.matchingSelectOption.get(r)??{})[i]?.deref();i=e?.text??""}}else if(r.value&&r.value!=r.defaultValue)continue;r.previewValue=i?.toString().replaceAll("*","•"),this.handler.changeFieldState(t,i?l.PREVIEW:l.NORMAL)}}clearFilled(e){a.AutofillTelemetry.recordFormInteractionEvent("filled_modified",this,{fieldName:e.fieldName});let t=!1;const r=[];for(const e of this.fieldDetails){const i=e.element;HTMLSelectElement.isInstance(i)?r.push(e):t|=this.handler.getFilledStateByElement(i)==l.AUTO_FILLED}if(!t){for(const e of r){let t=e.element;this._resetSelectElementValue(t),this.handler.changeFieldState(e,l.NORMAL)}this.filledRecordGUID=null}}clearPreviewedFormFields(){this.log.debug("clear previewed fields");for(const e of this.fieldDetails){let t=e.element;t?(t.previewValue="",this.handler.getFilledStateByElement(t)!=l.AUTO_FILLED&&this.handler.changeFieldState(e,l.NORMAL)):this.log.warn(e.fieldName,"is unreachable")}}clearPopulatedForm(){for(let e of this.fieldDetails){let t=e.element;t?this.handler.getFilledStateByElement(t)==l.AUTO_FILLED&&(HTMLInputElement.isInstance(t)?t.setUserInput(""):HTMLSelectElement.isInstance(t)&&this._resetSelectElementValue(t)):this.log.warn(e.fieldName,"is unreachable")}}resetFieldStates(){for(const e of this.fieldDetails)e.element.removeEventListener("input",this,{mozSystemGroup:!0}),this.handler.changeFieldState(e,l.NORMAL);this.filledRecordGUID=null}isFilled(){return!!this.filledRecordGUID}_condenseMultipleCCNumberFields(e){let t=0;for(let r=e.length-1;r>=0;r--)"cc-number"==e[r].fieldName?(t++,4==t&&(t=0,e[r].fieldValue=e[r].element?.value+e[r+1].element?.value+e[r+2].element?.value+e[r+3].element?.value,e.splice(r+1,3))):t=0}createRecord(){let e=this.fieldDetails;if(!this.isEnabled()||!e||!e.length)return null;let t={guid:this.filledRecordGUID,record:{},untouchedFields:[],section:this};this.flowId&&(t.flowId=this.flowId);let r=this.fieldDetails;this._condenseMultipleCCNumberFields(r),r.forEach((e=>{const r=e.element;let i=e.fieldValue??(r&&r.value.trim());i=this.computeFillingValue(i,e,r),!i||i.length>n.FormAutofillUtils.MAX_FIELD_VALUE_LENGTH?t.record[e.fieldName]="":(t.record[e.fieldName]=i,this.handler.getFilledStateByElement(r)==l.AUTO_FILLED&&t.untouchedFields.push(e.fieldName))}));const i=this.fieldDetails.filter((e=>"tel"==n.FormAutofillUtils.getCategoryFromFieldName(e.fieldName)));return i.length&&i.every((e=>t.untouchedFields.includes(e.fieldName)))&&(t.untouchedFields.includes("tel")||t.untouchedFields.push("tel")),this.isRecordCreatable(t.record)?t:null}_resetSelectElementValue(e){if(!e.options.length)return;let t=[...e.options].find((e=>e.hasAttribute("selected")));e.value=t?t.value:e.options[0].value,e.dispatchEvent(new e.ownerGlobal.Event("input",{bubbles:!0})),e.dispatchEvent(new e.ownerGlobal.Event("change",{bubbles:!0}))}}class d extends o{constructor(e,t){super(e,t),this.isValidSection()&&(this._cacheValue.oneLineStreetAddress=null,a.AutofillTelemetry.recordDetectedSectionCount(this),a.AutofillTelemetry.recordFormInteractionEvent("detected",this))}isValidSection(){return new Set(this.fieldDetails.map((e=>e.fieldName))).size>=n.FormAutofillUtils.AUTOFILL_FIELDS_THRESHOLD}isEnabled(){return s.FormAutofill.isAutofillAddressesEnabled}isRecordCreatable(e){const t=n.FormAutofillUtils.identifyCountryCode(e.country||e["country-name"]);return t&&!s.FormAutofill.isAutofillAddressesAvailableInCountry(t)?(this.log.warn("isRecordCreatable: Country not supported:",e.country),!1):Object.entries(e).filter((e=>!!e[1])).map((e=>n.FormAutofillUtils.getCategoryFromFieldName(e[0]))).reduce(((e,t)=>["name","tel"].includes(t)&&e.includes(t)?e:[...e,t]),[]).length>=n.FormAutofillUtils.AUTOFILL_FIELDS_THRESHOLD}_getOneLineStreetAddress(e){return this._cacheValue.oneLineStreetAddress||(this._cacheValue.oneLineStreetAddress={}),this._cacheValue.oneLineStreetAddress[e]||(this._cacheValue.oneLineStreetAddress[e]=n.FormAutofillUtils.toOneLineAddress(e)),this._cacheValue.oneLineStreetAddress[e]}addressTransformer(e){if(e["street-address"]){e["-moz-street-address-one-line"]=this._getOneLineStreetAddress(e["street-address"]);let t=this.getFieldDetailByName("street-address");t&&HTMLInputElement.isInstance(t.element)&&(e["street-address"]=e["-moz-street-address-one-line"]);let r=[];for(let t of["address-line3","address-line2","address-line1"])r.unshift(e[t]),this.getFieldDetailByName(t)&&(r.length>1&&(e[t]=n.FormAutofillUtils.toOneLineAddress(r)),r=[])}}telTransformer(e){if(!e.tel||!e["tel-national"])return;let t=this.getFieldDetailByName("tel");if(!t)return;let r,i=t.element,n=e=>(r||(r=new RegExp("^(?:"+i.pattern+")$","u")),r.test(e));if(i.pattern){if(n(e.tel))return}else if(i.maxLength&&"autocomplete"==t.reason&&e.tel.length<=i.maxLength)return;"autocomplete"!=t.reason?e.tel=e["tel-national"]:i.pattern?n(e["tel-national"])&&(e.tel=e["tel-national"]):i.maxLength&&e["tel-national"].length<=i.maxLength&&(e.tel=e["tel-national"])}applyTransformers(e){this.addressTransformer(e),this.telTransformer(e),this.matchSelectOptions(e),this.adaptFieldMaxLength(e)}computeFillingValue(e,t,r){if("address-level1"==t.fieldName&&HTMLSelectElement.isInstance(r))if(e&&1==r.selectedOptions.length){let t=r.selectedOptions[0].text.trim();e=n.FormAutofillUtils.getAbbreviatedSubregionName([e,t])||t}else e="";return e}}class c extends o{constructor(e,t){super(e,t),this.isValidSection()&&(a.AutofillTelemetry.recordDetectedSectionCount(this),a.AutofillTelemetry.recordFormInteractionEvent("detected",this),t.window.location!=t.window.parent?.location&&(this.log.debug("Credit card form is in an iframe -- watching for pagehide",e),t.window.addEventListener("pagehide",this._handlePageHide.bind(this))))}_handlePageHide(e){this.handler.window.removeEventListener("pagehide",this._handlePageHide.bind(this)),this.log.debug("Credit card subframe is pagehideing",this.handler.form),this.handler.onFormSubmitted()}isValidSection(){let e=null,t=null,r=null;for(let i of this.fieldDetails)switch(i.fieldName){case"cc-number":e=i;break;case"cc-name":case"cc-given-name":case"cc-additional-name":case"cc-family-name":t=i;break;case"cc-exp":case"cc-exp-month":case"cc-exp-year":r=i}if("autocomplete"==e?.reason||"autocomplete"==t?.reason||"autocomplete"==r?.reason)return!0;if("fathom"==e?.reason){if(t||r)return!0}else if("fathom"==t?.reason&&(e||r))return!0;let i,s=n.FormAutofillUtils.ccFathomHighConfidenceThreshold;if(e?.confidence>s?i=e:t?.confidence>s&&(i=t),i){const e=i.element,t=(e.form||e.ownerDocument).querySelectorAll("input:not([type=hidden])");if(1==t.length&&t[0]==e)return!0}return!1}isEnabled(){return s.FormAutofill.isAutofillCreditCardsEnabled}isRecordCreatable(e){return e["cc-number"]&&n.FormAutofillUtils.isCCNumber(e["cc-number"])}creditCardExpiryDateTransformer(e){if(!e["cc-exp"])return;const t=this.getFieldDetailByName("cc-exp")?.element;if(!t)return;let r=null;const i=e["cc-exp-month"].toString(),n=e["cc-exp-year"].toString();if("INPUT"==t.tagName){const e=[];t.placeholder&&e.push(t.placeholder),a.LabelUtils.findLabelElements(t)&&e.push(t.labels[0]?.textContent),"LABEL"==t.previousElementSibling?.tagName&&e.push(t.previousElementSibling.textContent),e.some((e=>(r=function(e,t,r){const i="yy|aa|jj|rr",n=(e,t)=>new RegExp("(?:\\b|^)((?:["+e+"]{2}){1,2})\\s*([\\-/])\\s*((?:["+t+"]{2}){1,2})(?:\\b|$)","i");let s=n("m",i).exec(e);return s?t.padStart(s[1].length,"0")+s[2]+r.substr(-1*s[3].length):(s=n(i,"m").exec(e),s?r.substr(-1*s[1].length)+s[2]+t.padStart(s[3].length,"0"):null)}(e,i,n),!!r)))}e["cc-exp"]=r??`${i.padStart(2,"0")}/${n}`}creditCardExpMonthAndYearTransformer(e){const t=(e,t)=>{if(!e)return null;let r=t.getFieldDetailByName(e);if(!r)return null;let i=r.element;return"INPUT"===i.tagName?i:null};t("cc-exp-month",this)&&(e["cc-exp-month-formatted"]=e["cc-exp-month"]?.toString().padStart(2,"0"));let r=t("cc-exp-year",this);if(r){let t=r.placeholder;/\b(yy|aa|jj|rr)\b/i.test(t)&&(e["cc-exp-year-formatted"]=e["cc-exp-year"].toString().substring(2))}}creditCardNameTransformer(e){const t=e["cc-name"];if(!t)return;const r=this.getFieldDetailByName("cc-given-name"),i=this.getFieldDetailByName("cc-middle-name"),n=this.getFieldDetailByName("cc-family-name");if(r||i||n){const s=a.FormAutofillNameUtils.splitName(t);r&&s.given&&(e["cc-given-name"]=s.given),i&&s.middle&&(e["cc-middle-name"]=s.middle),n&&s.family&&(e["cc-family-name"]=s.family)}}async _decrypt(e,t){let r;for(let e of this.fieldDetails){let t=e.element;if(t){r=t.ownerGlobal;break}}return r?r.windowGlobalChild.getActor("FormAutofill").sendQuery("FormAutofill:GetDecryptedString",{cipherText:e,reauth:t}):null}applyTransformers(e){this.creditCardExpiryDateTransformer(e),this.creditCardExpMonthAndYearTransformer(e),this.creditCardNameTransformer(e),this.matchSelectOptions(e),this.adaptFieldMaxLength(e)}getFilledValueFromProfile(e,t){const r=super.getFilledValueFromProfile(e,t);if("cc-number"==e.fieldName&&null!=e.part){const t=e.part;return r.slice(4*(t-1),4*t)}return r}computeFillingValue(e,t,r){if("cc-type"!=t.fieldName||!HTMLSelectElement.isInstance(r))return e;if(a.CreditCard.isValidNetwork(e))return e;if(e&&1==r.selectedOptions.length){let e=r.selectedOptions[0],t=a.CreditCard.getNetworkFromName(e.text)??a.CreditCard.getNetworkFromName(e.value);if(t)return t}return e}preparePreviewProfile(e){e["cc-number-decrypted"]?e["cc-number"]=e["cc-number-decrypted"]:e["cc-number"].startsWith("****")||(e["cc-number"]="****"+e["cc-number"])}async prepareFillingProfile(e){if(e["cc-number-encrypted"]){let t=await this._decrypt(e["cc-number-encrypted"],this.reauthPasswordPromptMessage);if(!t)return!1;e["cc-number"]=t}return!0}async autofillFields(e){return this.getAdaptedProfiles([e]),!!await super.autofillFields(e)}}},494:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AddressDataLoader:()=>d,FormAutofillUtils:()=>a});var i=r(394),n=r(564);const s={};let a;ChromeUtils.defineESModuleGetters(s,{CreditCard:"resource://gre/modules/CreditCard.sys.mjs",FormAutofillNameUtils:"resource://gre/modules/shared/FormAutofillNameUtils.sys.mjs",OSKeyStore:"resource://gre/modules/OSKeyStore.sys.mjs"});const l="resource://autofill/addressmetadata/",o=["text","email","tel","number","month"];let d={_dataLoaded:{country:!1,level1:new Set},_loadScripts(e){let t={},r={};try{t=a.loadDataFromScript(e+"addressReferences.js"),r=a.loadDataFromScript(e+"addressReferencesExt.js")}catch(e){return t}if(r.addressDataExt)for(let e in r.addressDataExt){let i=t.addressData[e];i||(i=t.addressData[e]={}),Object.assign(i,r.addressDataExt[e])}return t},_parse(e){if(!e)return null;const t=["languages","sub_keys","sub_isoids","sub_names","sub_lnames"];for(let r of t)if(e[r]){if(Array.isArray(e[r]))return e;e[r]=e[r].split("~")}return e},_loadData(e,t=null){return this._dataLoaded.country||(this._addressData=this._loadScripts(l).addressData,this._dataLoaded.country=!0),t?(this._dataLoaded.level1.has(e)||(Object.assign(this._addressData,this._loadScripts(`${l}${e}/`).addressData),this._dataLoaded.level1.add(e)),this._parse(this._addressData[`data/${e}/${t}`])):this._parse(this._addressData[`data/${e}`])},getData(e,t=null){let r=this._loadData(e,t);if(!r)return null;let i=this._parse(this._addressData[`data/${e}`]),n=[];return i.languages&&(n=i.languages.filter((e=>e!==i.lang)).map((e=>this._parse(this._addressData[`${r.id}--${e}`])))),{defaultLocale:r,locales:n}}};a={get AUTOFILL_FIELDS_THRESHOLD(){return 3},ADDRESSES_COLLECTION_NAME:"addresses",CREDITCARDS_COLLECTION_NAME:"creditCards",MANAGE_ADDRESSES_L10N_IDS:["autofill-add-new-address-title","autofill-manage-addresses-title"],EDIT_ADDRESS_L10N_IDS:["autofill-address-given-name","autofill-address-additional-name","autofill-address-family-name","autofill-address-organization","autofill-address-street","autofill-address-state","autofill-address-province","autofill-address-city","autofill-address-country","autofill-address-zip","autofill-address-postal-code","autofill-address-email","autofill-address-tel"],MANAGE_CREDITCARDS_L10N_IDS:["autofill-add-new-card-title","autofill-manage-credit-cards-title"],EDIT_CREDITCARD_L10N_IDS:["autofill-card-number","autofill-card-name-on-card","autofill-card-expires-month","autofill-card-expires-year","autofill-card-network"],MAX_FIELD_VALUE_LENGTH:200,FIELD_STATES:{NORMAL:"NORMAL",AUTO_FILLED:"AUTO_FILLED",PREVIEW:"PREVIEW"},_fieldNameInfo:{name:"name","given-name":"name","additional-name":"name","family-name":"name",organization:"organization","street-address":"address","address-line1":"address","address-line2":"address","address-line3":"address","address-level1":"address","address-level2":"address","postal-code":"address",country:"address","country-name":"address",tel:"tel","tel-country-code":"tel","tel-national":"tel","tel-area-code":"tel","tel-local":"tel","tel-local-prefix":"tel","tel-local-suffix":"tel","tel-extension":"tel",email:"email","cc-name":"creditCard","cc-given-name":"creditCard","cc-additional-name":"creditCard","cc-family-name":"creditCard","cc-number":"creditCard","cc-exp-month":"creditCard","cc-exp-year":"creditCard","cc-exp":"creditCard","cc-type":"creditCard","cc-csc":"creditCard"},_collators:{},_reAlternativeCountryNames:{},isAddressField(e){return!!this._fieldNameInfo[e]&&!this.isCreditCardField(e)},isCreditCardField(e){return"creditCard"==this._fieldNameInfo?.[e]},isCCNumber:e=>e&&s.CreditCard.isValidNumber(e),ensureLoggedIn(e){return s.OSKeyStore.ensureLoggedIn(!(!this._reauthEnabledByUser||!e)&&e)},getCreditCardNetworks:()=>s.CreditCard.getSupportedNetworks(),getCategoryFromFieldName(e){return this._fieldNameInfo[e]},getCategoriesFromFieldNames(e){let t=new Set;for(let r of e){let e=this.getCategoryFromFieldName(r);e&&t.add(e)}return Array.from(t)},getAddressSeparator:()=>" ",getAddressLabel(e){let t=["name","-moz-street-address-one-line","address-level3","address-level2","organization","address-level1","country","postal-code","tel","email"],r=[];(e={...e})["street-address"]&&(e["-moz-street-address-one-line"]=this.toOneLineAddress(e["street-address"])),"name"in e||(e.name=s.FormAutofillNameUtils.joinNameParts({given:e["given-name"],middle:e["additional-name"],family:e["family-name"]}));for(const i of t){let t=e[i];t&&r.push(t)}return r.join(", ")},_toStreetAddressParts(e,t="\n"){let r="string"==typeof e?e.split(t):e;return Array.isArray(r)?r.map((e=>e?e.trim():"")).filter((e=>e)):[]},toOneLineAddress(e,t="\n"){return this._toStreetAddressParts(e,t).join(this.getAddressSeparator())},compressTel(e){let t=e["tel-country-code"]||"",r=e["tel-area-code"]||"";e.tel||(e["tel-national"]?e.tel=t+e["tel-national"]:e["tel-local"]?e.tel=t+r+e["tel-local"]:e["tel-local-prefix"]&&e["tel-local-suffix"]&&(e.tel=t+r+e["tel-local-prefix"]+e["tel-local-suffix"]));for(let t in e)"tel"!=t&&"tel"==this.getCategoryFromFieldName(t)&&delete e[t]},isFieldAutofillable:e=>e&&!e.readOnly&&!e.disabled,isFieldVisible:(e,t=!0)=>t&&e.checkVisibility?e.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}):!e.hidden&&"none"!=e.style.display,isFieldFocusable:e=>Services.focus.elementIsFocusable(e,0)&&"-1"!=e.tabIndex,isCreditCardOrAddressFieldType:e=>!!e&&(HTMLInputElement.isInstance(e)?o.includes(e.type):HTMLSelectElement.isInstance(e)),loadDataFromScript:(e,t={})=>(Services.scriptloader.loadSubScript(e,t),t),getCountryAddressRawData(e=i.FormAutofill.DEFAULT_REGION,t=null){let r=d.getData(e,t);if(!r){if(t)return null;e!=i.FormAutofill.DEFAULT_REGION&&(r=d.getData(i.FormAutofill.DEFAULT_REGION))}return r||(r=d.getData("US")),r},getCountryAddressData(e,t){let r=this.getCountryAddressRawData(e,t);return r&&r.defaultLocale},getCountryAddressDataWithLocales(e,t){let r=this.getCountryAddressRawData(e,t);return r&&[r.defaultLocale,...r.locales]},getSearchCollators(e,{ignorePunctuation:t=!0,sensitivity:r="base",usage:i="search"}={}){if(!this._collators[e]){let n=this.getCountryAddressData(e),s=n.languages||[n.lang],a={ignorePunctuation:t,sensitivity:r,usage:i};this._collators[e]=s.map((e=>new Intl.Collator(e,a)))}return this._collators[e]},FIELDS_LOOKUP:{N:"name",O:"organization",A:"street-address",S:"address-level1",C:"address-level2",D:"address-level3",Z:"postal-code",n:"newLine"},parseAddressFormat(e){if(!e)throw new Error("fmt string is missing.");return e.match(/%[^%]/g).reduce(((e,t)=>{let r=this.FIELDS_LOOKUP[t[1]];if(!r)return e;if("newLine"==r){let t=e.length;return t&&(e[t-1].newLine=!0),e}return e.concat({fieldId:r})}),[])},buildRegionMapIfAvailable(e,t,r,i){if(!e||!e.length||!r&&!i||r&&e.length!=r.length||i&&e.length!=i.length)return null;if(t&&t.length&&t.length==e.length)for(let r=0;r<t.length;r++)t[r]&&(e[r]=t[r]);let n=r||i;return new Map(e.map(((e,t)=>[e,n[t]])))},parseRequireString(e){if(!e)throw new Error("requireString string is missing.");return e.split("").map((e=>this.FIELDS_LOOKUP[e]))},identifyCountryCode(e,t){if(!e)return null;if(d.getData(e))return e;const r=t?[t]:[...i.FormAutofill.countries.keys()];for(const t of r){let r=this.getSearchCollators(t),n=this.getCountryAddressData(t);t!=n.key&&(n={id:`data/${t}`,key:t,name:i.FormAutofill.countries.get(t)});let s=n.alternative_names||[n.name],a=this._reAlternativeCountryNames[t];if(a||(a=this._reAlternativeCountryNames[t]=[]),3==e.length&&this.strCompare(n.alpha_3_code,e,r))return t;for(let i=0;i<s.length;i++){let n=s[i],l=a[i];if(l||(l=a[i]=new RegExp("\\b"+this.escapeRegExp(n)+"\\b","i")),this.strCompare(n,e,r)||l.test(e))return t}}return null},findSelectOption(e,t,r){return this.isAddressField(r)?this.findAddressSelectOption(e,t,r):this.isCreditCardField(r)?this.findCreditCardSelectOption(e,t,r):null},getAbbreviatedSubregionName(e,t){let r=Array.isArray(e)?e:[e],i=this.getSearchCollators(t);for(let e of this.getCountryAddressDataWithLocales(t)){let{sub_keys:t,sub_names:n,sub_lnames:s}=e;if(!t)continue;n=n||s;let a=[];for(const e of r){let r=this.identifyValue(t,n,e,i);if(r)return r;[t,n].forEach((t=>{a.push(t.findIndex((t=>new RegExp("\\b"+this.escapeRegExp(t)+"\\b").test(e))))}))}let l=t[a.find((e=>!!~e))];if(l)return l}return null},findAddressSelectOption(e,t,r){if(e.options.length>512)return null;let i=t[r];if(!i)return null;let n=this.getSearchCollators(t.country);for(let t of e.options)if(this.strCompare(i,t.value,n)||this.strCompare(i,t.text,n))return t;switch(r){case"address-level1":{let{country:r}=t,s=this.getAbbreviatedSubregionName([i],r);if(!s)return null;for(let t of this.getCountryAddressDataWithLocales(r)){let r=t.sub_keys;if(!r)continue;let i=t.sub_names||t.sub_lnames,a=new RegExp("\\b"+this.escapeRegExp(s)+"\\b","i");for(let t of e.options){let e=this.identifyValue(r,i,t.value,n),l=this.identifyValue(r,i,t.text,n);if(s===e||s===l||a.test(t.value))return t}}break}case"country":if(this.getCountryAddressData(i))for(let t of e.options)if(this.identifyCountryCode(t.text,i)||this.identifyCountryCode(t.value,i))return t}return null},findCreditCardSelectOption(e,t,r){let i=t["cc-exp-month"]?t["cc-exp-month"].toString():null,n=i?i.padStart(2,"0"):null,a=t["cc-exp-year"]?t["cc-exp-year"].toString():null,l=a?a.substr(2,2):null,o=Array.from(e.options);switch(r){case"cc-exp-month":if(!i)return null;for(let e of o)if([e.text,e.label,e.value].some((e=>{let t=/[1-9]\d*/.exec(e);return t&&t[0]==i})))return e;break;case"cc-exp-year":if(!a)return null;for(let e of o)if([e.text,e.label,e.value].some((e=>e==l||e==a)))return e;break;case"cc-exp":{if(!i||!a)return null;let e=[i+"/"+l,i+"/"+a,n+"/"+l,n+"/"+a,i+"-"+l,i+"-"+a,n+"-"+l,n+"-"+a,l+"-"+n,a+"-"+n,a+"/"+i,n+l,l+n];for(let t of o)if([t.text,t.label,t.value].some((t=>e.some((e=>t.includes(e))))))return t;break}case"cc-type":{let e=t["cc-type"]||"";for(let t of o)if([t.text,t.label,t.value].some((t=>s.CreditCard.getNetworkFromName(t)==e)))return t;break}}return null},identifyValue(e,t,r,i){let n=e.find((e=>this.strCompare(r,e,i)));if(n)return n;let s=t.findIndex((e=>this.strCompare(r,e,i)));return-1!==s?e[s]:null},strCompare:(e="",t="",r)=>r.some((r=>!r.compare(e,t))),strInclude(e="",t="",r){const i=e.length-t.length;for(let n=0;n<=i;n++)if(this.strCompare(e.substring(n,n+t.length),t,r))return!0;return!1},escapeRegExp:e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),getFormFormat(e){let t=this.getCountryAddressData(e);return e!=t.key&&(t={fmt:"%N%n%O%n%A%n%C %S %Z"}),{addressLevel3L10nId:this.getAddressFieldL10nId(t.sublocality_name_type||"suburb"),addressLevel2L10nId:this.getAddressFieldL10nId(t.locality_name_type||"city"),addressLevel1L10nId:this.getAddressFieldL10nId(t.state_name_type||"province"),addressLevel1Options:this.buildRegionMapIfAvailable(t.sub_keys,t.sub_isoids,t.sub_names,t.sub_lnames),countryRequiredFields:this.parseRequireString(t.require||"AC"),fieldsOrder:this.parseAddressFormat(t.fmt||"%N%n%O%n%A%n%C"),postalCodeL10nId:this.getAddressFieldL10nId(t.zip_name_type||"postal-code"),postalCodePattern:t.zip}},getAddressFieldL10nId:e=>"autofill-address-"+e.replace(/_/g,"-"),CC_FATHOM_NONE:0,CC_FATHOM_JS:1,CC_FATHOM_NATIVE:2,isFathomCreditCardsEnabled(){return this.ccHeuristicsMode!=this.CC_FATHOM_NONE},formAutofillConfidencesKeyToCCFieldType:e=>({ccNumber:"cc-number",ccName:"cc-name",ccType:"cc-type",ccExp:"cc-exp",ccExpMonth:"cc-exp-month",ccExpYear:"cc-exp-year"}[e])},ChromeUtils.defineLazyGetter(a,"stringBundle",(function(){return Services.strings.createBundle("chrome://formautofill/locale/formautofill.properties")})),ChromeUtils.defineLazyGetter(a,"brandBundle",(function(){return Services.strings.createBundle("chrome://branding/locale/brand.properties")})),n.XPCOMUtils.defineLazyPreferenceGetter(a,"_reauthEnabledByUser","extensions.formautofill.reauth.enabled",!1),n.XPCOMUtils.defineLazyPreferenceGetter(a,"ccHeuristicsMode","extensions.formautofill.creditCards.heuristics.mode",0),n.XPCOMUtils.defineLazyPreferenceGetter(a,"ccFathomConfidenceThreshold","extensions.formautofill.creditCards.heuristics.fathom.confidenceThreshold",null,null,(e=>parseFloat(e))),n.XPCOMUtils.defineLazyPreferenceGetter(a,"ccFathomHighConfidenceThreshold","extensions.formautofill.creditCards.heuristics.fathom.highConfidenceThreshold",null,null,(e=>parseFloat(e))),n.XPCOMUtils.defineLazyPreferenceGetter(a,"ccFathomTestConfidence","extensions.formautofill.creditCards.heuristics.fathom.testConfidence",null,null,(e=>parseFloat(e))),n.XPCOMUtils.defineLazyPreferenceGetter(a,"visibilityCheckThreshold","extensions.formautofill.heuristics.visibilityCheckThreshold",200),n.XPCOMUtils.defineLazyPreferenceGetter(a,"interactivityCheckMode","extensions.formautofill.heuristics.interactivityCheckMode","focusability"),n.XPCOMUtils.defineLazyPreferenceGetter(a,"focusOnAutofill","extensions.formautofill.focusOnAutofill",!0)},359:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormLikeFactory:()=>i});let i={_propsFromForm:["action","autocomplete","ownerDocument"],createFromForm(e){if(!HTMLFormElement.isInstance(e))throw new Error("createFromForm: aForm must be a HTMLFormElement");let t={elements:[...e.elements],rootElement:e};for(let r of this._propsFromForm)t[r]=e[r];return this._addToJSONProperty(t),t},createFromField(e){if(!HTMLInputElement.isInstance(e)&&!HTMLSelectElement.isInstance(e)||!e.ownerDocument)throw new Error("createFromField requires a field in a document");let t=this.findRootForField(e);if(HTMLFormElement.isInstance(t))return this.createFromForm(t);let r=e.ownerDocument,i={action:r.baseURI,autocomplete:"on",ownerDocument:r,rootElement:t};return ChromeUtils.defineLazyGetter(i,"elements",(function(){let e=[];for(let t of this.rootElement.querySelectorAll("input, select"))t.form||e.push(t);return e})),this._addToJSONProperty(i),i},closestFormIgnoringShadowRoots(e){let t=e.closest("form"),r=e;for(;!t;){let e=r.getRootNode();if(!ShadowRoot.isInstance(e))break;let i=e.host;t=i.closest("form"),r=i}return t},findRootForField(e){return e.form||this.closestFormIgnoringShadowRoots(e)||e.ownerDocument.documentElement},_addToJSONProperty(e){function t(e){let t=e.id?"#"+e.id:"",r="";for(let t of e.classList)r+="."+t;return`<${e.nodeName+t+r}>`}Object.defineProperty(e,"toJSON",{value:()=>{let r={};for(let i of Object.keys(e)){let n=e[i],s=n;switch(i){case"elements":s=[];for(let e of n)s.push(t(e));break;case"ownerDocument":s={location:{href:n.location.href}};break;case"rootElement":s=t(n)}r[i]=s}return r}})}}},498:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FormStateManager:()=>n,default:()=>s});const i={};ChromeUtils.defineESModuleGetters(i,{FormLikeFactory:"resource://gre/modules/FormLikeFactory.sys.mjs",FormAutofillHandler:"resource://gre/modules/shared/FormAutofillHandler.sys.mjs"});class n{constructor(e,t){this._formsDetails=new WeakMap,this._activeItems={},this.onSubmit=e,this.onAutofillCallback=t}get activeFieldDetail(){if(!this._activeItems.fieldDetail){let e=this.activeFormDetails;if(!e)return null;for(let t of e){let e=t.element;if(e&&this.activeInput==e){this._activeItems.fieldDetail=t;break}}}return this._activeItems.fieldDetail}get activeFormDetails(){let e=this.activeHandler;return e?e.fieldDetails:null}get activeInput(){return this._activeItems.elementWeakRef?.deref()}get activeHandler(){const e=this.activeInput;if(!e)return null;let t=this._getFormHandler(e);return t&&(t.focusedInput=e),t}get activeSection(){let e=this.activeHandler;return e?e.activeSection:null}_getFormHandler(e){if(!e)return null;let t=i.FormLikeFactory.findRootForField(e);return this._formsDetails.get(t)}identifyAutofillFields(e){let t=this._getFormHandler(e);if(t){if(!t.updateFormIfNeeded(e))return t.fieldDetails}else{let r=i.FormLikeFactory.createFromField(e);t=new i.FormAutofillHandler(r,this.onSubmit,this.onAutofillCallback)}return this._formsDetails.set(t.form.rootElement,t),t.collectFormFields()}updateActiveInput(e){this._activeItems=e?{elementWeakRef:new WeakRef(e),fieldDetail:null}:{}}getRecords(e,t){const r=(t=t||this._formsDetails.get(e))?.createRecords();return t&&r&&Object.values(r).some((e=>e.length))?r:null}didDestroy(){this._activeItems=null}}const s=n},564:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AppConstants:()=>i.IOSAppConstants,AutofillTelemetry:()=>f,ChromeUtils:()=>d,OSKeyStore:()=>u,Region:()=>c,Services:()=>m,XPCOMUtils:()=>o,windowUtils:()=>h});var i=r(461),n=r(0),s=r.n(n);HTMLSelectElement.isInstance=e=>e instanceof HTMLSelectElement,HTMLInputElement.isInstance=e=>e instanceof HTMLInputElement,HTMLFormElement.isInstance=e=>e instanceof HTMLFormElement,ShadowRoot.isInstance=e=>e instanceof ShadowRoot,HTMLElement.prototype.ownerGlobal=window,HTMLInputElement.prototype.setUserInput=function(e){this.value=e,this.dispatchEvent(new Event("input",{bubbles:!0}))},HTMLElement.prototype.getAutocompleteInfo=function(){const e=this.getAttribute("autocomplete");return{fieldName:i.IOSAppConstants.validAutocompleteFields.includes(e)?e:""}},HTMLElement.prototype.checkVisibility=function(e){throw new Error("Not implemented: WebKit doesn't support checkVisibility ")};const a=e=>new Proxy(e,{get(e,t){if(!Object.keys(e).includes(t))throw new Error(`Not implemented: ${t} doesn't exist in mocked object `);return Reflect.get(...arguments)}}),l={resolveModule(e){const t=r(528),i=e.split("/").pop();return t("./"+(s().ModuleOverrides[i]??i))},resolveModules(e,t){for(const[r,i]of Object.entries(t)){const t=this.resolveModule(i);e[r]=t?.[r]}}},o=a({defineLazyGetter:(e,t,r)=>{e[t]=r?.call(e)},defineLazyPreferenceGetter:(e,t,r,n=null,s=null,a=(e=>e))=>{if(!Object.keys(i.IOSAppConstants.prefs).includes(r))throw Error(`Pref ${r} is not defined.`);e[t]=a(i.IOSAppConstants.prefs[r]??n)},defineLazyModuleGetters(e,t){l.resolveModules(e,t)}}),d=a({defineLazyGetter:(e,t,r)=>{e[t]=r?.call(e)},defineESModuleGetters(e,t){l.resolveModules(e,t)},importESModule:e=>l.resolveModule(e)});window.ChromeUtils=d;const c=a({home:"US"}),u=a({ensureLoggedIn:()=>!0}),m=a({focus:a({elementIsFocusable:e=>!e.disabled&&!e.hidden&&"none"!=e.style.display&&"-1"!=e.tabIndex}),intl:a({getAvailableLocaleDisplayNames:()=>[],getRegionDisplayNames:()=>[]}),locale:a({isAppLocaleRTL:!1}),prefs:a({prefIsLocked:()=>!1}),strings:a({createBundle:()=>a({GetStringFromName:()=>"",formatStringFromName:()=>""})}),uuid:a({generateUUID:()=>""})});window.Services=m;const h=a({removeManuallyManagedState:()=>{},addManuallyManagedState:()=>{}});window.windowUtils=h;const f=a({recordFormInteractionEvent:()=>{},recordDetectedSectionCount:()=>{}})},697:(e,t,r)=>{"use strict";r.r(t),r.d(t,{HeuristicsRegExp:()=>i,default:()=>n});const i={RULES:{email:void 0,tel:void 0,organization:void 0,"street-address":void 0,"address-line1":void 0,"address-line2":void 0,"address-line3":void 0,"address-level2":void 0,"address-level1":void 0,"postal-code":void 0,country:void 0,"cc-name":void 0,name:void 0,"given-name":void 0,"additional-name":void 0,"family-name":void 0,"cc-csc":void 0,"cc-number":void 0,"cc-exp-month":void 0,"cc-exp-year":void 0,"cc-exp":void 0,"cc-type":void 0},LABEL_RULES:{"address-line1":void 0,"address-line2":void 0},RULE_SETS:[{"address-line1":"addrline1|address_1|addl1","address-line2":"addrline2|address_2|addl2","address-line3":"addrline3|address_3|addl3","address-level1":"land","additional-name":"apellido.?materno|lastlastname","cc-name":"accountholdername|titulaire","cc-number":"(cc|kk)nr","cc-exp":"ważna.*do|data.*ważności|mm\\s*[\\-\\/]\\s*yy|mm\\s*[\\-\\/]\\s*aa|mm\\s*[\\-\\/]\\s*jj|vervaldatum","cc-exp-month":"month|(cc|kk)month|miesiąc|mes|maand","cc-exp-year":"year|(cc|kk)year|rok|(anno|año)|jaar","cc-type":"type|kartenmarke|typ.*karty","cc-csc":"(\\bcvn\\b|\\bcvv\\b|\\bcvc\\b|\\bcsc\\b|\\bcvd\\b|\\bcid\\b|\\bccv\\b)"},{email:"(^e-?mail$)|(^email-?address$)",tel:"(^phone$)|(^mobile$)|(^mobile-?phone$)|(^tel$)|(^telephone$)|(^phone-?number$)",organization:"(^company$)|(^company-?name$)|(^organization$)|(^organization-?name$)","street-address":"(^address$)|(^street-?address$)|(^addr$)|(^street$)|(^mailing-?addr(ess)?$)|(^billing-?addr(ess)?$)|(^mail-?addr(ess)?$)|(^bill-?addr(ess)?$)","address-line1":"(^address-?1$)|(^address-?line-?1$)|(^addr-?1$)|(^street-?1$)","address-line2":"(^address-?2$)|(^address-?line-?2$)|(^addr-?2$)|(^street-?2$)","address-line3":"(^address-?3$)|(^address-?line-?3$)|(^addr-?3$)|(^street-?3$)","address-level2":"(^city$)|(^town$)|(^address-?level-?2$)|(^address-?city$)|(^address-?town$)","address-level1":"(^state$)|(^province$)|(^provence$)|(^address-?level-?1$)|(^address-?state$)|(^address-?province$)","postal-code":"(^postal$)|(^zip$)|(^zip2$)|(^zip-?code$)|(^postal-?code$)|(^post-?code$)|(^address-?zip$)|(^address-?postal$)|(^address-?code$)|(^address-?postal-?code$)|(^address-?zip-?code$)",country:"(^country$)|(^country-?code$)|(^country-?name$)|(^address-?country$)|(^address-?country-?name$)|(^address-?country-?code$)",name:"(^name$)|full-?name|your-?name","given-name":"(^f-?name$)|(^first-?name$)|(^given-?name$)|(^first-?n$)","additional-name":"(^m-?name$)|(^middle-?name$)|(^additional-?name$)|(^middle-?initial$)|(^middle-?n$)|(^middle-?i$)","family-name":"(^l-?name$)|(^last-?name$)|(^s-?name$)|(^surname$)|(^family-?name$)|(^family-?n$)|(^last-?n$)","cc-name":"cc-?name|card-?name|cardholder-?name|cardholder|(^nom$)","cc-number":"cc-?number|cc-?num|card-?number|card-?num|(^number$)|(^cc$)|cc-?no|card-?no|(^credit-?card$)|numero-?carte|(^carte$)|(^carte-?credit$)|num-?carte|cb-?num","cc-exp":"(^cc-?exp$)|(^card-?exp$)|(^cc-?expiration$)|(^card-?expiration$)|(^cc-?ex$)|(^card-?ex$)|(^card-?expire$)|(^card-?expiry$)|(^validite$)|(^expiration$)|(^expiry$)|mm-?yy|mm-?yyyy|yy-?mm|yyyy-?mm|expiration-?date|payment-?card-?expiration|(^payment-?cc-?date$)","cc-exp-month":"(^exp-?month$)|(^cc-?exp-?month$)|(^cc-?month$)|(^card-?month$)|(^cc-?mo$)|(^card-?mo$)|(^exp-?mo$)|(^card-?exp-?mo$)|(^cc-?exp-?mo$)|(^card-?expiration-?month$)|(^expiration-?month$)|(^cc-?mm$)|(^cc-?m$)|(^card-?mm$)|(^card-?m$)|(^card-?exp-?mm$)|(^cc-?exp-?mm$)|(^exp-?mm$)|(^exp-?m$)|(^expire-?month$)|(^expire-?mo$)|(^expiry-?month$)|(^expiry-?mo$)|(^card-?expire-?month$)|(^card-?expire-?mo$)|(^card-?expiry-?month$)|(^card-?expiry-?mo$)|(^mois-?validite$)|(^mois-?expiration$)|(^m-?validite$)|(^m-?expiration$)|(^expiry-?date-?field-?month$)|(^expiration-?date-?month$)|(^expiration-?date-?mm$)|(^exp-?mon$)|(^validity-?mo$)|(^exp-?date-?mo$)|(^cb-?date-?mois$)|(^date-?m$)","cc-exp-year":"(^exp-?year$)|(^cc-?exp-?year$)|(^cc-?year$)|(^card-?year$)|(^cc-?yr$)|(^card-?yr$)|(^exp-?yr$)|(^card-?exp-?yr$)|(^cc-?exp-?yr$)|(^card-?expiration-?year$)|(^expiration-?year$)|(^cc-?yy$)|(^cc-?y$)|(^card-?yy$)|(^card-?y$)|(^card-?exp-?yy$)|(^cc-?exp-?yy$)|(^exp-?yy$)|(^exp-?y$)|(^cc-?yyyy$)|(^card-?yyyy$)|(^card-?exp-?yyyy$)|(^cc-?exp-?yyyy$)|(^expire-?year$)|(^expire-?yr$)|(^expiry-?year$)|(^expiry-?yr$)|(^card-?expire-?year$)|(^card-?expire-?yr$)|(^card-?expiry-?year$)|(^card-?expiry-?yr$)|(^an-?validite$)|(^an-?expiration$)|(^annee-?validite$)|(^annee-?expiration$)|(^expiry-?date-?field-?year$)|(^expiration-?date-?year$)|(^cb-?date-?ann$)|(^expiration-?date-?yy$)|(^expiration-?date-?yyyy$)|(^validity-?year$)|(^exp-?date-?year$)|(^date-?y$)","cc-type":"(^cc-?type$)|(^card-?type$)|(^card-?brand$)|(^cc-?brand$)|(^cb-?type$)"},{email:"e.?mail|courriel|correo.*electr(o|ó)nico|メールアドレス|Электронной.?Почты|邮件|邮箱|電郵地址|ഇ-മെയില്‍|ഇലക്ട്രോണിക്.?മെയിൽ|ایمیل|پست.*الکترونیک|ईमेल|इलॅक्ट्रॉनिक.?मेल|(\\b|_)eposta(\\b|_)|(?:이메일|전자.?우편|[Ee]-?mail)(.?주소)?",tel:"phone|mobile|contact.?number|telefonnummer|telefono|teléfono|telfixe|電話|telefone|telemovel|телефон|मोबाइल|(\\b|_|\\*)telefon(\\b|_|\\*)|电话|മൊബൈല്‍|(?:전화|핸드폰|휴대폰|휴대전화)(?:.?번호)?",organization:"company|business|organization|organisation|(?<neg>confirma)|firma|firmenname|empresa|societe|société|ragione.?sociale|会社|название.?компании|单位|公司|شرکت|회사|직장","street-address":"streetaddress|street-address","address-line1":"^address$|address[_-]?line(one)?|address1|addr1|street|(?:shipping|billing)address$|strasse|straße|hausnummer|housenumber|house.?name|direccion|dirección|adresse|indirizzo|^住所$|住所1|morada|(?<neg>identificação do endereço)|(endereço)|Адрес|地址|(\\b|_)adres(?! (başlığı(nız)?|tarifi))(\\b|_)|^주소.?$|주소.?1","address-line2":"address[_-]?line(2|two)|address2|addr2|street|suite|unit(?!e)|adresszusatz|ergänzende.?angaben|direccion2|colonia|adicional|addresssuppl|complementnom|appartement|indirizzo2|住所2|complemento|addrcomplement|Улица|地址2|주소.?2","address-line3":"address[_-]?line(3|three)|address3|addr3|street|suite|unit(?!e)|adresszusatz|ergänzende.?angaben|direccion3|colonia|adicional|addresssuppl|complementnom|appartement|indirizzo3|住所3|complemento|addrcomplement|Улица|地址3|주소.?3","address-level2":"city|town|\\bort\\b|stadt|suburb|ciudad|provincia|localidad|poblacion|ville|commune|localita|市区町村|cidade|Город|市|分區|شهر|शहर|ग्राम|गाँव|നഗരം|ഗ്രാമം|((\\b|_|\\*)([İii̇]l[cç]e(miz|niz)?)(\\b|_|\\*))|^시[^도·・]|시[·・]?군[·・]?구","address-level1":"(?<neg>united?.state|hist?.state|history?.state)|state|county|region|province|principality|都道府県|estado|provincia|область|省|地區|സംസ്ഥാനം|استان|राज्य|((\\b|_|\\*)(eyalet|[şs]ehir|[İii̇]l(imiz)?|kent)(\\b|_|\\*))|^시[·・]?도","postal-code":"zip|postal|post.*code|pcode|pin.?code|postleitzahl|\\bcp\\b|\\bcdp\\b|\\bcap\\b|郵便番号|codigo|codpos|\\bcep\\b|Почтовый.?Индекс|पिन.?कोड|പിന്‍കോഡ്|邮政编码|邮编|郵遞區號|(\\b|_)posta kodu(\\b|_)|우편.?번호",country:"country|countries|país|pais|(\\b|_)land(\\b|_)(?!.*(mark.*))|(?<neg>入国|出国)|国|国家|국가|나라|(\\b|_)(ülke|ulce|ulke)(\\b|_)|کشور","cc-name":"card.?(?:holder|owner)|name.*(\\b)?on(\\b)?.*card|(?:card|cc).?name|cc.?full.?name|karteninhaber|nombre.*tarjeta|nom.*carte|nome.*cart|名前|Имя.*карты|信用卡开户名|开户名|持卡人姓名|持卡人姓名",name:"^name|full.?name|your.?name|customer.?name|bill.?name|ship.?name|name.*first.*last|firstandlastname|nombre.*y.*apellidos|^nom(?!bre)|お名前|氏名|^nome|نام.*نام.*خانوادگی|姓名|(\\b|_|\\*)ad[ı]? soyad[ı]?(\\b|_|\\*)|성명","given-name":"first.*name|initials|fname|first$|given.*name|vorname|nombre|forename|prénom|prenom|名|nome|Имя|نام|이름|പേര്|(\\b|_|\\*)(isim|ad|ad(i|ı|iniz|ınız)?)(\\b|_|\\*)|नाम","additional-name":"middle.*name|mname|middle$|middle.*initial|m\\.i\\.|mi$|\\bmi\\b","family-name":"last.*name|lname|surname|last$|secondname|family.*name|nachname|apellidos?|famille|^nom(?!bre)|cognome|姓|apelidos|surename|sobrenome|Фамилия|نام.*خانوادگی|उपनाम|മറുപേര്|(\\b|_|\\*)(soyisim|soyad(i|ı|iniz|ınız)?)(\\b|_|\\*)|\\b성(?:[^명]|\\b)","cc-number":"(add)?(?:card|cc|acct).?(?:number|#|no|num|field)|(?<neg>telefonnummer|hausnummer|personnummer|fødselsnummer)|nummer|カード番号|Номер.*карты|信用卡号|信用卡号码|信用卡卡號|카드|(numero|número|numéro)(?!.*(document|fono|phone|réservation))","cc-exp-month":"expir|exp.*mo|exp.*date|ccmonth|cardmonth|addmonth|gueltig|gültig|monat|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты|月","cc-exp-year":"exp|^/|(add)?year|ablaufdatum|gueltig|gültig|jahr|fecha|scadenza|有効期限|validade|Срок действия карты|年|有效期","cc-exp":"expir|exp.*date|^expfield$|gueltig|gültig|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты","cc-csc":"verification|card.?identification|security.?code|card.?code|security.?value|security.?number|card.?pin|c-v-v|\\bcid\\b"}],LABEL_RULE_SETS:[{"address-line1":"(^\\W*address)|(address\\W*$)|(?:shipping|billing|mailing|pick.?up|drop.?off|delivery|sender|postal|recipient|home|work|office|school|business|mail)[\\s\\-]+address|address\\s+(of|for|to|from)|adresse|indirizzo|住所|地址|(\\b|_)adres(?! tarifi)(\\b|_)|주소|^alamat|street.*(house|building|apartment|floor)|(house|building|apartment|floor).*street|(sokak|cadde).*(apartman|bina|daire|mahalle)|(apartman|bina|daire|mahalle).*(sokak|cadde)|улиц.*(дом|корпус|квартир|этаж)|(дом|корпус|квартир|этаж).*улиц"},{"address-line2":"address|line|adresse|indirizzo|地址|주소"}],_getRules:(e,t)=>(Object.keys(e).forEach((r=>Object.defineProperty(e,r,{get:()=>function(r){let i=[];t.forEach((e=>{e[r]&&i.push(`(${e[r].toLowerCase()})`.normalize("NFKC"))}));const n=new RegExp(i.join("|"),"gu");return Object.defineProperty(e,r,{get:void 0}),Object.defineProperty(e,r,{value:n}),n}(r)}))),e),getLabelRules(){return this._getRules(this.LABEL_RULES,this.LABEL_RULE_SETS)},getRules(){return this._getRules(this.RULES,this.RULE_SETS)}},n=i},877:(e,t,r)=>{"use strict";r.r(t),r.d(t,{LabelUtils:()=>i,default:()=>n});const i={EXCLUDED_TAGS:["SCRIPT","NOSCRIPT","OPTION","STYLE"],_mappedLabels:null,_unmappedLabelControls:null,_labelStrings:null,extractLabelStrings(e){if(this._labelStrings.has(e))return this._labelStrings.get(e);let t=[],r=e=>{if(!this.EXCLUDED_TAGS.includes(e.tagName))if(e.nodeType!=e.TEXT_NODE&&e.childNodes.length)for(let t of e.childNodes){let e=t.nodeType;e!=t.ELEMENT_NODE&&e!=t.TEXT_NODE||r(t)}else{let r=e.textContent.trim();r&&t.push(r)}};return r(e),this._labelStrings.set(e,t),t},generateLabelMap(e){this._mappedLabels=new Map,this._unmappedLabelControls=[],this._labelStrings=new WeakMap;for(let t of e.querySelectorAll("label")){let e,r=t.htmlFor;if(!r){if(e=t.control,!e)continue;r=e.id}if(r){let e=this._mappedLabels.get(r);e?e.push(t):this._mappedLabels.set(r,[t])}else this._unmappedLabelControls.push({label:t,control:e})}},clearLabelMap(){this._mappedLabels=null,this._unmappedLabelControls=null,this._labelStrings=null},findLabelElements(e){this._mappedLabels||this.generateLabelMap(e.ownerDocument);let t=e.id;return t?this._mappedLabels.get(t)||[]:this._unmappedLabelControls.filter((t=>t.control==e)).map((e=>e.label))}},n=i},364:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Logic:()=>i});class i{static inputTypeIsCompatibleWithUsername(e){const t=e.getAttribute("type")?.toLowerCase()||e.type;return["text","email","url","tel","number","search"].includes(t)||t?.includes("user")}static elementAttrsMatchRegex(e,t){if(t.test(e.id)||t.test(e.name)||t.test(e.className))return!0;const r=e.getAttribute("placeholder");return r&&t.test(r)}static hasLabelMatchingRegex(e,t){return t.test(e.labels?.[0]?.textContent)}}},0:e=>{"use strict";e.exports={ModuleOverrides:{"AutofillTelemetry.sys.mjs":"Helpers.ios.mjs","AppConstants.sys.mjs":"Helpers.ios.mjs","XPCOMUtils.sys.mjs":"Helpers.ios.mjs","Region.sys.mjs":"Helpers.ios.mjs","OSKeyStore.sys.mjs":"Helpers.ios.mjs","FormAutofill.sys.mjs":"FormAutofill.ios.sys.mjs","EntryFile.sys.mjs":"FormAutofillChild.ios.sys.mjs"}}},716:(e,t,r)=>{"use strict";r.r(t),r.d(t,{and:()=>de,atMost:()=>le,clusters:()=>z,dom:()=>j,element:()=>H,exceptions:()=>s,nearest:()=>ce,note:()=>se,out:()=>ee,props:()=>ie,rule:()=>he,ruleset:()=>xe,score:()=>ae,type:()=>ne,typeIn:()=>oe,utils:()=>D,version:()=>Fe});class i extends Error{}class n extends Error{}var s=Object.freeze({__proto__:null,CycleError:i,NoWindowError:n});function a(e){return e}function l(e,t,r){let i,n,s=!0;if(w((function(e){const a=t(e);(r(a,n)||s)&&(i=e,n=a,s=!1)}),e),s)throw new Error("Tried to call best() on empty iterable");return i}function o(e,t=a){return l(e,t,((e,t)=>e>t))}function d(e,t=a){let r,i=[],n=!0;return w((function(e){const s=t(e);s>r||n?(i=[e],r=s,n=!1):s===r&&i.push(e)}),e),i}function c(e,t=a){return l(e,t,((e,t)=>e<t))}function u(e){let t,r=!0;return w((function(e){r?(t=e,r=!1):t+=e}),e),t}function*m(e,t=(e=>!0)){yield e;for(let r of e.childNodes)if(t(r))for(let e of m(r,t))yield e}const h=new Set(["ADDRESS","BLOCKQUOTE","BODY","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","HR","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL","DD","DT","FRAMESET","LI","TBODY","TD","TFOOT","TH","THEAD","TR","HTML"]);function f(e){return h.has(e.tagName)}function*p(e,t=(e=>!0)){for(let r of m(e,(e=>!(f(e)||"SCRIPT"===e.tagName&&"STYLE"===e.tagName)&&t(e))))r.nodeType===r.TEXT_NODE&&(yield r.textContent)}function y(e,t=(e=>!0)){return u(v((e=>g(e).length),p(e,t)))}function g(e){return e.replace(/\s{2,}/g," ")}function x(e){return e.nodeType===e.TEXT_NODE&&0===e.textContent.trim().length}function b(e,t,r){if(e.has(t))return e.get(t);const i=r();return e.set(t,i),i}function E(e,t,r){return e.has(t)?e.get(t):r()}function F(e,t){const r=[],n=new Set(e),s=new Set;function a(e){if(s.has(e))throw new i("The graph has a cycle.");if(n.has(e)){s.add(e);for(let r of t(e))a(r);s.delete(e),n.delete(e),r.push(e)}}for(;n.size>0;)a(C(n));return r}class _ extends Set{pop(){for(let e of this.values())return this.delete(e),e;throw new Error("Tried to pop from an empty NiceSet.")}extend(e){for(let t of e)this.add(t);return this}minus(e){const t=new _(this);for(const r of e)t.delete(r);return t}toString(){return"{"+Array.from(this).join(", ")+"}"}}function C(e){for(let t of e)return t}function S(e){return e.ownerDocument.documentElement}function A(e){return I(e)?e:e.element}function*L(e){let t;for(yield e;null!==(t=e.parentNode)&&t.nodeType===t.ELEMENT_NODE;)yield t,e=t}function M(e){return 1/(1+Math.exp(-e))}function*N(e){for(const r of e)"string"!=typeof r&&(t=r)&&"function"==typeof t[Symbol.iterator]?yield*N(r):yield r;var t}function*v(e,t){for(const r of t)yield e(r)}function w(e,t){for(const r of t)e(r)}function I(e){return void 0!==e.nodeName}function*R(e){for(let t=e.length-1;t>=0;t--)yield e[t]}function T(e){let t=e.ownerDocument;null===t&&(t=e);const r=t.defaultView;if(null===r)throw new n;return r}var D=Object.freeze({__proto__:null,identity:a,best:l,max:o,maxes:d,min:c,sum:u,length:function(e){let t=0;for(let r of e)t++;return t},walk:m,isBlock:f,inlineTexts:p,inlineTextLength:y,collapseWhitespace:g,linkDensity:function(e,t){void 0===t&&(t=y(e.element));const r=y(e.element,(e=>"A"!==e.tagName));return(t-r)/t},isWhitespace:x,setDefault:b,getDefault:E,toposort:F,NiceSet:_,first:C,rootElement:S,numberOfMatches:function(e,t){return(t.match(e)||[]).length},page:function(e){return function(t){const r=e(t);return void 0!==r.score&&(r.element=S(t.element)),r}},domSort:function(e){return Array.from(e).sort((function(e,t){const r=e.element,i=r.compareDocumentPosition(t.element);return i&r.DOCUMENT_POSITION_FOLLOWING?-1:i&r.DOCUMENT_POSITION_PRECEDING?1:0}))},toDomElement:A,attributesMatch:function(e,t,r=[]){const i=0===r.length?Array.from(e.attributes).map((e=>e.name)):r;for(let r=0;r<i.length;r++){const n=e.getAttribute(i[r]);if(n&&(Array.isArray(n)&&n.some(t)||t(n)))return!0}return!1},ancestors:L,sigmoid:M,isVisible:function(e){const t=A(e),r=T(t),i=t.getBoundingClientRect(),n=r.getComputedStyle(t);if(0===i.width&&0===i.height&&"hidden"!==n.overflow)return!1;if("hidden"===n.visibility)return!1;if(i.x+i.width<0||i.y+i.height<0)return!1;for(const e of L(t)){const s=e===t,a=s?n:r.getComputedStyle(e);if("0"===a.opacity)return!1;if("contents"===a.display)continue;const l=s?i:e.getBoundingClientRect();if((0===l.width||0===l.height)&&"hidden"===n.overflow)return!1}return!0},rgbaFromString:function(e){const t=e.match(/^rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/i);if(t)return[t[1]/255,t[2]/255,t[3]/255,void 0===t[4]?void 0:parseFloat(t[4])];throw new Error("Color "+e+" did not match pattern rgb[a](r, g, b[, a]).")},saturation:function(e,t,r){const i=Math.max(e,t,r),n=Math.min(e,t,r),s=i-n,a=(i+n)/2,l=1-Math.abs(2*a-1);return 0===l?0:s/l},linearScale:function(e,t,r){if(t<r){if(e<=t)return 0;if(e>=r)return 1}else{if(e>=t)return 0;if(e<=r)return 1}return 1/(r-t)*(e-t)},flatten:N,map:v,forEach:w,isDomElement:I,reversed:R,windowForElement:T});function $(e,t){let r=0,i=e,n=i&&i!==t;for(;n;)i=i.nextSibling,(n=i&&i!==t)&&!x(i)&&(r+=1);if(i!==t)for(i=t;i;)i=i.previousSibling,i&&!x(i)&&(r+=1);return r}function O(e,t,{differentDepthCost:r=2,differentTagCost:i=2,sameTagCost:n=1,strideCost:s=1,additionalCost:a=((e,t)=>0)}={}){if(e===t)return 0;const l=I(e)?e:e.element,o=I(t)?t:t.element,d=[l],c=[o];let u=l,m=o;for(;!u.contains(o);)u=u.parentNode,d.push(u);const h=l.compareDocumentPosition(o);if(h&(l.DOCUMENT_POSITION_CONTAINS|l.DOCUMENT_POSITION_CONTAINED_BY))return Number.MAX_VALUE;do{m=m.parentNode,c.push(m)}while(m!==u);let f=d,p=c,y=0;for(h&l.DOCUMENT_POSITION_FOLLOWING?(f=d,p=c):h&l.DOCUMENT_POSITION_PRECEDING&&(f=c,p=d);f.length||p.length;){const e=f.pop(),t=p.pop();y+=void 0===e||void 0===t?r:e.tagName===t.tagName?n:i,0!==s&&(y+=$(e,t)*s)}return y+a(e,t)}function U(e,t){function r(e){return e.left+e.width/2}function i(e){return e.top+e.height/2}const n=A(e),s=A(t),a=n.getBoundingClientRect(),l=s.getBoundingClientRect();return Math.sqrt((r(a)-r(l))**2+(i(a)-i(l))**2)}class k{constructor(e,t){this._matrix=new Map;const r=e.map((e=>[e]));for(let e of r){const r=new Map;for(let i of this._matrix.keys())r.set(i,t(e[0],i[0]));this._matrix.set(e,r)}this._numClusters=r.length}closest(){const e=this;if(this._numClusters<2)throw new Error("There must be at least 2 clusters in order to return the closest() ones.");return c(function(){const t=[];for(let[r,i]of e._matrix.entries())for(let[e,n]of i.entries())t.push({a:r,b:e,distance:n});return t}(),(e=>e.distance))}_cachedDistance(e,t){let r=this._matrix.get(e).get(t);return void 0===r&&(r=this._matrix.get(t).get(e)),r}merge(e,t){const r=new Map;for(let i of this._matrix.keys())i!==e&&i!==t&&r.set(i,Math.min(this._cachedDistance(e,i),this._cachedDistance(t,i)));this._matrix.delete(e),this._matrix.delete(t);for(let r of this._matrix.values())r.delete(e),r.delete(t);this._matrix.set([e,t],r),this._numClusters-=1}numClusters(){return this._numClusters}clusters(){return Array.from(this._matrix.keys()).map((e=>Array.from(N(e))))}}function P(e,t,r=O){const i=new k(e,r);let n;for(;i.numClusters()>1&&(n=i.closest()).distance<t;)i.merge(n.a,n.b);return i.clusters()}var z=Object.freeze({__proto__:null,distance:O,euclidean:U,clusters:P});function j(e){return new V(e)}function H(e){return new B(e)}class G{constructor(){this._predicate=()=>!0}static fromFirstCall(e){if("type"===e.method)return new Y(...e.args);if("and"===e.method)return new q(e.args);if("nearest"===e.method)return new Q(e.args);throw new Error("The left-hand side of a rule() must start with dom(), type(), and(), or nearest().")}when(e){let t=this.clone();return t._predicate=e,t}fnodesSatisfyingWhen(e){return Array.from(e).filter(this._predicate)}checkFact(e){}guaranteedType(){}aggregatedType(){}}class V extends G{constructor(e){if(super(),void 0===e)throw new Error("A querySelector()-style selector is required as the argument to "+this._callName()+"().");this.selector=e}_callName(){return"dom"}clone(){return new this.constructor(this.selector)}fnodes(e){return this._domNodesToFilteredFnodes(e,e.doc.querySelectorAll(this.selector))}_domNodesToFilteredFnodes(e,t){let r=[];for(let i=0;i<t.length;i++)r.push(e.fnodeForElement(t[i]));return this.fnodesSatisfyingWhen(r)}checkFact(e){if(void 0===e.type)throw new Error(`The right-hand side of a ${this._callName()}() rule failed to specify a type. This means there is no way for its output to be used by later rules. All it specified was ${e}.`)}asLhs(){return this}possibleTypeCombinations(){return[]}typesMentioned(){return new _}}class B extends V{_callName(){return"element"}fnodes(e){return this._domNodesToFilteredFnodes(e,e.doc.matches(this.selector)?[e.doc]:[])}}class Y extends G{constructor(e){if(super(),void 0===e)throw new Error("A type name is required when calling type().");this._type=e}clone(){return new this.constructor(this._type)}fnodes(e){const t=E(e.typeCache,this._type,(()=>[]));return this.fnodesSatisfyingWhen(t)}type(e){return new this.constructor(e)}max(){return new X(this._type)}bestCluster(e){return new K(this._type,e)}guaranteedType(){return this._type}possibleTypeCombinations(){return[this.typesMentioned()]}typesMentioned(){return new _([this._type])}}class W extends Y{aggregatedType(){return this._type}}class X extends W{fnodes(e){const t=this,r=()=>super.fnodes(e);return b(e.maxCache,this._type,(function(){return d(r(),(r=>e.weightedScore(r.scoresSoFarFor(t._type))))}))}}class K extends W{constructor(e,t){super(e),this._options=t||{splittingDistance:3}}fnodes(e){const t=Array.from(super.fnodes(e));return 0===t.length?[]:o(P(t,this._options.splittingDistance,((e,t)=>O(e,t,this._options))).map((e=>[e,u(e.map((e=>e.scoreFor(this._type))))])),(e=>e[1]))[0]}}class q extends G{constructor(e){super(),this._args=e.map(J)}*fnodes(e){const t=this._args[0].fnodes(e);e:for(let e of t){for(let t of this._args.slice(1))if(!e.hasType(t.guaranteedType()))continue e;yield e}}possibleTypeCombinations(){return[this.typesMentioned()]}typesMentioned(){return new _(this._args.map((e=>e.guaranteedType())))}}function J(e){const t=e.asLhs();if(t.constructor!==Y)throw new Error("and() and nearest() support only simple type() calls as arguments for now.");return t}class Q extends G{constructor([e,t,r]){super(),this._a=J(e),this._b=J(t),this._distance=r}*fnodes(e){const t=this._a.fnodes(e),r=Array.from(this._b.fnodes(e));if(r.length>0)for(const e of t){const t=c(r,(t=>this._distance(e,t)));yield{fnode:e,rhsTransformer:function(e){return void 0===e.note&&(e.note=t),e}}}}checkFact(e){}possibleTypeCombinations(){return[new _([this._a.guaranteedType()])]}typesMentioned(){return new _([this._a.guaranteedType(),this._b.guaranteedType()])}guaranteedType(){return this._a.guaranteedType()}}const Z={type:1,note:2,score:4,element:8};function ee(e){return new re(e)}class te{constructor(e=[],t=1/0,r){this._calls=e.slice(),this._max=t,this._types=new _(r)}atMost(e){return new this.constructor(this._calls,e,this._types)}_checkAtMost(e){if(void 0!==e.score&&e.score>this._max)throw new Error(`Score of ${e.score} exceeds the declared atMost(${this._max}).`)}props(e){function t(r){const i=e(r);for(let e in i)Z.hasOwnProperty(e)&&Z[e]&t.possibleSubfacts||delete i[e];return i}return t.possibleSubfacts=15,t.kind="props",new this.constructor(this._calls.concat(t),this._max,this._types)}type(e){function t(){return{type:e}}return t.possibleSubfacts=1,t.type=e,t.kind="type",new this.constructor(this._calls.concat(t),this._max,this._types)}typeIn(...e){return new this.constructor(this._calls,this._max,e)}_checkTypeIn(e,t){if(this._types.size>0)if(void 0===e.type){if(!this._types.has(t))throw new Error(`A right-hand side claimed, via typeIn(...) to emit one of the types ${this._types} but actually inherited ${t} from the left-hand side.`)}else if(!this._types.has(e.type))throw new Error(`A right-hand side claimed, via typeIn(...) to emit one of the types ${this._types} but actually emitted ${e.type}.`)}note(e){function t(t){return{note:e(t)}}return t.possibleSubfacts=2,t.kind="note",new this.constructor(this._calls.concat(t),this._max,this._types)}score(e){let t;return t="number"==typeof e?function(t){return{score:e}}:function(t){let r=e(t);return"boolean"==typeof r&&(r=Number(r)),{score:r}},t.possibleSubfacts=4,t.kind="score",new this.constructor(this._calls.concat(t),this._max,this._types)}fact(e,t){const r=new Set,i={};let n=0;for(let t of R(this._calls))if(!r.has(t.kind)&&(r.add(t.kind),~n&t.possibleSubfacts)){const r=t(e);for(let e in r)i.hasOwnProperty(e)||(i[e]=r[e]),n|=Z[e]}return this._checkAtMost(i),this._checkTypeIn(i,t),i}possibleEmissions(){let e=!1;for(let t of R(this._calls)){if("props"===t.kind){e=!0;break}if("type"===t.kind)return{couldChangeType:!0,possibleTypes:new Set([t.type])}}return{couldChangeType:e,possibleTypes:this._types}}}class re{constructor(e,t=(e=>e),r=(e=>e)){this.key=e,this.callback=t,this.allCallback=r}through(e){return new this.constructor(this.key,e,this.allCallback)}allThrough(e){return new this.constructor(this.key,this.callback,e)}asRhs(){return this}}function ie(e){return new ue({method:"props",args:[e]})}function ne(e){return new ue({method:"type",args:[e]})}function se(e){return new ue({method:"note",args:[e]})}function ae(e){return new ue({method:"score",args:[e]})}function le(e){return new ue({method:"atMost",args:[e]})}function oe(...e){return new ue({method:"typeIn",args:e})}function de(...e){return new ue({method:"and",args:e})}function ce(e,t,r=U){return new ue({method:"nearest",args:[e,t,r]})}class ue{constructor(...e){this._calls=e}max(){return this._and("max")}bestCluster(e){return this._and("bestCluster",e)}props(e){return this._and("props",e)}type(...e){return this._and("type",...e)}note(e){return this._and("note",e)}score(e){return this._and("score",e)}atMost(e){return this._and("atMost",e)}typeIn(...e){return this._and("typeIn",...e)}and(...e){return this._and("and",e)}_and(e,...t){return new this.constructor(...this._calls.concat({method:e,args:t}))}asLhs(){return this._asSide(G.fromFirstCall(this._calls[0]),this._calls.slice(1))}asRhs(){return this._asSide(new te,this._calls)}_asSide(e,t){for(let r of t)e=e[r.method](...r.args);return e}when(e){return this._and("when",e)}}class me{constructor(e,t){if(void 0===e)throw new Error("Someone tried to make a fnode without specifying the element they're talking about.");this.element=e,this._ruleset=t,this._types=new Map,this._conservedScores=new Map}hasType(e){return this._computeType(e),this._types.has(e)}scoreFor(e){return this._computeType(e),M(this._ruleset.weightedScore(this.scoresSoFarFor(e))+E(this._ruleset.biases,e,(()=>0)))}noteFor(e){return this._computeType(e),this._noteSoFarFor(e)}hasNoteFor(e){return this._computeType(e),this._hasNoteSoFarFor(e)}typesSoFar(){return this._types.keys()}_noteSoFarFor(e){return this._typeRecordForGetting(e).note}_hasNoteSoFarFor(e){return void 0!==this._noteSoFarFor(e)}scoresSoFarFor(e){return this._typeRecordForGetting(e).score}addScoreFor(e,t,r){this._typeRecordForSetting(e).score.set(r,t)}setNoteFor(e,t){if(this._hasNoteSoFarFor(e)){if(void 0!==t)throw new Error(`Someone (likely the right-hand side of a rule) tried to add a note of type ${e} to an element, but one of that type already exists. Overwriting notes is not allowed, since it would make the order of rules matter.`)}else this._typeRecordForSetting(e).note=t}_typeRecordForSetting(e){return b(this._types,e,(()=>({score:new Map})))}_typeRecordForGetting(e){return E(this._types,e,(()=>({score:new Map})))}_computeType(e){this._types.has(e)||this._ruleset.get(ne(e))}}function he(e,t,r){return"string"==typeof t&&(t=ee(t)),new(t instanceof re?ge:ye)(e,t,r)}let fe=0;class pe{constructor(e,t,r){this.lhs=e.asLhs(),this.rhs=t.asRhs(),this.name=(r?r.name:void 0)||"_"+fe++}prerequisites(e){function t(e,t,r,i){for(let n of t){const t=r(n);if(!(t.length>0))throw new Error(`No rule ${i} the "${n}" type, but another rule needs it as input.`);e.extend(t)}}const r=new _;return t(r,this._typesFinalized(),(t=>e.inwardRulesThatCouldEmit(t)),"emits"),t(r,this.lhs.typesMentioned(),(t=>e.inwardRulesThatCouldAdd(t)),"adds"),r}_typesFinalized(){const e=this.lhs.aggregatedType();return void 0===e?new _:new _([e])}}class ye extends pe{results(e){if(e.doneRules.has(this))throw new Error("A bug in Fathom caused results() to be called on an inward rule twice. That could cause redundant score contributions, etc.");const t=this,r=this.lhs.fnodes(e),i=new Set;w((function(r){const n=t.lhs.guaranteedType(),{fnode:s=r,rhsTransformer:l=a}=r,o=l(t.rhs.fact(s,n));t.lhs.checkFact(o);const d=e.fnodeForElement(o.element||s.element),c=o.type||t.lhs.guaranteedType();if(void 0!==o.score){if(void 0===c)throw new Error(`The right-hand side of a rule specified a score (${o.score}) with neither an explicit type nor one we could infer from the left-hand side.`);d.addScoreFor(c,o.score,t.name)}if(void 0!==o.type||void 0!==o.note){if(void 0===c)throw new Error(`The right-hand side of a rule specified a note (${o.note}) with neither an explicit type nor one we could infer from the left-hand side. Notes are per-type, per-node, so that's a problem.`);d.setNoteFor(c,o.note)}i.add(d)}),r),e.doneRules.add(this);for(let t of i)for(let r of t.typesSoFar())b(e.typeCache,r,(()=>new Set)).add(t);return i.values()}typesItCouldEmit(){const e=this.rhs.possibleEmissions();if(e.couldChangeType||void 0===this.lhs.guaranteedType()){if(e.possibleTypes.size>0)return e.possibleTypes;throw new Error("Could not determine the emitted type of a rule because its right-hand side calls props() without calling typeIn().")}return new Set([this.lhs.guaranteedType()])}typesItCouldAdd(){const e=new Set(this.typesItCouldEmit());return e.delete(this.lhs.guaranteedType()),e}_typesFinalized(){const e=this;return function(){const t=new _,r=e.rhs.possibleEmissions();if(r.couldChangeType)for(let i of e.lhs.possibleTypeCombinations())for(let e of r.possibleTypes)if(!i.has(e)){t.extend(i);break}return t}().extend(super._typesFinalized())}}class ge extends pe{results(e){return this.rhs.allCallback(v(this.rhs.callback,v((function(e){return e instanceof me?e:e.fnode}),this.lhs.fnodes(e))))}key(){return this.rhs.key}_typesFinalized(){return this.lhs.typesMentioned().extend(super._typesFinalized())}}function xe(e,t=[],r=[]){return new be(e,t,r)}class be{constructor(e,t=[],r=[]){this._inRules=[],this._outRules=new Map,this._rulesThatCouldEmit=new Map,this._rulesThatCouldAdd=new Map,this._coeffs=new Map(t),this.biases=new Map(r);for(let t of e)if(t instanceof ye){this._inRules.push(t);const e=t.typesItCouldEmit();for(let r of e)b(this._rulesThatCouldEmit,r,(()=>[])).push(t);for(let e of t.typesItCouldAdd())b(this._rulesThatCouldAdd,e,(()=>[])).push(t)}else{if(!(t instanceof ge))throw new Error(`This element of ruleset()'s first param wasn't a rule: ${t}`);this._outRules.set(t.key(),t)}}against(e){return new Ee(e,this._inRules,this._outRules,this._rulesThatCouldEmit,this._rulesThatCouldAdd,this._coeffs,this.biases)}rules(){return Array.from([...this._inRules,...this._outRules.values()])}}class Ee{constructor(e,t,r,i,n,s,a){this.doc=e,this._inRules=t,this._outRules=r,this._rulesThatCouldEmit=i,this._rulesThatCouldAdd=n,this._coeffs=s,this.biases=a,this._clearCaches(),this.elementCache=new WeakMap,this.doneRules=new Set}setCoeffsAndBiases(e,t=[]){this._coeffs=new Map(e),this.biases=new Map(t),this._clearCaches()}_clearCaches(){this.maxCache=new Map,this.typeCache=new Map}get(e){if("string"==typeof e){if(this._outRules.has(e))return Array.from(this._execute(this._outRules.get(e)));throw new Error(`There is no out() rule with key "${e}".`)}if(I(e))return this.fnodeForElement(e);if(void 0!==e.asLhs){const t=he(e,ee(Symbol("outKey")));return Array.from(this._execute(t))}throw new Error("ruleset.get() expects a string, an expression like on the left-hand side of a rule, or a DOM node.")}weightedScore(e){let t=0;for(const[r,i]of e)t+=i*E(this._coeffs,r,(()=>1));return t}_prerequisitesTo(e,t=new Map){for(let r of e.prerequisites(this))if(!this.doneRules.has(r)){const i=t.has(r);b(t,r,(()=>[])).push(e),i||this._prerequisitesTo(r,t)}return t}_execute(e){const t=this._prerequisitesTo(e);let r,n;try{r=[e].concat(F(t.keys(),(e=>t.get(e))))}catch(e){throw e instanceof i?new i("There is a cyclic dependency in the ruleset."):e}for(let e of R(r))n=e.results(this);return Array.from(n)}inwardRulesThatCouldEmit(e){return E(this._rulesThatCouldEmit,e,(()=>[]))}inwardRulesThatCouldAdd(e){return E(this._rulesThatCouldAdd,e,(()=>[]))}fnodeForElement(e){return b(this.elementCache,e,(()=>new me(e,this)))}}const Fe="3.7.3"},528:(e,t,r)=>{var i={"./Constants.ios.mjs":461,"./CreditCard.sys.mjs":377,"./CreditCardRecord.sys.mjs":121,"./CreditCardRuleset.sys.mjs":783,"./FieldScanner.sys.mjs":173,"./FormAutofill.ios.sys.mjs":394,"./FormAutofill.sys.mjs":116,"./FormAutofillChild.ios.sys.mjs":233,"./FormAutofillExtras.ios.mjs":675,"./FormAutofillHandler.sys.mjs":81,"./FormAutofillHeuristics.sys.mjs":588,"./FormAutofillNameUtils.sys.mjs":54,"./FormAutofillSection.ios.sys.mjs":193,"./FormAutofillSection.sys.mjs":411,"./FormAutofillUtils.sys.mjs":494,"./FormLikeFactory.sys.mjs":359,"./FormStateManager.sys.mjs":498,"./Helpers.ios.mjs":564,"./HeuristicsRegExp.sys.mjs":697,"./LabelUtils.sys.mjs":877,"./LoginManager.shared.mjs":364,"./fathom.mjs":716};function n(e){var t=s(e);return r(t)}function s(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=s,e.exports=n,n.id=528}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=r(233),t=r(675);const i=e=>e,n=e=>(t,r=i)=>i=>e?.postMessage({type:t,payload:r(i)}),s=n(window.webkit.messageHandlers.creditCardMessageHandler),a=n(),l=s("capture-credit-card-form",(e=>Object.entries(e?.[0]).reduce(((e,[t,r])=>({...e,[t]:String(r)})),{}))),o=s("fill-credit-card-form"),d=a("fill-address-form"),c=a("capture-address-form");Object.defineProperty(window.__firefox__,"FormAutofillHelper",{enumerable:!1,configurable:!1,writable:!1,value:Object.freeze(new e.default({creditCard:{submit:l,autofill:o},address:{submit:c,autofill:d}}))}),Object.defineProperty(window.__firefox__,"FormAutofillExtras",{enumerable:!1,configurable:!1,writable:!1,value:Object.freeze(new t.default)})})()})();