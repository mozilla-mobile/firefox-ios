/*! fxa-content-server@1.89.2
 *
 * Git sha: 6c7b8c5d4278ff325b4622866fa90efcfec34b15
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * For more information, see https://github.com/mozilla/fxa-content-server/
 */

var requirejs,require,define;!function(global){function commentReplace(a,b,c,d){return d||""}function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if("."===(c=a[b]))a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=c&&c.split("/"),q=x.map,r=q&&q["*"];if(a&&(a=a.split("/"),j=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[j])&&(a[j]=a[j].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&p&&(o=p.slice(0,p.length-1),a=o.concat(a)),b(a),a=a.join("/")),d&&q&&(p||r)){f=a.split("/");a:for(g=f.length;g>0;g-=1){if(i=f.slice(0,g).join("/"),p)for(h=p.length;h>0;h-=1)if((e=getOwn(q,p.slice(0,h).join("/")))&&(e=getOwn(e,i))){k=e,l=g;break a}!m&&r&&getOwn(r,i)&&(m=getOwn(r,i),n=g)}!k&&m&&(k=m,l=n),k&&(f.splice(0,l,k),a=f.join("/"))}return getOwn(x.pkgs,a)||a}function d(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName)return b.parentNode.removeChild(b),!0})}function e(a){var b=getOwn(x.paths,a);if(b&&isArray(b)&&b.length>1)return b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){if(a.usingExports=!0,a.map.isDefine)return a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()}))}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(b){a=b}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var g=[];each(this.depMaps,function(a){g.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,g)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),void((k=getOwn(y,f.id))&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(a){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+a,a,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){if(a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/"),"string"==typeof a.urlArgs){var b=a.urlArgs;a.urlArgs=function(a,c){return(-1===c.indexOf("?")?"?":"&")+b}}var c=x.shim,d={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){d[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),c[b]=a}),x.shim=c),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){getOwn(y,a.id)&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|^blob\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs&&!/^blob\:/.test(h)?h+x.urlArgs(a,h):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){if(a.id===b.id)return c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){if("interactive"===a.readyState)return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g="_";return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version="2.2.0",req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts._;return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,e.onNodeCreated&&e.onNodeCreated(d,e,b,c),currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{setTimeout(function(){},0),importScripts(c),a.completeLoad(b)}catch(d){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,d,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){if(head||(head=a.parentNode),dataMain=a.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,commentReplace).replace(/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript())&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")]),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this);var requirejs,require,define;!function(global){function commentReplace(a,b,c,d){return d||""}function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if("."===(c=a[b]))a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=c&&c.split("/"),q=x.map,r=q&&q["*"];if(a&&(a=a.split("/"),j=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[j])&&(a[j]=a[j].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&p&&(o=p.slice(0,p.length-1),a=o.concat(a)),b(a),a=a.join("/")),d&&q&&(p||r)){f=a.split("/");a:for(g=f.length;g>0;g-=1){if(i=f.slice(0,g).join("/"),p)for(h=p.length;h>0;h-=1)if((e=getOwn(q,p.slice(0,h).join("/")))&&(e=getOwn(e,i))){k=e,l=g;break a}!m&&r&&getOwn(r,i)&&(m=getOwn(r,i),n=g)}!k&&m&&(k=m,l=n),k&&(f.splice(0,l,k),a=f.join("/"))}return getOwn(x.pkgs,a)||a}function d(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName)return b.parentNode.removeChild(b),!0})}function e(a){var b=getOwn(x.paths,a);if(b&&isArray(b)&&b.length>1)return b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){if(a.usingExports=!0,a.map.isDefine)return a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()}))}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(b){a=b}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var g=[];each(this.depMaps,function(a){g.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,g)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),void((k=getOwn(y,f.id))&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(a){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+a,a,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){if(a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/"),"string"==typeof a.urlArgs){var b=a.urlArgs;a.urlArgs=function(a,c){return(-1===c.indexOf("?")?"?":"&")+b}}var c=x.shim,d={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){d[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),c[b]=a}),x.shim=c),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){getOwn(y,a.id)&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|^blob\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs&&!/^blob\:/.test(h)?h+x.urlArgs(a,h):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){if(a.id===b.id)return c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){if("interactive"===a.readyState)return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}
void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g="_";return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version="2.2.0",req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts._;return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,e.onNodeCreated&&e.onNodeCreated(d,e,b,c),currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{setTimeout(function(){},0),importScripts(c),a.completeLoad(b)}catch(d){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,d,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){if(head||(head=a.parentNode),dataMain=a.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,commentReplace).replace(/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript())&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")]),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(){function a(a){return new Promise(function(b,c){i(a,b,c)})}function b(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function c(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var d="";if("undefined"!=typeof window){var e=document.querySelector("body");d=e.getAttribute("data-static-resource-host")||""}else"undefined"!=typeof global&&(require={config:function(a){module.exports=a}});require.config({baseUrl:"/scripts",config:{moment:{noGlobal:!0}},packages:[{location:"../bower_components/jquery-ui/ui",main:"draggable",name:"draggable"},{location:"../bower_components/jquery-ui-touch-punch",main:"jquery.ui.touch-punch",name:"touch-punch"}],requireOnDemand:["fxaClient","jwcrypto"],sriConfig:{"fxaClient":"sha512-i5dJ9h0bt8dyDx1ShMoHWWFU6Xe534zCD6xMO+3BlPzHBwexvoV/tW4AS1f/1bVrm6WcMETLb1GuI4+YzNoIlQ==","jwcrypto":"sha512-Drxt9+6wrcuP7AHr9UydnN88meUMyxEZKADkcMbLCgslLguEA1LUkuPZcgOtjdBYxWVfS4zClIu1g5imlHqRJg=="},onNodeCreated:function(a,b,c,e){a.src=d+e;var f=b.sriConfig[c];f&&(a.setAttribute("integrity",f),a.setAttribute("crossorigin","anonymous"))},paths:{backbone:"../bower_components/backbone/backbone",canvasToBlob:"../bower_components/blueimp-canvas-to-blob/js/canvas-to-blob",chai:"../bower_components/chai/chai",cocktail:"../bower_components/cocktail/Cocktail",duration:"../bower_components/Duration.js/duration",fxaCheckbox:"../bower_components/fxa-checkbox/checkbox",fxaClient:"../bower_components/fxa-js-client/4a6ac6dc.fxa-client",jquery:"../bower_components/jquery/dist/jquery","jquery-simulate":"../bower_components/jquery-simulate/jquery.simulate",jwcrypto:"vendor/jwcrypto/b735fe93.jwcrypto.ds","jwcrypto.rs":"vendor/jwcrypto/jwcrypto.rs",mailcheck:"../bower_components/mailcheck/src/mailcheck",modal:"../bower_components/jquery-modal/jquery.modal",moment:"../bower_components/moment/moment",mustache:"../bower_components/mustache/mustache","p-promise":"../bower_components/p/p",raven:"../bower_components/raven-js/dist/raven",sinon:"../bower_components/sinon/lib/sinon",speedTrap:"../bower_components/speed-trap/dist/speed-trap",stache:"../bower_components/requirejs-mustache/stache",text:"../bower_components/requirejs-text/text","ua-parser-js":"../bower_components/ua-parser-js/src/ua-parser",underscore:"../bower_components/underscore/underscore",uuid:"../bower_components/node-uuid/uuid",vat:"../bower_components/vat/vat",webrtc:"../bower_components/webrtc-adapter/adapter"},shim:{backbone:{deps:["underscore","jquery"],exports:"Backbone"},mailcheck:{deps:["jquery"],exports:"mailcheck"},modal:{deps:["jquery"],exports:"modal"},sinon:{exports:"sinon"},sjcl:{exports:"sjcl"},underscore:{exports:"_"}},stache:{extension:".mustache"}}),define("require_config",function(){}),function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&f<g;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&f<e;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&f<h;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)(f=F[c])in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(d<2||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;i<h;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&b<=y};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;d<e;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;d<e;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;g<e;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;if(void 0!==(d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c))&&-1!==d)return a[d]},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;h<i;h++)(d=a[h])>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){((e=b(a,c,d))>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;h<i;h++)(d=a[h])<f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){((e=b(a,c,d))<g||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;f<d;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);g<h;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;j<k;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);g<h;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);d<e;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;g<c&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;d<b;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);f<g;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;f<d;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;g<e;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(d<=1)throw new Error("bindAll must be passed function names");for(b=1;b<d;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=!1===c.leading?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||!1!==c.leading||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||!1===c.trailing||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;j<b&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;h<f;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;f<g;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;h<i;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;f<d;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case"[object Date]":case"[object Boolean]":return+a==+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if((i=a.length)!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a||(A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length)},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;e<a;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},M=function(a){return"\\"+L[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||/(.)^/).source,(b.interpolate||/(.)^/).source,(b.evaluate||/(.)^/).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(/\\|'|\r|\n|\u2028|\u2029/g,M),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(a){throw a.source=f,a}var h=function(a){return g.call(this,a,s)};return h.source="function("+(b.variable||"obj")+"){\n"+f+"}",h},s.chain=function(a){var b=s(a);return b._chain=!0,b};var N=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),N(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],N(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return N(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}.call(this),define("lib/able",["require","exports","module"],function(a,b,c){"use strict";function d(){}d.prototype={choose:function(){var a=window.able;if(a)return a.choose.apply(a,arguments)}},c.exports=d}),function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function c(a,b){b=b||_;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}function d(a){var b=!!a&&"length"in a&&a.length,c=la.type(a);return"function"!==c&&!la.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}function e(a,b,c){if(la.isFunction(b))return la.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return la.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(sa.test(b))return la.filter(b,a,c);b=la.filter(b,a)}return la.grep(a,function(a){return ea.call(b,a)>-1!==c&&1===a.nodeType})}function f(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function g(a){var b={};return la.each(a.match(xa)||[],function(a,c){b[c]=!0}),b}function h(a){return a}function i(a){throw a}function j(a,b,c){var d;try{a&&la.isFunction(d=a.promise)?d.call(a).done(b).fail(c):a&&la.isFunction(d=a.then)?d.call(a,b,c):b.call(void 0,a)}catch(a){c.call(void 0,a)}}function k(){_.removeEventListener("DOMContentLoaded",k),a.removeEventListener("load",k),la.ready()}function l(){this.expando=la.expando+l.uid++}function m(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Fa,"-$&").toLowerCase(),"string"==typeof(c=a.getAttribute(d))){try{c="true"===c||"false"!==c&&("null"===c?null:+c+""===c?+c:Ea.test(c)?JSON.parse(c):c)}catch(a){}Da.set(a,b,c)}else c=void 0;return c}function n(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return la.css(a,b,"")},i=h(),j=c&&c[3]||(la.cssNumber[b]?"":"px"),k=(la.cssNumber[b]||"px"!==j&&+i)&&Ha.exec(la.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do{f=f||".5",k/=f,la.style(a,b,k+j)}while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}function o(a){var b,c=a.ownerDocument,d=a.nodeName,e=La[d];return e||(b=c.body.appendChild(c.createElement(d)),e=la.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),La[d]=e,e)}function p(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=Ca.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&Ja(d)&&(e[f]=o(d))):"none"!==c&&(e[f]="none",Ca.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}function q(a,b){var c=void 0!==a.getElementsByTagName?a.getElementsByTagName(b||"*"):void 0!==a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&la.nodeName(a,b)?la.merge([a],c):c}function r(a,b){for(var c=0,d=a.length;c<d;c++)Ca.set(a[c],"globalEval",!b||Ca.get(b[c],"globalEval"))}function s(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if((f=a[n])||0===f)if("object"===la.type(f))la.merge(m,f.nodeType?[f]:f);else if(Qa.test(f)){for(g=g||l.appendChild(b.createElement("div")),h=(Na.exec(f)||["",""])[1].toLowerCase(),i=Pa[h]||Pa._default,g.innerHTML=i[1]+la.htmlPrefilter(f)+i[2],k=i[0];k--;)g=g.lastChild;la.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));for(l.textContent="",n=0;f=m[n++];)if(d&&la.inArray(f,d)>-1)e&&e.push(f);else if(j=la.contains(f.ownerDocument,f),g=q(l.appendChild(f),"script"),j&&r(g),c)for(k=0;f=g[k++];)Oa.test(f.type||"")&&c.push(f);return l}function t(){return!0}function u(){return!1}function v(){try{return _.activeElement}catch(a){}}function w(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)w(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),!1===e)e=u;else if(!e)return a;return 1===f&&(g=e,e=function(a){return la().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=la.guid++)),a.each(function(){la.event.add(this,b,e,d,c)})}function x(a,b){return la.nodeName(a,"table")&&la.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a:a}function y(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function z(a){var b=Xa.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function A(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(Ca.hasData(a)&&(f=Ca.access(a),g=Ca.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)la.event.add(b,e,j[e][c])}Da.hasData(a)&&(h=Da.access(a),i=la.extend({},h),Da.set(b,i))}}function B(a,b){var c=b.nodeName.toLowerCase();"input"===c&&Ma.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function C(a,b,d,e){b=ca.apply([],b);var f,g,h,i,j,k,l=0,m=a.length,n=m-1,o=b[0],p=la.isFunction(o);if(p||m>1&&"string"==typeof o&&!ka.checkClone&&Wa.test(o))return a.each(function(c){var f=a.eq(c);p&&(b[0]=o.call(this,c,f.html())),C(f,b,d,e)});if(m&&(f=s(b,a[0].ownerDocument,!1,a,e),g=f.firstChild,1===f.childNodes.length&&(f=g),g||e)){for(h=la.map(q(f,"script"),y),i=h.length;l<m;l++)j=f,l!==n&&(j=la.clone(j,!0,!0),i&&la.merge(h,q(j,"script"))),d.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,la.map(h,z),l=0;l<i;l++)j=h[l],Oa.test(j.type||"")&&!Ca.access(j,"globalEval")&&la.contains(k,j)&&(j.src?la._evalUrl&&la._evalUrl(j.src):c(j.textContent.replace(Ya,""),k))}return a}function D(a,b,c){for(var d,e=b?la.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||la.cleanData(q(d)),d.parentNode&&(c&&la.contains(d.ownerDocument,d)&&r(q(d,"script")),d.parentNode.removeChild(d));return a}function E(a,b,c){var d,e,f,g,h=a.style;return c=c||_a(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||la.contains(a.ownerDocument,a)||(g=la.style(a,b)),!ka.pixelMarginRight()&&$a.test(g)&&Za.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function F(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function G(a){if(a in eb)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=db.length;c--;)if((a=db[c]+b)in eb)return a}function H(a,b,c){var d=Ha.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function I(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;f<4;f+=2)"margin"===c&&(g+=la.css(a,c+Ia[f],!0,e)),d?("content"===c&&(g-=la.css(a,"padding"+Ia[f],!0,e)),"margin"!==c&&(g-=la.css(a,"border"+Ia[f]+"Width",!0,e))):(g+=la.css(a,"padding"+Ia[f],!0,e),"padding"!==c&&(g+=la.css(a,"border"+Ia[f]+"Width",!0,e)));return g}function J(a,b,c){var d,e=!0,f=_a(a),g="border-box"===la.css(a,"boxSizing",!1,f);if(a.getClientRects().length&&(d=a.getBoundingClientRect()[b]),d<=0||null==d){if(d=E(a,b,f),(d<0||null==d)&&(d=a.style[b]),$a.test(d))return d;e=g&&(ka.boxSizingReliable()||d===a.style[b]),d=parseFloat(d)||0}return d+I(a,b,c||(g?"border":"content"),e,f)+"px"}function K(a,b,c,d,e){return new K.prototype.init(a,b,c,d,e)}function L(){gb&&(a.requestAnimationFrame(L),la.fx.tick())}function M(){return a.setTimeout(function(){fb=void 0}),fb=la.now()}function N(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=Ia[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function O(a,b,c){for(var d,e=(R.tweeners[b]||[]).concat(R.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function P(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,q=a.nodeType&&Ja(a),r=Ca.get(a,"fxshow");c.queue||(g=la._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,la.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],hb.test(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}n[d]=r&&r[d]||la.style(a,d)}if((i=!la.isEmptyObject(b))||!la.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=r&&r.display,null==j&&(j=Ca.get(a,"display")),k=la.css(a,"display"),"none"===k&&(j?k=j:(p([a],!0),j=a.style.display||j,k=la.css(a,"display"),p([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===la.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(r?"hidden"in r&&(q=r.hidden):r=Ca.access(a,"fxshow",{display:j}),f&&(r.hidden=!q),q&&p([a],!0),m.done(function(){q||p([a]),Ca.remove(a,"fxshow");for(d in n)la.style(a,d,n[d])})),i=O(q?r[d]:0,d,m),d in r||(r[d]=i.start,q&&(i.end=i.start,i.start=0))}}function Q(a,b){var c,d,e,f,g;for(c in a)if(d=la.camelCase(c),e=b[d],f=a[c],la.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=la.cssHooks[d])&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function R(a,b,c){var d,e,f=0,g=R.prefilters.length,h=la.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=fb||M(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:la.extend({},b),opts:la.extend(!0,{specialEasing:{},easing:la.easing._default},c),originalProperties:b,originalOptions:c,startTime:fb||M(),duration:c.duration,tweens:[],createTween:function(b,c){var d=la.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props
;for(Q(k,j.opts.specialEasing);f<g;f++)if(d=R.prefilters[f].call(j,a,k,j.opts))return la.isFunction(d.stop)&&(la._queueHooks(j.elem,j.opts.queue).stop=la.proxy(d.stop,d)),d;return la.map(k,O,j),la.isFunction(j.opts.start)&&j.opts.start.call(a,j),la.fx.timer(la.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function S(a){return a.getAttribute&&a.getAttribute("class")||""}function T(a,b,c,d){var e;if(la.isArray(b))la.each(b,function(b,e){c||rb.test(a)?d(a,e):T(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==la.type(b))d(a,b);else for(e in b)T(a+"["+e+"]",b[e],c,d)}function U(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(xa)||[];if(la.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function V(a,b,c,d){function e(h){var i;return f[h]=!0,la.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===yb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function W(a,b){var c,d,e=la.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&la.extend(!0,a,d),a}function X(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function Y(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(!(g=j[i+" "+f]||j["* "+f]))for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a.throws)b=g(b);else try{b=g(b)}catch(a){return{state:"parsererror",error:g?a:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function Z(a){return la.isWindow(a)?a:9===a.nodeType&&a.defaultView}var $=[],_=a.document,aa=Object.getPrototypeOf,ba=$.slice,ca=$.concat,da=$.push,ea=$.indexOf,fa={},ga=fa.toString,ha=fa.hasOwnProperty,ia=ha.toString,ja=ia.call(Object),ka={},la=function(a,b){return new la.fn.init(a,b)},ma=function(a,b){return b.toUpperCase()};la.fn=la.prototype={jquery:"3.1.0",constructor:la,length:0,toArray:function(){return ba.call(this)},get:function(a){return null!=a?a<0?this[a+this.length]:this[a]:ba.call(this)},pushStack:function(a){var b=la.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return la.each(this,a)},map:function(a){return this.pushStack(la.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(ba.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:da,sort:$.sort,splice:$.splice},la.extend=la.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||la.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(la.isPlainObject(d)||(e=la.isArray(d)))?(e?(e=!1,f=c&&la.isArray(c)?c:[]):f=c&&la.isPlainObject(c)?c:{},g[b]=la.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},la.extend({expando:"jQuery"+("3.1.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===la.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=la.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==ga.call(a))&&(!(b=aa(a))||"function"==typeof(c=ha.call(b,"constructor")&&b.constructor)&&ia.call(c)===ja)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?fa[ga.call(a)]||"object":typeof a},globalEval:function(a){c(a)},camelCase:function(a){return a.replace(/^-ms-/,"ms-").replace(/-([a-z])/g,ma)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,e=0;if(d(a))for(c=a.length;e<c&&!1!==b.call(a[e],e,a[e]);e++);else for(e in a)if(!1===b.call(a[e],e,a[e]))break;return a},trim:function(a){return null==a?"":(a+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(d(Object(a))?la.merge(c,"string"==typeof a?[a]:a):da.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:ea.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d=[],e=0,f=a.length,g=!c;e<f;e++)!b(a[e],e)!==g&&d.push(a[e]);return d},map:function(a,b,c){var e,f,g=0,h=[];if(d(a))for(e=a.length;g<e;g++)null!=(f=b(a[g],g,c))&&h.push(f);else for(g in a)null!=(f=b(a[g],g,c))&&h.push(f);return ca.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),la.isFunction(a))return d=ba.call(arguments,2),e=function(){return a.apply(b||this,d.concat(ba.call(arguments)))},e.guid=a.guid=a.guid||la.guid++,e},now:Date.now,support:ka}),"function"==typeof Symbol&&(la.fn[Symbol.iterator]=$[Symbol.iterator]),la.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){fa["[object "+b+"]"]=b.toLowerCase()});var na=function(a){function b(a,b,c,d){var e,f,g,h,i,k,m,n=b&&b.ownerDocument,o=b?b.nodeType:9;if(c=c||[],"string"!=typeof a||!a||1!==o&&9!==o&&11!==o)return c;if(!d&&((b?b.ownerDocument||b:N)!==F&&E(b),b=b||F,H)){if(11!==o&&(i=pa.exec(a)))if(e=i[1]){if(9===o){if(!(g=b.getElementById(e)))return c;if(g.id===e)return c.push(g),c}else if(n&&(g=n.getElementById(e))&&L(b,g)&&g.id===e)return c.push(g),c}else{if(i[2])return Y.apply(c,b.getElementsByTagName(a)),c;if((e=i[3])&&u.getElementsByClassName&&b.getElementsByClassName)return Y.apply(c,b.getElementsByClassName(e)),c}if(u.qsa&&!S[a+" "]&&(!I||!I.test(a))){if(1!==o)n=b,m=a;else if("object"!==b.nodeName.toLowerCase()){for((h=b.getAttribute("id"))?h=h.replace(ta,ua):b.setAttribute("id",h=M),k=y(a),f=k.length;f--;)k[f]="#"+h+" "+l(k[f]);m=k.join(","),n=qa.test(a)&&j(b.parentNode)||b}if(m)try{return Y.apply(c,n.querySelectorAll(m)),c}catch(a){}finally{h===M&&b.removeAttribute("id")}}}return A(a.replace(fa,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>v.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[M]=!0,a}function e(a){var b=F.createElement("fieldset");try{return!!a(b)}catch(a){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=c.length;d--;)v.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){return"label"in b&&b.disabled===a||"form"in b&&b.disabled===a||"form"in b&&!1===b.disabled&&(b.isDisabled===a||b.isDisabled!==!a&&("label"in b||!wa(b))!==a)}}function i(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function j(a){return a&&void 0!==a.getElementsByTagName&&a}function k(){}function l(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function m(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=P++;return b.first?function(b,c,e){for(;b=b[d];)if(1===b.nodeType||g)return a(b,c,e)}:function(b,c,i){var j,k,l,m=[O,h];if(i){for(;b=b[d];)if((1===b.nodeType||g)&&a(b,c,i))return!0}else for(;b=b[d];)if(1===b.nodeType||g)if(l=b[M]||(b[M]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===O&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}}}function n(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function o(a,c,d){for(var e=0,f=c.length;e<f;e++)b(a,c[e],d);return d}function p(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function q(a,b,c,e,f,g){return e&&!e[M]&&(e=q(e)),f&&!f[M]&&(f=q(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],q=g.length,r=d||o(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:p(r,m,a,h,i),t=c?f||(d?a:q||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=p(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?$(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=p(t===g?t.splice(q,t.length):t),f?f(null,g,t,i):Y.apply(g,t)})}function r(a){for(var b,c,d,e=a.length,f=v.relative[a[0].type],g=f||v.relative[" "],h=f?1:0,i=m(function(a){return a===b},g,!0),j=m(function(a){return $(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==B)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];h<e;h++)if(c=v.relative[a[h].type])k=[m(n(k),c)];else{if(c=v.filter[a[h].type].apply(null,a[h].matches),c[M]){for(d=++h;d<e&&!v.relative[a[d].type];d++);return q(h>1&&n(k),h>1&&l(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(fa,"$1"),c,h<d&&r(a.slice(h,d)),d<e&&r(a=a.slice(d)),d<e&&l(a))}k.push(c)}return n(k)}function s(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",q=d&&[],r=[],s=B,t=d||f&&v.find.TAG("*",j),u=O+=null==s?1:Math.random()||.1,w=t.length;for(j&&(B=g===F||g||j);o!==w&&null!=(k=t[o]);o++){if(f&&k){for(l=0,g||k.ownerDocument===F||(E(k),h=!H);m=a[l++];)if(m(k,g||F,h)){i.push(k);break}j&&(O=u)}e&&((k=!m&&k)&&n--,d&&q.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(q,r,g,h);if(d){if(n>0)for(;o--;)q[o]||r[o]||(r[o]=W.call(i));r=p(r)}Y.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(O=u,B=s),q};return e?d(g):g}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M="sizzle"+1*new Date,N=a.document,O=0,P=0,Q=c(),R=c(),S=c(),T=function(a,b){return a===b&&(D=!0),0},U={}.hasOwnProperty,V=[],W=V.pop,X=V.push,Y=V.push,Z=V.slice,$=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},_="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",aa="[\\x20\\t\\r\\n\\f]",ba="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ca="\\["+aa+"*("+ba+")(?:"+aa+"*([*^$|!~]?=)"+aa+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ba+"))|)"+aa+"*\\]",da=":("+ba+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ca+")*)|.*)\\)|)",ea=new RegExp(aa+"+","g"),fa=new RegExp("^"+aa+"+|((?:^|[^\\\\])(?:\\\\.)*)"+aa+"+$","g"),ga=new RegExp("^"+aa+"*,"+aa+"*"),ha=new RegExp("^"+aa+"*([>+~]|"+aa+")"+aa+"*"),ia=new RegExp("="+aa+"*([^\\]'\"]*?)"+aa+"*\\]","g"),ja=new RegExp(da),ka=new RegExp("^"+ba+"$"),la={ID:new RegExp("^#("+ba+")"),CLASS:new RegExp("^\\.("+ba+")"),TAG:new RegExp("^("+ba+"|[*])"),ATTR:new RegExp("^"+ca),PSEUDO:new RegExp("^"+da),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+aa+"*(even|odd|(([+-]|)(\\d*)n|)"+aa+"*(?:([+-]|)"+aa+"*(\\d+)|))"+aa+"*\\)|)","i"),bool:new RegExp("^(?:"+_+")$","i"),needsContext:new RegExp("^"+aa+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+aa+"*((?:-\\d)?\\d*)"+aa+"*\\)|)(?=[^-]|$)","i")},ma=/^(?:input|select|textarea|button)$/i,na=/^h\d$/i,oa=/^[^{]+\{\s*\[native \w/,pa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,qa=/[+~]/,ra=new RegExp("\\\\([\\da-f]{1,6}"+aa+"?|("+aa+")|.)","ig"),sa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ta=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,ua=function(a,b){return b?"\0"===a?"":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},va=function(){E()},wa=m(function(a){return!0===a.disabled},{dir:"parentNode",next:"legend"});try{Y.apply(V=Z.call(N.childNodes),N.childNodes),V[N.childNodes.length].nodeType}catch(a){Y={apply:V.length?function(a,b){X.apply(a,Z.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}u=b.support={},x=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},E=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:N;return d!==F&&9===d.nodeType&&d.documentElement?(F=d,G=F.documentElement,H=!x(F),N!==F&&(c=F.defaultView)&&c.top!==c&&(c.addEventListener?c.addEventListener("unload",va,!1):c.attachEvent&&c.attachEvent("onunload",va)),u.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),u.getElementsByTagName=e(function(a){return a.appendChild(F.createComment("")),!a.getElementsByTagName("*").length}),u.getElementsByClassName=oa.test(F.getElementsByClassName),u.getById=e(function(a){return G.appendChild(a).id=M,!F.getElementsByName||!F.getElementsByName(M).length}),u.getById?(v.find.ID=function(a,b){if(void 0!==b.getElementById&&H){var c=b.getElementById(a);return c?[c]:[]}},v.filter.ID=function(a){var b=a.replace(ra,sa);return function(a){return a.getAttribute("id")===b}}):(delete v.find.ID,v.filter.ID=function(a){var b=a.replace(ra,sa);return function(a){var c=void 0!==a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),v.find.TAG=u.getElementsByTagName?function(a,b){return void 0!==b.getElementsByTagName?b.getElementsByTagName(a):u.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},v.find.CLASS=u.getElementsByClassName&&function(a,b){if(void 0!==b.getElementsByClassName&&H)return b.getElementsByClassName(a)},J=[],I=[],(u.qsa=oa.test(F.querySelectorAll))&&(e(function(a){G.appendChild(a).innerHTML="<a id='"+M+"'></a><select id='"+M+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&I.push("[*^$]="+aa+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||I.push("\\["+aa+"*(?:value|"+_+")"),a.querySelectorAll("[id~="+M+"-]").length||I.push("~="),a.querySelectorAll(":checked").length||I.push(":checked"),a.querySelectorAll("a#"+M+"+*").length||I.push(".#.+[+~]")}),e(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=F.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&I.push("name"+aa+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&I.push(":enabled",":disabled"),G.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&I.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),I.push(",.*:")})),(u.matchesSelector=oa.test(K=G.matches||G.webkitMatchesSelector||G.mozMatchesSelector||G.oMatchesSelector||G.msMatchesSelector))&&e(function(a){u.disconnectedMatch=K.call(a,"*"),K.call(a,"[s!='']:x"),J.push("!=",da)}),I=I.length&&new RegExp(I.join("|")),J=J.length&&new RegExp(J.join("|")),b=oa.test(G.compareDocumentPosition),L=b||oa.test(G.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},T=b?function(a,b){if(a===b)return D=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c||(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!u.sortDetached&&b.compareDocumentPosition(a)===c?a===F||a.ownerDocument===N&&L(N,a)?-1:b===F||b.ownerDocument===N&&L(N,b)?1:C?$(C,a)-$(C,b):0:4&c?-1:1)}:function(a,b){if(a===b)return D=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===F?-1:b===F?1:e?-1:f?1:C?$(C,a)-$(C,b):0;if(e===f)return g(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)i.unshift(c);for(;h[d]===i[d];)d++;return d?g(h[d],i[d]):h[d]===N?-1:i[d]===N?1:0},F):F},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==F&&E(a),c=c.replace(ia,"='$1']"),u.matchesSelector&&H&&!S[c+" "]&&(!J||!J.test(c))&&(!I||!I.test(c)))try{var d=K.call(a,c);if(d||u.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(a){}return b(c,F,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==F&&E(a),L(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==F&&E(a);var c=v.attrHandle[b.toLowerCase()],d=c&&U.call(v.attrHandle,b.toLowerCase())?c(a,b,!H):void 0;return void 0!==d?d:u.attributes||!H?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.escape=function(a){return(a+"").replace(ta,ua)},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(D=!u.detectDuplicates,C=!u.sortStable&&a.slice(0),a.sort(T),D){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return C=null,a},w=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=w(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=w(b);return c},v=b.selectors={cacheLength:50,createPseudo:d,match:la,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ra,sa),a[3]=(a[3]||a[4]||a[5]||"").replace(ra,sa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return la.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&ja.test(c)&&(b=y(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ra,sa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=Q[a+" "];return b||(b=new RegExp("(^|"+aa+")"+a+"("+aa+"|$)"))&&Q(a,function(a){return b.test("string"==typeof a.className&&a.className||void 0!==a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:!c||(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(ea," ")+" ").indexOf(d)>-1:"|="===c&&(f===d||f.slice(0,d.length+1)===d+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(m=q,l=m[M]||(m[M]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===O&&j[1],t=n&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[O,n,t];break}}else if(s&&(m=b,l=m[M]||(m[M]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===O&&j[1],t=n),!1===t)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&(l=m[M]||(m[M]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[O,t]),m!==b)););return(t-=e)===d||t%d==0&&t/d>=0}}},PSEUDO:function(a,c){var e,f=v.pseudos[a]||v.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[M]?f(c):f.length>1?(e=[a,a,"",c],v.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=$(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=z(a.replace(fa,"$1"));return e[M]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(ra,sa),function(b){return(b.textContent||b.innerText||w(b)).indexOf(a)>-1}}),lang:d(function(a){return ka.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(ra,sa).toLowerCase(),function(b){var c;do{if(c=H?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return(c=c.toLowerCase())===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===G},focus:function(a){return a===F.activeElement&&(!F.hasFocus||F.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:h(!1),disabled:h(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!v.pseudos.empty(a)},header:function(a){return na.test(a.nodeName)},input:function(a){return ma.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:i(function(){return[0]}),last:i(function(a,b){return[b-1]}),eq:i(function(a,b,c){return[c<0?c+b:c]}),even:i(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:i(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:i(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:i(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},v.pseudos.nth=v.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})v.pseudos[t]=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}(t);for(t in{submit:!0,reset:!0})v.pseudos[t]=function(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}(t);return k.prototype=v.filters=v.pseudos,v.setFilters=new k,y=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=R[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=v.preFilter;h;){d&&!(e=ga.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ha.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(fa," ")}),h=h.slice(d.length));for(g in v.filter)!(e=la[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):R(a,i).slice(0)},z=b.compile=function(a,b){var c,d=[],e=[],f=S[a+" "];if(!f){for(b||(b=y(a)),c=b.length;c--;)f=r(b[c]),f[M]?d.push(f):e.push(f);f=S(a,s(e,d)),f.selector=a}return f},A=b.select=function(a,b,c,d){var e,f,g,h,i,k="function"==typeof a&&a,m=!d&&y(a=k.selector||a);if(c=c||[],1===m.length){if(f=m[0]=m[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&u.getById&&9===b.nodeType&&H&&v.relative[f[1].type]){if(!(b=(v.find.ID(g.matches[0].replace(ra,sa),b)||[])[0]))return c;k&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=la.needsContext.test(a)?0:f.length;e--&&(g=f[e],!v.relative[h=g.type]);)if((i=v.find[h])&&(d=i(g.matches[0].replace(ra,sa),qa.test(f[0].type)&&j(b.parentNode)||b))){if(f.splice(e,1),!(a=d.length&&l(f)))return Y.apply(c,d),c;break}}return(k||z(a,m))(d,b,!H,c,!b||qa.test(a)&&j(b.parentNode)||b),c},u.sortStable=M.split("").sort(T).join("")===M,u.detectDuplicates=!!D,E(),u.sortDetached=e(function(a){return 1&a.compareDocumentPosition(F.createElement("fieldset"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),u.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(_,function(a,b,c){var d;if(!c)return!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);la.find=na,la.expr=na.selectors,la.expr[":"]=la.expr.pseudos,la.uniqueSort=la.unique=na.uniqueSort,la.text=na.getText,la.isXMLDoc=na.isXML,la.contains=na.contains,la.escapeSelector=na.escape;var oa=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&la(a).is(c))break;d.push(a)}return d},pa=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},qa=la.expr.match.needsContext,ra=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,sa=/^.[^:#\[\.,]*$/;la.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?la.find.matchesSelector(d,a)?[d]:[]:la.find.matches(a,la.grep(b,function(a){return 1===a.nodeType}))},la.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(la(a).filter(function(){for(b=0;b<d;b++)if(la.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)la.find(a,e[b],c);return d>1?la.uniqueSort(c):c},filter:function(a){return this.pushStack(e(this,a||[],!1))},not:function(a){return this.pushStack(e(this,a||[],!0))},is:function(a){return!!e(this,"string"==typeof a&&qa.test(a)?la(a):a||[],!1).length}});var ta,ua=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(la.fn.init=function(a,b,c){var d,e;if(!a)return this;if(c=c||ta,"string"==typeof a){if(!(d="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:ua.exec(a))||!d[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(d[1]){if(b=b instanceof la?b[0]:b,la.merge(this,la.parseHTML(d[1],b&&b.nodeType?b.ownerDocument||b:_,!0)),ra.test(d[1])&&la.isPlainObject(b))for(d in b)la.isFunction(this[d])?this[d](b[d]):this.attr(d,b[d]);return this}return e=_.getElementById(d[2]),e&&(this[0]=e,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):la.isFunction(a)?void 0!==c.ready?c.ready(a):a(la):la.makeArray(a,this)}).prototype=la.fn,ta=la(_);var va=/^(?:parents|prev(?:Until|All))/,wa={children:!0,contents:!0,next:!0,prev:!0};la.fn.extend({has:function(a){var b=la(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(la.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&la(a);if(!qa.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&la.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?la.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?ea.call(la(a),this[0]):ea.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(la.uniqueSort(la.merge(this.get(),la(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),la.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return oa(a,"parentNode")},parentsUntil:function(a,b,c){return oa(a,"parentNode",c)},next:function(a){return f(a,"nextSibling")},prev:function(a){return f(a,"previousSibling")},nextAll:function(a){return oa(a,"nextSibling")},prevAll:function(a){return oa(a,"previousSibling")},nextUntil:function(a,b,c){return oa(a,"nextSibling",c)},prevUntil:function(a,b,c){return oa(a,"previousSibling",c)},siblings:function(a){return pa((a.parentNode||{}).firstChild,a)},children:function(a){return pa(a.firstChild)},contents:function(a){return a.contentDocument||la.merge([],a.childNodes)}},function(a,b){la.fn[a]=function(c,d){var e=la.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=la.filter(d,e)),this.length>1&&(wa[a]||la.uniqueSort(e),va.test(a)&&e.reverse()),this.pushStack(e)}});var xa=/\S+/g;la.Callbacks=function(a){a="string"==typeof a?g(a):la.extend({},a);var b,c,d,e,f=[],h=[],i=-1,j=function(){for(e=a.once,d=b=!0;h.length;i=-1)for(c=h.shift();++i<f.length;)!1===f[i].apply(c[0],c[1])&&a.stopOnFalse&&(i=f.length,c=!1);a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},k={add:function(){return f&&(c&&!b&&(i=f.length-1,h.push(c)),function b(c){la.each(c,function(c,d){la.isFunction(d)?a.unique&&k.has(d)||f.push(d):d&&d.length&&"string"!==la.type(d)&&b(d)})}(arguments),c&&!b&&j()),this},remove:function(){return la.each(arguments,function(a,b){for(var c;(c=la.inArray(b,f,c))>-1;)f.splice(c,1),c<=i&&i--}),this},has:function(a){return a?la.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=h=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=h=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],h.push(c),b||j()),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},la.extend({Deferred:function(b){var c=[["notify","progress",la.Callbacks("memory"),la.Callbacks("memory"),2],["resolve","done",la.Callbacks("once memory"),la.Callbacks("once memory"),0,"resolved"],["reject","fail",la.Callbacks("once memory"),la.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},catch:function(a){return e.then(null,a)},pipe:function(){var a=arguments;return la.Deferred(function(b){la.each(c,function(c,d){var e=la.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&la.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){function f(b,c,d,e){return function(){var j=this,k=arguments,l=function(){var a,l;if(!(b<g)){if((a=d.apply(j,k))===c.promise())throw new TypeError("Thenable self-resolution");l=a&&("object"==typeof a||"function"==typeof a)&&a.then,la.isFunction(l)?e?l.call(a,f(g,c,h,e),f(g,c,i,e)):(g++,l.call(a,f(g,c,h,e),f(g,c,i,e),f(g,c,h,c.notifyWith))):(d!==h&&(j=void 0,k=[a]),(e||c.resolveWith)(j,k))}},m=e?l:function(){try{l()}catch(a){la.Deferred.exceptionHook&&la.Deferred.exceptionHook(a,m.stackTrace),b+1>=g&&(d!==i&&(j=void 0,k=[a]),c.rejectWith(j,k))}};b?m():(la.Deferred.getStackHook&&(m.stackTrace=la.Deferred.getStackHook()),a.setTimeout(m))}}var g=0;return la.Deferred(function(a){c[0][3].add(f(0,a,la.isFunction(e)?e:h,a.notifyWith)),c[1][3].add(f(0,a,la.isFunction(b)?b:h)),c[2][3].add(f(0,a,la.isFunction(d)?d:i))}).promise()},promise:function(a){return null!=a?la.extend(a,e):e}},f={};return la.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=ba.call(arguments),f=la.Deferred(),g=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?ba.call(arguments):c,--b||f.resolveWith(d,e)}};if(b<=1&&(j(a,f.done(g(c)).resolve,f.reject),
"pending"===f.state()||la.isFunction(e[c]&&e[c].then)))return f.then();for(;c--;)j(e[c],g(c),f.reject);return f.promise()}});var ya=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;la.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&ya.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},la.readyException=function(b){a.setTimeout(function(){throw b})};var za=la.Deferred();la.fn.ready=function(a){return za.then(a).catch(function(a){la.readyException(a)}),this},la.extend({isReady:!1,readyWait:1,holdReady:function(a){a?la.readyWait++:la.ready(!0)},ready:function(a){(!0===a?--la.readyWait:la.isReady)||(la.isReady=!0,!0!==a&&--la.readyWait>0||za.resolveWith(_,[la]))}}),la.ready.then=za.then,"complete"===_.readyState||"loading"!==_.readyState&&!_.documentElement.doScroll?a.setTimeout(la.ready):(_.addEventListener("DOMContentLoaded",k),a.addEventListener("load",k));var Aa=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===la.type(c)){e=!0;for(h in c)Aa(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,la.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(la(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Ba=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};l.uid=1,l.prototype={cache:function(a){var b=a[this.expando];return b||(b={},Ba(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[la.camelCase(b)]=c;else for(d in b)e[la.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][la.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){la.isArray(b)?b=b.map(la.camelCase):(b=la.camelCase(b),b=b in d?[b]:b.match(xa)||[]),c=b.length;for(;c--;)delete d[b[c]]}(void 0===b||la.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!la.isEmptyObject(b)}};var Ca=new l,Da=new l,Ea=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Fa=/[A-Z]/g;la.extend({hasData:function(a){return Da.hasData(a)||Ca.hasData(a)},data:function(a,b,c){return Da.access(a,b,c)},removeData:function(a,b){Da.remove(a,b)},_data:function(a,b,c){return Ca.access(a,b,c)},_removeData:function(a,b){Ca.remove(a,b)}}),la.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=Da.get(f),1===f.nodeType&&!Ca.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=la.camelCase(d.slice(5)),m(f,d,e[d])));Ca.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){Da.set(this,a)}):Aa(this,function(b){var c;if(f&&void 0===b){if(void 0!==(c=Da.get(f,a)))return c;if(void 0!==(c=m(f,a)))return c}else this.each(function(){Da.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){Da.remove(this,a)})}}),la.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=Ca.get(a,b),c&&(!d||la.isArray(c)?d=Ca.access(a,b,la.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=la.queue(a,b),d=c.length,e=c.shift(),f=la._queueHooks(a,b),g=function(){la.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return Ca.get(a,c)||Ca.access(a,c,{empty:la.Callbacks("once memory").add(function(){Ca.remove(a,[b+"queue",c])})})}}),la.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?la.queue(this[0],a):void 0===b?this:this.each(function(){var c=la.queue(this,a,b);la._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&la.dequeue(this,a)})},dequeue:function(a){return this.each(function(){la.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=la.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)(c=Ca.get(f[g],a+"queueHooks"))&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Ga=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ha=new RegExp("^(?:([+-])=|)("+Ga+")([a-z%]*)$","i"),Ia=["Top","Right","Bottom","Left"],Ja=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&la.contains(a.ownerDocument,a)&&"none"===la.css(a,"display")},Ka=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},La={};la.fn.extend({show:function(){return p(this,!0)},hide:function(){return p(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){Ja(this)?la(this).show():la(this).hide()})}});var Ma=/^(?:checkbox|radio)$/i,Na=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Oa=/^$|\/(?:java|ecma)script/i,Pa={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Pa.optgroup=Pa.option,Pa.tbody=Pa.tfoot=Pa.colgroup=Pa.caption=Pa.thead,Pa.th=Pa.td;var Qa=/<|&#?\w+;/;!function(){var a=_.createDocumentFragment(),b=a.appendChild(_.createElement("div")),c=_.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),ka.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",ka.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var Ra=_.documentElement,Sa=/^key/,Ta=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ua=/^([^.]*)(?:\.(.+)|)/;la.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=Ca.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),e&&la.find.matchesSelector(Ra,e),c.guid||(c.guid=la.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return void 0!==la&&la.event.triggered!==b.type?la.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(xa)||[""],j=b.length;j--;)h=Ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=la.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=la.event.special[n]||{},k=la.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&la.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&!1!==l.setup.call(a,d,o,g)||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),la.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=Ca.hasData(a)&&Ca.get(a);if(q&&(i=q.events)){for(b=(b||"").match(xa)||[""],j=b.length;j--;)if(h=Ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=la.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&!1!==l.teardown.call(a,o,q.handle)||la.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)la.event.remove(a,n+b[j],c,d,!0);la.isEmptyObject(i)&&Ca.remove(a,"handle events")}},dispatch:function(a){var b,c,d,e,f,g,h=la.event.fix(a),i=new Array(arguments.length),j=(Ca.get(this,"events")||{})[h.type]||[],k=la.event.special[h.type]||{};for(i[0]=h,b=1;b<arguments.length;b++)i[b]=arguments[b];if(h.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,h)){for(g=la.event.handlers.call(this,h,j),b=0;(e=g[b++])&&!h.isPropagationStopped();)for(h.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!h.isImmediatePropagationStopped();)h.rnamespace&&!h.rnamespace.test(f.namespace)||(h.handleObj=f,h.data=f.data,void 0!==(d=((la.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,i))&&!1===(h.result=d)&&(h.preventDefault(),h.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,h),h.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!==this;i=i.parentNode||this)if(1===i.nodeType&&(!0!==i.disabled||"click"!==a.type)){for(d=[],c=0;c<h;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?la(e,this).index(i)>-1:la.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},addProp:function(a,b){Object.defineProperty(la.Event.prototype,a,{enumerable:!0,configurable:!0,get:la.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[la.expando]?a:new la.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==v()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===v()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&la.nodeName(this,"input"))return this.click(),!1},_default:function(a){return la.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},la.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},la.Event=function(a,b){if(!(this instanceof la.Event))return new la.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?t:u,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&la.extend(this,b),this.timeStamp=a&&a.timeStamp||la.now(),this[la.expando]=!0},la.Event.prototype={constructor:la.Event,isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=t,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=t,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=t,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},la.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&Sa.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&Ta.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},la.event.addProp),la.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){la.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||la.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),la.fn.extend({on:function(a,b,c,d){return w(this,a,b,c,d)},one:function(a,b,c,d){return w(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,la(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=u),this.each(function(){la.event.remove(this,a,c,b)})}});var Va=/<script|<style|<link/i,Wa=/checked\s*(?:[^=]|=\s*.checked.)/i,Xa=/^true\/(.*)/,Ya=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;la.extend({htmlPrefilter:function(a){return a.replace(/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=la.contains(a.ownerDocument,a);if(!(ka.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||la.isXMLDoc(a)))for(g=q(h),f=q(a),d=0,e=f.length;d<e;d++)B(f[d],g[d]);if(b)if(c)for(f=f||q(a),g=g||q(h),d=0,e=f.length;d<e;d++)A(f[d],g[d]);else A(a,h);return g=q(h,"script"),g.length>0&&r(g,!i&&q(a,"script")),h},cleanData:function(a){for(var b,c,d,e=la.event.special,f=0;void 0!==(c=a[f]);f++)if(Ba(c)){if(b=c[Ca.expando]){if(b.events)for(d in b.events)e[d]?la.event.remove(c,d):la.removeEvent(c,d,b.handle);c[Ca.expando]=void 0}c[Da.expando]&&(c[Da.expando]=void 0)}}}),la.fn.extend({detach:function(a){return D(this,a,!0)},remove:function(a){return D(this,a)},text:function(a){return Aa(this,function(a){return void 0===a?la.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return C(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){x(this,a).appendChild(a)}})},prepend:function(){return C(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=x(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return C(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return C(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(la.cleanData(q(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return la.clone(this,a,b)})},html:function(a){return Aa(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Va.test(a)&&!Pa[(Na.exec(a)||["",""])[1].toLowerCase()]){a=la.htmlPrefilter(a);try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(la.cleanData(q(b,!1)),b.innerHTML=a);b=0}catch(a){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return C(this,arguments,function(b){var c=this.parentNode;la.inArray(this,a)<0&&(la.cleanData(q(this)),c&&c.replaceChild(b,this))},a)}}),la.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){la.fn[a]=function(a){for(var c,d=[],e=la(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),la(e[g])[b](c),da.apply(d,c.get());return this.pushStack(d)}});var Za=/^margin/,$a=new RegExp("^("+Ga+")(?!px)[a-z%]+$","i"),_a=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(h){h.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",h.innerHTML="",Ra.appendChild(g);var b=a.getComputedStyle(h);c="1%"!==b.top,f="2px"===b.marginLeft,d="4px"===b.width,h.style.marginRight="50%",e="4px"===b.marginRight,Ra.removeChild(g),h=null}}var c,d,e,f,g=_.createElement("div"),h=_.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",ka.clearCloneStyle="content-box"===h.style.backgroundClip,g.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",g.appendChild(h),la.extend(ka,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),d},pixelMarginRight:function(){return b(),e},reliableMarginLeft:function(){return b(),f}}))}();var ab=/^(none|table(?!-c[ea]).+)/,bb={position:"absolute",visibility:"hidden",display:"block"},cb={letterSpacing:"0",fontWeight:"400"},db=["Webkit","Moz","ms"],eb=_.createElement("div").style;la.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=E(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=la.camelCase(b),i=a.style;if(b=la.cssProps[h]||(la.cssProps[h]=G(h)||h),g=la.cssHooks[b]||la.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];f=typeof c,"string"===f&&(e=Ha.exec(c))&&e[1]&&(c=n(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(la.cssNumber[h]?"":"px")),ka.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c))}},css:function(a,b,c,d){var e,f,g,h=la.camelCase(b);return b=la.cssProps[h]||(la.cssProps[h]=G(h)||h),g=la.cssHooks[b]||la.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=E(a,b,d)),"normal"===e&&b in cb&&(e=cb[b]),""===c||c?(f=parseFloat(e),!0===c||isFinite(f)?f||0:e):e}}),la.each(["height","width"],function(a,b){la.cssHooks[b]={get:function(a,c,d){if(c)return!ab.test(la.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?J(a,b,d):Ka(a,bb,function(){return J(a,b,d)})},set:function(a,c,d){var e,f=d&&_a(a),g=d&&I(a,b,d,"border-box"===la.css(a,"boxSizing",!1,f),f);return g&&(e=Ha.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=la.css(a,b)),H(a,c,g)}}}),la.cssHooks.marginLeft=F(ka.reliableMarginLeft,function(a,b){if(b)return(parseFloat(E(a,"marginLeft"))||a.getBoundingClientRect().left-Ka(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),la.each({margin:"",padding:"",border:"Width"},function(a,b){la.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+Ia[d]+b]=f[d]||f[d-2]||f[0];return e}},Za.test(a)||(la.cssHooks[a+b].set=H)}),la.fn.extend({css:function(a,b){return Aa(this,function(a,b,c){var d,e,f={},g=0;if(la.isArray(b)){for(d=_a(a),e=b.length;g<e;g++)f[b[g]]=la.css(a,b[g],!1,d);return f}return void 0!==c?la.style(a,b,c):la.css(a,b)},a,b,arguments.length>1)}}),la.Tween=K,K.prototype={constructor:K,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||la.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(la.cssNumber[c]?"":"px")},cur:function(){var a=K.propHooks[this.prop];return a&&a.get?a.get(this):K.propHooks._default.get(this)},run:function(a){var b,c=K.propHooks[this.prop];return this.options.duration?this.pos=b=la.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):K.propHooks._default.set(this),this}},K.prototype.init.prototype=K.prototype,K.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=la.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){la.fx.step[a.prop]?la.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[la.cssProps[a.prop]]&&!la.cssHooks[a.prop]?a.elem[a.prop]=a.now:la.style(a.elem,a.prop,a.now+a.unit)}}},K.propHooks.scrollTop=K.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},la.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},la.fx=K.prototype.init,la.fx.step={};var fb,gb,hb=/^(?:toggle|show|hide)$/,ib=/queueHooks$/;la.Animation=la.extend(R,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return n(c.elem,a,Ha.exec(b),c),c}]},tweener:function(a,b){la.isFunction(a)?(b=a,a=["*"]):a=a.match(xa);for(var c,d=0,e=a.length;d<e;d++)c=a[d],R.tweeners[c]=R.tweeners[c]||[],R.tweeners[c].unshift(b)},prefilters:[P],prefilter:function(a,b){b?R.prefilters.unshift(a):R.prefilters.push(a)}}),la.speed=function(a,b,c){var d=a&&"object"==typeof a?la.extend({},a):{complete:c||!c&&b||la.isFunction(a)&&a,duration:a,easing:c&&b||b&&!la.isFunction(b)&&b};return la.fx.off||_.hidden?d.duration=0:d.duration="number"==typeof d.duration?d.duration:d.duration in la.fx.speeds?la.fx.speeds[d.duration]:la.fx.speeds._default,null!=d.queue&&!0!==d.queue||(d.queue="fx"),d.old=d.complete,d.complete=function(){la.isFunction(d.old)&&d.old.call(this),d.queue&&la.dequeue(this,d.queue)},d},la.fn.extend({fadeTo:function(a,b,c,d){return this.filter(Ja).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=la.isEmptyObject(a),f=la.speed(b,c,d),g=function(){var b=R(this,la.extend({},a),f);(e||Ca.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=la.timers,g=Ca.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ib.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||la.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=Ca.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=la.timers,g=d?d.length:0;for(c.finish=!0,la.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),la.each(["toggle","show","hide"],function(a,b){var c=la.fn[b];la.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(N(b,!0),a,d,e)}}),la.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){la.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),la.timers=[],la.fx.tick=function(){var a,b=0,c=la.timers;for(fb=la.now();b<c.length;b++)(a=c[b])()||c[b]!==a||c.splice(b--,1);c.length||la.fx.stop(),fb=void 0},la.fx.timer=function(a){la.timers.push(a),a()?la.fx.start():la.timers.pop()},la.fx.interval=13,la.fx.start=function(){gb||(gb=a.requestAnimationFrame?a.requestAnimationFrame(L):a.setInterval(la.fx.tick,la.fx.interval))},la.fx.stop=function(){a.cancelAnimationFrame?a.cancelAnimationFrame(gb):a.clearInterval(gb),gb=null},la.fx.speeds={slow:600,fast:200,_default:400},la.fn.delay=function(b,c){return b=la.fx?la.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=_.createElement("input"),b=_.createElement("select"),c=b.appendChild(_.createElement("option"));a.type="checkbox",ka.checkOn=""!==a.value,ka.optSelected=c.selected,a=_.createElement("input"),a.value="t",a.type="radio",ka.radioValue="t"===a.value}();var jb,kb=la.expr.attrHandle;la.fn.extend({attr:function(a,b){return Aa(this,la.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){la.removeAttr(this,a)})}}),la.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return void 0===a.getAttribute?la.prop(a,b,c):(1===f&&la.isXMLDoc(a)||(e=la.attrHooks[b.toLowerCase()]||(la.expr.match.bool.test(b)?jb:void 0)),void 0!==c?null===c?void la.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=la.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!ka.radioValue&&"radio"===b&&la.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(xa);if(e&&1===a.nodeType)for(;c=e[d++];)a.removeAttribute(c)}}),jb={set:function(a,b,c){return!1===b?la.removeAttr(a,c):a.setAttribute(c,c),c}},la.each(la.expr.match.bool.source.match(/\w+/g),function(a,b){var c=kb[b]||la.find.attr;kb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=kb[g],kb[g]=e,e=null!=c(a,b,d)?g:null,kb[g]=f),e}});var lb=/^(?:input|select|textarea|button)$/i,mb=/^(?:a|area)$/i;la.fn.extend({prop:function(a,b){return Aa(this,la.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[la.propFix[a]||a]})}}),la.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&la.isXMLDoc(a)||(b=la.propFix[b]||b,e=la.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=la.find.attr(a,"tabindex");return b?parseInt(b,10):lb.test(a.nodeName)||mb.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ka.optSelected||(la.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),la.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){la.propFix[this.toLowerCase()]=this});la.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(la.isFunction(a))return this.each(function(b){la(this).addClass(a.call(this,b,S(this)))});if("string"==typeof a&&a)for(b=a.match(xa)||[];c=this[i++];)if(e=S(c),d=1===c.nodeType&&(" "+e+" ").replace(/[\t\r\n\f]/g," ")){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=la.trim(d),e!==h&&c.setAttribute("class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(la.isFunction(a))return this.each(function(b){la(this).removeClass(a.call(this,b,S(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a)for(b=a.match(xa)||[];c=this[i++];)if(e=S(c),d=1===c.nodeType&&(" "+e+" ").replace(/[\t\r\n\f]/g," ")){for(g=0;f=b[g++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");h=la.trim(d),e!==h&&c.setAttribute("class",h)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):la.isFunction(a)?this.each(function(c){la(this).toggleClass(a.call(this,c,S(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c)for(d=0,e=la(this),f=a.match(xa)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else void 0!==a&&"boolean"!==c||(b=S(this),b&&Ca.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":Ca.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&(" "+S(c)+" ").replace(/[\t\r\n\f]/g," ").indexOf(b)>-1)return!0;return!1}});la.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=la.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,la(this).val()):a,null==e?e="":"number"==typeof e?e+="":la.isArray(e)&&(e=la.map(e,function(a){return null==a?"":a+""})),(b=la.valHooks[this.type]||la.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return(b=la.valHooks[e.type]||la.valHooks[e.nodeName.toLowerCase()])&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(/\r/g,""):null==c?"":c)}}}),la.extend({valHooks:{option:{get:function(a){var b=la.find.attr(a,"value");return null!=b?b:la.trim(la.text(a)).replace(/[\x20\t\r\n\f]+/g," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type,g=f?null:[],h=f?e+1:d.length,i=e<0?h:f?e:0;i<h;i++)if(c=d[i],(c.selected||i===e)&&!c.disabled&&(!c.parentNode.disabled||!la.nodeName(c.parentNode,"optgroup"))){if(b=la(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=la.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=la.inArray(la.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),la.each(["radio","checkbox"],function(){la.valHooks[this]={set:function(a,b){if(la.isArray(b))return a.checked=la.inArray(la(a).val(),b)>-1}},ka.checkOn||(la.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var nb=/^(?:focusinfocus|focusoutblur)$/;la.extend(la.event,{trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||_],n=ha.call(b,"type")?b.type:b,o=ha.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||_,3!==d.nodeType&&8!==d.nodeType&&!nb.test(n+la.event.triggered)&&(n.indexOf(".")>-1&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[la.expando]?b:new la.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:la.makeArray(c,[b]),l=la.event.special[n]||{},e||!l.trigger||!1!==l.trigger.apply(d,c))){if(!e&&!l.noBubble&&!la.isWindow(d)){for(i=l.delegateType||n,nb.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||_)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(Ca.get(g,"events")||{})[b.type]&&Ca.get(g,"handle"),k&&k.apply(g,c),(k=j&&g[j])&&k.apply&&Ba(g)&&(b.result=k.apply(g,c),!1===b.result&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&!1!==l._default.apply(m.pop(),c)||!Ba(d)||j&&la.isFunction(d[n])&&!la.isWindow(d)&&(h=d[j],h&&(d[j]=null),la.event.triggered=n,d[n](),la.event.triggered=void 0,h&&(d[j]=h)),b.result}},simulate:function(a,b,c){var d=la.extend(new la.Event,c,{type:a,isSimulated:!0});la.event.trigger(d,null,b)}}),la.fn.extend({trigger:function(a,b){return this.each(function(){la.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return la.event.trigger(a,b,c,!0)}}),la.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){la.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),la.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),ka.focusin="onfocusin"in a,ka.focusin||la.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){la.event.simulate(b,a.target,la.event.fix(a))};la.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=Ca.access(d,b);e||d.addEventListener(a,c,!0),Ca.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=Ca.access(d,b)-1;e?Ca.access(d,b,e):(d.removeEventListener(a,c,!0),Ca.remove(d,b))}}});var ob=a.location,pb=la.now(),qb=/\?/;la.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(a){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||la.error("Invalid XML: "+b),c};var rb=/\[\]$/,sb=/^(?:submit|button|image|reset|file)$/i,tb=/^(?:input|select|textarea|keygen)/i;la.param=function(a,b){var c,d=[],e=function(a,b){var c=la.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(la.isArray(a)||a.jquery&&!la.isPlainObject(a))la.each(a,function(){e(this.name,this.value)});else for(c in a)T(c,a[c],b,e);return d.join("&")},la.fn.extend({serialize:function(){return la.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=la.prop(this,"elements");return a?la.makeArray(a):this}).filter(function(){var a=this.type
;return this.name&&!la(this).is(":disabled")&&tb.test(this.nodeName)&&!sb.test(a)&&(this.checked||!Ma.test(a))}).map(function(a,b){var c=la(this).val();return null==c?null:la.isArray(c)?la.map(c,function(a){return{name:b.name,value:a.replace(/\r?\n/g,"\r\n")}}):{name:b.name,value:c.replace(/\r?\n/g,"\r\n")}}).get()}});var ub=/^(.*?):[ \t]*([^\r\n]*)$/gm,vb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,wb=/^(?:GET|HEAD)$/,xb={},yb={},zb="*/".concat("*"),Ab=_.createElement("a");Ab.href=ob.href,la.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ob.href,type:"GET",isLocal:vb.test(ob.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":la.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?W(W(a,la.ajaxSettings),b):W(la.ajaxSettings,a)},ajaxPrefilter:U(xb),ajaxTransport:U(yb),ajax:function(b,c){function d(b,c,d,h){var j,m,n,u,v,w=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",x.readyState=b>0?4:0,j=b>=200&&b<300||304===b,d&&(u=X(o,x,d)),u=Y(o,u,x,j),j?(o.ifModified&&(v=x.getResponseHeader("Last-Modified"),v&&(la.lastModified[f]=v),(v=x.getResponseHeader("etag"))&&(la.etag[f]=v)),204===b||"HEAD"===o.type?w="nocontent":304===b?w="notmodified":(w=u.state,m=u.data,n=u.error,j=!n)):(n=w,!b&&w||(w="error",b<0&&(b=0))),x.status=b,x.statusText=(c||w)+"",j?r.resolveWith(p,[m,w,x]):r.rejectWith(p,[x,w,n]),x.statusCode(t),t=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[x,o,j?m:n]),s.fireWith(p,[x,w]),l&&(q.trigger("ajaxComplete",[x,o]),--la.active||la.event.trigger("ajaxStop")))}"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=la.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?la(p):la.event,r=la.Deferred(),s=la.Callbacks("once memory"),t=o.statusCode||{},u={},v={},w="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h)for(h={};b=ub.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=v[a.toLowerCase()]=v[a.toLowerCase()]||a,u[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)x.always(a[x.status]);else for(b in a)t[b]=[t[b],a[b]];return this},abort:function(a){var b=a||w;return e&&e.abort(b),d(0,b),this}};if(r.promise(x),o.url=((b||o.url||ob.href)+"").replace(/^\/\//,ob.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(xa)||[""],null==o.crossDomain){j=_.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Ab.protocol+"//"+Ab.host!=j.protocol+"//"+j.host}catch(a){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=la.param(o.data,o.traditional)),V(xb,o,c,x),k)return x;l=la.event&&o.global,l&&0==la.active++&&la.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!wb.test(o.type),f=o.url.replace(/#.*$/,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(/%20/g,"+")):(n=o.url.slice(f.length),o.data&&(f+=(qb.test(f)?"&":"?")+o.data,delete o.data),!1===o.cache&&(f=f.replace(/([?&])_=[^&]*/,""),n=(qb.test(f)?"&":"?")+"_="+pb+++n),o.url=f+n),o.ifModified&&(la.lastModified[f]&&x.setRequestHeader("If-Modified-Since",la.lastModified[f]),la.etag[f]&&x.setRequestHeader("If-None-Match",la.etag[f])),(o.data&&o.hasContent&&!1!==o.contentType||c.contentType)&&x.setRequestHeader("Content-Type",o.contentType),x.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+zb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)x.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(!1===o.beforeSend.call(p,x,o)||k))return x.abort();if(w="abort",s.add(o.complete),x.done(o.success),x.fail(o.error),e=V(yb,o,c,x)){if(x.readyState=1,l&&q.trigger("ajaxSend",[x,o]),k)return x;o.async&&o.timeout>0&&(i=a.setTimeout(function(){x.abort("timeout")},o.timeout));try{k=!1,e.send(u,d)}catch(a){if(k)throw a;d(-1,a)}}else d(-1,"No Transport");return x},getJSON:function(a,b,c){return la.get(a,b,c,"json")},getScript:function(a,b){return la.get(a,void 0,b,"script")}}),la.each(["get","post"],function(a,b){la[b]=function(a,c,d,e){return la.isFunction(c)&&(e=e||d,d=c,c=void 0),la.ajax(la.extend({url:a,type:b,dataType:e,data:c,success:d},la.isPlainObject(a)&&a))}}),la._evalUrl=function(a){return la.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},la.fn.extend({wrapAll:function(a){var b;return this[0]&&(la.isFunction(a)&&(a=a.call(this[0])),b=la(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return la.isFunction(a)?this.each(function(b){la(this).wrapInner(a.call(this,b))}):this.each(function(){var b=la(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=la.isFunction(a);return this.each(function(c){la(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){la(this).replaceWith(this.childNodes)}),this}}),la.expr.pseudos.hidden=function(a){return!la.expr.pseudos.visible(a)},la.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},la.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(a){}};var Bb={0:200,1223:204},Cb=la.ajaxSettings.xhr();ka.cors=!!Cb&&"withCredentials"in Cb,ka.ajax=Cb=!!Cb,la.ajaxTransport(function(b){var c,d;if(ka.cors||Cb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Bb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(a){if(c)throw a}},abort:function(){c&&c()}}}),la.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),la.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return la.globalEval(a),a}}}),la.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),la.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=la("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),_.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Db=[],Eb=/(=)\?(?=&|$)|\?\?/;la.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Db.pop()||la.expando+"_"+pb++;return this[a]=!0,a}}),la.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(Eb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Eb.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=la.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Eb,"$1"+e):!1!==b.jsonp&&(b.url+=(qb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||la.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?la(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Db.push(e)),g&&la.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),ka.createHTMLDocument=function(){var a=_.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),la.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var d,e,f;return b||(ka.createHTMLDocument?(b=_.implementation.createHTMLDocument(""),d=b.createElement("base"),d.href=_.location.href,b.head.appendChild(d)):b=_),e=ra.exec(a),f=!c&&[],e?[b.createElement(e[1])]:(e=s([a],b,f),f&&f.length&&la(f).remove(),la.merge([],e.childNodes))},la.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=la.trim(a.slice(h)),a=a.slice(0,h)),la.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&la.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?la("<div>").append(la.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},la.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){la.fn[b]=function(a){return this.on(b,a)}}),la.expr.pseudos.animated=function(a){return la.grep(la.timers,function(b){return a===b.elem}).length},la.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=la.css(a,"position"),l=la(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=la.css(a,"top"),i=la.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),la.isFunction(b)&&(b=b.call(a,c,la.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},la.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){la.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),d.width||d.height?(e=f.ownerDocument,c=Z(e),b=e.documentElement,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):d):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===la.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),la.nodeName(a[0],"html")||(d=a.offset()),d={top:d.top+la.css(a[0],"borderTopWidth",!0),left:d.left+la.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-la.css(c,"marginTop",!0),left:b.left-d.left-la.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===la.css(a,"position");)a=a.offsetParent;return a||Ra})}}),la.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;la.fn[a]=function(d){return Aa(this,function(a,d,e){var f=Z(a);if(void 0===e)return f?f[b]:a[d];f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e},a,d,arguments.length)}}),la.each(["top","left"],function(a,b){la.cssHooks[b]=F(ka.pixelPosition,function(a,c){if(c)return c=E(a,b),$a.test(c)?la(a).position()[b]+"px":c})}),la.each({Height:"height",Width:"width"},function(a,b){la.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){la.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(!0===e||!0===f?"margin":"border");return Aa(this,function(b,c,e){var f;return la.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?la.css(b,c,h):la.style(b,c,e,h)},b,g?e:void 0,g)}})}),la.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),la.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return la});var Fb=a.jQuery,Gb=a.$;return la.noConflict=function(b){return a.$===la&&(a.$=Gb),b&&a.jQuery===la&&(a.jQuery=Fb),la},b||(a.jQuery=a.$=la),la}),function(a,b){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c,d=require("underscore");try{c=require("jquery")}catch(a){}b(a,exports,d,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){var e=a.Backbone,f=[],g=f.slice;b.VERSION="1.1.1",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){return j(this,"on",a,[b,c])&&b?(this._events||(this._events={}),(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,ctx:c||this}),this):this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;i<k;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;l<m;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;g<h;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){return(this._listeningTo||(this._listeningTo={}))[b._listenId||(b._listenId=c.uniqueId("l"))]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;m<n;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return!!this.hasChanged()&&c.clone(this.changed);var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){if(!b.set(b.parse(c,a),a))return!1;d&&d(b,c,a),b.trigger("sync",b,c,a)},C(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);if(d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d))return!1;j&&j(i,a,d),i.trigger("sync",i,a,d)},C(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;C(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||B();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return!d||(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1)}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;e<f;e++)(h=a[e]=this.get(a[e]))&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&!1!==b.sort,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!(o||!u||!w)&&[];for(e=0,f=a.length;e<f;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(!(h=a[e]=this._prepareModel(i,b)))continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;e<f;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;e<f;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;e<f;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;e<f;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;d<e;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){if(null!=a)return this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},C(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a,b){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,u)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],!1!==c&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(/^(\S+)\s*(.*)$/),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a.class=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=w[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||B()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){if(a.setRequestHeader("X-HTTP-Method-Override",f),h)return h.apply(this,arguments)}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&v&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var x=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};c.extend(x.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,function(a,b){return b?a:"([^/?]+)"}).replace(/\*\w+/g,"([^?]*?)"),new RegExp("^"+a+"(?:\\?(.*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var y=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},z=/msie [\w.]+/;y.started=!1,c.extend(y.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(/\/$/,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(/^[#\/]|\s+$/g,"")},start:function(a){if(y.started)throw new Error("Backbone.history has already been started");y.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=z.exec(navigator.userAgent.toLowerCase())&&(!e||e<=7);if(this.root=("/"+this.root+"/").replace(/^\/+|\/+$/g,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(/^[#\/]|\s+$/g,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),y.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){if(b.route.test(a))return b.callback(a),!0})},navigate:function(a,b){if(!y.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(/#.*$/,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new y;var A=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=x.extend=t.extend=y.extend=A;var B=function(){throw new Error('A "url" property or function must be specified')},C=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),define("lib/strings",["require","exports","module"],function(a,b,c){"use strict";function d(a){
var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.replace(k,function(a){return b.shift&&b.length>0?b.shift():a}).replace(j,function(a,c){return c in b?b[c]:a})}function e(a){return h.test(a)||i.test(a)}function f(a){return k.test(a)||l.test(a)}var g=function(a){return a},h=/&(\D+|#\d+);/i,i=/<.*>/,j=/\%\(([a-zA-Z]+)\)s/g,k=/%s/g,l=/\%\(((?!escaped)[a-zA-Z]+)\)s/g;g('By proceeding, you agree to the <a id="service-tos" href="%(termsUri)s">Terms of Service</a> and<a id="service-pp" href="%(privacyUri)s">Privacy Notice</a> of %(serviceName)s (%(serviceUri)s).'),g('<a href="https://support.mozilla.org/kb/im-having-problems-with-my-firefox-account">Help</a>'),g("Get the latest news about Mozilla and Firefox."),g("%(city)s, %(country)s (estimated)"),g("%(country)s (estimated)"),g("IP address: %(ip)s"),g("For added security, please confirm this sign-in to begin syncing with this device:"),g("Web Session"),g("Sign in"),c.exports={hasHTML:e,hasUnsafeVariables:f,interpolate:d}});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};define("lib/errors",["require","exports","module","underscore","lib/strings"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/strings");c.exports={find:function(a){var b;return"number"==typeof a.errno?b=this.find(a.errno):"number"==typeof a?b=d.find(this.ERRORS,function(b){return b.errno===a}):"string"==typeof a&&(b=this.ERRORS[a]),b},toMessage:function(a){if(!a)return this.toMessage("SERVICE_UNAVAILABLE");if(a.forceMessage)return a.forceMessage;if(a.message)return a.message;var b=this.find(a);return b&&b.message?b.message:"string"!=typeof a?this.toMessage("UNEXPECTED_ERROR"):a},toInterpolatedMessage:function(a,b){var c=this.toMessage(a),d=this.toInterpolationContext(a);return b?b.get(c,d):e.interpolate(c,d)},toInterpolationContext:function(){return{}},toErrno:function(a){var b=this.find(a);return b&&b.errno?b.errno:a},toError:function(a,b){var c=this.toErrno(a),e=this.toMessage(c),g=new Error(e);return"object"===(void 0===a?"undefined":f(a))&&d.extendOwn(g,a),g.errno=c,g.message=e,g.namespace=this.NAMESPACE,g.errorModule=this,b&&(g.context=b),g},toInvalidParameterError:function(a){var b=this.toError("INVALID_PARAMETER");return b.param=a,b},toMissingParameterError:function(a){var b=this.toError("MISSING_PARAMETER");return b.param=a,b},toInvalidResumeTokenPropertyError:function(a){var b=this.toError("INVALID_RESUME_TOKEN_PROPERTY");return b.property=a,b},toMissingResumeTokenPropertyError:function(a){var b=this.toError("MISSING_RESUME_TOKEN_PROPERTY");return b.property=a,b},toInvalidDataAttributeError:function(a){var b=this.toError("INVALID_DATA_ATTRIBUTE");return b.property=a,b},toMissingDataAttributeError:function(a){var b=this.toError("MISSING_DATA_ATTRIBUTE");return b.property=a,b},is:function(a,b){var c=this.toErrno(b);return a.errno===c},created:function(a){return a.namespace===this.NAMESPACE},normalizeXHRError:function(a){var b;if(!("status"in(b=a&&0!==a.status?a.responseJSON?this.toError(a.responseJSON):503===a.status?this.toError("SERVICE_UNAVAILABLE"):429===a.status?this.toError("THROTTLED"):this.toError("UNEXPECTED_ERROR"):this.toError("SERVICE_UNAVAILABLE")))){var c=a&&a.status||0;b.status=c}return b}}}),define("lib/logger",["require","exports","module"],function(a,b,c){"use strict";function d(a){this._window=a||window}d.prototype={info:function(){this._window.console&&this._window.console.info&&this._window.console.info.apply(this._window.console,arguments)},trace:function(){this._window.console&&this._window.console.trace&&this._window.console.trace()},warn:function(){this._window.console&&this._window.console.warn&&this._window.console.warn.apply(this._window.console,arguments)},error:function(a){if(this._window.console&&this._window.console.error){var b="";a.errorModule?(b=a.errorModule.toInterpolatedMessage(a),this._window.console.error(b)):this._window.console.error.apply(this._window.console,arguments)}}},c.exports=d}),define("lib/auth-errors",["require","exports","module","underscore","lib/errors","lib/logger"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/errors"),f=a("lib/logger"),g=new f,h=function(a){return a},i=h("Unexpected error"),j=h("The link you clicked to verify your email is expired."),k=h("You've tried too many times. Try again later."),l=h("You've tried too many times. Try again %(retryAfterLocalized)s."),m={UNEXPECTED_ERROR:{errno:999,message:i},INVALID_TOKEN:{errno:110,message:h("Invalid token")},INVALID_TIMESTAMP:{errno:111,message:h("Invalid timestamp in request signature")},INVALID_NONCE:{errno:115,message:h("Invalid nonce in request signature")},ACCOUNT_ALREADY_EXISTS:{errno:101,message:h("Account already exists")},UNKNOWN_ACCOUNT:{errno:102,message:h("Unknown account")},INCORRECT_EMAIL_CASE:{errno:120,message:h("Incorrect email case")},INCORRECT_PASSWORD:{errno:103,message:h("Incorrect password")},UNVERIFIED_ACCOUNT:{errno:104,message:h("Unverified account")},INVALID_VERIFICATION_CODE:{errno:105,message:h("Invalid verification code")},INVALID_JSON:{errno:106,message:h("Invalid JSON in request body")},INVALID_PARAMETER:{errno:107,message:h("Invalid parameter: %(param)s")},MISSING_PARAMETER:{errno:108,message:h("Missing parameter: %(param)s")},INVALID_REQUEST_SIGNATURE:{errno:109,message:h("Invalid request signature")},MISSING_CONTENT_LENGTH_HEADER:{errno:112,message:h("Missing content-length header")},REQUEST_TOO_LARGE:{errno:113,message:h("Request body too large")},THROTTLED:{errno:114,message:k},REQUEST_BLOCKED:{errno:125,message:h("The request was blocked for security reasons")},ACCOUNT_RESET:{errno:126,message:h("Your account has been locked for security reasons")},INCORRECT_UNBLOCK_CODE:{errno:127,message:h("Invalid authorization code")},INVALID_PHONE_NUMBER:{errno:129,message:h("Invalid phone number")},INVALID_PHONE_REGION:{errno:130,message:h("Cannot send to this country")},SMS_ID_INVALID:{errno:131,message:"SMS ID invalid"},SMS_REJECTED:{errno:132,message:h("Could not send a message to this number")},EMAIL_SENT_COMPLAINT:{errno:133,message:h("Your email was just returned")},EMAIL_HARD_BOUNCE:{errno:134,message:h("Your email was just returned. Mistyped email?")},EMAIL_SOFT_BOUNCE:{errno:135,message:h("Unable to deliver email")},EMAIL_EXISTS:{errno:136,message:h("This email was already verified by another user")},EMAIL_PRIMARY_EXISTS:{errno:139,message:h("Secondary email must be different than your account email")},EMAIL_VERIFIED_PRIMARY_EXISTS:{errno:140,message:h("Account already exists")},UNVERIFIED_PRIMARY_EMAIL_NEWLY_CREATED:{errno:141,message:h("Account already exists")},LOGIN_WITH_SECONDARY_EMAIL:{errno:142,message:h("Primary account email required for sign-in")},VERIFIED_SECONDARY_EMAIL_EXISTS:{errno:144,message:h("Address in use by another account")},RESET_PASSWORD_WITH_SECONDARY_EMAIL:{errno:145,message:h("Primary account email required for reset")},INVALID_SIGNIN_CODE:{errno:146,message:h("Invalid signin code")},SERVER_BUSY:{errno:201,message:h("Server busy, try again soon")},ENDPOINT_NOT_SUPPORTED:{errno:116,message:h("This endpoint is no longer supported")},SERVICE_UNAVAILABLE:{errno:998,message:h("System unavailable, try again soon")},USER_CANCELED_LOGIN:{errno:1001,message:h("Login attempt cancelled")},SESSION_EXPIRED:{errno:1002,message:h("Session expired. Sign in to continue.")},COOKIES_STILL_DISABLED:{errno:1003,message:h("Cookies are still disabled")},PASSWORDS_DO_NOT_MATCH:{errno:1004,message:h("Passwords do not match")},WORKING:{errno:1005,message:h("Working")},COULD_NOT_GET_PP:{errno:1006,message:h("Could not get Privacy Notice")},COULD_NOT_GET_TOS:{errno:1007,message:h("Could not get Terms of Service")},PASSWORDS_MUST_BE_DIFFERENT:{errno:1008,message:h("Your new password must be different")},PASSWORD_TOO_SHORT:{errno:1009,message:h("Must be at least 8 characters")},PASSWORD_REQUIRED:{errno:1010,message:h("Valid password required")},EMAIL_REQUIRED:{errno:1011,message:h("Valid email required")},UNUSABLE_IMAGE:{errno:1013,message:h("A usable image was not found")},NO_CAMERA:{errno:1014,message:h("Could not initialize camera")},URL_REQUIRED:{errno:1015,message:h("Valid URL required")},DESKTOP_CHANNEL_TIMEOUT:{errno:1017,message:i},SIGNUP_EMAIL_BOUNCE:{errno:1018,message:h("Your verification email was just returned. Mistyped email?")},DIFFERENT_EMAIL_REQUIRED:{errno:1019,message:h("Valid email required")},DIFFERENT_EMAIL_REQUIRED_FIREFOX_DOMAIN:{errno:1020,message:h("Enter a valid email address. firefox.com does not offer email.")},CHANNEL_TIMEOUT:{errno:1021,message:i},ILLEGAL_IFRAME_PARENT:{errno:1022,message:h("Firefox Accounts can only be placed into an IFRAME on approved sites")},INVALID_EMAIL:{errno:1023,message:h("Valid email required")},EXPIRED_VERIFICATION_LINK:{errno:1025,message:j},DAMAGED_VERIFICATION_LINK:{errno:1026,message:h("Verification link damaged")},UNEXPECTED_POSTMESSAGE_ORIGIN:{errno:1027,message:i},INVALID_IMAGE_SIZE:{errno:1028,message:h("The image dimensions must be at least 100x100px")},IOS_SIGNUP_DISABLED:{errno:1029,message:h("Signup is coming soon to Firefox for iOS")},AGE_REQUIRED:{errno:1031,message:h("You must enter your age to sign up")},INVALID_CAMERA_DIMENSIONS:{errno:1033,message:i},DELETED_ACCOUNT:{errno:1034,message:h("Account no longer exists.")},INVALID_RESUME_TOKEN_PROPERTY:{errno:1035,message:h("Invalid property in resume token: %(property)s")},MISSING_RESUME_TOKEN_PROPERTY:{errno:1036,message:h("Missing property in resume token: %(property)s")},INVALID_DATA_ATTRIBUTE:{errno:1037,message:h("Invalid data attribute: %(property)s")},MISSING_DATA_ATTRIBUTE:{errno:1038,message:h("Missing data attribute: %(property)s")},POLLING_FAILED:{errno:1039,message:h("Server busy, try again soon")},UNKNOWN_ACCOUNT_VERIFICATION:{errno:1040,message:j},REUSED_SIGNIN_VERIFICATION_CODE:{errno:1041,message:h("That confirmation link was already used, and can only be used once.")},INPUT_REQUIRED:{errno:1042,message:h("This is a required field")},UNBLOCK_CODE_REQUIRED:{errno:1043,message:h("Authorization code required")},INVALID_UNBLOCK_CODE:{errno:1044,message:h("Invalid authorization code")},DAMAGED_REJECT_UNBLOCK_LINK:{errno:1045,message:h("Link damaged")},UNSAFE_INTERPOLATION_VARIABLE_NAME:{errno:1046,message:"String contains variables that are not escaped: %(string)s"},HTML_WILL_BE_ESCAPED:{errno:1047,message:"HTML will be escaped: %(string)s"},CANNOT_CHANGE_INPUT_TYPE:{errno:1048,message:"Cannot change input type: %(type)s"},PHONE_NUMBER_REQUIRED:{errno:1049,message:h("Phone number required")},ACCOUNT_HAS_NO_UID:{errno:1050,message:"Account has no uid"},INVALID_WEB_CHANNEL:{errno:1051,message:"Browser not configured to accept WebChannel messages from this domain"}};c.exports=d.extend({},e,{ERRORS:m,NAMESPACE:"auth",toInterpolationContext:function(a){try{if(this.is(a,"INVALID_PARAMETER"))return{param:a.param||a.validation.keys};if(this.is(a,"MISSING_PARAMETER"))return{param:a.param};if(this.is(a,"INVALID_RESUME_TOKEN_PROPERTY"))return{property:a.property};if(this.is(a,"MISSING_RESUME_TOKEN_PROPERTY"))return{property:a.property};if(this.is(a,"INVALID_DATA_ATTRIBUTE"))return{property:a.property};if(this.is(a,"MISSING_DATA_ATTRIBUTE"))return{property:a.property};if(this.is(a,"UNSAFE_INTERPOLATION_VARIABLE_NAME"))return{string:a.string};if(this.is(a,"HTML_WILL_BE_ESCAPED"))return{string:a.string};if(this.is(a,"CANNOT_CHANGE_INPUT_TYPE"))return{type:a.type};if(this.is(a,"THROTTLED"))return a.retryAfterLocalized&&(a.message=l),{retryAfterLocalized:a.retryAfterLocalized}}catch(a){g.error("Error in errors.js->toInterpolationContext: %s",String(a))}return{}}})}),function(a){"function"==typeof require&&"undefined"!=typeof module&&module.exports?module.exports=a(require("underscore")):"function"==typeof define?define("cocktail",["underscore"],a):this.Cocktail=a(_)}(function(a){var b={};b.mixins={},b.mixin=function(c){var d=a.chain(arguments).toArray().rest().flatten().value(),e=c.prototype||c,f={};return a(d).each(function(c){a.isString(c)&&(c=b.mixins[c]),a(c).each(function(b,c){if(a.isFunction(b)){if(e[c]===b)return;e[c]&&(f[c]=f.hasOwnProperty(c)?f[c]:[e[c]],f[c].push(b)),e[c]=b}else a.isArray(b)?e[c]=a.union(b,e[c]||[]):a.isObject(b)?e[c]=a.extend({},b,e[c]||{}):c in e||(e[c]=b)})}),a(f).each(function(b,c){e[c]=function(){var c,d=this,e=arguments;return a(b).each(function(b){var f=a.isFunction(b)?b.apply(d,e):b;c=void 0===f?c:f}),c}}),c};var c;return b.patch=function(d){c=d.Model.extend;var e=function(a,d){var e=c.call(this,a,d),f=e.prototype.mixins;return f&&e.prototype.hasOwnProperty("mixins")&&b.mixin(e,f),e};a([d.Model,d.Collection,d.Router,d.View]).each(function(c){c.mixin=function(){b.mixin(this,a.toArray(arguments))},c.extend=e})},b.unpatch=function(b){a([b.Model,b.Collection,b.Router,b.View]).each(function(a){a.mixin=void 0,a.extend=c})},b}),define("lib/dom-writer",["require","exports","module"],function(a,b,c){"use strict";c.exports={write:function(a,b){$("#loading-spinner").hide(),$("#stage").html(b).addClass("fade-in-forward").css("opacity",1),a.scrollTo(0,0),$("#fox-logo").addClass("fade-in-forward").css("opacity",1)}}}),define("text",{}),function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),"function"==typeof define&&define.amd?define("mustache",c):a.Mustache=c}}(this,function(a){function b(a,b){return u.call(a,b)}function c(a){return!b(q,a)}function d(a){return"function"==typeof a}function e(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return x[a]})}function g(a){this.string=a,this.tail=a,this.pos=0}function h(a,b){this.view=null==a?{}:a,this.parent=b,this._cache={".":this.view}}function i(){this.clearCache()}function j(b,c,e,f){function g(a){return c.render(a,e)}for(var h,i,k,l="",m=0,n=b.length;m<n;++m)switch(h=b[m],i=h[1],h[0]){case"#":if("object"==typeof(k=e.lookup(i))||"string"==typeof k)if(w(k))for(var o=0,p=k.length;o<p;++o)l+=j(h[4],c,e.push(k[o]),f);else k&&(l+=j(h[4],c,e.push(k),f));else if(d(k)){var q=null==f?null:f.slice(h[3],h[5]);k=k.call(e.view,q,g),null!=k&&(l+=k)}else k&&(l+=j(h[4],c,e,f));break;case"^":k=e.lookup(i),(!k||w(k)&&0===k.length)&&(l+=j(h[4],c,e,f));break;case">":k=c.getPartial(i),d(k)&&(l+=k(e));break;case"&":k=e.lookup(i),null!=k&&(l+=k);break;case"name":k=e.lookup(i),null!=k&&(l+=a.escape(k));break;case"text":l+=i}return l}function k(a){for(var b,c=[],d=c,e=[],f=0,g=a.length;f<g;++f)switch(b=a[f],b[0]){case"#":case"^":e.push(b),d.push(b),d=b[4]=[];break;case"/":e.pop()[5]=b[2],d=e.length>0?e[e.length-1][4]:c;break;default:d.push(b)}return c}function l(a){for(var b,c,d=[],e=0,f=a.length;e<f;++e)(b=a[e])&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(c=b,d.push(b)));return d}function m(a){return[new RegExp(e(a[0])+"\\s*"),new RegExp("\\s*"+e(a[1]))]}function n(b,d){if(b=b||"",d=d||a.tags,"string"==typeof d&&(d=d.split(p)),2!==d.length)throw new Error("Invalid tags: "+d.join(", "));for(var f,h,i,j,n,q,u=m(d),v=new g(b),w=[],x=[],y=[],z=!1,A=!1;!v.eos();){if(f=v.pos,i=v.scanUntil(u[0]))for(var B=0,C=i.length;B<C;++B)j=i.charAt(B),c(j)?y.push(x.length):A=!0,x.push(["text",j,f,f+1]),f+=1,"\n"==j&&function(){if(z&&!A)for(;y.length;)delete x[y.pop()];else y=[];z=!1,A=!1}();if(!v.scan(u[0]))break;if(z=!0,h=v.scan(t)||"name",v.scan(o),"="===h?(i=v.scanUntil(r),v.scan(r),v.scanUntil(u[1])):"{"===h?(i=v.scanUntil(new RegExp("\\s*"+e("}"+d[1]))),v.scan(s),v.scanUntil(u[1]),h="&"):i=v.scanUntil(u[1]),!v.scan(u[1]))throw new Error("Unclosed tag at "+v.pos);if(n=[h,i,f,v.pos],x.push(n),"#"===h||"^"===h)w.push(n);else if("/"===h){if(!(q=w.pop()))throw new Error('Unopened section "'+i+'" at '+f);if(q[1]!==i)throw new Error('Unclosed section "'+q[1]+'" at '+f)}else if("name"===h||"{"===h||"&"===h)A=!0;else if("="===h){if(d=i.split(p),2!==d.length)throw new Error("Invalid tags at "+f+": "+d.join(", "));u=m(d)}}if(q=w.pop())throw new Error('Unclosed section "'+q[1]+'" at '+v.pos);return k(l(x))}var o=/\s*/,p=/\s+/,q=/\S/,r=/\s*=/,s=/\s*\}/,t=/#|\^|\/|>|\{|&|=|!/,u=RegExp.prototype.test,v=Object.prototype.toString,w=Array.isArray||function(a){return"[object Array]"===v.call(a)},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(a){var b=this.tail.match(a);if(b&&0===b.index){var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c}return""},g.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},h.make=function(a){return a instanceof h?a:new h(a)},h.prototype.push=function(a){return new h(a,this)},h.prototype.lookup=function(a){var b;if(a in this._cache)b=this._cache[a];else{for(var c=this;c;){if(a.indexOf(".")>0){b=c.view;for(var e=a.split("."),f=0;null!=b&&f<e.length;)b=b[e[f++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return d(b)&&(b=b.call(this.view)),b},i.prototype.clearCache=function(){this._cache={},this._partialCache={}},i.prototype.compile=function(b,c){var d=this._cache[b];if(!d){var e=a.parse(b,c);d=this._cache[b]=this.compileTokens(e,b)}return d},i.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},i.prototype.getPartial=function(a){return a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a)),this._partialCache[a]},i.prototype.compileTokens=function(a,b){var c=this;return function(e,f){if(f)if(d(f))c._loadPartial=f;else for(var g in f)c.compilePartial(g,f[g]);return j(a,c,h.make(e),b)}},i.prototype.render=function(a,b,c){return this.compile(a)(b,c)},a.name="mustache.js",a.version="0.7.3",a.tags=["{{","}}"],a.Scanner=g,a.Context=h,a.Writer=i,a.parse=n,a.escape=f;var y=new i;a.clearCache=function(){return y.clearCache()},a.compile=function(a,b){return y.compile(a,b)},a.compilePartial=function(a,b,c){return y.compilePartial(a,b,c)},a.compileTokens=function(a,b){return y.compileTokens(a,b)},a.render=function(a,b,c){return y.render(a,b,c)},a.to_html=function(b,c,e,f){var g=a.render(b,c,e);if(!d(f))return g;f(g)}}),define("stache",{load:function(a){throw new Error("Dynamic load not allowed: "+a)}}),define("stache!templates/500",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-500-header">{{#t}}500 Error{{/t}}</h1>\n  </header>\n\n  <section>\n    {{#t}}Oh dear, something went wrong there. We\'ve been notified and will get working on a fix.{{/t}}\n  </section>\n</div>\n\n')}),define("stache!templates/400",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-400-header">{{#t}}Bad Request{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error visible">{{message}}</div>\n  </section>\n</div>\n\n')}),define("lib/oauth-errors",["require","exports","module","underscore","lib/errors","lib/logger","lib/strings"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/errors"),f=a("lib/logger"),g=new f,h=a("lib/strings"),i=function(a){return a},j=i("Unexpected error"),k={UNKNOWN_CLIENT:{errno:101,message:i("Unknown client")},INCORRECT_REDIRECT:{errno:103,message:i("Incorrect redirect_uri")},INVALID_ASSERTION:{errno:104,message:i("Invalid assertion")},UNKNOWN_CODE:{errno:105,message:i("Unknown code")},INCORRECT_CODE:{errno:106,message:i("Incorrect code")},EXPIRED_CODE:{errno:107,message:i("Expired code")},INVALID_TOKEN:{errno:108,message:i("Invalid token")},INVALID_PARAMETER:{errno:109,message:i("Invalid OAuth parameter: %(param)s")},INVALID_RESPONSE_TYPE:{errno:110,message:j},UNAUTHORIZED:{errno:111,message:i("Unauthorized")},FORBIDDEN:{errno:112,message:i("Forbidden")},INVALID_CONTENT_TYPE:{errno:113,message:j},INVALID_SCOPES:{errno:114,message:h.interpolate(i("Invalid OAuth parameter: %(param)s"),{param:"scope"})},SERVICE_UNAVAILABLE:{errno:998,message:i("System unavailable, try again soon")},UNEXPECTED_ERROR:{errno:999,message:j},TRY_AGAIN:{errno:1e3,message:i("Something went wrong. Please close this tab and try again.")},INVALID_RESULT:{errno:1001,message:j},INVALID_RESULT_REDIRECT:{errno:1002,message:j},INVALID_RESULT_CODE:{errno:1003,message:j},USER_CANCELED_OAUTH_LOGIN:{errno:1004,message:i("no message")},MISSING_PARAMETER:{errno:1005,message:i("Missing OAuth parameter: %(param)s")}};c.exports=d.extend({},e,{ERRORS:k,NAMESPACE:"oauth",toInterpolationContext:function(a){try{if(this.is(a,"MISSING_PARAMETER"))return{param:a.param};if(this.is(a,"INVALID_PARAMETER"))return{param:a.param||a.validation.keys.join(",")}}catch(a){g.error("Error in oauth-errors.js->toInterpolationContext: %s",String(a))}return{}}})}),function(a){"undefined"!=typeof module&&module&&module.exports?module.exports=a():"function"==typeof define&&define.amd?define("p-promise",a):P=a()}(function(){"use strict";function a(a){if(!a.stack)try{throw a}catch(a){}return a}function b(){var a=R(new Error).stack;if(!a)return null;var b=[e(a,1)];return T&&(b=b.concat(T),128===b.length&&b.pop()),b}function c(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a)||/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)||/@(.+):(\d+):(?:\d+)$/.exec(a);return b?{fileName:b[1],lineNumber:Number(b[2])}:null}function d(){var a=R(new Error).stack;if(!a)return 0;var b=a.split("\n"),d=b[0].indexOf("@")>0?b[1]:b[2],e=c(d);return e?(Q=e.fileName,e.lineNumber):0}function e(a,b){for(var c=a.split("\n"),d=[],e=0|b,h=c.length;e<h;++e){var i=c[e];!i||f(i)||g(i)||d.push(i)}return d.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=c(a);return!!b&&b.fileName===Q&&b.lineNumber>=S&&b.lineNumber<=pa}function h(a){if(a instanceof Error){var b=a.stack;if(b){if(~b.indexOf(W))return}else b=R(a).stack;b&&(a.stack=[e(b,0)].concat(T||[]).join(W))}}function i(){this.f=null,this.a=null,this.b=null,this.next=null}function j(a){return"object"===a||"function"===a}function k(){if(da.length)throw da.shift()}function l(){for(;$!==_;){var a=$=$.next;ba>=1024?_.next=_.next.next:++ba;var b=a.f,c=a.a,d=a.b;a.f=null,a.a=null,a.b=null,b(c,d)}aa=!1,T=null}function m(a,b,c){var d=_.next;d===$?(_.next=d=new i,d.next=$):--ba,_=d,d.f=a,d.a=b,d.b=c,aa||(aa=!0,ca())}function n(){var a=process.domain;a&&(V||(V=require("domain")),V.active=process.domain=null),aa&&Y?setImmediate(l):process.nextTick(l),a&&(V.active=process.domain=a)}function o(a){return function(){function b(){clearTimeout(c),clearInterval(d),a()}var c=setTimeout(b,0),d=setInterval(b,50)}}function p(a){if(!q.onerror)throw a;(0,q.onerror)(a)}function q(a){return a instanceof H?a:u(new H,a)}function r(a,b){a._state>0||(a._state=ha,a._value=b,a._domain=null,z(a))}function s(a,b){a._state>0||(T&&h(b),a._state=ia,a._value=b,X&&(a._domain=process.domain),a._op===ma?U(b):z(a))}function t(a,b){b._state>0||(b._state=a._state,b._value=a._value,b._domain=a._domain,z(b))}function u(a,b){if(a._state>0)return a;if(b instanceof H)v(a,b);else{var c=typeof b;"object"===c&&null!==b||"function"===c?w(a,b):r(a,b)}return a}function v(a,b){b===a?s(a,new TypeError("You can't resolve a promise with itself")):b._state>0?t(b,a):B(b,ka,a)}function w(a,b){var c=x(a,b);"function"==typeof c?y(E(a,!1),c,b):r(a,b)}function x(a,b){try{return b.then}catch(b){return s(a,b),null}}function y(a,b,c){try{fa.call(b,c,a.resolve,a.reject)}catch(b){a.reject(b)}}function z(a){null!==a._pending&&(A(a,a._op,a._pending),a._pending=null)}function A(a,b,c){if(b>=0)c._cb(a,b);else if(b===ja)c(a);else if(b===ka)m(C,a,c);else for(var d=0,e=c.length;d<e;d+=2)A(a,c[d],c[d+1])}function B(a,b,c){a._state>0?A(a,b,c):null===a._pending?(a._pending=c,a._op=b):a._op===la?a._pending.push(b,c):(a._pending=[a._op,a._pending,b,c],a._op=la)}function C(a,b){var c=a._state===ha?b._cb:b._eb;b._cb=null,b._eb=null,b._trace&&(T=b._trace,b._trace=null),null===c?t(a,b):D(b,c,a._value,a._domain||b._domain)}function D(a,b,c,d){if(d){if(d._disposed)return;d.enter()}try{c=b(c)}catch(b){s(a,b),a=null}a&&u(a,c),d&&d.exit()}function E(a,c){function d(b,d){if(a){var f=a;a=null,e&&(T?e=null:T=e),b?s(f,c?b:d):u(f,d),e&&(T=e=null)}}var e=q.longStackSupport?b():null;return c?d:{promise:a,resolve:function(a){d(!1,a)},reject:function(a){d(!0,a)}}}function F(){return E(new H,!1)}function G(a){var b=new H;return s(b,a),b}function H(){this._state=0,this._value=void 0,this._domain=null,this._cb=null,this._eb=null,this._op=0,this._pending=null,this._trace=null}function I(a,b){this._value[b]=a.inspect(),0==++this._state&&(null===this._pending?this._state=ha:m(r,this,this._value))}function J(a,b){this._state<0&&(a._state===ia?(this._state=0,null===this._pending?t(a,this):m(t,a,this)):(this._value[b]=a._value,0==++this._state&&(null===this._pending?this._state=ha:m(r,this,this._value))))}function K(a){var b=new H;b._cb=oa?I:J,oa=!1;var c=0|a.length;b._state=c?-c:ha,b._value=new Array(c);for(var d=0;d<c&&b._state<0;++d)B(q(a[d]),d,b);return b}function L(a){return oa=!0,K(a)}function M(a,b,c){return K(a).then(function(a){return ga.call(b,void 0,a)},c)}function N(a){function b(b){return fa.apply(a,b)}return function(){var a=arguments.length,c=new Array(a+1);c[0]=this;for(var d=0;d<a;++d)c[d+1]=arguments[d];return K(c).then(b)}}function O(a){return function(){var b=new H,c=arguments.length,d=new Array(c+1);for(d[c]=E(b,!0);c--;)d[c]=arguments[c];return P(b,a,this,d),b}}function P(a,b,c,d){try{ga.call(b,c,d)}catch(b){s(a,b)}}var Q,R=a,S=d(),T=null;(new Error).stack&&(R=function(a){return a});var U,V,W="\nFrom previous event:\n",X=j(typeof process)&&null!=process&&"[object process]"==={}.toString.call(process),Y="function"==typeof setImmediate,Z=j(typeof MutationObserver)&&MutationObserver||j(typeof WebKitMutationObserver)&&WebKitMutationObserver,$=new i,_=$,aa=!1,ba=0,ca=X?n:Z?function(a){var b=1,c=document.createTextNode("");return new Z(a).observe(c,{characterData:!0}),function(){b=-b,c.data=b}}(l):o(l),da=[],ea=o(k),fa=j.call,ga=j.apply;_.next=$,U=X?function(a){throw T=null,ca(),a}:function(a){da.push(a),ea()};var ha=1,ia=2,ja=-1,ka=-2,la=-3,ma=-4,na=q(void 0);q.longStackSupport=!1,q.defer=F,q.reject=G,H.prototype.then=function(a,c){var d=new H;return d._cb="function"==typeof a?a:null,d._eb="function"==typeof c?c:null,q.longStackSupport&&(d._trace=b()),X&&(d._domain=process.domain),this._state>0?m(C,this,d):B(this,ka,d),d},H.prototype.done=function(a,b){var c=this;(a||b)&&(c=c.then(a,b)),c.then(null,p)._op=ma},H.prototype.fail=function(a){return this.then(null,a)},H.prototype.fin=function(a){function b(){return a()}var c=this;return c.then(b,b).then(function(){return c})},H.prototype.spread=function(a,b){return this.then(K).then(function(b){return ga.call(a,void 0,b)},b)},H.prototype.timeout=function(a,c){var d=new H;if(this._state>0)t(this,d);else{var e=!1,f=q.longStackSupport?b():null,g=setTimeout(function(){e=!0,T=f,s(d,new Error(c||"Timed out after "+a+" ms")),T=null},a);B(this,ja,function(a){e||(m(t,a,d),clearTimeout(g))})}return d},H.prototype.delay=function(a){var b=new H;return B(this,ja,function(c){c._state===ha?setTimeout(function(){t(c,b)},a):m(t,c,b)}),b},H.prototype.all=function(){return this.then(K)},H.prototype.allSettled=function(){return this.then(L)},H.prototype.inspect=function(){switch(this._state){case ha:return{state:"fulfilled",value:this._value};case ia:return{state:"rejected",reason:this._value};default:return{state:"pending"}}},H.prototype.nodeify=function(a){return a?void this.done(function(b){a(null,b)},a):this};var oa=!1;q.all=K,q.allSettled=L,q.spread=M,q.promised=N,q.denodeify=O,q.onerror=null,q.nextTick=function(a){na.then(function(){a.call()})._op=ma};var pa=d();return q}),define("lib/promise",["require","exports","module","p-promise"],function(a,b,c){"use strict";var d=a("p-promise");window.Promise||(window.Promise=function(a){var b=d.defer();try{a(b.resolve.bind(b),b.reject.bind(b))}catch(a){b.reject(a)}return b.promise}),c.exports=d}),define("lib/error-utils",["require","exports","module","lib/auth-errors","lib/dom-writer","stache!templates/500","stache!templates/400","lib/logger","lib/oauth-errors","lib/promise"],function(a,b,c){"use strict";function d(a){return a?a.translateInTemplate.bind(a):function(){return function(a){return a}}}var e=a("lib/auth-errors"),f=a("lib/dom-writer"),g=a("stache!templates/500"),h=a("stache!templates/400"),i=a("lib/logger"),j=a("lib/oauth-errors"),k=a("lib/promise");c.exports={getErrorPageTemplate:function(a){return e.is(a,"INVALID_PARAMETER")||e.is(a,"MISSING_PARAMETER")||j.is(a,"INVALID_PARAMETER")||j.is(a,"MISSING_PARAMETER")||j.is(a,"UNKNOWN_CLIENT")?h:g},captureError:function(a,b,c,d){new i(d).error(a);try{a.message=this.getErrorMessage(a)}catch(a){}b.captureException(a),c&&c.logError(a)},captureAndFlushError:function(a,b,c,d){return this.captureError(a,b,c,d),k().then(function(){if(c)return c.flush()})},renderError:function(a,b,c){var e=this.getErrorPageTemplate(a),g=this.getErrorMessage(a,c),h=e({message:g,t:d(c)});f.write(b,h)},fatalError:function(a,b,c,d,e){return k.all([this.captureAndFlushError(a,b,c,d),this.renderError(a,d,e)])},getErrorMessage:function(a,b){return a&&a.errorModule?a.errorModule.toInterpolatedMessage(a,b):a.message}}}),define("views/mixins/external-links-mixin",["require","exports","module","jquery","lib/promise"],function(a,b,c){"use strict";function d(a){return a&&a.hasCapability("convertExternalLinksToText")}function e(a){var b=f(a),c=b.attr("href"),d=b.text();c&&c!==d&&b.addClass("visible-url").attr("data-visible-url",b.attr("href"))}var f=a("jquery"),g=a("lib/promise");c.exports={afterRender:function(){var a=this.$("a[href^=http]"),b=this.broker&&this.broker.environment&&this.broker.environment.isAboutAccounts();a.each(function(a,c){f(c).attr("rel","noopener noreferrer"),b&&f(c).attr("target","_blank")}),d(this.broker)&&a.each(function(a,b){return e(b)})},events:{"click a[href^=http]":"_onExternalLinkClick"},_onExternalLinkClick:function(a){return this._shouldIgnoreClick(a)?g():(a.preventDefault(),this._flushMetricsThenRedirect(a.currentTarget.href))},_shouldIgnoreClick:function(a){return this._isEventModifiedOrPrevented(a)||this._doesLinkOpenInAnotherTab(f(a.currentTarget))},_isEventModifiedOrPrevented:function(a){return!!(a.isDefaultPrevented()||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)},_doesLinkOpenInAnotherTab:function(a){return!!a.attr("target")},_flushMetricsThenRedirect:function(a){var b=this;return this.metrics.flush().then(function(){b.window.location=a})}}}),define("lib/channels/notifier-mixin",["require","exports","module","underscore"],function(a,b,c){"use strict";function d(a){var b=a.consumer,c=a.notifier;this._consumer=b,this._notifier=c,this.delegateNotifications()}var e=a("underscore"),f=/^once!/;d.prototype={delegateNotifications:function(a){var b=this,c=this._consumer;if(!a&&!(a=e.result(c,"notifications")))return!1;for(var d in a)!function(g){var h=a[g],i="on";f.test(g)&&(i="once",g=g.replace(f,"")),e.isString(h)&&e.isFunction(c[h])?b[i](g,function(){c[h].apply(c,arguments)}):e.isFunction(h)&&b[i](g,h.bind(c)),d=g}(d)},trigger:function(a,b){this._notifier.trigger(a,b,this._consumer)},triggerAll:function(a,b){this._notifier.triggerAll(a,b,this._consumer)},triggerRemote:function(a,b){this._notifier.triggerRemote(a,b)},on:function(a,b){this._consumer.listenTo(this._notifier,a,b)},once:function(a,b){this._consumer.listenToOnce(this._notifier,a,b)},off:function(a,b){this._consumer.stopListening(this._notifier,a,b)}};var g={initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.notifier&&(this.notifier=new d({consumer:this,notifier:a.notifier}))}};c.exports=g}),define("lib/constants",["require","exports","module"],function(a,b,c){"use strict";c.exports={URL_MAX_LENGTH:2048,
SESSION_TOKEN_USED_FOR_SYNC:"fx_desktop_v1",CONTENT_SERVER_CONTEXT:"web",FX_SYNC_CONTEXT:"fx_sync",FX_DESKTOP_V1_CONTEXT:"fx_desktop_v1",FX_DESKTOP_V2_CONTEXT:"fx_desktop_v2",FX_DESKTOP_V3_CONTEXT:"fx_desktop_v3",FX_FENNEC_V1_CONTEXT:"fx_fennec_v1",FX_FIRSTRUN_V1_CONTEXT:"fx_firstrun_v1",FX_FIRSTRUN_V2_CONTEXT:"fx_firstrun_v2",FX_IOS_V1_CONTEXT:"fx_ios_v1",IFRAME_CONTEXT:"iframe",OAUTH_CONTEXT:"oauth",CONTENT_SERVER_SERVICE:"content-server",SYNC_SERVICE:"sync",SYNC11_MIGRATION:"sync11",AMO_MIGRATION:"amo",VERIFICATION_POLL_IN_MS:4e3,EMAIL_RESEND_MAX_TRIES:4,CODE_LENGTH:32,UID_LENGTH:32,OAUTH_CODE_LENGTH:64,OAUTH_ACTION_SIGNIN:"signin",OAUTH_ACTION_SIGNUP:"signup",OAUTH_PROMPT_CONSENT:"consent",OAUTH_TRUSTED_PROFILE_SCOPE:"profile",OAUTH_TRUSTED_PROFILE_SCOPE_EXPANSION:["profile:uid","profile:email","profile:display_name","profile:avatar"],OAUTH_UNTRUSTED_ALLOWED_PERMISSIONS:["profile:display_name","profile:email","profile:uid"],RELIER_KEYS_LENGTH:32,RELIER_KEYS_CONTEXT_INFO_PREFIX:"identity.mozilla.com/picl/v1/oauth/",PASSWORD_MIN_LENGTH:8,PROFILE_IMAGE_DISPLAY_SIZE:240,PROFILE_IMAGE_EXPORT_SIZE:600,PROFILE_IMAGE_JPEG_QUALITY:.8,PROFILE_IMAGE_MIN_HEIGHT:100,PROFILE_IMAGE_MIN_WIDTH:100,DEFAULT_PROFILE_IMAGE_MIME_TYPE:"image/jpeg",DISALLOW_CACHED_CREDENTIALS:"blank",ONERROR_MESSAGE_LIMIT:100,ACCOUNT_UPDATES_WEBCHANNEL_ID:"account_updates",MARKETING_EMAIL_NEWSLETTER_ID:"firefox-accounts-journey",ACCESS_TYPE_ONLINE:"online",ACCESS_TYPE_OFFLINE:"offline",CLIENT_TYPE_DEVICE:"device",CLIENT_TYPE_OAUTH_APP:"oAuthApp",CLIENT_TYPE_WEB_SESSION:"webSession",DEFAULT_XHR_TIMEOUT_MS:2500,DEFAULT_DECLINED_ENGINES:["bookmarks","history","passwords","tabs","desktop-addons","desktop-preferences"],IOS_V1_LOGIN_MESSAGE_DELAY_MS:5e3,BLOCKED_SIGNIN_SUPPORT_URL:"https://support.mozilla.org/kb/accounts-blocked",UNBLOCK_CODE_LENGTH:8,MARKETING_ID_SPRING_2015:"spring-2015-android-ios-sync",MARKETING_ID_AUTUMN_2016:"autumn-2016-connect-another-device",DOWNLOAD_LINK_TEMPLATE_ANDROID:"https://app.adjust.com/2uo1qc?campaign=%(campaign)s&creative=%(creative)s&adgroup=android",DOWNLOAD_LINK_TEMPLATE_IOS:"https://app.adjust.com/2uo1qc?campaign=%(campaign)s&creative=%(creative)s&adgroup=ios&fallback=https://itunes.apple.com/app/apple-store/id989804926?pt=373246&ct=adjust_tracker&mt=8"}});var g=function(){var a={ms:1,s:1e3,m:6e4,h:36e5,d:864e5,w:6048e5},b=function(a){if(a instanceof b)return a;switch(typeof a){case"number":if(!isFinite(a))throw new Error("invalid duration: "+a);this._milliseconds=a;break;case"string":this._milliseconds=b.parse(a).valueOf();break;case"undefined":this._milliseconds=0;break;default:throw new Error("invalid duration: "+a)}};return b.millisecond=new b(1),b.second=new b(1e3),b.minute=new b(6e4),b.hour=new b(36e5),b.day=new b(864e5),b.week=new b(6048e5),b.prototype.nanoseconds=function(){return 1e6*this._milliseconds},b.prototype.microseconds=function(){return 1e3*this._milliseconds},b.prototype.milliseconds=function(){return this._milliseconds},b.prototype.seconds=function(){return Math.floor(this._milliseconds/1e3)},b.prototype.minutes=function(){return Math.floor(this._milliseconds/6e4)},b.prototype.hours=function(){return Math.floor(this._milliseconds/36e5)},b.prototype.days=function(){return Math.floor(this._milliseconds/864e5)},b.prototype.weeks=function(){return Math.floor(this._milliseconds/6048e5)},b.prototype.toString=function(){var a="",b=Math.abs(this._milliseconds),c=this._milliseconds<0?"-":"";if(0===b)return"0";var d=Math.floor(b/36e5);0!==d&&(b-=36e5*d,a+=d.toString()+"h");var e=Math.floor(b/6e4);0!==e&&(b-=6e4*e,a+=e.toString()+"m");var f=Math.floor(b/1e3);return 0!==f&&(b-=1e3*f,a+=f.toString()+"s"),0!==b&&(a+=b.toString()+"ms"),c+a},b.prototype.valueOf=function(){return this._milliseconds},b.parse=function(c){if("0"===c||"+0"===c||"-0"===c)return new b(0);for(var d,e,f,g=/([\-\+\d\.]+)([a-z]+)/g,h=0,i=0,j="-"===c[0]?-1:1;f=g.exec(c);){if(d=f[2],e=Math.abs(parseFloat(f[1])),i++,isNaN(e))throw new Error("invalid duration");if(void 0===a[d])throw new Error("invalid unit: "+d);h+=e*a[d]}if(0===i)throw new Error("invalid duration");return new b(h*j)},b.fromMicroseconds=function(a){var c=Math.floor(a/1e3);return new b(c)},b.fromNanoseconds=function(a){var c=Math.floor(a/1e6);return new b(c)},b.prototype.roundTo=function(a){var c=new b(a).valueOf();this._milliseconds=c*Math.round(this._milliseconds/c)},b}.call(this);!function(a){"function"==typeof define&&define.amd?define("duration",[],function(){return g}):"undefined"!=typeof module?module.exports=g:a.Duration=g}(this),function(a,b){"use strict";"function"==typeof define&&define.amd?define("lib/environment",b):a.FxaHead.Environment=b()}(window,function(){"use strict";function a(a){this.window=a}return a.prototype={hasGetUserMedia:function(){var a=this.window.navigator;return!!(a.mediaDevices||a.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia)},hasPasswordRevealer:function(){var a=this.window.document;return!!(a.documentMode&&a.documentMode>=10)},hasTouchEvents:function(){var a=this.window,b=a.document;return!!("ontouchstart"in a||a.DocumentTouch&&b instanceof a.DocumentTouch)},isFramed:function(){var a=this.window,b={payflow:!0,remote:!0},c=b[a.name];return!(!a.top||a.top===a||c)},isAboutAccounts:function(){var a=this.window,b=!(!a.top||a.top===a||"remote"!==a.name),c=a.location.search.indexOf("forceAboutAccounts=true")>0;return b||c},isFxiOS:function(){return/FxiOS/.test(this.window.navigator.userAgent)},hasSendBeacon:function(){return"function"==typeof this.window.navigator.sendBeacon}},a}),define("models/resume-token",["require","exports","module","underscore","backbone"],function(a,b,c){"use strict";function d(a){try{return JSON.parse(atob(a))}catch(a){}}function e(a){return btoa(JSON.stringify(a))}function f(a){var b=d(a);return new i(b)}var g=a("underscore"),h=a("backbone"),i=h.Model.extend({defaults:{email:void 0,entrypoint:void 0,flowBegin:void 0,flowId:void 0,resetPasswordConfirm:void 0,uniqueUserId:void 0,utmCampaign:null,utmContent:null,utmMedium:null,utmSource:null,utmTerm:null},initialize:function(a){this.allowedKeys=Object.keys(this.defaults),this.clear();var b=g.pick(a,this.allowedKeys);this.set(b)},stringify:function(){return e(this.pick(this.allowedKeys))}});g.extend(i,{createFromStringifiedResumeToken:f,parse:d,stringify:e}),c.exports=i}),define("lib/validate",["require","exports","module","underscore","lib/constants"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants"),f=e.UNBLOCK_CODE_LENGTH,g=/^(?:[a-fA-F0-9]{2})+$/,h=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/,i=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,j="^[a-z0-9]{"+f+"}$",k=new RegExp(j,"i"),l=/^[\w.!#$%&*+\/=?^`{|}~-]{1,64}@[a-z\d](?:[a-z\d-]{0,253}[a-z\d])?(?:\.[a-z\d](?:[a-z\d-]{0,253}[a-z\d])?)+$/i,m={isEmailValid:function(a){return!("string"!=typeof a||a.length>256)&&l.test(a)},isCodeValid:function(a){return"string"==typeof a&&(a.length===e.CODE_LENGTH&&g.test(a))},isOAuthCodeValid:function(a){return"string"==typeof a&&(a.length===e.OAUTH_CODE_LENGTH&&g.test(a))},isTokenValid:function(a){return"string"==typeof a&&g.test(a)},isUidValid:function(a){return"string"==typeof a&&(a.length===e.UID_LENGTH&&g.test(a))},isPasswordValid:function(a){return"string"==typeof a&&a.length>=e.PASSWORD_MIN_LENGTH},isPromptValid:function(a){var b=[e.OAUTH_PROMPT_CONSENT];return d.contains(b,a)},isUrlValid:function(a){return h.test(a)},isUuidValid:function(a){return i.test(a)},isAccessTypeValid:function(a){var b=[e.ACCESS_TYPE_OFFLINE,e.ACCESS_TYPE_ONLINE];return d.contains(b,a)},isHexValid:function(a){return g.test(a)},isUnblockCodeValid:function(a){return k.test(a)}};c.exports=m});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(a){if("object"===("undefined"==typeof exports?"undefined":f(exports))&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("vat",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.VAT=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){var b=new TypeError("validation error");return b.value=a,b}var e=a("../utils");b.exports={_allowed:[],_renameTo:null,_transforms:[],_valid:[],_validators:[],_duplicate:function(a){var b=Object.create(this);return a&&(b[a]=[].concat(this[a])),b},allow:function(){var a=this._duplicate("_allowed");return[].push.apply(a._allowed,arguments),a},clone:function(){return this._duplicate()},extend:function(a){return e.extend(this,a),this},optional:function(){return this},renameTo:function(a){if(0===arguments.length)return this._renameTo;var b=this._duplicate();return b._renameTo=a,b},required:function(){var a=this._duplicate();return a._isRequired=!0,a},strict:function(){var a=this._duplicate();return a._transforms=[],a},test:function(a){var b=this._duplicate("_validators");return b._validators.push(a),b},transform:function(a){var b=this._duplicate("_transforms");return b._transforms.push(a),b},valid:function(){var a=this._duplicate("_valid");return[].push.apply(a._valid,arguments),a},validate:function(a){var b=a;if(a=this._transforms.reduce(function(a,b){return b(a)},a),this._valid.length){if(e.contains(this._valid,a))return{value:a};if(!e.isUndefined(a))return{error:d(b)}}if(e.contains(this._allowed,a))return{value:a};if(e.isUndefined(a))return this._isRequired?{error:new ReferenceError("missing value")}:{value:a};try{this._validators.forEach(function(c){if(!c(a))throw d(b)})}catch(a){return{error:a}}return{value:a}}}},{"../utils":5}],2:[function(a,b,c){"use strict";b.exports=function(a){var b=a.utils;return a.any().transform(function(a){return"true"===a||"false"!==a&&a}).test(function(a){return b.isBoolean(a)||b.isUndefined(a)})}},{}],3:[function(a,b,c){"use strict";function d(a){var b=new RangeError("invalid value");return b.value=a,b}var e={max:function(a){return this.test(function(b){if(b>a)throw d(b);return!0})},min:function(a){return this.test(function(b){if(b<a)throw d(b);return!0})}};b.exports=function(a){var b=a.utils;return a.any().clone().extend(e).transform(function(a){if(!b.isNumber(a)){if(/^[+-]?\d+$/.test(a))return parseInt(a,10);if(/^[+-]?\d*\.\d*$/.test(a))return parseFloat(a);if(/^[+-]?Infinity$/.test(a))return"-"===a[0]?-1/0:1/0}return a}).test(function(a){return b.isNumber(a)||b.isUndefined(a)})}},{}],4:[function(a,b,c){"use strict";b.exports=function(a){var b={len:function(a){return this.test(function(b){return b.length===a})},max:function(a){return this.test(function(b){return b.length<=a})},min:function(a){return this.test(function(b){return b.length>=a})},test:function(b){if(b instanceof RegExp){var c=b;b=function(a){return c.test(a)}}return a.any().test.call(this,b)}},c=a.utils;return a.any().clone().extend(b).transform(function(a){return c.isString(a)?a.trim():a}).test(function(a){return c.isString(a)||c.isUndefined(a)})}},{}],5:[function(a,b,c){"use strict";b.exports={contains:function(a,b){return-1!==a.indexOf(b)},extend:function(a){return[].slice.call(arguments,1).forEach(function(b){for(var c in b)a[c]=b[c]}),a},isBoolean:function(a){return"[object Boolean]"===Object.prototype.toString.call(a)},isFunction:function(a){return"function"==typeof a},isNumber:function(a){return"[object Number]"===Object.prototype.toString.call(a)},isString:function(a){return"[object String]"===Object.prototype.toString.call(a)},isUndefined:function(a){return void 0===a},union:function(){var a=[].slice.call(arguments,0),c=[];return a.forEach(function(a){a.forEach(function(a){b.exports.contains(c,a)||c.push(a)})}),c}}},{}],6:[function(a,b,c){"use strict";function d(a,b,c){c=c||{};var e=null,f=a;try{if(g.isUndefined(b)){var h=new ReferenceError("missing schema");throw h.value=a,h}if(g.isFunction(b.validate))return b.validate(a);var i=g.union(Object.keys(a),Object.keys(b));f={},i.forEach(function(e){if(b[e]){var h=d(a[e],b[e],c);if(h.error)throw h.error.key=e,h.error;var i=b[e].renameTo()||e;g.isUndefined(h.value)&&!b[e]._isRequired||(f[i]=h.value)}else{if(!c.allowUnknown){var j=new ReferenceError("'"+e+"' is not allowed");throw j.key=e,j}f[e]=a[e]}})}catch(a){e=a}return{error:e,value:f}}function e(a,c){if(g.contains(h,a))throw new Error("'"+a+"' is reserved");if(i[a])throw new Error("'"+a+"' is already registered");b.exports[a]=i[a]=function(){return c}}function f(a){if(g.contains(h,a))throw new Error("'"+a+"' is reserved");if(!i[a])throw new Error("'"+a+"' is already not registered");delete b.exports[a],delete i[a]}var g=a("./utils");b.exports={register:e,unregister:f,utils:g,validate:d};var h=Object.keys(b.exports),i={};e("any",a("./types/any")),e("boolean",a("./types/boolean")(b.exports)),e("number",a("./types/number")(b.exports)),e("string",a("./types/string")(b.exports))},{"./types/any":1,"./types/boolean":2,"./types/number":3,"./types/string":4,"./utils":5}]},{},[6])(6)}),define("lib/vat",["require","exports","module","lib/validate","vat"],function(a,b,c){"use strict";var d=a("lib/validate"),e=a("vat");return e.register("accessType",e.string().test(d.isAccessTypeValid)),e.register("email",e.string().test(d.isEmailValid)),e.register("hex",e.string().test(d.isHexValid)),e.register("keyFetchToken",e.string()),e.register("oauthCode",e.string().test(d.isOAuthCodeValid)),e.register("password",e.string().test(d.isPasswordValid)),e.register("prompt",e.string().test(d.isPromptValid)),e.register("sessionToken",e.string()),e.register("token",e.string().test(d.isTokenValid)),e.register("uid",e.string().test(d.isUidValid)),e.register("unblockCode",e.string().test(d.isUnblockCodeValid)),e.register("unwrapBKey",e.string()),e.register("url",e.string().test(d.isUrlValid)),e.register("uuid",e.string().test(d.isUuidValid)),e.register("verificationCode",e.string().test(d.isCodeValid)),e.register("verificationRedirect",e.string().test(d.isVerificationRedirectValid)),e.register("clientId",e.hex()),e.any().extend({empty:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return this.transform(function(a){return b.indexOf(a)>-1?void 0:a})}}),e}),define("models/mixins/resume-token",["require","exports","module","lib/auth-errors","lib/error-utils","models/resume-token","lib/vat"],function(a,b,c){"use strict";function d(a){if(this.resumeTokenSchema)return i.validate(a,this.resumeTokenSchema).error}function e(a){a=a instanceof ReferenceError?f.toMissingResumeTokenPropertyError(a.key):f.toInvalidResumeTokenPropertyError(a.key),g.captureError(a,this.sentryMetrics)}var f=a("lib/auth-errors"),g=a("lib/error-utils"),h=a("models/resume-token"),i=a("lib/vat");c.exports={pickResumeTokenInfo:function(){if(this.resumeTokenFields)return this.pick(this.resumeTokenFields)},populateFromStringifiedResumeToken:function(a){if(this.resumeTokenFields){var b=h.createFromStringifiedResumeToken(a);this.populateFromResumeToken(b)}},populateFromResumeToken:function(a){if(this.resumeTokenFields){var b=a.pick(this.resumeTokenFields),c=d.call(this,b);if(c)return e.call(this,c);this.set(b)}}}});var h=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("lib/url",["require","exports","module","underscore"],function(a,b,c){"use strict";var d=a("underscore");c.exports={searchParams:function(a,b){var c=a.replace(/^\?/,"").trim();if(!c)return{};var e=c.split("&"),f={};return d.each(e,function(a){var b=a.split("="),c=h(b,2),d=c[0],e=c[1];f[d]=decodeURIComponent(e).trim()}),b?d.pick(f,b):f},searchParam:function(a,b){return this.searchParams(b)[a]},objToSearchString:function(a){var b=[];for(var c in a){var d=a[c];void 0!==d&&null!==d&&b.push(c+"="+encodeURIComponent(d))}return b.length?"?"+b.join("&"):""},getOrigin:function(a){if(!a)return"";var b=document.createElement("a");if(b.setAttribute("href",a),!b.protocol||!b.host)return null;var c=443===Number(b.port)||80===Number(b.port)?b.hostname:b.host,d=b.protocol+"//"+c;return 0!==a.indexOf(d)?null:d},updateSearchString:function(a,b){var c={},e=a.indexOf("?");return e>=0&&(c=this.searchParams(a.substring(e+1)),a=a.substring(0,e)),d.extend(c,b),a+this.objToSearchString(c)},cleanSearchString:function(a,b){var c=a.split("?"),d=h(c,2),e=d[0],f=d[1],g=void 0===f?"":f,i=this.searchParams(g,b);return e+this.objToSearchString(i)}}}),define("lib/search-param-mixin",["require","exports","module","lib/url"],function(a,b,c){"use strict";var d=a("lib/url");c.exports={getSearchParam:function(a){return d.searchParam(a,this.window.location.search)},getSearchParams:function(a){return d.searchParams(this.window.location.search,a)}}}),define("lib/transform",["require","exports","module","lib/vat"],function(a,b,c){"use strict";var d=a("lib/vat");c.exports={transformUsingSchema:function(a,b,c){var e=d.validate(a,b),f=e.error;if(f instanceof ReferenceError)throw c.toMissingParameterError(f.key);if(f instanceof TypeError)throw c.toInvalidParameterError(f.key);return e.value}}}),define("models/mixins/search-param",["require","exports","module","underscore","lib/search-param-mixin","lib/transform"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/search-param-mixin"),f=a("lib/transform");c.exports=d.extend({importSearchParamsUsingSchema:function(a,b){var c=this.getSearchParams(Object.keys(a)),d=f.transformUsingSchema(c,a,b);this.set(d)}},e)}),define("models/flow",["require","exports","module","jquery","lib/auth-errors","backbone","cocktail","lib/error-utils","models/mixins/resume-token","models/mixins/search-param","lib/vat"],function(a,b,c){"use strict";var d=a("jquery"),e=a("lib/auth-errors"),f=a("backbone"),g=a("cocktail"),h=a("lib/error-utils"),i=a("models/mixins/resume-token"),j=a("models/mixins/search-param"),k=a("lib/vat"),l=f.Model.extend({initialize:function(a){a=a||{},this.sentryMetrics=a.sentryMetrics,this.window=a.window||window,this.populateFromStringifiedResumeToken(this.getSearchParam("resume")),this.has("flowId")?this.has("flowBegin")||this.logError(e.toMissingResumeTokenPropertyError("flowBegin")):this.has("flowBegin")?this.logError(e.toMissingResumeTokenPropertyError("flowId")):(this.populateFromDataAttribute("flowId"),this.populateFromDataAttribute("flowBegin"))},defaults:{flowBegin:null,flowId:null},populateFromDataAttribute:function(a){var b=d(this.window.document.body).data(a);if(b){var c=this.resumeTokenSchema[a].validate(b);c.error?this.logError(e.toInvalidDataAttributeError(a)):this.set(a,c.value)}else this.logError(e.toMissingDataAttributeError(a))},logError:function(a){return h.captureError(a,this.sentryMetrics)},resumeTokenFields:["flowId","flowBegin"],resumeTokenSchema:{flowBegin:k.number().test(function(a){return a===Math.round(a)}),flowId:k.hex().len(64)}});g.mixin(l,i,j),c.exports=l}),function(a){a("speedTrap",["require","exports","module"],function(a,b,c,d){"use strict";function e(a){if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b}function f(){return(new Date).getTime()}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}var h,i={init:function(a){a=a||{},this.navigationTiming=e(k),this.navigationTiming.init(a),this.baseTime=this.navigationTiming.get().navigationStart||f(),this.timers=e(l),this.timers.init({baseTime:this.baseTime}),this.events=e(m),this.events.init({baseTime:this.baseTime}),this.uuid=g(),this.tags=a.tags||[];try{this.returning=!!localStorage.getItem("_st"),localStorage.setItem("_st","1")}catch(a){}},getLoad:function(){var a;try{a=sessionStorage.getItem("_puuid"),sessionStorage.removeItem("_puuid")}catch(a){}return{uuid:this.uuid,puuid:a,navigationTiming:this.navigationTiming.diff(),referrer:document.referrer||"",tags:this.tags,returning:this.returning,screen:{width:window.screen.width,height:window.screen.height}}},getUnload:function(){try{sessionStorage.setItem("_puuid",this.uuid)}catch(a){}return{uuid:this.uuid,duration:f()-this.baseTime,timers:this.timers.get(),events:this.events.get()}}},j={navigationStart:d,unloadEventStart:d,unloadEventEnd:d,redirectStart:d,redirectEnd:d,fetchStart:d,domainLookupStart:d,domainLookupEnd:d,connectStart:d,connectEnd:d,secureConnectionStart:d,requestStart:d,responseStart:d,responseEnd:d,domLoading:d,domInteractive:d,domContentLoadedEventStart:d,domContentLoadedEventEnd:d,domComplete:d,loadEventStart:d,loadEventEnd:d};try{h=window.performance.timing}catch(a){h=e(j)}var k={init:function(a){a=a||{},this.navigationTiming=a.navigationTiming||h,this.baseTime=this.navigationTiming.navigationStart||f()},get:function(){return this.navigationTiming},diff:function(){var a={},b=this.baseTime;for(var c in j)this.navigationTiming[c]?a[c]=this.navigationTiming[c]-b:a[c]=null;return a}},l={init:function(a){this.completed={},this.running={},this.baseTime=a.baseTime},start:function(a){var b=f();if(this.running[a])throw new Error(a+" timer already started");this.running[a]=b},stop:function(a){var b=f();if(!this.running[a])throw new Error(a+" timer not started");this.completed[a]||(this.completed[a]=[]);var c=this.running[a];this.completed[a].push({start:c-this.baseTime,stop:b-this.baseTime,elapsed:b-c}),this.running[a]=null,delete this.running[a]},get:function(a){return a?this.completed[a]:this.completed},clear:function(){this.completed={},this.running={}}},m={init:function(a){this.events=[],this.baseTime=a.baseTime},capture:function(a){this.events.push({type:a,offset:f()-this.baseTime})},get:function(){return this.events},clear:function(){this.events=[]}};c.exports=e(i)})}(function(a,b){return"function"==typeof define&&define.amd?define:"object"==typeof module?function(a){a(require,exports,module)}:function(a){var c={exports:{}},d=function(a){return b[a]};b.SpeedTrap=a(d,c.exports,c)||c.exports}}(0,this)),define("lib/xhr",["require","exports","module","jquery","underscore","lib/promise"],function(a,b,c){"use strict";function d(a){var b=g.defer();return a.then(function(a){return b.resolve(a)},function(a){return b.reject(a)}),b.promise}var e=a("jquery"),f=a("underscore"),g=a("lib/promise");c.exports={ajax:function(a){return"json"===a.dataType&&(a.contentType="application/json",a.data&&!1!==a.processData&&(a.data=JSON.stringify(a.data)),a.accepts||(a.accepts={}),a.accepts.json="application/json"),d(e.ajax(a))},oauthAjax:function(a){var b={dataType:"json",headers:{Accept:"application/json",Authorization:"Bearer "+a.accessToken},timeout:a.timeout,type:a.type,url:a.url};a.headers&&f.extend(b.headers,a.headers);var c=a.data;return c&&(b.data=c),"undefined"!=typeof Blob&&c instanceof Blob&&(b.processData=!1),this.ajax(b)},get:function(a,b,c,d){return d||(d="json"),this.ajax({data:b,dataType:d,method:"GET",success:c,url:a})},post:function(a,b,c,d){return d||(d="json"),this.ajax({data:b,dataType:d,method:"POST",success:c,url:a})},getJSON:function(a,b,c){return d(e.getJSON(a,b,c))}}}),define("lib/metrics",["require","exports","module","jquery","underscore","cocktail","lib/constants","backbone","duration","lib/environment","models/flow","lib/channels/notifier-mixin","lib/promise","speedTrap","lib/strings","lib/xhr"],function(a,b,c){"use strict";function d(a){return h.reduce(a,function(a,b){return a.concat(h.map(b,function(a){return a}))},[])}function e(a,b){return b?"flow."+b.replace(/^oauth\./,"")+"."+a:"flow."+a}function f(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._speedTrap=new t,this._speedTrap.init(),this.timers=this._speedTrap.timers,this.events=this._speedTrap.events,this._window=a.window||window,this._able=a.able,this._activeExperiments={},this._brokerType=a.brokerType||w,this._clientHeight=a.clientHeight||w,this._clientWidth=a.clientWidth||w,this._collector=a.collector||"",this._context=a.context||j.CONTENT_SERVER_CONTEXT,this._devicePixelRatio=a.devicePixelRatio||w,this._entrypoint=a.entrypoint||w,this._env=a.environment||new m(this._window),this._eventMemory={},this._inactivityFlushMs=a.inactivityFlushMs||v,this._isSampledUser=a.isSampledUser||!1,this._lang=a.lang||"unknown",this._marketingImpressions={},this._migration=a.migration||w,this._numStoredAccounts=a.numStoredAccounts||"",this._referrer=this._window.document.referrer||w,this._screenHeight=a.screenHeight||w,this._screenWidth=a.screenWidth||w,this._sentryMetrics=a.sentryMetrics,this._service=a.service||w,this._startTime=a.startTime||this._speedTrap.baseTime,this._uniqueUserId=a.uniqueUserId||w,this._utmCampaign=a.utmCampaign||w,this._utmContent=a.utmContent||w,this._utmMedium=a.utmMedium||w,this._utmSource=a.utmSource||w,this._utmTerm=a.utmTerm||w,this._xhr=a.xhr||s,this.initialize(a)}var g=a("jquery"),h=a("underscore"),i=a("cocktail"),j=a("lib/constants"),k=a("backbone"),l=a("duration"),m=a("lib/environment"),n=a("models/flow"),o=a("lib/channels/notifier-mixin"),p=a("lib/promise"),q=a("speedTrap"),r=a("lib/strings"),s=a("lib/xhr"),t=function(){};t.prototype=q;var u=["broker","context","duration","entrypoint","events","experiments","flowBeginTime","flowId","flushTime","isSampledUser","lang","marketing","migration","navigationTiming","numStoredAccounts","referrer","screen","service","startTime","timers","uniqueUserId","utm_campaign","utm_content","utm_medium","utm_source","utm_term"],v=new l("2m").milliseconds(),w="none";h.extend(f.prototype,k.Events,{ALLOWED_FIELDS:u,initialize:function(){this._flush=h.bind(this.flush,this,!0),g(this._window).on("unload",this._flush),g(this._window).on("blur",this._flush),this._resetInactivityFlushTimeout()},destroy:function(){g(this._window).off("unload",this._flush),g(this._window).off("blur",this._flush),this._clearInactivityFlushTimeout()},notifications:{"flow.initialize":"_initializeFlowModel","flow.event":"_logFlowEvent","view-shown":function(a){return function(){this.logEventOnce(a)}}("loaded")},_initializeFlowModel:function(){if(!this._flowModel){var a=new n({sentryMetrics:this._sentryMetrics,window:this._window});a.has("flowId")&&(this._flowModel=a)}},_logFlowEvent:function(a){if(this._flowModel){var b=a.viewName&&this.addViewNamePrefix(a.viewName),c=e(a.event,b);a.once?this.logEventOnce(c):this.logEvent(c)}},flush:function(a){var b=this;this._clearInactivityFlushTimeout();var c=this.getFilteredData();if(!this._isFlushRequired(c,this._lastFlushedData))return p();this._lastFlushedData=c,this._speedTrap.events.clear(),this._speedTrap.timers.clear(),this._numStoredAccounts="";var d=function(){return b._send(c,a)};return d().then(function(a){return a||d()})},_isFlushRequired:function(a,b){return!b||h.any(a,function(a,c){return"duration"!==c&&"flushTime"!==c&&(!("events"===c&&!a.length)&&(!("timers"===c&&!a.length)&&!h.isEqual(b[c],a)))})},_clearInactivityFlushTimeout:function(){clearTimeout(this._inactivityFlushTimeout)},_resetInactivityFlushTimeout:function(){var a=this;this._clearInactivityFlushTimeout(),this._inactivityFlushTimeout=setTimeout(function(){a.logEvent("inactivity.flush"),a.flush()},this._inactivityFlushMs)},getAllData:function(){var a=this._speedTrap.getLoad(),b=this._speedTrap.getUnload(),c=this.getFlowEventMetadata(),e=h.extend({},a,b,{broker:this._brokerType,context:this._context,entrypoint:this._entrypoint,experiments:d(this._activeExperiments),flowBeginTime:c.flowBeginTime,flowId:c.flowId,flushTime:Date.now(),isSampledUser:this._isSampledUser,lang:this._lang,marketing:d(this._marketingImpressions),migration:this._migration,numStoredAccounts:this._numStoredAccounts,referrer:this._referrer,screen:{clientHeight:this._clientHeight,clientWidth:this._clientWidth,devicePixelRatio:this._devicePixelRatio,height:this._screenHeight,width:this._screenWidth},service:this._service,startTime:this._startTime,uniqueUserId:this._uniqueUserId,utm_campaign:this._utmCampaign,utm_content:this._utmContent,utm_medium:this._utmMedium,utm_source:this._utmSource,utm_term:this._utmTerm});return JSON.parse(JSON.stringify(e))},getFilteredData:function(){var a=this,b=h.pick(this.getAllData(),u);return h.pick(b,function(b,c){return(!a._lastFlushedData||"navigationTiming"!==c)&&(!h.isUndefined(b)&&""!==b)})},_send:function(a,b){var c=this,d=this._collector+"/metrics",e=JSON.stringify(a);return this._env.hasSendBeacon()?p().then(function(){return c._window.navigator.sendBeacon(d,e)}):this._xhr.ajax({async:!b,contentType:"application/json",data:e,type:"POST",url:d}).then(function(){return!0},function(){return!1})},logEvent:function(a){this._resetInactivityFlushTimeout(),this.events.capture(a)},logEventOnce:function(a){this._eventMemory[a]||(this.logEvent(a),this._eventMemory[a]=!0)},startTimer:function(a){this._resetInactivityFlushTimeout(),this.timers.start(a)},stopTimer:function(a){this._resetInactivityFlushTimeout(),this.timers.stop(a)},logError:function(a){this.logEvent(this.errorToId(a))},errorToId:function(a){var b=a.context;return b||(b=a.viewName?this.addViewNamePrefix(a.viewName):"unknown context"),r.interpolate("error.%s.%s.%s",[b,a.namespace||"unknown namespace",a.errno||String(a)])},setViewNamePrefix:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._viewNamePrefix=a},addViewNamePrefix:function(a){return this._viewNamePrefix?this._viewNamePrefix+"."+a:a},logView:function(a){this.logEvent("screen."+this.addViewNamePrefix(a))},logViewEvent:function(a,b){this.logEvent(this.addViewNamePrefix(a)+"."+b)},logExperiment:function(a,b){if(this._logFlowEvent({event:"experiment."+a+"."+b,once:!0}),a&&b){var c=this._activeExperiments;c[a]||(c[a]={}),c[a][b]={choice:a,group:b}}},logMarketingImpression:function(a,b){a=a||"unknown";var c=this._marketingImpressions;c[a]||(c[a]={}),c[a][b]={campaignId:a,clicked:!1,url:b}},logMarketingClick:function(a,b){a=a||"unknown";var c=this.getMarketingImpression(a,b);c&&(c.clicked=!0)},getMarketingImpression:function(a,b){var c=this._marketingImpressions;return c[a]&&c[a][b]},setBrokerType:function(a){this._brokerType=a},isCollectionEnabled:function(){return this._isSampledUser},getFlowEventMetadata:function(){var a=this._flowModel&&this._flowModel.attributes||{};return{flowBeginTime:a.flowBegin,flowId:a.flowId}},getFlowModel:function(a){return this._flowModel},logNumStoredAccounts:function(a){this._numStoredAccounts=a}}),i.mixin(f,o),c.exports=f}),define("lib/null-metrics",["require","exports","module","underscore","lib/metrics","lib/promise"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("lib/metrics"),g=a("lib/promise");e.forEach(e.keys(f.prototype),function(a){d.prototype[a]=function(){}}),d.prototype.flush=function(){return g()},d.prototype.isCollectionEnabled=function(){return!1},c.exports=d}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("raven",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Raven=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require
;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){this.name="RavenConfigError",this.message=a}d.prototype=new Error,d.prototype.constructor=d,b.exports=d},{}],2:[function(a,b,c){"use strict";var d=function(a,b,c){var d=a[b],e=a;if(b in a){var f="warn"===b?"warning":b;a[b]=function(){var a=[].slice.call(arguments),b=""+a.join(" "),g={level:f,logger:"console",extra:{arguments:a}};c&&c(b,g),d&&Function.prototype.apply.call(d,e,a)}}};b.exports={wrapMethod:d}},{}],3:[function(a,b,c){(function(c){"use strict";function d(){return+new Date}function e(){this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument=!f(H),this._hasNavigator=!f(I),this._lastCapturedException=null,this._lastData=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],crossOrigin:"anonymous",collectWindowErrors:!0,maxMessageLength:0,stackTraceLimit:50,autoBreadcrumbs:!0,sampleRate:1},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=G.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=d(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=G.location,this._lastHref=this._location&&this._location.href,this._resetBackoff();for(var a in this._originalConsole)this._originalConsoleMethods[a]=this._originalConsole[a]}function f(a){return void 0===a}function g(a){return"function"==typeof a}function h(a){return"[object String]"===J.toString.call(a)}function i(a){for(var b in a)return!1;return!0}function j(a,b){var c,d;if(f(a.length))for(c in a)m(a,c)&&b.call(null,c,a[c]);else if(d=a.length)for(c=0;c<d;c++)b.call(null,c,a[c])}function k(a,b){return b?(j(b,function(b,c){a[b]=c}),a):a}function l(a,b){return!b||a.length<=b?a:a.substr(0,b)+""}function m(a,b){return J.hasOwnProperty.call(a,b)}function n(a){for(var b,c=[],d=0,e=a.length;d<e;d++)b=a[d],h(b)?c.push(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):b&&b.source&&c.push(b.source);return new RegExp(c.join("|"),"i")}function o(a){var b=[];return j(a,function(a,c){b.push(encodeURIComponent(a)+"="+encodeURIComponent(c))}),b.join("&")}function p(a){var b=a.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!b)return{};var c=b[6]||"",d=b[8]||"";return{protocol:b[2],host:b[4],path:b[5],relative:b[5]+c+d}}function q(){var a=G.crypto||G.msCrypto;if(!f(a)&&a.getRandomValues){var b=new Uint16Array(8);a.getRandomValues(b),b[3]=4095&b[3]|16384,b[4]=16383&b[4]|32768;var c=function(a){for(var b=a.toString(16);b.length<4;)b="0"+b;return b};return c(b[0])+c(b[1])+c(b[2])+c(b[3])+c(b[4])+c(b[5])+c(b[6])+c(b[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function r(a){for(var b,c=[],d=0,e=0,f=" > ".length;a&&d++<5&&!("html"===(b=s(a))||d>1&&e+c.length*f+b.length>=80);)c.push(b),e+=b.length,a=a.parentNode;return c.reverse().join(" > ")}function s(a){var b,c,d,e,f,g=[];if(!a||!a.tagName)return"";if(g.push(a.tagName.toLowerCase()),a.id&&g.push("#"+a.id),(b=a.className)&&h(b))for(c=b.split(/\s+/),f=0;f<c.length;f++)g.push("."+c[f]);var i=["type","name","title","alt"];for(f=0;f<i.length;f++)d=i[f],(e=a.getAttribute(d))&&g.push("["+d+'="'+e+'"]');return g.join("")}function t(a,b){return!!(!!a^!!b)}function u(a,b){return!t(a,b)&&(a=a.values[0],b=b.values[0],a.type===b.type&&a.value===b.value&&v(a.stacktrace,b.stacktrace))}function v(a,b){if(t(a,b))return!1;var c=a.frames,d=b.frames;if(c.length!==d.length)return!1;for(var e,f,g=0;g<c.length;g++)if(e=c[g],f=d[g],e.filename!==f.filename||e.lineno!==f.lineno||e.colno!==f.colno||e.function!==f.function)return!1;return!0}function w(a,b,c,d){var e=a[b];a[b]=c(e),d&&d.push([a,b,e])}var x=a(6),y=a(7),z=a(1),A=a(5),B=A.isError,C=A.isObject,D=a(2).wrapMethod,E="source protocol user pass host port path".split(" "),F=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/,G="undefined"!=typeof window?window:void 0!==c?c:"undefined"!=typeof self?self:{},H=G.document,I=G.navigator;e.prototype={VERSION:"3.13.0",debug:!1,TraceKit:x,config:function(a,b){var c=this;if(c._globalServer)return this._logDebug("error","Error: Raven has already been configured"),c;if(!a)return c;var d=c._globalOptions;b&&j(b,function(a,b){"tags"===a||"extra"===a||"user"===a?c._globalContext[a]=b:d[a]=b}),c.setDSN(a),d.ignoreErrors.push(/^Script error\.?$/),d.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),d.ignoreErrors=n(d.ignoreErrors),d.ignoreUrls=!!d.ignoreUrls.length&&n(d.ignoreUrls),d.whitelistUrls=!!d.whitelistUrls.length&&n(d.whitelistUrls),d.includePaths=n(d.includePaths),d.maxBreadcrumbs=Math.max(0,Math.min(d.maxBreadcrumbs||100,100));var e={xhr:!0,console:!0,dom:!0,location:!0},f=d.autoBreadcrumbs;return"[object Object]"==={}.toString.call(f)?f=k(e,f):!1!==f&&(f=e),d.autoBreadcrumbs=f,x.collectWindowErrors=!!d.collectWindowErrors,c},install:function(){var a=this;return a.isSetup()&&!a._isRavenInstalled&&(x.report.subscribe(function(){a._handleOnErrorStackInfo.apply(a,arguments)}),a._instrumentTryCatch(),a._globalOptions.autoBreadcrumbs&&a._instrumentBreadcrumbs(),a._drainPlugins(),a._isRavenInstalled=!0),Error.stackTraceLimit=a._globalOptions.stackTraceLimit,this},setDSN:function(a){var b=this,c=b._parseDSN(a),d=c.path.lastIndexOf("/"),e=c.path.substr(1,d);b._dsn=a,b._globalKey=c.user,b._globalSecret=c.pass&&c.pass.substr(1),b._globalProject=c.path.substr(d+1),b._globalServer=b._getGlobalServer(c),b._globalEndpoint=b._globalServer+"/"+e+b._globalProject,this._resetBackoff()},context:function(a,b,c){return g(a)&&(c=b||[],b=a,a=void 0),this.wrap(a,b).apply(this,c)},wrap:function(a,b,c){function d(){var d=[],f=arguments.length,h=!a||a&&!1!==a.deep;for(c&&g(c)&&c.apply(this,arguments);f--;)d[f]=h?e.wrap(a,arguments[f]):arguments[f];try{return b.apply(this,d)}catch(b){throw e._ignoreNextOnError(),e.captureException(b,a),b}}var e=this;if(f(b)&&!g(a))return a;if(g(a)&&(b=a,a=void 0),!g(b))return b;try{if(b.__raven__)return b;if(b.__raven_wrapper__)return b.__raven_wrapper__}catch(a){return b}for(var h in b)m(b,h)&&(d[h]=b[h]);return d.prototype=b.prototype,b.__raven_wrapper__=d,d.__raven__=!0,d.__inner__=b,d},uninstall:function(){return x.report.uninstall(),this._restoreBuiltIns(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},captureException:function(a,b){if(!B(a))return this.captureMessage(a,k({trimHeadFrames:1,stacktrace:!0},b));this._lastCapturedException=a;try{var c=x.computeStackTrace(a);this._handleStackInfo(c,b)}catch(b){if(a!==b)throw b}return this},captureMessage:function(a,b){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(a)){b=b||{};var c=k({message:a+""},b);if(this._globalOptions.stacktrace||b&&b.stacktrace){var d;try{throw new Error(a)}catch(a){d=a}d.name=null,b=k({fingerprint:a,trimHeadFrames:(b.trimHeadFrames||0)+1},b);var e=x.computeStackTrace(d),f=this._prepareFrames(e,b);c.stacktrace={frames:f.reverse()}}return this._send(c),this}},captureBreadcrumb:function(a){var b=k({timestamp:d()/1e3},a);if(g(this._globalOptions.breadcrumbCallback)){var c=this._globalOptions.breadcrumbCallback(b);if(C(c)&&!i(c))b=c;else if(!1===c)return this}return this._breadcrumbs.push(b),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(a){var b=[].slice.call(arguments,1);return this._plugins.push([a,b]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(a){return this._globalContext.user=a,this},setExtraContext:function(a){return this._mergeContext("extra",a),this},setTagsContext:function(a){return this._mergeContext("tags",a),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(y(this._globalContext))},setEnvironment:function(a){return this._globalOptions.environment=a,this},setRelease:function(a){return this._globalOptions.release=a,this},setDataCallback:function(a){var b=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=g(a)?function(c){return a(c,b)}:a,this},setBreadcrumbCallback:function(a){var b=this._globalOptions.breadcrumbCallback;return this._globalOptions.breadcrumbCallback=g(a)?function(c){return a(c,b)}:a,this},setShouldSendCallback:function(a){var b=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=g(a)?function(c){return a(c,b)}:a,this},setTransport:function(a){return this._globalOptions.transport=a,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!!this._hasJSON&&(!!this._globalServer||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var a=G.RavenConfig;a&&this.config(a.dsn,a.config).install()},showReportDialog:function(a){if(H){a=a||{};var b=a.eventId||this.lastEventId();if(!b)throw new z("Missing eventId");var c=a.dsn||this._dsn;if(!c)throw new z("Missing DSN");var d=encodeURIComponent,e="";e+="?eventId="+d(b),e+="&dsn="+d(c);var f=a.user||this._globalContext.user;f&&(f.name&&(e+="&name="+d(f.name)),f.email&&(e+="&email="+d(f.email)));var g=this._getGlobalServer(this._parseDSN(c)),h=H.createElement("script");h.async=!0,h.src=g+"/api/embed/error-page/"+e,(H.head||H.body).appendChild(h)}},_ignoreNextOnError:function(){var a=this;this._ignoreOnError+=1,setTimeout(function(){a._ignoreOnError-=1})},_triggerEvent:function(a,b){var c,d;if(this._hasDocument){b=b||{},a="raven"+a.substr(0,1).toUpperCase()+a.substr(1),H.createEvent?(c=H.createEvent("HTMLEvents"),c.initEvent(a,!0,!0)):(c=H.createEventObject(),c.eventType=a);for(d in b)m(b,d)&&(c[d]=b[d]);if(H.createEvent)H.dispatchEvent(c);else try{H.fireEvent("on"+c.eventType.toLowerCase(),c)}catch(a){}}},_breadcrumbEventHandler:function(a){var b=this;return function(c){if(b._keypressTimeout=null,b._lastCapturedEvent!==c){b._lastCapturedEvent=c;var d;try{d=r(c.target)}catch(a){d="<unknown>"}b.captureBreadcrumb({category:"ui."+a,message:d})}}},_keypressEventHandler:function(){var a=this;return function(b){var c;try{c=b.target}catch(a){return}var d=c&&c.tagName;if(d&&("INPUT"===d||"TEXTAREA"===d||c.isContentEditable)){var e=a._keypressTimeout;e||a._breadcrumbEventHandler("input")(b),clearTimeout(e),a._keypressTimeout=setTimeout(function(){a._keypressTimeout=null},1e3)}}},_captureUrlChange:function(a,b){var c=p(this._location.href),d=p(b),e=p(a);this._lastHref=b,c.protocol===d.protocol&&c.host===d.host&&(b=d.relative),c.protocol===e.protocol&&c.host===e.host&&(a=e.relative),this.captureBreadcrumb({category:"navigation",data:{to:b,from:a}})},_instrumentTryCatch:function(){function a(a){return function(c,d){for(var e=new Array(arguments.length),f=0;f<e.length;++f)e[f]=arguments[f];var h=e[0];return g(h)&&(e[0]=b.wrap(h)),a.apply?a.apply(this,e):a(e[0],e[1])}}var b=this,c=b._wrappedBuiltIns,d=this._globalOptions.autoBreadcrumbs;w(G,"setTimeout",a,c),w(G,"setInterval",a,c),G.requestAnimationFrame&&w(G,"requestAnimationFrame",function(a){return function(c){return a(b.wrap(c))}},c);for(var e=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],f=0;f<e.length;f++)!function(a){var e=G[a]&&G[a].prototype;e&&e.hasOwnProperty&&e.hasOwnProperty("addEventListener")&&(w(e,"addEventListener",function(c){return function(e,f,g,h){try{f&&f.handleEvent&&(f.handleEvent=b.wrap(f.handleEvent))}catch(a){}var i,j,k;return d&&d.dom&&("EventTarget"===a||"Node"===a)&&(j=b._breadcrumbEventHandler("click"),k=b._keypressEventHandler(),i=function(a){if(a){var b;try{b=a.type}catch(a){return}return"click"===b?j(a):"keypress"===b?k(a):void 0}}),c.call(this,e,b.wrap(f,void 0,i),g,h)}},c),w(e,"removeEventListener",function(a){return function(b,c,d,e){try{c=c&&(c.__raven_wrapper__?c.__raven_wrapper__:c)}catch(a){}return a.call(this,b,c,d,e)}},c))}(e[f])},_instrumentBreadcrumbs:function(){function a(a,c){a in c&&g(c[a])&&w(c,a,function(a){return b.wrap(a)})}var b=this,c=this._globalOptions.autoBreadcrumbs,d=b._wrappedBuiltIns;if(c.xhr&&"XMLHttpRequest"in G){var e=XMLHttpRequest.prototype;w(e,"open",function(a){return function(c,d){return h(d)&&-1===d.indexOf(b._globalKey)&&(this.__raven_xhr={method:c,url:d,status_code:null}),a.apply(this,arguments)}},d),w(e,"send",function(c){return function(d){function e(){if(f.__raven_xhr&&(1===f.readyState||4===f.readyState)){try{f.__raven_xhr.status_code=f.status}catch(a){}b.captureBreadcrumb({type:"http",category:"xhr",data:f.__raven_xhr})}}for(var f=this,h=["onload","onerror","onprogress"],i=0;i<h.length;i++)a(h[i],f);return"onreadystatechange"in f&&g(f.onreadystatechange)?w(f,"onreadystatechange",function(a){return b.wrap(a,void 0,e)}):f.onreadystatechange=e,c.apply(this,arguments)}},d)}c.xhr&&"fetch"in G&&w(G,"fetch",function(a){return function(c,d){for(var e=new Array(arguments.length),f=0;f<e.length;++f)e[f]=arguments[f];var g="GET";e[1]&&e[1].method&&(g=e[1].method);var h={method:g,url:e[0],status_code:null};return b.captureBreadcrumb({type:"http",category:"fetch",data:h}),a.apply(this,e).then(function(a){return h.status_code=a.status,a})}},d),c.dom&&this._hasDocument&&(H.addEventListener?(H.addEventListener("click",b._breadcrumbEventHandler("click"),!1),H.addEventListener("keypress",b._keypressEventHandler(),!1)):(H.attachEvent("onclick",b._breadcrumbEventHandler("click")),H.attachEvent("onkeypress",b._keypressEventHandler())));var f=G.chrome,i=f&&f.app&&f.app.runtime,k=!i&&G.history&&history.pushState;if(c.location&&k){var l=G.onpopstate;G.onpopstate=function(){var a=b._location.href;if(b._captureUrlChange(b._lastHref,a),l)return l.apply(this,arguments)},w(history,"pushState",function(a){return function(){var c=arguments.length>2?arguments[2]:void 0;return c&&b._captureUrlChange(b._lastHref,c+""),a.apply(this,arguments)}},d)}if(c.console&&"console"in G&&console.log){var m=function(a,c){b.captureBreadcrumb({message:a,level:c.level,category:"console"})};j(["debug","info","warn","error","log"],function(a,b){D(console,b,m)})}},_restoreBuiltIns:function(){for(var a;this._wrappedBuiltIns.length;){a=this._wrappedBuiltIns.shift();var b=a[0],c=a[1],d=a[2];b[c]=d}},_drainPlugins:function(){var a=this;j(this._plugins,function(b,c){var d=c[0],e=c[1];d.apply(a,[a].concat(e))})},_parseDSN:function(a){var b=F.exec(a),c={},d=7;try{for(;d--;)c[E[d]]=b[d]||""}catch(b){throw new z("Invalid DSN: "+a)}if(c.pass&&!this._globalOptions.allowSecretKey)throw new z("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return c},_getGlobalServer:function(a){var b="//"+a.host+(a.port?":"+a.port:"");return a.protocol&&(b=a.protocol+":"+b),b},_handleOnErrorStackInfo:function(){this._ignoreOnError||this._handleStackInfo.apply(this,arguments)},_handleStackInfo:function(a,b){var c=this._prepareFrames(a,b);this._triggerEvent("handle",{stackInfo:a,options:b}),this._processException(a.name,a.message,a.url,a.lineno,c,b)},_prepareFrames:function(a,b){var c=this,d=[];if(a.stack&&a.stack.length&&(j(a.stack,function(a,b){var e=c._normalizeFrame(b);e&&d.push(e)}),b&&b.trimHeadFrames))for(var e=0;e<b.trimHeadFrames&&e<d.length;e++)d[e].in_app=!1;return d=d.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(a){if(a.url){var b={filename:a.url,lineno:a.line,colno:a.column,function:a.func||"?"};return b.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(b.filename)||/(Raven|TraceKit)\./.test(b.function)||/raven\.(min\.)?js$/.test(b.filename)),b}},_processException:function(a,b,c,d,e,f){var g;if((!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(b))&&(b+="",e&&e.length?(c=e[0].filename||c,e.reverse(),g={frames:e}):c&&(g={frames:[{filename:c,lineno:d,in_app:!0}]}),(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(c))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(c)))){var h=k({exception:{values:[{type:a,value:b,stacktrace:g}]},culprit:c},f);this._send(h)}},_trimPacket:function(a){var b=this._globalOptions.maxMessageLength;if(a.message&&(a.message=l(a.message,b)),a.exception){var c=a.exception.values[0];c.value=l(c.value,b)}return a},_getHttpData:function(){if(this._hasNavigator||this._hasDocument){var a={};return this._hasNavigator&&I.userAgent&&(a.headers={"User-Agent":navigator.userAgent}),this._hasDocument&&(H.location&&H.location.href&&(a.url=H.location.href),H.referrer&&(a.headers||(a.headers={}),a.headers.Referer=H.referrer)),a}},_resetBackoff:function(){this._backoffDuration=0,this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&d()-this._backoffStart<this._backoffDuration},_isRepeatData:function(a){var b=this._lastData;return!(!b||a.message!==b.message||a.culprit!==b.culprit)&&(a.stacktrace||b.stacktrace?v(a.stacktrace,b.stacktrace):!a.exception&&!b.exception||u(a.exception,b.exception))},_setBackoffState:function(a){if(!this._shouldBackoff()){var b=a.status;if(400===b||401===b||429===b){var c;try{c=a.getResponseHeader("Retry-After"),c=1e3*parseInt(c,10)}catch(a){}this._backoffDuration=c||(2*this._backoffDuration||1e3),this._backoffStart=d()}}},_send:function(a){var b=this._globalOptions,c={project:this._globalProject,logger:b.logger,platform:"javascript"},e=this._getHttpData();if(e&&(c.request=e),a.trimHeadFrames&&delete a.trimHeadFrames,a=k(c,a),a.tags=k(k({},this._globalContext.tags),a.tags),a.extra=k(k({},this._globalContext.extra),a.extra),a.extra["session:duration"]=d()-this._startTime,this._breadcrumbs&&this._breadcrumbs.length>0&&(a.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),i(a.tags)&&delete a.tags,this._globalContext.user&&(a.user=this._globalContext.user),b.environment&&(a.environment=b.environment),b.release&&(a.release=b.release),b.serverName&&(a.server_name=b.serverName),g(b.dataCallback)&&(a=b.dataCallback(a)||a),a&&!i(a)&&(!g(b.shouldSendCallback)||b.shouldSendCallback(a)))return this._shouldBackoff()?void this._logDebug("warn","Raven dropped error due to backoff: ",a):void("number"==typeof b.sampleRate?Math.random()<b.sampleRate&&this._sendProcessedPayload(a):this._sendProcessedPayload(a))},_getUuid:function(){return q()},_sendProcessedPayload:function(a,b){var c=this,d=this._globalOptions;if(this.isSetup()){if(this._lastEventId=a.event_id||(a.event_id=this._getUuid()),a=this._trimPacket(a),!this._globalOptions.allowDuplicates&&this._isRepeatData(a))return void this._logDebug("warn","Raven dropped repeat event: ",a);this._lastData=a,this._logDebug("debug","Raven about to send:",a);var e={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};this._globalSecret&&(e.sentry_secret=this._globalSecret);var f=a.exception&&a.exception.values[0];this.captureBreadcrumb({category:"sentry",message:f?(f.type?f.type+": ":"")+f.value:a.message,event_id:a.event_id,level:a.level||"error"});var g=this._globalEndpoint;(d.transport||this._makeRequest).call(this,{url:g,auth:e,data:a,options:d,onSuccess:function(){c._resetBackoff(),c._triggerEvent("success",{data:a,src:g}),b&&b()},onError:function(d){c._logDebug("error","Raven transport failed to send: ",d),d.request&&c._setBackoffState(d.request),c._triggerEvent("failure",{data:a,src:g}),d=d||new Error("Raven send failed (no additional details provided)"),b&&b(d)}})}},_makeRequest:function(a){var b=new XMLHttpRequest;if("withCredentials"in b||"undefined"!=typeof XDomainRequest){var c=a.url;"withCredentials"in b?b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status)a.onSuccess&&a.onSuccess();else if(a.onError){var c=new Error("Sentry error code: "+b.status);c.request=b,a.onError(c)}}:(b=new XDomainRequest,c=c.replace(/^https?:/,""),a.onSuccess&&(b.onload=a.onSuccess),a.onError&&(b.onerror=function(){var c=new Error("Sentry error code: XDomainRequest");c.request=b,a.onError(c)})),b.open("POST",c+"?"+o(a.auth)),b.send(y(a.data))}},_logDebug:function(a){this._originalConsoleMethods[a]&&this.debug&&Function.prototype.apply.call(this._originalConsoleMethods[a],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(a,b){f(b)?delete this._globalContext[a]:this._globalContext[a]=k(this._globalContext[a]||{},b)}};var J=Object.prototype;"undefined"!=typeof __DEV__&&__DEV__&&(e.utils={isUndefined:f,isFunction:g,isString:h,isObject:C,isEmptyObject:i,isError:B,each:j,objectMerge:k,truncate:l,hasKey:m,joinRegExp:n,urlencode:o,uuid4:q,htmlTreeAsString:r,htmlElementAsString:s,parseUrl:p,fill:w}),e.prototype.setUser=e.prototype.setUserContext,e.prototype.setReleaseContext=e.prototype.setRelease,b.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,2:2,5:5,6:6,7:7}],4:[function(a,b,c){(function(c){"use strict";var d=a(3),e="undefined"!=typeof window?window:void 0!==c?c:"undefined"!=typeof self?self:{},f=e.Raven,g=new d;g.noConflict=function(){return e.Raven=f,g},g.afterLoad(),b.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{3:3}],5:[function(a,b,c){"use strict";function d(a){return"object"==typeof a&&null!==a}function e(a){var b={}.toString.call(a);return d(a)&&"[object Error]"===b||"[object Exception]"===b||a instanceof Error}b.exports={isObject:d,isError:e}},{}],6:[function(a,b,c){(function(c){"use strict";function d(){return"undefined"==typeof document||void 0===document.location?"":document.location.href}var e=a(5),f={collectWindowErrors:!0,debug:!1},g="undefined"!=typeof window?window:void 0!==c?c:"undefined"!=typeof self?self:{},h=[].slice,i="?",j=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;f.report=function(){function a(a){m(),s.push(a)}function b(a){for(var b=s.length-1;b>=0;--b)s[b]===a&&s.splice(b,1)}function c(){n(),s=[]}function k(a,b){var c=null;if(!b||f.collectWindowErrors){for(var d in s)if(s.hasOwnProperty(d))try{s[d].apply(null,[a].concat(h.call(arguments,2)))}catch(a){c=a}if(c)throw c}}function l(a,b,c,g,h){var l=null;if(v)f.computeStackTrace.augmentStackTraceWithInitialElement(v,b,c,a),o();else if(h&&e.isError(h))l=f.computeStackTrace(h),k(l,!0);else{var m,n={url:b,line:c,column:g},p=void 0,r=a;if("[object String]"==={}.toString.call(a)){var m=a.match(j);m&&(p=m[1],r=m[2])}n.func=i,l={name:p,message:r,url:d(),stack:[n]},k(l,!0)}return!!q&&q.apply(this,arguments)}function m(){r||(q=g.onerror,g.onerror=l,r=!0)}function n(){r&&(g.onerror=q,r=!1,q=void 0)}function o(){var a=v,b=t;t=null,v=null,u=null,k.apply(null,[a,!1].concat(b))}function p(a,b){var c=h.call(arguments,1);if(v){if(u===a)return;o()}var d=f.computeStackTrace(a);if(v=d,u=a,t=c,setTimeout(function(){u===a&&o()},d.incomplete?2e3:0),!1!==b)throw a}var q,r,s=[],t=null,u=null,v=null;return p.subscribe=a,p.unsubscribe=b,p.uninstall=c,p}(),f.computeStackTrace=function(){function a(a){if(void 0!==a.stack&&a.stack){for(var b,c,e=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,f=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|resource|\[native).*?)(?::(\d+))?(?::(\d+))?\s*$/i,g=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,h=a.stack.split("\n"),j=[],k=(/^(.*) is undefined$/.exec(a.message),0),l=h.length;k<l;++k){if(b=e.exec(h[k])){var m=b[2]&&-1!==b[2].indexOf("native");c={url:m?null:b[2],func:b[1]||i,args:m?[b[2]]:[],line:b[3]?+b[3]:null,column:b[4]?+b[4]:null}}else if(b=g.exec(h[k]))c={url:b[2],func:b[1]||i,args:[],line:+b[3],column:b[4]?+b[4]:null};else{if(!(b=f.exec(h[k])))continue;c={url:b[3],func:b[1]||i,args:b[2]?b[2].split(","):[],line:b[4]?+b[4]:null,column:b[5]?+b[5]:null}}!c.func&&c.line&&(c.func=i),j.push(c)}return j.length?(j[0].column||void 0===a.columnNumber||(j[0].column=a.columnNumber+1),{name:a.name,message:a.message,url:d(),stack:j}):null}}function b(a,b,c,d){var e={url:b,line:c};if(e.url&&e.line){if(a.incomplete=!1,e.func||(e.func=i),a.stack.length>0&&a.stack[0].url===e.url){if(a.stack[0].line===e.line)return!1;if(!a.stack[0].line&&a.stack[0].func===e.func)return a.stack[0].line=e.line,!1}return a.stack.unshift(e),a.partial=!0,!0}return a.incomplete=!0,!1}function c(a,g){for(var h,j,k=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,l=[],m={},n=!1,o=c.caller;o&&!n;o=o.caller)if(o!==e&&o!==f.report){if(j={url:null,func:i,line:null,column:null},o.name?j.func=o.name:(h=k.exec(o.toString()))&&(j.func=h[1]),void 0===j.func)try{j.func=h.input.substring(0,h.input.indexOf("{"))}catch(a){}m[""+o]?n=!0:m[""+o]=!0,l.push(j)}g&&l.splice(0,g);var p={name:a.name,message:a.message,url:d(),stack:l};return b(p,a.sourceURL||a.fileName,a.line||a.lineNumber,a.message||a.description),p}function e(b,e){var g=null;e=null==e?0:+e;try{if(g=a(b))return g}catch(a){if(f.debug)throw a}try{if(g=c(b,e+1))return g}catch(a){if(f.debug)throw a}return{name:b.name,message:b.message,url:d()}}return e.augmentStackTraceWithInitialElement=b,e.computeStackTraceFromStackProp=a,e}(),b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{5:5}],7:[function(a,b,c){"use strict";function d(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function e(a,b,c,d){return JSON.stringify(a,f(b,d),c)}function f(a,b){var c=[],e=[];return null==b&&(b=function(a,b){return c[0]===b?"[Circular ~]":"[Circular ~."+e.slice(0,d(c,b)).join(".")+"]"}),function(f,g){if(c.length>0){var h=d(c,this);~h?c.splice(h+1):c.push(this),~h?e.splice(h,1/0,f):e.push(f),~d(c,g)&&(g=b.call(this,f,g))}else c.push(g);return null==a?g:a.call(this,f,g)}}c=b.exports=e,c.getSerialize=f},{}]},{},[4])(4)}),define("views/mixins/timer-mixin",["require","exports","module","underscore"],function(a,b,c){"use strict";function d(){var a=this.window||window;e.each(this._timeouts,function(b){a.clearTimeout(b)}),this._timeouts=null}var e=a("underscore"),f={setTimeout:function(a,b){var c=this;this._timeouts||(this._timeouts=[],this.on("destroy",d.bind(this)));var e=this.window||window,f=e.setTimeout(function(){c.clearTimeout(f),a.call(c)},b);return this._timeouts.push(f),f},clearTimeout:function(a){(this.window||window).clearTimeout(a),this._timeouts=e.without(this._timeouts,a)}};c.exports=f}),define("lib/verification-reasons",["require","exports","module"],function(a,b,c){"use strict";return{FORCE_AUTH:"force_auth",PASSWORD_RESET:"reset_password",SECONDARY_EMAIL_VERIFIED:"secondary_email_verified",SIGN_IN:"login",SIGN_UP:"signup"}}),define("views/base",["require","exports","module","jquery","underscore","lib/auth-errors","backbone","cocktail","lib/dom-writer","lib/error-utils","views/mixins/external-links-mixin","lib/channels/notifier-mixin","lib/null-metrics","lib/logger","lib/promise","raven","lib/search-param-mixin","lib/strings","views/mixins/timer-mixin","lib/verification-reasons"],function(a,b,c){"use strict";function d(a,b){this.hideError();var c=this.$(".success");b&&c[a](this.translator.get(b)),c.slideDown(z).attr("data-shown","true"),this.trigger("success",b),this._isSuccessVisible=!0}function e(a,b){if(!this._areErrorsEnabled)return void this.logger.error("Error ignored: %s",JSON.stringify(b));this.hideSuccess(),b=this._normalizeError(b),this.logError(b);var c=this.translateError(b),d=this.$(".error");return c&&d[a](c),d.slideDown(z).attr("data-shown","true"),this.trigger("error",c),this._isErrorVisible=!0,c}function f(a){return a&&a.errorModule?a.errorModule:j}function g(a){return a}var h=a("jquery"),i=a("underscore"),j=a("lib/auth-errors"),k=a("backbone"),l=a("cocktail"),m=a("lib/dom-writer"),n=a("lib/error-utils"),o=a("views/mixins/external-links-mixin"),p=a("lib/channels/notifier-mixin"),q=a("lib/null-metrics"),r=a("lib/logger"),s=a("lib/promise"),t=a("raven"),u=a("lib/search-param-mixin"),v=a("lib/strings"),w=a("views/mixins/timer-mixin"),x=a("lib/verification-reasons"),y=window.document.title,z=150,A=new q,B=k.View.extend({layoutClassName:null,viewName:"",constructor:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.broker=b.broker,this.currentPage=b.currentPage,this.model=b.model||new k.Model,this.metrics=b.metrics||A,this.relier=b.relier,this.sentryMetrics=b.sentryMetrics||t,this.childViews=[],this.user=b.user,this.lang=b.lang,this.window=b.window||window,this.logger=new r(this.window),this.navigator=b.navigator||this.window.navigator||navigator,this.translator=b.translator||this.window.translator,i.extend(this.events,o.events);for(var c in this.events)!function(b){var c=a.events[b];i.isString(c)&&i.isFunction(a[c])&&(a.events[b]=function(){this[c].apply(this,arguments)})}(c);!this.viewName&&b.viewName&&(this.viewName=b.viewName),k.View.call(this,b),p.initialize.call(this,b),this._boundDisableErrors=this.disableErrors.bind(this),h(this.window).on("beforeunload",this._boundDisableErrors),this._boundCheckAuthorization=this.checkAuthorization.bind(this),h(this.window).on("focus",this._boundCheckAuthorization)},render:function(){var a=this;return this.layoutClassName&&h("body").addClass(this.layoutClassName),this._hasNavigated=!1,s().then(function(){return a.checkAuthorization()}).then(function(b){return b&&a.beforeRender()}).then(function(b){return!1!==b&&!a._hasNavigated&&s().then(function(){a.destroyChildViews(),a._context=null,a.$el.html(a.renderTemplate(a.template.bind(a))),a._isErrorVisible=a.$(".error").hasClass("visible"),a._isSuccessVisible=a.$(".success").hasClass("visible")}).then(i.bind(a.afterRender,a)).then(function(){return a.trigger("rendered"),!0})})},renderTemplate:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(i.extend({},this.getContext(),b))},writeToDOM:function(a){return m.write(this.window,a)},checkAuthorization:function(){var a=this;return this.mustAuth||this.mustVerify?this.user.sessionStatus().then(function(b){if(a.mustVerify&&!b.get("verified")){var c;return b.get("verificationReason")===x.SIGN_UP?c="confirm":b.get("verificationReason")===x.SIGN_IN&&(c="confirm_signin"),a.navigate(c,{account:b}),!1}return!0},function(b){if(j.is(b,"INVALID_TOKEN"))return a.logError(j.toError("SESSION_EXPIRED")),a.navigate(a._reAuthPage(),{redirectTo:a.currentPage}),!1;throw b}):s(!0)},_reAuthPage:function(){return this.relier&&this.relier.get("email")?"force_auth":"signin"},displayStatusMessages:function(){var a=this.model.get("success");a&&(this.displaySuccess(a),this.model.unset("success"));var b=this.model.get("unsafeSuccess");b&&(this.unsafeDisplaySuccess(b),this.model.unset("unsafeSuccess"));var c=this.model.get("error");c&&(this.displayError(c),this.model.unset("error"))},titleFromView:function(a){var b=a||y,c=this.$("header:first h1").text(),d=this.$("header:first h2").text();return c&&d?b=c+": "+d:c?b=c:d&&(b=b+": "+d),b},getContext:function(){this._context||(this._context=this.context()||{});var a=this._context
;return a.t=this.translateInTemplate.bind(this),a.unsafeTranslate=this.unsafeTranslateInTemplate.bind(this),a},context:function(){},translate:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getContext();if(v.hasHTML(a)){var c=j.toError("HTML_WILL_BE_ESCAPED");c.string=a,this.logError(c)}return i.escape(this.translator.get(a,b))},unsafeTranslate:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getContext();if(v.hasUnsafeVariables(a)){var c=j.toError("UNSAFE_INTERPOLATION_VARIABLE_NAME");c.string=a,this.logError(c)}return this.translator.get(a,b)},translateInTemplate:function(a){var b=this;return function(c){return b.translate(a||c)}},unsafeTranslateInTemplate:function(a){var b=this;return function(c){return b.unsafeTranslate(a||c)}},beforeRender:function(){},afterRender:function(){return s()},afterVisible:function(){this.displayStatusMessages();var a=this.$el.find(".links");if(a.length>0){var b=Math.floor(a.width()/2),c=!1;a.children("a").each(function(d,e){a.find(e).width()>=b&&(c=!0)}),!0===c&&a.addClass("centered")}return this.focusAutofocusElement(),s()},destroy:function(a){this.trigger("destroy"),this.beforeDestroy&&this.beforeDestroy(),a?this.remove():(this.stopListening(),this.$el.off()),this.layoutClassName&&h("body").removeClass(this.layoutClassName),h(this.window).off("beforeunload",this._boundDisableErrors),h(this.window).off("focus",this._boundCheckAuthorization),this.destroyChildViews(),this.trigger("destroyed")},trackChildView:function(a){return i.contains(this.childViews,a)||(this.childViews.push(a),a.on("destroyed",i.bind(this.untrackChildView,this,a))),a},untrackChildView:function(a){return this.childViews=i.without(this.childViews,a),a},destroyChildViews:function(){i.invoke(this.childViews,"destroy"),this.childViews=[]},isChildViewTracked:function(a){return i.indexOf(this.childViews,a)>-1},displaySuccess:i.partial(d,"text"),unsafeDisplaySuccess:i.partial(d,"html"),hideSuccess:function(){this.$(".success").slideUp(z).removeClass("visible"),this._isSuccessVisible=!1},isSuccessVisible:function(){return!!this._isSuccessVisible},translateError:function(a){return f(a).toInterpolatedMessage(a,this.translator)},_areErrorsEnabled:!0,disableErrors:function(){this._areErrorsEnabled=!1},displayError:i.partial(e,"text"),unsafeDisplayError:i.partial(e,"html"),logError:function(a){a=this._normalizeError(a),a.logged||(a.logged=!0,n.captureError(a,this.sentryMetrics,this.metrics))},fatalError:function(a){return n.fatalError(a,this.sentryMetrics,this.metrics,this.window,this.translator)},getViewName:function(){return this.viewName},_normalizeError:function(a){var b=f(a);return a||(a=b.toError("UNEXPECTED_ERROR"),this.logger.trace()),i.isString(a)&&(a=new Error(a)),a.viewName=this.getViewName(),a},logView:function(){this.metrics.logView(this.getViewName())},logEvent:function(a){this.metrics.logEvent(a)},logEventOnce:function(a){this.metrics.logEventOnce(a)},logViewEvent:function(a){this.metrics.logViewEvent(this.getViewName(),a)},logFlowEvent:function(a,b,c){this.notifier.trigger("flow.event",i.assign({},c,{event:a,viewName:b}))},logFlowEventOnce:function(a,b){this.logFlowEvent(a,b,{once:!0})},hideError:function(){this.$(".error").slideUp(z).removeClass("visible"),this._isErrorVisible=!1},isErrorVisible:function(){return!!this._isErrorVisible},navigate:function(a,b,c){b=b||{},c=c||{},b.error&&this.logError(b.error),this.notifier.trigger("navigate",{nextViewData:b,routerOptions:c,url:a}),this._hasNavigated=!0},navigateAway:function(a){this.notifier.trigger("navigate",{server:!0,url:a})},focusAutofocusElement:function(){var a=this,b=this.$("[autofocus]");if(h("html").hasClass("no-touch")&&b.length){!function c(){if(!b.is(":focus"))return b.is(":visible")?void a.focus(b):void a.setTimeout(c,50)}()}},focus:function(a){var b=this;if(h("html").hasClass("no-touch"))try{var c=this.$(a);c.one("focus",function(){return b.placeCursorAt(c)}),c.get(0).focus()}catch(a){}},placeCursorAt:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h(a).__val().length,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,d=h(a).get(0);try{d.selectionStart=b,d.selectionEnd=c}catch(a){}},invokeHandler:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];if(i.isString(a)&&(a=this[a],!i.isFunction(a)))throw new Error(a+" is an invalid function name");if(i.isFunction(a))return i.isArguments(c[0])&&(c=c[0]),a.apply(this,c)},getSignedInAccount:function(){return this.user.getSignedInAccount()},getAccount:function(){},showChildView:function(){return s()},invokeBrokerMethod:function(a){for(var b,c=this,d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return s((b=this.broker)[a].apply(b,e)).then(function(a){return c.invokeBehavior.apply(c,[a].concat(e))})},invokeBehavior:function(a){for(var b=this,c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return s().then(function(){return i.isFunction(a)?a.apply(void 0,[b].concat(d)):a})}});B.preventDefaultThen=function(a){return function(b){b&&b.preventDefault();var c=[].slice.call(arguments,0);return c.unshift(a),this.invokeHandler.apply(this,c)}},B.cancelEventThen=function(a){return function(b){b&&(b.preventDefault(),b.stopPropagation());var c=[].slice.call(arguments,0);return c.unshift(a),this.invokeHandler.apply(this,c)}},B.t=g,l.mixin(B,o,u,w),c.exports=B}),define("lib/key-codes",["require","exports","module"],function(a,b,c){"use strict";c.exports={BACKSPACE:8,DOWN_ARROW:40,ENTER:13,ESCAPE:27,LEFT_ARROW:37,NUMPAD_0:96,NUMPAD_9:105,NUM_0:48,NUM_1:49,NUM_9:57,PERIOD:190,RIGHT_ARROW:39,TAB:9,UP_ARROW:38}}),define("stache!templates/loading",["mustache"],function(a){return a.compile('<div id="main-content" class="card loading">\n  <section>\n    <div class="error"></div>\n\n    <div class="spinner"></div>\n  </section>\n</div>\n')}),define("views/mixins/loading-mixin",["require","exports","module","stache!templates/loading"],function(a,b,c){"use strict";var d=a("stache!templates/loading");c.exports={initialize:function(){var a=d({});this.writeToDOM(a)}}}),define("views/app",["require","exports","module","jquery","backbone","views/base","cocktail","lib/key-codes","views/mixins/loading-mixin","lib/promise"],function(a,b,c){"use strict";var d=a("jquery"),e=a("backbone"),f=a("views/base"),g=a("cocktail"),h=a("lib/key-codes"),i=a("views/mixins/loading-mixin"),j=a("lib/promise"),k=f.extend({initialize:function(a){a=a||{},this._environment=a.environment,this._createView=a.createView},notifications:{"show-child-view":"showChildView","show-view":"showView"},events:{'click a[href^="/"]':"onAnchorClick",keyup:"onKeyUp"},onKeyUp:function(a){a.which===h.ESCAPE&&(d.modal.isActive()?d.modal.close():a.currentTarget.className.indexOf("settings")>=0&&(d(".settings-unit").removeClass("open"),this.navigate("settings")))},onAnchorClick:function(a){if(!(a.isDefaultPrevented()||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){a.preventDefault();var b=d(a.currentTarget).attr("href").replace(/^\//,"");if(this._environment.isFramed()&&b.indexOf("legal")>-1)return void this.window.open(b,"_blank");this.navigate(b)}},_currentView:null,showView:function(a,b){var c=this;return j().then(function(){b.model=b.model||new e.Model;var d=c._currentView;if(d instanceof a)return d.model.set(b.model.toJSON()),c.notifier.trigger("navigate-from-child-view",b),c.setTitle(d.titleFromView()),d;d&&d.destroy();var f=c._createView(a,b);return c._currentView=f,f.render().then(function(a){return a?(c.setTitle(f.titleFromView()),c.writeToDOM(f.el),f.logView(),f.afterVisible(),c.notifier.trigger("view-shown",f),f):(f.destroy(),f===c._currentView&&(c._currentView=null),j(null))})}).fail(this.fatalError.bind(this))},showChildView:function(a,b,c){var d=this;return j().then(function(){if(!(d._currentView instanceof b))return d.showView(b,c)}).then(function(){return d._currentView.showChildView(a,c)}).then(function(a){var b=a.titleFromView(d._currentView.titleFromView());return d.setTitle(b),a.logView(),a.model.set(c.model.toJSON()),a.displayStatusMessages(),a})},setTitle:function(a){this.window.document.title=a}});g.mixin(k,i),c.exports=k}),define("views/behaviors/navigate",["require","exports","module","lib/promise"],function(a,b,c){"use strict";var d=a("lib/promise"),e=function(a,b){b=b||{};var c=function(c){return c.navigate(a,b),d.defer().promise};return c.endpoint=a,c.halt=!0,c.type="navigate",c};c.exports=e}),define("views/behaviors/null",["require","exports","module"],function(a,b,c){"use strict";var d=function(){var a=function(){};return a.type="null",a};c.exports=d}),define("lib/null-storage",["require","exports","module"],function(a,b,c){"use strict";function d(){this._storage={}}d.prototype.getItem=function(a){return a?this._storage[a]:null},d.prototype.setItem=function(a,b){a&&(this._storage[a]=b)},d.prototype.removeItem=function(a){a&&delete this._storage[a]},d.prototype.clear=function(){this._storage={}},c.exports=d}),define("lib/storage",["require","exports","module","lib/null-storage","lib/url"],function(a,b,c){"use strict";function d(a){return i+"."+a}function e(a,b){return a.context="storage",a.namespace=b,a.errno=a.name||a.message,a}function f(a){this._backend=a||new g}var g=a("lib/null-storage"),h=a("lib/url"),i="__fxa_storage";f.prototype.get=function(a){var b;try{b=JSON.parse(this._backend.getItem(d(a)))}catch(a){}return b},f.prototype.set=function(a,b){this._backend.setItem(d(a),JSON.stringify(b))},f.prototype.remove=function(a){this._backend.removeItem(d(a))},f.prototype.clear=function(){this._backend.clear()},f.prototype.isNull=function(){return this._backend instanceof g},f.testStorage=function(a,b){try{b=b||window;var c;if("sessionStorage"===a)c=b.sessionStorage;else{if("1"===h.searchParam("disable_local_storage",b.location.search))throw new Error("disabled for tests");c=b.localStorage}c.setItem("storage-test","storage-test"),c.removeItem("storage-test")}catch(b){throw e(b,a)}},f.testLocalStorage=function(a){f.testStorage("localStorage",a)},f.testSessionStorage=function(a){f.testStorage("sessionStorage",a)},f._isStorageEnabled=function(a,b){try{return f.testStorage(a,b),!0}catch(a){return!1}},f.isLocalStorageEnabled=function(a){return f._isStorageEnabled("localStorage",a)},f.isSessionStorageEnabled=function(a){return f._isStorageEnabled("sessionStorage",a)},f.factory=function(a,b){return b=b||window,new f("localStorage"===a&&this.isLocalStorageEnabled(b)?b.localStorage:"sessionStorage"===a&&this.isSessionStorageEnabled(b)?b.sessionStorage:new g)},c.exports=f}),define("models/verification/same-browser",["require","exports","module","backbone","lib/storage"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/storage"),f="verificationInfo",g=d.Model.prototype,h=d.Model.extend({initialize:function(a,b){g.initialize.call(this,a,b),this._email=b.email,this._namespace=b.namespace,this._uid=b.uid,this._window=b.window||window,this._storage=b.storage||new e(this._window.localStorage)},_STORAGE_KEY:f,_getUsersStorageId:function(){return this._uid||this._email},persist:function(){var a=this._getUsersStorageId();if(a){var b=this._storage.get(f)||{};b[a]=b[a]||{},b[a][this._namespace]=this.toJSON(),this._storage.set(f,b)}},load:function(){var a=this._getUsersStorageId();if(a){var b=(this._storage.get(f)||{})[a];b&&this.set(b[this._namespace]||{})}},clear:function(){var a=this._getUsersStorageId();if(a){var b=this._storage.get(f)||{};b[a]&&(delete b[a][this._namespace],Object.keys(b[a]).length||delete b[a],this._storage.set(f,b))}}});c.exports=h}),define("models/auth_brokers/base",["require","exports","module","lib/auth-errors","backbone","cocktail","lib/environment","lib/channels/notifier-mixin","views/behaviors/navigate","views/behaviors/null","lib/promise","models/verification/same-browser","models/mixins/search-param","lib/vat"],function(a,b,c){"use strict";function d(a,b){return new n({},{email:a.get("email"),namespace:b,uid:a.get("uid")})}function e(a,b){d(a,b).clear()}var f=a("lib/auth-errors"),g=a("backbone"),h=a("cocktail"),i=a("lib/environment"),j=a("lib/channels/notifier-mixin"),k=a("views/behaviors/navigate"),l=a("views/behaviors/null"),m=a("lib/promise"),n=a("models/verification/same-browser"),o=a("models/mixins/search-param"),p=a("lib/vat"),q={automatedBrowser:p.boolean()},r=g.Model.extend({type:"base",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.relier=a.relier,this.window=a.window||window,this.environment=new i(this.window),this._behaviors=new g.Model(this.defaultBehaviors),this._capabilities=new g.Model(this.defaultCapabilities),this._fxaClient=a.fxaClient,this._metrics=a.metrics,this._notificationChannel=a.notificationChannel,this._notificationChannel&&this.setCapability("fxaStatus",this._notificationChannel.isFxaStatusSupported())},notifications:{"once!view-shown":"afterLoaded"},defaultBehaviors:{afterChangePassword:new l,afterCompleteResetPassword:new l,afterCompleteSignUp:new l,afterDeleteAccount:new l,afterForceAuth:new l,afterResetPasswordConfirmationPoll:new l,afterSignIn:new l,afterSignInConfirmationPoll:new k("signin_confirmed"),afterSignUp:new l,afterSignUpConfirmationPoll:new k("signup_confirmed"),beforeSignIn:new l,beforeSignUpConfirmationPoll:new l},setBehavior:function(a,b){this._behaviors.set(a,b)},getBehavior:function(a){if(!this._behaviors.has(a))throw new Error("behavior not found for: "+a);return this._behaviors.get(a)},fetch:function(){var a=this;return m().then(function(){if(a._isForceAuth=a._isForceAuthUrl(),a.importSearchParamsUsingSchema(q,f),a.hasCapability("fxaStatus"))return a._fetchFxaStatus()}).then(function(){var b=a.relier&&a.relier.get("signinCode");if(b)return a._consumeSigninCode(b)})},_fetchFxaStatus:function(){var a=this,b=this.isAutomatedBrowser()?200:0,c=this._notificationChannel;return m().delay(b).then(function(){return c.request(c.COMMANDS.FXA_STATUS,a.relier.pick("service"))}).then(function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.set("browserSignedInAccount",b.signedInUser)},function(b){if(f.is(b,"INVALID_WEB_CHANNEL"))return void a.setCapability("fxaStatus",!1);throw b})},_consumeSigninCode:function(a){var b=this;this._metrics._initializeFlowModel();var c=this._metrics.getFlowEventMetadata(),d=c.flowId,e=c.flowBeginTime;return this._fxaClient.consumeSigninCode(a,d,e).then(function(a){b.set("signinCodeAccount",a)},function(a){b._metrics.logError(a)})},afterLoaded:function(){return m()},beforeSignIn:function(){return m(this.getBehavior("beforeSignIn"))},afterSignIn:function(){return m(this.getBehavior("afterSignIn"))},afterSignInConfirmationPoll:function(){return m(this.getBehavior("afterSignInConfirmationPoll"))},afterForceAuth:function(){return m(this.getBehavior("afterForceAuth"))},persistVerificationData:function(a){var b=this;return m().then(function(){var c=d(a,"context");return c.set({context:b.relier.get("context")}),c.persist()})},unpersistVerificationData:function(a){return m().then(function(){e(a,"context")})},afterSignUp:function(){return m(this.getBehavior("afterSignUp"))},beforeSignUpConfirmationPoll:function(){return m(this.getBehavior("beforeSignUpConfirmationPoll"))},afterSignUpConfirmationPoll:function(){return m(this.getBehavior("afterSignUpConfirmationPoll"))},afterCompleteSignUp:function(a){var b=this;return this.unpersistVerificationData(a).then(function(){return b.getBehavior("afterCompleteSignUp")})},afterResetPasswordConfirmationPoll:function(){return m(this.getBehavior("afterResetPasswordConfirmationPoll"))},afterCompleteResetPassword:function(a){var b=this;return this.unpersistVerificationData(a).then(function(){return b.getBehavior("afterCompleteResetPassword")})},afterChangePassword:function(){return m(this.getBehavior("afterChangePassword"))},afterDeleteAccount:function(){return m(this.getBehavior("afterDeleteAccount"))},transformLink:function(a){return a},isForceAuth:function(){return!!this._isForceAuth},_isForceAuthUrl:function(){var a=this.window.location.pathname;return"/force_auth"===a||"/oauth/force_auth"===a},isAutomatedBrowser:function(){return!!this.get("automatedBrowser")},defaultCapabilities:{allowUidChange:!1,chooseWhatToSyncCheckbox:!0,convertExternalLinksToText:!1,emailVerificationMarketingSnippet:!0,fxaStatus:!1,handleSignedInNotification:!0,signup:!0},hasCapability:function(a){return this._capabilities.has(a)&&!!this._capabilities.get(a)},setCapability:function(a,b){this._capabilities.set(a,b)},unsetCapability:function(a){this._capabilities.unset(a)},getCapability:function(a){return this._capabilities.get(a)}});h.mixin(r,j,o),c.exports=r}),define("views/behaviors/connect-another-device",["require","exports","module"],function(a,b,c){"use strict";c.exports=function(a){var b=function(b,c){return b.isEligibleForConnectAnotherDevice(c)?b.navigateToConnectAnotherDeviceScreen(c):b.invokeBehavior(a,c)};return b.type="connect-another-device",b}}),define("models/auth_brokers/fx-sync",["require","exports","module","underscore","models/auth_brokers/base","views/behaviors/connect-another-device"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/auth_brokers/base"),f=a("views/behaviors/connect-another-device"),g=e.prototype;c.exports=e.extend({defaultBehaviors:d.extend({},g.defaultBehaviors,{cadAfterSignUpConfirmationPoll:!1}),type:"fx-sync",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._metrics=a.metrics,g.initialize.call(this,a)},afterSignUpConfirmationPoll:function(a){var b=this;return g.afterSignUpConfirmationPoll.call(this,a).then(function(a){return b.hasCapability("cadAfterSignUpConfirmationPoll")?(b._metrics.setViewNamePrefix("signup"),new f(a)):a})}})}),define("lib/channels/base",["require","exports","module","underscore","backbone"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("backbone");e.extend(d.prototype,f.Events,{initialize:function(){},teardown:function(){},send:function(a,b,c){c&&c()}}),c.exports=d}),define("lib/channels/duplex",["require","exports","module","underscore","lib/channels/base","duration","lib/logger","lib/promise"],function(a,b,c){"use strict";function d(a){this._window=a.window,this._sendTimeoutLength=a.sendTimeoutLength||k,this._requests={},this._logger=new i(this._window)}function e(){}var f=a("underscore"),g=a("lib/channels/base"),h=a("duration"),i=a("lib/logger"),j=a("lib/promise"),k=new h("90s").milliseconds();d.prototype={add:function(a,b){this.remove(a),b.timeout=this._window.setTimeout(function(a){this._logger.error("Response not received for: "+a)}.bind(this,b.command),this._sendTimeoutLength),this._requests[a]=b},remove:function(a){var b=this.get(a);b&&(this._window.clearTimeout(b.timeout),delete this._requests[b.messageId])},get:function(a){return this._requests[a]},clear:function(){for(var a in this._requests)this.remove(this._requests[a])},each:function(a){f.each(this._requests,a)}};var l=0;f.extend(e.prototype,new g,{initialize:function(a){var b=this;if(a=a||{},this._sender=a.sender,!this._sender)throw new Error("DuplexChannel must have a sender");if(this._receiver=a.receiver,!this._receiver)throw new Error("DuplexChannel must have a receiver");this._receiver.on("error",function(a){return b.onErrorReceived(a)}),this._receiver.on("message",function(a){return b.onMessageReceived(a)}),this._outstandingRequests=new d({sendTimeoutLength:a.sendTimeoutLength,window:a.window})},teardown:function(){this._outstandingRequests.clear(),this._sender&&this._sender.teardown(),this._receiver&&this._receiver.teardown()},send:function(a,b){var c=this;return j().then(function(){return c._sender.send(a,b,null)})},request:function(a,b){var c=this,d=this.createMessageId(a,b),e={command:a,data:b,deferred:j.defer(),messageId:d};return this._outstandingRequests.add(d,e),j().then(function(){return c._sender.send(a,b,d)}).then(function(){return e.deferred.promise}).fail(function(a){throw c._outstandingRequests.remove(d),a})},createMessageId:function(a,b){return""+Date.now()+ ++l},onMessageReceived:function(a){var b=this.parseMessage(a),c=b.command,d=b.data,e=b.messageId;if(e){var f=this._outstandingRequests.get(e);f&&(this._outstandingRequests.remove(e),f.deferred.resolve(d))}this.trigger(c,d)},parseMessage:function(a){return f.pick(a,"command","data","messageId")},onErrorReceived:function(a){var b=this.parseError(a),c=b.error,d=b.messageId;if(d){var e=this._outstandingRequests.get(d);e&&(this._outstandingRequests.remove(d),e.deferred.reject(c))}this.trigger("error",c)},parseError:function(a){return f.pick(a,"error","messageId")},rejectAllOutstandingRequests:function(a){var b=this;this._outstandingRequests.each(function(c,d){b._outstandingRequests.remove(d),c.deferred.reject(a)})}}),c.exports=e}),define("lib/channels/senders/fx-desktop-v1",["require","exports","module","lib/promise"],function(a,b,c){"use strict";function d(){}function e(a,b,c){return new a.CustomEvent("FirefoxAccountsCommand",{detail:{bubbles:!0,command:b,data:c}})}var f=a("lib/promise");d.prototype={initialize:function(a){a=a||{},this._window=a.window},send:function(a,b,c){var d=this;return f().then(function(){return d.dispatchCommand(a,b,c)})},dispatchCommand:function(a,b,c){var d=this._window,f=e(d,a,b);d.dispatchEvent(f)},teardown:function(){}},c.exports=d}),define("lib/channels/receivers/postmessage",["require","exports","module","underscore","lib/auth-errors","backbone","lib/logger"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("lib/auth-errors"),g=a("backbone"),h=a("lib/logger");e.extend(d.prototype,g.Events,{initialize:function(a){a=a||{},this._origin=a.origin,this._window=a.window,this._boundReceiveEvent=this.receiveEvent.bind(this),this._window.addEventListener("message",this._boundReceiveEvent,!1),this._logger=new h(this._window)},isOriginIgnored:function(a){return"chrome://browser"===a},isOriginTrusted:function(a){return"null"===a||this._origin===a},receiveEvent:function(a){if("message"===a.type){var b=a.origin;if(this.isOriginIgnored(b))this._logger.error("postMessage received from %s, ignoring",b);else if(this.isOriginTrusted(b))a.data?this.trigger("message",a.data):this.trigger("error",{error:new Error("malformed event")});else{this._logger.error("postMessage received from %s, expected %s",b,this._origin);var c=f.toError("UNEXPECTED_POSTMESSAGE_ORIGIN");c.context=b,this.trigger("error",{error:c})}}},teardown:function(){this._window.removeEventListener("message",this._boundReceiveEvent,!1)}}),c.exports=d}),define("lib/channels/fx-desktop-v1",["require","exports","module","underscore","lib/channels/duplex","lib/channels/senders/fx-desktop-v1","lib/channels/receivers/postmessage"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("lib/channels/duplex"),g=a("lib/channels/senders/fx-desktop-v1"),h=a("lib/channels/receivers/postmessage");e.extend(d.prototype,new f,{initialize:function(a){a=a||{};var b=a.window||window,c=this._sender=new g;c.initialize({window:b});var d=this._receiver=new h;d.initialize({origin:a.origin,window:b}),f.prototype.initialize.call(this,{receiver:d,sender:c,window:b})},createMessageId:function(a){return a},parseMessage:function(a){if(!a||!a.content)throw new Error("malformed message");var b=a.content;return{command:b.status,data:b.data,messageId:b.status}}}),c.exports=d}),define("models/auth_brokers/mixins/channel",["require","exports","module","lib/promise"],function(a,b,c){"use strict";function d(a){return 3===a.length?e.denodeify(a):a}var e=a("lib/promise"),f={send:function(a,b){var c=this.getChannel();return d(c.send.bind(c))(a,b)},request:function(a,b){var c=this.getChannel();return d((c.request||c.send).bind(c))(a,b)}};c.exports=f}),define("models/auth_brokers/fx-sync-channel",["require","exports","module","underscore","lib/auth-errors","models/auth_brokers/mixins/channel","cocktail","models/auth_brokers/fx-sync","lib/logger","lib/promise"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("models/auth_brokers/mixins/channel"),g=a("cocktail"),h=a("models/auth_brokers/fx-sync"),i=a("lib/logger"),j=a("lib/promise"),k=h.prototype,l=h.extend({type:"fx-sync-channel",commands:null,defaultCapabilities:d.extend({},k.defaultCapabilities,{sendChangePasswordNotice:!0}),getCommand:function(a){if(!this.commands)throw new Error("this.commands must be specified");var b=this.commands[a];if(!b)throw new Error("command not found for: "+a);return b},initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._logger=new i,this._channel=a.channel,a.commands&&(this.commands=a.commands),k.initialize.call(this,a)},afterLoaded:function(){var a=this;return this.send(this.getCommand("LOADED")).then(function(){return k.afterLoaded.call(a)})},beforeSignIn:function(a){var b=this,c=a.get("email");return this._verifiedCanLinkEmail===c?k.beforeSignIn.call(this,a):this.request(this.getCommand("CAN_LINK_ACCOUNT"),{email:c}).then(function(d){if(d&&!d.ok)throw e.toError("USER_CANCELED_LOGIN");return b._verifiedCanLinkEmail=c,k.beforeSignIn.call(b,a)},function(a){b._logger.error("beforeSignIn failed with",a)})},afterSignIn:function(a){var b=this;return this._notifyRelierOfLogin(a).then(function(){return k.afterSignIn.call(b,a)})},afterForceAuth:function(a){var b=this;return this._notifyRelierOfLogin(a).then(function(){return k.afterForceAuth.apply(b,a)})},beforeSignUpConfirmationPoll:function(a){var b=this;return this._notifyRelierOfLogin(a).then(function(){return k.beforeSignUpConfirmationPoll.call(b,a)})},afterResetPasswordConfirmationPoll:function(a){var b=this;return this._notifyRelierOfLogin(a).then(function(){return k.afterResetPasswordConfirmationPoll.call(b,a)})},afterChangePassword:function(a){var b=this;return this.hasCapability("sendChangePasswordNotice")?this.send(this.getCommand("CHANGE_PASSWORD"),this._getLoginData(a)).then(function(){return k.afterChangePassword.call(b,a)}):k.afterChangePassword.call(this,a)},afterDeleteAccount:function(a){var b=this;return this.send(this.getCommand("DELETE_ACCOUNT"),{email:a.get("email"),uid:a.get("uid")}).then(function(){return k.afterDeleteAccount.call(b,a)})},getChannel:function(){return this._channel||(this._channel=this.createChannel()),this._channel},createChannel:function(){throw new Error("createChannel must be overridden")},_notifyRelierOfLogin:function(a){var b=this._getLoginData(a);return this._hasRequiredLoginFields(b)?this.send(this.getCommand("LOGIN"),b):j()},_hasRequiredLoginFields:function(a){var b=l.REQUIRED_LOGIN_FIELDS,c=Object.keys(a);return!d.difference(b,c).length},_getLoginData:function(a){var b=["customizeSync","declinedSyncEngines","email","keyFetchToken","sessionToken","uid","unwrapBKey","verified"],c=a.pick(b);return c.verified=!!c.verified,c.verifiedCanLinkAccount=!!this._verifiedCanLinkEmail,c}},{REQUIRED_LOGIN_FIELDS:["customizeSync","email","keyFetchToken","sessionToken","uid","unwrapBKey","verified"]});g.mixin(l,f),c.exports=l}),define("views/behaviors/halt",["require","exports","module","lib/promise"],function(a,b,c){"use strict";var d=a("lib/promise"),e=function(){var a=function(a){return d.defer().promise};return a.halt=!0,a.type="halt",a};c.exports=e}),define("models/auth_brokers/fx-desktop-v1",["require","exports","module","underscore","lib/channels/fx-desktop-v1","models/auth_brokers/fx-sync-channel","views/behaviors/halt","lib/url"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/channels/fx-desktop-v1"),f=a("models/auth_brokers/fx-sync-channel"),g=a("views/behaviors/halt"),h=a("lib/url"),i=f.prototype,j=f.extend({type:"fx-desktop-v1",commands:{CAN_LINK_ACCOUNT:"can_link_account",CHANGE_PASSWORD:"change_password",DELETE_ACCOUNT:"delete_account",LOADED:"loaded",LOGIN:"login"},defaultBehaviors:d.extend({},i.defaultBehaviors,{afterForceAuth:new g,afterResetPasswordConfirmationPoll:new g,afterSignIn:new g,beforeSignUpConfirmationPoll:new g}),createChannel:function(){var a=new e;return a.initialize({origin:this.window.location.origin||h.getOrigin(this.window.location.href),window:this.window}),a.on("error",this.trigger.bind(this,"error")),a}});c.exports=j}),function(a,b){"use strict";var c="name",d="version",e={extend:function(a,b){var c={};for(var d in a)b[d]&&b[d].length%2==0?c[d]=b[d].concat(a[d]):c[d]=a[d];return c},has:function(a,b){return"string"==typeof a&&-1!==b.toLowerCase().indexOf(a.toLowerCase())},lowerize:function(a){return a.toLowerCase()},major:function(a){return"string"==typeof a?a.split(".")[0]:void 0}},f={rgx:function(){for(var a,b,c,d,e,f,g,h=0,i=arguments;h<i.length&&!f;){var j=i[h],k=i[h+1];if(void 0===a){a={};for(d in k)k.hasOwnProperty(d)&&(e=k[d],"object"==typeof e?a[e[0]]=void 0:a[e]=void 0)}for(b=c=0;b<j.length&&!f;)if(f=j[b++].exec(this.getUA()))for(d=0;d<k.length;d++)g=f[++c],e=k[d],"object"==typeof e&&e.length>0?2==e.length?"function"==typeof e[1]?a[e[0]]=e[1].call(this,g):a[e[0]]=e[1]:3==e.length?"function"!=typeof e[1]||e[1].exec&&e[1].test?a[e[0]]=g?g.replace(e[1],e[2]):void 0:a[e[0]]=g?e[1].call(this,g,e[2]):void 0:4==e.length&&(a[e[0]]=g?e[3].call(this,g.replace(e[1],e[2])):void 0):a[e]=g||void 0;h+=2}return a},str:function(a,b){for(var c in b)if("object"==typeof b[c]&&b[c].length>0){for(var d=0;d<b[c].length;d++)if(e.has(b[c][d],a))return"?"===c?void 0:c}else if(e.has(b[c],a))return"?"===c?void 0:c;return a}},g={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},h={browser:[[/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[c,d],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[c,"IE"],d],[/(edge)\/((\d+)?[\w\.]+)/i],[c,d],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],d],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[c,d],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[c,"Chrome"],d],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[d,[c,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[d,[c,"Facebook"]],[/fxios\/([\w\.-]+)/i],[d,[c,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[d,[c,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[d,c],[/(navigator|netscape)\/([\w\.-]+)/i],[[c,"Netscape"],d],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[c,d]],cpu:[[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",e.lowerize]]],device:[[/\s(tablet)[;\/]/i,/\s(mobile)[;\/]/i],[["type",e.lowerize],"vendor","model"]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[d,[c,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i],[c,d],[/rv\:([\w\.]+).*(gecko)/i],[d,c]],
os:[[/microsoft\s(windows)\s(vista|xp)/i],[c,d],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[c,[d,f.str,g.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[c,"Windows"],[d,f.str,g.os.windows.version]],[/\((bb)(10);/i],[[c,"BlackBerry"],d],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[c,d],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[c,"Symbian"],d],[/\((series40);/i],[c],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[c,"Firefox OS"],d],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[c,d],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[c,"Chromium OS"],d],[/(sunos)\s?([\w\.]+\d)*/i],[[c,"Solaris"],d],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[c,d],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[c,"iOS"],[d,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[c,"Mac OS"],[d,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[c,d]]},i=function(b,c){if(!(this instanceof i))return new i(b,c).getResult();var d=b||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),g=c?e.extend(h,c):h;return this.getBrowser=function(){var a=f.rgx.apply(this,g.browser);return a.major=e.major(a.version),a},this.getCPU=function(){return f.rgx.apply(this,g.cpu)},this.getDevice=function(){return f.rgx.apply(this,g.device)},this.getEngine=function(){return f.rgx.apply(this,g.engine)},this.getOS=function(){return f.rgx.apply(this,g.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return d},this.setUA=function(a){return d=a,this},this};i.VERSION="0.7.10",i.BROWSER={NAME:c,MAJOR:"major",VERSION:d},i.CPU={ARCHITECTURE:"architecture"},i.DEVICE={MODEL:"model",VENDOR:"vendor",TYPE:"type",CONSOLE:"console",MOBILE:"mobile",SMARTTV:"smarttv",TABLET:"tablet",WEARABLE:"wearable",EMBEDDED:"embedded"},i.ENGINE={NAME:c,VERSION:d},i.OS={NAME:c,VERSION:d},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.UAParser=i):"function"==typeof define&&define.amd?define("ua-parser-js",[],function(){return i}):a.UAParser=i;var j=a.jQuery||a.Zepto;if(void 0!==j){var k=new i;j.ua=k.getResult(),j.ua.get=function(){return k.getUA()},j.ua.set=function(a){k.setUA(a);var b=k.getResult();for(var c in b)j.ua[c]=b[c]}}}("object"==typeof window?window:this),define("lib/user-agent",["require","exports","module","underscore","ua-parser-js"],function(a,b,c){"use strict";var d=a("underscore"),e=a("ua-parser-js"),f=function(a){var b=e(a);return d.extend(b,{isAndroid:function(){return"Android"===this.os.name},isIos:function(){return"iOS"===this.os.name},isMobileSafari:function(){return"Mobile Safari"===this.browser.name},isFirefox:function(){return"Firefox"===this.browser.name},isFirefoxAndroid:function(){return this.isFirefox()&&this.isAndroid()},isFirefoxIos:function(){return this.isFirefox()&&this.isIos()},isFirefoxDesktop:function(){return this.isFirefox()&&!this.isFirefoxIos()&&!this.isFirefoxAndroid()},parseVersion:function(){var a=this.browser.version?this.browser.version.split("."):[];return{major:parseInt(a[0]||0,10),minor:parseInt(a[1]||0,10),patch:parseInt(a[2]||0,10)}}}),b};f.toGenericOSName=function(a){return/^Windows/.test(a)?"Windows":/^Android/.test(a)?"Android":/^Mac OS/.test(a)?"macOS":/^iOS/.test(a)?"iOS":/^Ubuntu/.test(a)||/^Linux/.test(a)||/^Fedora/.test(a)||/^Red Hat/.test(a)||/^Debian/.test(a)?"Linux":"Unknown"},c.exports=f}),define("lib/user-agent-mixin",["require","exports","module","lib/user-agent"],function(a,b,c){"use strict";var d=a("lib/user-agent");c.exports={getUserAgentString:function(){return this.getSearchParam("forceUA")||this.window.navigator.userAgent},getUserAgent:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getUserAgentString();return new d(a)}}}),define("lib/channels/receivers/web-channel",["require","exports","module","underscore","backbone","lib/logger","raven"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("backbone"),g=a("lib/logger"),h=a("raven");e.extend(d.prototype,f.Events,{initialize:function(a){a=a||{},this._window=a.window,this._boundReceiveMessage=this.receiveMessage.bind(this),this._window.addEventListener("WebChannelMessageToContent",this._boundReceiveMessage,!0),this._webChannelId=a.webChannelId,this._logger=new g(this._window)},receiveMessage:function(a){var b=a.detail;if(!b||!b.id)return void this._logger.error("malformed WebChannelMessageToContent event",JSON.stringify(b));if(b.id===this._webChannelId){var c=b.message;if(c){var d=this._extractErrorFromMessage(c);d?(this._reportError(d),c.error=d,this.trigger("error",c)):this.trigger("message",c)}}},_reportError:function(a){this._logger.error("WebChannel error:",a.message),h.captureMessage("WebChannel error: "+a.message,{extra:{stackTrace:a.stack}})},_extractErrorFromMessage:function(a){return a.error&&e.isString(a.error)?{message:a.error,stack:null}:a.data&&a.data.error?{message:a.data.error.message,stack:a.data.error.stack}:void 0},teardown:function(){this._window.removeEventListener("WebChannelMessageToContent",this._boundReceiveMessage,!0)}}),c.exports=d}),define("lib/channels/senders/web-channel",["require","exports","module","lib/promise","lib/user-agent"],function(a,b,c){"use strict";function d(){}function e(a,b){return new a.CustomEvent("WebChannelMessageToChrome",{detail:g(a,b)})}function f(a,b,c,d){return{id:a,message:{command:b,data:c,messageId:d}}}function g(a,b){var c=new i(a.navigator.userAgent);return(c.isFirefoxDesktop()||c.isFirefoxAndroid())&&c.browser.version>=50?JSON.stringify(b):b}var h=a("lib/promise"),i=a("lib/user-agent");d.prototype={initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._window=a.window,this._webChannelId=a.webChannelId},send:function(a,b,c){var d=this;return h().then(function(){d._saveEventName(a);var g=f(d._webChannelId,a,b,c),h=e(d._window,g);d._window.dispatchEvent(h)})},teardown:function(){},_saveEventName:function(a){var b=void 0;try{b=JSON.parse(this._window.sessionStorage.getItem("webChannelEvents"))||[]}catch(a){b=[]}b.push(a);try{this._window.sessionStorage.setItem("webChannelEvents",JSON.stringify(b))}catch(a){}}},c.exports=d}),define("lib/channels/web",["require","exports","module","underscore","lib/auth-errors","cocktail","lib/channels/duplex","lib/search-param-mixin","lib/user-agent-mixin","lib/channels/receivers/web-channel","lib/channels/senders/web-channel"],function(a,b,c){"use strict";function d(a){if(!a)throw new Error("WebChannel must have an id");this._id=a}var e=a("underscore"),f=a("lib/auth-errors"),g=a("cocktail"),h=a("lib/channels/duplex"),i=a("lib/search-param-mixin"),j=a("lib/user-agent-mixin"),k=a("lib/channels/receivers/web-channel"),l=a("lib/channels/senders/web-channel"),m={CAN_LINK_ACCOUNT:"fxaccounts:can_link_account",CHANGE_PASSWORD:"fxaccounts:change_password",DELETE:"fxaccounts:delete",DELETE_ACCOUNT:"fxaccounts:delete_account",FXA_STATUS:"fxaccounts:fxa_status",LOADED:"fxaccounts:loaded",LOGIN:"fxaccounts:login",LOGOUT:"fxaccounts:logout",PROFILE_CHANGE:"profile:change"};e.extend(d,m),e.extend(d.prototype,new h,{COMMANDS:m,initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this.window=a.window||window,c=this._id,d=this._sender=new l;d.initialize({webChannelId:c,window:b});var e=this._receiver=new k;e.initialize({webChannelId:c,window:b}),h.prototype.initialize.call(this,{receiver:e,sender:d,window:b})},isFxaStatusSupported:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getUserAgentString(),b=this.getUserAgent(a);return b.isFirefoxDesktop()&&b.parseVersion().major>=55},onErrorReceived:function(a){var b=this.parseError(a),c=b.error;/no such channel/i.test(c&&c.message)&&this.rejectAllOutstandingRequests(f.toError("INVALID_WEB_CHANNEL")),h.prototype.onErrorReceived.call(this,a)}}),g.mixin(d,i,j),c.exports=d}),define("models/auth_brokers/fx-sync-web-channel",["require","exports","module","underscore","lib/constants","./fx-sync-channel","lib/channels/web"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants"),f=a("./fx-sync-channel"),g=a("lib/channels/web"),h=f.prototype,i=f.extend({type:"fx-sync-web-channel",defaultCapabilities:d.extend({},h.defaultCapabilities,{sendChangePasswordNotice:!1}),commands:d.pick(g,"CAN_LINK_ACCOUNT","CHANGE_PASSWORD","DELETE_ACCOUNT","LOADED","LOGIN"),createChannel:function(){var a=new g(e.ACCOUNT_UPDATES_WEBCHANNEL_ID);return a.initialize({window:this.window}),a}});c.exports=i}),define("models/auth_brokers/fx-desktop-v2",["require","exports","module","underscore","lib/constants","./fx-sync-web-channel","views/behaviors/halt","views/behaviors/null","lib/promise"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants"),f=a("./fx-sync-web-channel"),g=a("views/behaviors/halt"),h=a("views/behaviors/null"),i=a("lib/promise"),j=f.prototype,k=f.extend({defaultBehaviors:d.extend({},j.defaultBehaviors,{afterForceAuth:new g,afterResetPasswordConfirmationPoll:new g,afterSignIn:new g,beforeSignUpConfirmationPoll:new g}),defaultCapabilities:d.extend({},j.defaultCapabilities,{chooseWhatToSyncCheckbox:!1,chooseWhatToSyncWebV1:{engines:e.DEFAULT_DECLINED_ENGINES},openWebmailButtonVisible:!0}),type:"fx-desktop-v2",afterResetPasswordConfirmationPoll:function(){return i(new g)},afterCompleteResetPassword:function(a){var b=this;return this._notifyRelierOfLogin(a).then(function(){return j.afterCompleteResetPassword.call(b,a)})},fetch:function(){var a=this;return j.fetch.call(this).then(function(){a.environment.isAboutAccounts()||a._behaviors.keys().forEach(function(b){"halt"===a.getBehavior(b).type&&a.setBehavior(b,new h)})})}});c.exports=k}),define("models/auth_brokers/fx-desktop-v3",["require","exports","module","underscore","./fx-desktop-v2"],function(a,b,c){"use strict";var d=a("underscore"),e=a("./fx-desktop-v2"),f=e.prototype,g=e.extend({defaultCapabilities:d.extend({},f.defaultCapabilities,{allowUidChange:!0}),type:"fx-desktop-v3"});c.exports=g}),define("models/auth_brokers/fx-fennec-v1",["require","exports","module","underscore","lib/constants","models/auth_brokers/fx-sync-web-channel","views/behaviors/navigate"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants"),f=a("models/auth_brokers/fx-sync-web-channel"),g=a("views/behaviors/navigate"),h=f.prototype,i=f.extend({defaultBehaviors:d.extend({},h.defaultBehaviors,{afterSignIn:new g("signin_confirmed"),afterSignUpConfirmationPoll:new g("signup_confirmed")}),defaultCapabilities:d.extend({},h.defaultCapabilities,{chooseWhatToSyncCheckbox:!1,chooseWhatToSyncWebV1:{engines:e.DEFAULT_DECLINED_ENGINES},emailVerificationMarketingSnippet:!1}),type:"fx-fennec-v1"});c.exports=i}),define("models/auth_brokers/fx-firstrun-v1",["require","exports","module","underscore","models/auth_brokers/fx-sync-web-channel","views/behaviors/halt"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/auth_brokers/fx-sync-web-channel"),f=a("views/behaviors/halt"),g=e.prototype,h=e.extend({type:"fx-firstrun-v1",_iframeCommands:{LOADED:"loaded",LOGIN:"login",SIGNUP_MUST_VERIFY:"signup_must_verify",VERIFICATION_COMPLETE:"verification_complete"},defaultCapabilities:d.extend({},g.defaultCapabilities,{cadAfterSignUpConfirmationPoll:!0,chooseWhatToSyncCheckbox:!0,chooseWhatToSyncWebV1:!1,openWebmailButtonVisible:!0}),initialize:function(a){return a=a||{},this._iframeChannel=a.iframeChannel,g.initialize.call(this,a)},fetch:function(){var a=this;return g.fetch.call(this).then(function(){"true"===a.getSearchParam("haltAfterSignIn")&&a.setBehavior("afterSignIn",new f)})},afterLoaded:function(){return this._iframeChannel.send(this._iframeCommands.LOADED),g.afterLoaded.apply(this,arguments)},afterSignIn:function(){return this._iframeChannel.send(this._iframeCommands.LOGIN),g.afterSignIn.apply(this,arguments)},afterSignInConfirmationPoll:function(){return this._iframeChannel.send(this._iframeCommands.VERIFICATION_COMPLETE),g.afterSignInConfirmationPoll.apply(this,arguments)},afterResetPasswordConfirmationPoll:function(){return this._iframeChannel.send(this._iframeCommands.VERIFICATION_COMPLETE),g.afterResetPasswordConfirmationPoll.apply(this,arguments)},beforeSignUpConfirmationPoll:function(a){return this._iframeChannel.send(this._iframeCommands.SIGNUP_MUST_VERIFY,{emailOptIn:!!a.get("needsOptedInToMarketingEmail")}),g.beforeSignUpConfirmationPoll.apply(this,arguments)},afterSignUpConfirmationPoll:function(){return this._iframeChannel.send(this._iframeCommands.VERIFICATION_COMPLETE),g.afterSignUpConfirmationPoll.apply(this,arguments)}});c.exports=h}),define("models/auth_brokers/fx-firstrun-v2",["require","exports","module","underscore","lib/constants","./fx-firstrun-v1"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants"),f=a("./fx-firstrun-v1"),g=f.prototype,h=f.extend({type:"fx-firstrun-v2",defaultCapabilities:d.extend({},g.defaultCapabilities,{chooseWhatToSyncCheckbox:!1,chooseWhatToSyncWebV1:{engines:e.DEFAULT_DECLINED_ENGINES}}),notifications:d.extend({},g.notifications,{"form.disabled":"_sendFormDisabled","form.enabled":"_sendFormEnabled","form.engaged":"_sendFormEngaged","show-child-view":"_onShowChildView","show-view":"_onShowView"}),_iframeCommands:d.extend({},g._iframeCommands,{FORM_DISABLED:"form_disabled",FORM_ENABLED:"form_enabled",FORM_ENGAGED:"form_engaged",NAVIGATED:"navigated"}),_sendFormEngaged:function(){this._iframeChannel.send(this._iframeCommands.FORM_ENGAGED)},_sendFormDisabled:function(){this._iframeChannel.send(this._iframeCommands.FORM_DISABLED)},_sendFormEnabled:function(){this._iframeChannel.send(this._iframeCommands.FORM_ENABLED)},_onShowView:function(a,b){var c=b.currentPage;this._sendNavigated(c)},_onShowChildView:function(a,b,c){var d=c.currentPage;this._sendNavigated(d)},_sendNavigated:function(a){this._iframeChannel.send(this._iframeCommands.NAVIGATED,{url:a})}});c.exports=h}),define("models/auth_brokers/fx-ios-v1",["require","exports","module","underscore","jquery","lib/constants","models/auth_brokers/fx-desktop-v1","views/behaviors/null","lib/promise","lib/user-agent"],function(a,b,c){"use strict";var d=a("underscore"),e=a("jquery"),f=a("lib/constants"),g=a("models/auth_brokers/fx-desktop-v1"),h=a("views/behaviors/null"),i=a("lib/promise"),j=a("lib/user-agent"),k=g.prototype,l=g.extend({defaultCapabilities:d.extend({},k.defaultCapabilities,{chooseWhatToSyncCheckbox:!1,convertExternalLinksToText:!0,immediateUnverifiedLogin:!1}),initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};k.initialize.call(this,a),this._supportsImmediateUnverifiedLogin()&&(this.setCapability("immediateUnverifiedLogin",!0),this.setBehavior("beforeSignUpConfirmationPoll",new h))},_getUserAgentString:function(){return this.getSearchParam("forceUA")||this.window.navigator.userAgent},_supportsImmediateUnverifiedLogin:function(){var a=new j(this._getUserAgentString()),b=a.parseVersion();return b.major>6||6===b.major&&b.minor>=1},_notifyRelierOfLogin:function(a){var b=this;if(a.get("verified")||this.getCapability("immediateUnverifiedLogin"))return k._notifyRelierOfLogin.call(this,a);var c=i.defer(),d=function(){return c.resolve()},g=this.window,h=e(g),j=g.setTimeout(d,f.IOS_V1_LOGIN_MESSAGE_DELAY_MS);return h.on("blur",d),c.promise.then(function(){return k._notifyRelierOfLogin.call(b,a)}).then(function(a){return g.clearTimeout(j),h.off("blur",d),a})}});c.exports=l}),define("models/auth_brokers/oauth",["require","exports","module","underscore","lib/auth-errors","models/auth_brokers/base","lib/constants","views/behaviors/halt","lib/oauth-errors","lib/promise","lib/url","lib/vat"],function(a,b,c){"use strict";function d(a){if(!a)return k.reject(j.toError("INVALID_RESULT"));if(!a.redirect)return k.reject(j.toError("INVALID_RESULT_REDIRECT"));var b=a.redirect.split("?")[1];return a.state=l.searchParam("state",b),a.code=l.searchParam("code",b),m.oauthCode().validate(a.code).error?k.reject(j.toError("INVALID_RESULT_CODE")):k(a)}var e=a("underscore"),f=a("lib/auth-errors"),g=a("models/auth_brokers/base"),h=a("lib/constants"),i=a("views/behaviors/halt"),j=a("lib/oauth-errors"),k=a("lib/promise"),l=a("lib/url"),m=a("lib/vat"),n=g.prototype,o=g.extend({type:"oauth",defaultBehaviors:e.extend({},n.defaultBehaviors,{afterForceAuth:new i,afterSignIn:new i,afterSignInConfirmationPoll:new i}),defaultCapabilities:e.extend({},n.defaultCapabilities,{handleSignedInNotification:!1}),initialize:function(a){return a=a||{},this.session=a.session,this._assertionLibrary=a.assertionLibrary,this._oAuthClient=a.oAuthClient,g.prototype.initialize.call(this,a)},getOAuthResult:function(a){var b=this;if(!a||!a.get("sessionToken"))return k.reject(f.toError("INVALID_TOKEN"));var c=this.relier,e=c.get("clientId");return this._assertionLibrary.generate(a.get("sessionToken"),null,e).then(function(a){var d={assertion:a,client_id:e,scope:c.get("scope"),state:c.get("state")};return c.get("accessType")===h.ACCESS_TYPE_OFFLINE&&(d.access_type=h.ACCESS_TYPE_OFFLINE),b._oAuthClient.getCode(d)}).then(d)},sendOAuthResultToRelier:function(){return k.reject(new Error("subclasses must override sendOAuthResultToRelier"))},finishOAuthSignInFlow:function(a){return this.finishOAuthFlow(a,{action:h.OAUTH_ACTION_SIGNIN})},finishOAuthSignUpFlow:function(a){return this.finishOAuthFlow(a,{action:h.OAUTH_ACTION_SIGNUP})},finishOAuthFlow:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.session.clear("oauth"),this.getOAuthResult(a).then(function(a){return a=e.extend(a,c),b.sendOAuthResultToRelier(a)})},persistVerificationData:function(a){var b=this;return k().then(function(){var c=b.relier;return b.session.set("oauth",{access_type:c.get("access_type"),action:c.get("action"),client_id:c.get("clientId"),keys:c.get("keys"),scope:c.get("scope"),state:c.get("state")}),n.persistVerificationData.call(b,a)})},afterForceAuth:function(a){var b=this;return this.finishOAuthSignInFlow(a).then(function(){return n.afterForceAuth.call(b,a)})},afterSignIn:function(a){var b=this;return this.finishOAuthSignInFlow(a).then(function(){return n.afterSignIn.call(b,a)})},afterSignInConfirmationPoll:function(a){var b=this;return this.finishOAuthSignInFlow(a).then(function(){return n.afterSignInConfirmationPoll.call(b,a)})},afterSignUpConfirmationPoll:function(a){return this.finishOAuthSignUpFlow(a)},afterResetPasswordConfirmationPoll:function(a){return this.finishOAuthSignInFlow(a)},transformLink:function(a){"/"!==a[0]&&(a="/"+a),/^\/(signin|signup)/.test(a)&&(a="/oauth"+a);var b=l.searchParams(this.window.location.search);return l.updateSearchString(a,b)}});c.exports=o}),define("models/auth_brokers/oauth-redirect",["require","exports","module","views/behaviors/halt","models/auth_brokers/oauth","lib/promise","lib/url"],function(a,b,c){"use strict";var d=a("views/behaviors/halt"),e=a("models/auth_brokers/oauth"),f=a("lib/promise"),g=a("lib/url"),h=e.prototype,i=e.extend({type:"redirect",initialize:function(a){return a=a||{},this._metrics=a.metrics,h.initialize.call(this,a)},sendOAuthResultToRelier:function(a){var b=this.window;return this._metrics.flush().then(function(){var c={};a.error&&(c.error=a.error),a.action&&(c.action=a.action),b.location.href=g.updateSearchString(a.redirect,c)})},setOriginalTabMarker:function(){this.window.sessionStorage.setItem("originalTab","1")},isOriginalTab:function(){return!!this.window.sessionStorage.getItem("originalTab")},clearOriginalTabMarker:function(){this.window.sessionStorage.removeItem("originalTab")},persistVerificationData:function(a){var b=this;return f().then(function(){return b.setOriginalTabMarker(),h.persistVerificationData.call(b,a)})},finishOAuthFlow:function(a,b){var c=this;return f().then(function(){return c.clearOriginalTabMarker(),h.finishOAuthFlow.call(c,a,b)})},afterCompleteSignUp:function(a){var b=this;return h.afterCompleteSignUp.call(this,a).delay(100).then(function(c){return b.isOriginalTab()?b.finishOAuthSignUpFlow(a).then(function(){return new d}):c})},afterCompleteResetPassword:function(a){var b=this;return h.afterCompleteResetPassword.call(this,a).then(function(c){return b.isOriginalTab()?b.finishOAuthSignInFlow(a).then(function(){return new d}):c})}});c.exports=i}),define("models/auth_brokers/web",["require","exports","module","underscore","models/auth_brokers/base","lib/constants","views/behaviors/navigate"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/auth_brokers/base"),f=a("lib/constants"),g=f.CONTENT_SERVER_CONTEXT,h=a("views/behaviors/navigate"),i=e.prototype,j=new h("settings",{success:function(a){return a}("Account verified successfully")});c.exports=e.extend({defaultBehaviors:d.extend({},i.defaultBehaviors,{afterCompleteResetPassword:j,afterResetPasswordConfirmationPoll:j,afterSignInConfirmationPoll:j,afterSignUpConfirmationPoll:j}),type:g})}),define("models/auth_brokers/index",["require","exports","module","lib/constants","models/auth_brokers/fx-sync","models/auth_brokers/fx-desktop-v1","models/auth_brokers/fx-desktop-v2","models/auth_brokers/fx-desktop-v3","models/auth_brokers/fx-fennec-v1","models/auth_brokers/fx-firstrun-v1","models/auth_brokers/fx-firstrun-v2","models/auth_brokers/fx-ios-v1","models/auth_brokers/oauth-redirect","models/auth_brokers/web","models/auth_brokers/web"],function(a,b,c){"use strict";var d=a("lib/constants"),e=[{context:d.FX_SYNC_CONTEXT,Constructor:a("models/auth_brokers/fx-sync")},{context:d.FX_DESKTOP_V1_CONTEXT,Constructor:a("models/auth_brokers/fx-desktop-v1")},{context:d.FX_DESKTOP_V2_CONTEXT,Constructor:a("models/auth_brokers/fx-desktop-v2")},{context:d.FX_DESKTOP_V3_CONTEXT,Constructor:a("models/auth_brokers/fx-desktop-v3")},{context:d.FX_FENNEC_V1_CONTEXT,Constructor:a("models/auth_brokers/fx-fennec-v1")},{context:d.FX_FIRSTRUN_V1_CONTEXT,Constructor:a("models/auth_brokers/fx-firstrun-v1")},{context:d.FX_FIRSTRUN_V2_CONTEXT,Constructor:a("models/auth_brokers/fx-firstrun-v2")},{context:d.FX_IOS_V1_CONTEXT,Constructor:a("models/auth_brokers/fx-ios-v1")},{context:d.OAUTH_CONTEXT,Constructor:a("models/auth_brokers/oauth-redirect")},{context:d.CONTENT_SERVER_CONTEXT,Constructor:a("models/auth_brokers/web")}].reduce(function(a,b){return a[b.context]=b.Constructor,a},{});c.exports={get:function(b){return e[b]||a("models/auth_brokers/web")}}}),define("lib/require-on-demand",["require","exports","module","underscore","lib/errors","lib/promise"],function(a,b,c){"use strict";function d(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return g().then(function(){var c=g.defer(),d=b.require;return d.config({waitSeconds:i}),d([a],c.resolve.bind(c),function(b){var d=b.requireType||"UNEXPECTED_ERROR",e=d.toUpperCase(),f=j.toError(e,a);c.reject(f)}),c.promise})}var e=a("underscore"),f=a("lib/errors"),g=a("lib/promise"),h=function(a){return a},i=40,j=e.extend({},f,{ERRORS:{UNEXPECTED_ERROR:{errno:999,message:h("Unexpected error")},TIMEOUT:{errno:1e3,message:h("Resources failed to load")},NODEFINE:{errno:1001,message:h("Unexpected resource error")},SCRIPTERROR:{errno:1002,message:h("Script error")}},NAMESPACE:"require-on-demand"});d.Errors=j,c.exports=d}),define("lib/assertion",["require","exports","module","duration","lib/promise","lib/require-on-demand"],function(a,b,c){"use strict";function d(){var a=this;try{if(window.crypto&&window.crypto.getRandomValues)return k(!0)}catch(a){}return this._fxaClient.getRandomBytes().then(function(b){a._jwcrypto.addEntropy(b)})}function e(){var a=this;return d.call(this).then(function(){return k.denodeify(a._jwcrypto.generateKeypair)({algorithm:"DS",keysize:128})})}function f(a,b,c){var d=this;return e.call(this).then(function(e){return k.all([d._fxaClient.certificateSign(e.publicKey.toSimpleObject(),m,b,c),g(d._jwcrypto,e.secretKey,a)])})}function g(a,b,c){return k.denodeify(a.assertion.sign)(a,{},{audience:c,expiresAt:Date.now()+n},b)}function h(a,b,c){var d=this;return l("jwcrypto").then(function(e){return d._jwcrypto=e,f.call(d,b||d._audience,a,c)}).spread(function(a,b){return d._jwcrypto.cert.bundle([a.cert],b)})}function i(a){a=a||{},this._fxaClient=a.fxaClient,this._audience=a.audience}var j=a("duration"),k=a("lib/promise"),l=a("lib/require-on-demand"),m=new j("6h").milliseconds(),n=25*new j("52w").milliseconds();i.prototype={generate:h},c.exports=i}),define("lib/config-loader",["require","exports","module","jquery","underscore","lib/errors","lib/promise"],function(a,b,c){"use strict";function d(){}var e=a("jquery"),f=a("underscore"),g=a("lib/errors"),h=a("lib/promise");d.prototype={useConfig:function(a){this._config=a},fetch:function(){return this._config?h(this._config):this._readConfigFromHTML().then(this._parseHTMLConfig).then(function(a){return a.lang=e("html").attr("lang"),a})},_readConfigFromHTML:function(){var a=e('meta[name="fxa-content-server/config"]').attr("content");return a?h(a):h.reject(d.Errors.toError("MISSING_CONFIG"))},_parseHTMLConfig:function(a){var b=void 0;try{var c=decodeURIComponent(a);b=JSON.parse(c)}catch(a){return h.reject(d.Errors.toError("INVALID_CONFIG"))}return h(b)}};var i=function(a){return a};d.Errors=f.extend({},g,{ERRORS:{MISSING_CONFIG:{errno:1e3,message:i("Missing configuration")},INVALID_CONFIG:{errno:1001,message:i("Invalid configuration")}},NAMESPACE:"config"}),c.exports=d}),define("models/form-prefill",["require","exports","module","backbone"],function(a,b,c){"use strict";var d=a("backbone"),e=d.Model.extend({defaults:{age:null,email:null,password:null}});c.exports=e});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};define("lib/session",["require","exports","module","underscore"],function(a,b,c){"use strict";function d(){this.load()}var e=a("underscore"),g=["oauth"];d.prototype={load:function(){var a={};try{a=e.extend(a,JSON.parse(sessionStorage.getItem("__fxa_session")))}catch(a){}try{a=e.extend(a,JSON.parse(localStorage.getItem("__fxa_session")))}catch(a){}return e.each(a,function(a,b){d.prototype.hasOwnProperty(b)||(this[b]=a)},this),a},reload:function(){var a=this.load();e.each(this,function(b,c){d.prototype.hasOwnProperty(c)||a.hasOwnProperty(c)||(this[c]=null,delete this[c])},this)},set:function(a,b){if(void 0===b&&"object"===(void 0===a?"undefined":f(a)))return e.each(a,function(a,b){this.set(b,a)},this);d.prototype.hasOwnProperty(a)||(this[a]=b,this.persist())},persist:function(){var a={},b={};e.each(this,function(c,d){e.indexOf(g,d)>=0?b[d]=c:a[d]=c});try{localStorage.setItem("__fxa_session",JSON.stringify(b)),sessionStorage.setItem("__fxa_session",JSON.stringify(a))}catch(a){}},get:function(a){return this[a]},clear:function(a){if(void 0!==a)this.hasOwnProperty(a)&&(this[a]=null,delete this[a],this.persist());else for(a in this)this.clear(a)},testRemove:function(a){this.hasOwnProperty(a)&&(this[a]=null,delete this[a])},testClear:function(){for(var a in this)this.hasOwnProperty(a)&&(this[a]=null,delete this[a]);sessionStorage.clear(),localStorage.clear()}},c.exports=new d}),define("lib/sign-in-reasons",["require","exports","module"],function(a,b,c){"use strict";return{PASSWORD_CHANGE:"password_change",PASSWORD_CHECK:"password_check",PASSWORD_RESET:"password_reset",SIGN_IN:"signin"}}),define("lib/sms-errors",["require","exports","module","underscore","lib/errors"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/errors"),f=function(a){return a},g=f("Invalid phone number"),h=f("You've tried too many times. Try again later."),i={SUCCESS:{errno:0,message:f("SMS sent")},THROTTLED:{errno:1,message:h},MISSING_PARAMETER:{errno:2,message:"SMS parameter missing"},INVALID_PARAMETER:{errno:3,message:"SMS parameter invalid"},INVALID_CREDENTIALS:{errno:4,message:"SMS credentials invalid"},INTERNAL_ERROR:{errno:5,message:"SMS internal error"},UNROUTABLE_MESSAGE:{errno:6,message:g},NUMBER_BLOCKED:{errno:7,message:f("Your number has been blocked")},PARTNER_ACCOUNT_BLOCKED:{errno:8,message:"SMS partner account blocked"},PARTNER_QUOTA_EXCEEDED:{errno:9,message:"SMS partner quota exceeded"},ACCOUNT_NOT_ENABLED_FOR_REST:{errno:11,message:"SMS account not enabled for REST"},MESSAGE_TOO_LONG:{errno:12,message:"SMS message too long"},COMMUNICATION_FAILED:{errno:13,message:f("SMS not sent, please try again")},INVALID_SIGNATURE:{errno:14,message:"SMS invalid signature"},ILLEGAL_SENDER_ADDRESS:{errno:15,message:"SMS sender address illegal"},INVALID_TTL:{errno:16,message:"SMS ttl invalid"},FACILITY_NOT_ALLOWED:{errno:19,message:"SMS facility not allowed"},INVALID_MESSAGE_CLASS:{errno:20,message:"SMS message class invalid"},MISSING_PROTOCOL:{errno:23,message:"SMS protocol missing"},DESTINATION_NOT_ALLOWED:{errno:29,message:"SMS destination not allowed"},INVALID_PHONE_NUMBER:{errno:34,message:g}};c.exports=d.extend({},e,{ERRORS:i,NAMESPACE:"sms"})}),define("lib/verification-methods",["require","exports","module"],function(a,b,c){"use strict";return{EMAIL:"email",EMAIL_CAPTCHA:"email-captcha"}}),define("lib/fxa-client",["require","exports","module","underscore","jquery","lib/auth-errors","lib/constants","lib/promise","lib/require-on-demand","lib/session","lib/sign-in-reasons","lib/sms-errors","lib/verification-reasons","lib/verification-methods"],function(a,b,c){"use strict";function d(a){return m.trim(a)}function e(a,b){return a.wantsKeys()||l.contains(w,b)}function f(a){var b=Object.create(a);for(var c in a)"function"==typeof a[c]&&(b[c]=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=this[a].apply(this,c);return e.then?e.then(null,function(a){throw n.toError(a)}):e}.bind(a,c));return b}function g(a){return function(){for(var b=this,c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return this._getClient().then(function(c){return a.apply(b,[c].concat(d))})}}function h(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return this._getClient().then(function(b){if(!l.isFunction(b[a]))throw new Error("Invalid method on fxa-js-client: "+a);return b[a].apply(b,c)})}}function i(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},f=d.sessionTokenContext;!f&&b.isSync()&&(f=o.SESSION_TOKEN_USED_FOR_SYNC);var g={email:a,sessionToken:c.sessionToken,sessionTokenContext:f,uid:c.uid,verificationMethod:c.verificationMethod,verificationReason:c.verificationReason,verified:c.verified||!1};return e(b,f)&&(g.unwrapBKey=c.unwrapBKey,g.keyFetchToken=c.keyFetchToken),b.isSync()&&(g.customizeSync=d.customizeSync||!1),g}function j(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.client?this._client=f(a.client):a.authServerUrl&&(this._authServerUrl=a.authServerUrl)}function k(a,b){b.metricsContext&&(a.metricsContext=b.metricsContext)}var l=a("underscore"),m=a("jquery"),n=a("lib/auth-errors"),o=a("lib/constants"),p=a("lib/promise"),q=a("lib/require-on-demand"),r=a("lib/session"),s=a("lib/sign-in-reasons"),t=a("lib/sms-errors"),u=a("lib/verification-reasons"),v=a("lib/verification-methods"),w=[o.IFRAME_CONTEXT,o.FX_DESKTOP_V1_CONTEXT,o.FX_DESKTOP_V2_CONTEXT,o.FX_DESKTOP_V3_CONTEXT,o.FX_FENNEC_V1_CONTEXT,o.FX_FIRSTRUN_V2_CONTEXT];j.prototype={_getClient:function(){var a=this
;return this._client?p(this._client):q("fxaClient").then(function(b){var c=new b(a._authServerUrl);return a._client=f(c),a._client})},getRandomBytes:h("getRandomBytes"),checkPassword:g(function(a,b,c){return a.signIn(b,c,{reason:s.PASSWORD_CHECK}).then(function(b){if(b&&b.sessionToken)return a.sessionDestroy(b.sessionToken)})}),checkAccountExists:g(function(a,b){return a.accountStatus(b).then(function(a){return a.exists})}),checkAccountExistsByEmail:g(function(a,b){return a.accountStatusByEmail(b).then(function(a){return a.exists})}),signIn:g(function(a,b,c,f){var g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},h=d(b),j={keys:e(f),reason:g.reason||s.SIGN_IN};return f.has("service")&&(j.service=f.get("service")),f.has("redirectTo")&&(j.redirectTo=f.get("redirectTo")),g.unblockCode&&(j.unblockCode=g.unblockCode),g.resume&&(j.resume=g.resume),g.skipCaseError&&(j.skipCaseError=g.skipCaseError),k(j,g),a.signIn(h,c,j).then(function(a){return a.verified||a.hasOwnProperty("verificationReason")||(a.verificationReason=u.SIGN_UP,a.verificationMethod=v.EMAIL),i(h,f,a,g)})}),signUp:g(function(a,b,c,f){var g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},h=d(b),j={keys:e(f)};return f.has("service")&&(j.service=f.get("service")),f.has("redirectTo")&&(j.redirectTo=f.get("redirectTo")),g.preVerified&&(j.preVerified=!0),g.resume&&(j.resume=g.resume),k(j,g),a.signUp(h,c,j).then(function(a){return i(h,f,a,g)})}),signUpResend:g(function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},e={redirectTo:b.get("redirectTo"),service:b.get("service")};return d.resume&&(e.resume=d.resume),a.recoveryEmailResendCode(c,e)}),sessionDestroy:h("sessionDestroy"),verifyCode:h("verifyCode"),passwordReset:g(function(a,b,c){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},f=d(b),g={redirectTo:c.get("redirectTo"),service:c.get("service")};return e.resume&&(g.resume=e.resume),k(g,e),a.passwordForgotSendCode(f,g).then(function(a){return r.clear(),a})}),passwordResetResend:g(function(a,b,c,e){var f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},g=d(b),h={redirectTo:e.get("redirectTo"),service:e.get("service")};return f.resume&&(h.resume=f.resume),k(h,f),a.passwordForgotResendCode(g,c,h)}),completePasswordReset:g(function(a,b,c,f,g,h){var j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=d(b),m={keys:e(h),sessionToken:!0};k(m,j);var n={};return k(n,j),a.passwordForgotVerifyCode(g,f,n).then(function(b){return a.accountReset(l,c,b.accountResetToken,m)}).then(function(a){return i(l,h,a)})}),isPasswordResetComplete:g(function(a,b){return a.passwordForgotStatus(b).then(function(){return!1},function(a){if(n.is(a,"INVALID_TOKEN"))return!0;throw a})}),changePassword:g(function(a,b,c,f,g,h,j){var k=d(b);return a.passwordChange(k,c,f,{keys:e(j,h),sessionToken:g}).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(k,j,a,{sessionTokenContext:h})})}),deleteAccount:g(function(a,b,c){var e=d(b);return a.accountDestroy(e,c)}),certificateSign:g(function(a,b,c,d,e){return a.certificateSign(d,b,c,{service:e||o.CONTENT_SERVER_SERVICE})}),sessionStatus:h("sessionStatus"),isSignedIn:function(a){return a?this.sessionStatus(a).then(function(){return!0},function(a){if(n.is(a,"INVALID_TOKEN"))return!1;throw a}):p(!1)},recoveryEmailStatus:g(function(a,b){return a.recoveryEmailStatus(b).then(function(a){if(!a.verified){var b=a.emailVerified?u.SIGN_IN:u.SIGN_UP;return{email:a.email,verificationMethod:v.EMAIL,verificationReason:b,verified:!1}}return l.pick(a,"email","verified")})}),sessionVerificationStatus:h("recoveryEmailStatus"),accountKeys:h("accountKeys"),deviceList:h("deviceList"),sessions:h("sessions"),deviceDestroy:h("deviceDestroy"),sendUnblockEmail:g(function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d={};return k(d,c),a.sendUnblockCode(b,d)}),rejectUnblockCode:h("rejectUnblockCode"),sendSms:g(function(a,b,c,d){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return a.sendSms(b,c,d,e).fail(function(a){if(n.is(a,"SMS_REJECTED"))throw t.toError(parseInt(a.reasonCode,10));if(function(a){return n.is(a,"INVALID_PARAMETER")&&a.validation&&a.validation.keys&&"phoneNumber"===a.validation.keys[0]}(a))throw n.toError("INVALID_PHONE_NUMBER");throw a})}),smsStatus:h("smsStatus"),consumeSigninCode:h("consumeSigninCode"),recoveryEmails:h("recoveryEmails"),recoveryEmailCreate:h("recoveryEmailCreate"),recoveryEmailDestroy:h("recoveryEmailDestroy"),resendEmailCode:h("recoveryEmailResendCode"),deleteEmail:h("deleteEmail")},c.exports=j}),define("lib/height-observer",["require","exports","module","underscore","backbone"],function(a,b,c){"use strict";function d(a){a=a||{},this._targetEl=a.target,this._window=a.window,"delayMS"in a&&(this._delayMS=a.delayMS)}var e=a("underscore"),f=a("backbone");e.extend(d.prototype,f.Events,{_delayMS:50,start:function(){if(this._observer)throw new Error("Already started");var a=this._window.MutationObserver;if(a){var b=e.debounce(this._onMutation.bind(this),this._delayMS);this._observer=new a(b),this._observer.observe(this._targetEl,{attributeFilter:["class","style"],attributes:!0,characterData:!0,childList:!0,subtree:!0}),this._onMutation()}},_lastHeight:-1/0,_onMutation:function(){var a=this._targetEl.clientHeight;"number"==typeof a&&a!==this._lastHeight&&(this.trigger("change",a),this._lastHeight=a)},stop:function(){var a=this._observer;a&&(a.disconnect(),delete this._observer)}}),c.exports=d}),define("lib/channels/senders/postmessage",["require","exports","module","lib/promise"],function(a,b,c){"use strict";function d(){}function e(a,b,c){return JSON.stringify({command:a,data:b||{},messageId:c})}var f=a("lib/promise");d.prototype={initialize:function(a){a=a||{},this._origin=a.origin,this._window=a.window},send:function(a,b,c){var d=this;return f().then(function(){var f=e(a,b,c);d._window.postMessage(f,d._origin)})},teardown:function(){}},c.exports=d}),define("lib/channels/iframe",["require","exports","module","underscore","lib/channels/duplex","lib/channels/receivers/postmessage","lib/channels/senders/postmessage"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("lib/channels/duplex"),g=a("lib/channels/receivers/postmessage"),h=a("lib/channels/senders/postmessage");e.extend(d.prototype,new f,{initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.origin=a.origin;var b=a.window||window,c=this._sender=new h;c.initialize({origin:a.origin,window:b.parent});var d=this._receiver=new g;d.initialize({origin:a.origin,window:b}),f.prototype.initialize.call(this,{receiver:d,sender:c,window:b})},receiveEvent:function(a){return this._receiver.receiveEvent(a)},parseMessage:function(a){try{return d.parse(a)}catch(a){return{}}}}),d.stringify=function(a,b){return JSON.stringify({command:a,data:b||{}})},d.parse=function(a){var b=JSON.parse(a);return b.messageId||(b.messageId=b.command),b},c.exports=d}),define("lib/channels/inter-tab",["require","exports","module","underscore","backbone"],function(a,b,c){"use strict";function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.window||window;"BroadcastChannel"in b&&(this._broadcastChannel=new b.BroadcastChannel(g),this._broadcastChannel.onmessage=this.onMessage.bind(this))}var e=a("underscore"),f=a("backbone"),g="firefox_accounts";d.prototype={onMessage:function(a){var b=JSON.parse(a.data);this.trigger(b.name,b.data)},send:function(a,b){this._broadcastChannel&&this._broadcastChannel.postMessage(this.stringify(a,b))},stringify:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return JSON.stringify({data:b,name:a})}},e.extend(d.prototype,f.Events),c.exports=d}),define("lib/marketing-email-errors",["require","exports","module","underscore","lib/errors"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/errors"),f=function(a){return a},g=f("Unexpected error"),h={NETWORK_FAILURE:{errno:1,message:f("System unavailable, try again soon")},INVALID_EMAIL:{errno:2,message:g},UNKNOWN_EMAIL:{errno:3,message:g},UNKNOWN_TOKEN:{errno:4,message:g},USAGE_ERROR:{errno:5,message:f("Please try again later")},EMAIL_PROVIDER_AUTH_FAILURE:{errno:6,message:g},AUTH_ERROR:{errno:7,message:g},SSL_REQUIRED:{errno:8,message:g},INVALID_NEWSLETTER:{errno:9,message:g},INVALID_LANGUAGE:{errno:10,message:g},EMAIL_NOT_CHANGED:{errno:11,message:g},CHANGE_REQUEST_NOT_FOUND:{errno:12,message:g},UNKNOWN_ERROR:{errno:99,message:g},SERVICE_UNAVAILABLE:{errno:998,message:f("System unavailable, try again soon")},UNEXPECTED_ERROR:{errno:999,message:g}};c.exports=d.extend({},e,{ERRORS:h,NAMESPACE:"basket-errors",normalizeXHRError:function(a){var b=a.responseJSON;return!b||"errno"in b||!b.code||(b.errno=b.code,b.code=a.status),e.normalizeXHRError.call(this,a)}})}),define("lib/marketing-email-client",["require","exports","module","lib/constants","lib/marketing-email-errors","lib/url","lib/xhr"],function(a,b,c){"use strict";function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._baseUrl=a.baseUrl,this._preferencesUrl=a.preferencesUrl,this._window=a.window||window,this._xhr=a.xhr||h,this._xhrTimeout=a.timeout||e.DEFAULT_XHR_TIMEOUT_MS}var e=a("lib/constants"),f=a("lib/marketing-email-errors"),g=a("lib/url"),h=a("lib/xhr"),i=["client_id","service","utm_campaign","utm_content","utm_medium","utm_source","utm_term"];d.prototype={_request:function(a,b,c,d){var e=this._baseUrl+b;return this._xhr.oauthAjax({accessToken:c,data:d,timeout:this._xhrTimeout,type:a,url:e}).fail(function(a){throw f.normalizeXHRError(a)})},fetch:function(a){var b=this;return this._request("get","/lookup-user",a).then(function(a){return a.token&&(a.preferencesUrl=b._preferencesUrl+a.token),a})},optIn:function(a,b){var c=g.cleanSearchString(this._window.location.href,i);return this._request("post","/subscribe",a,{newsletters:b,source_url:c})},optOut:function(a,b){return this._request("post","/unsubscribe",a,{newsletters:b})}},c.exports=d}),define("lib/channels/notifier",["require","exports","module","underscore","backbone","lib/vat","lib/channels/web"],function(a,b,c){"use strict";function d(a){return a?e.omit(a,e.isUndefined):a}var e=a("underscore"),f=a("backbone"),g=a("lib/vat"),h=a("lib/channels/web"),i={CHANGE_PASSWORD:{name:h.CHANGE_PASSWORD,schema:{email:g.email().required(),keyFetchToken:g.keyFetchToken().optional(),sessionToken:g.sessionToken().required(),uid:g.uid().required(),unwrapBKey:g.unwrapBKey().optional(),verified:g.boolean().required()}},COMPLETE_RESET_PASSWORD_TAB_OPEN:{name:"fxaccounts:complete_reset_password_tab_open",schema:null},DELETE:{name:h.DELETE,schema:{uid:g.uid().required()}},PROFILE_CHANGE:{name:h.PROFILE_CHANGE,schema:{uid:g.uid().required()}},SIGNED_IN:{name:"internal:signed_in",schema:{keyFetchToken:g.keyFetchToken().optional(),sessionToken:g.sessionToken().required(),sessionTokenContext:g.string().optional(),uid:g.uid().required(),unwrapBKey:g.unwrapBKey().optional()}},SIGNED_OUT:{name:h.LOGOUT,schema:{uid:g.uid().optional()}}},j={},k={};Object.keys(i).forEach(function(a){var b=i[a];j[a]=b.name,k[b.name]=b.schema});var l=f.Model.extend({COMMANDS:j,SCHEMATA:k,initialize:function(a){a=a||{},this._internalChannels=[],this._channels=[],a.iframeChannel&&this._channels.push(a.iframeChannel),a.webChannel&&this._channels.push(a.webChannel),a.tabChannel&&(this._tabChannel=a.tabChannel,this._internalChannels.push(a.tabChannel),this._channels.push(a.tabChannel),this._listen(a.tabChannel))},triggerAll:function(a,b,c){this.triggerRemote(a,b),this.trigger(a,b,c)},triggerRemote:function(a,b){if(b=d(b),k[a]){if(g.validate(b,k[a]).error)throw new Error("Invalid data for command "+a)}else if(!e.isNull(b)&&!e.isUndefined(b))throw new Error("Unexpected data for command "+a);/^internal:/.test(a)?this._internalChannels.forEach(function(c){c.send(a,b)}):this._channels.forEach(function(c){c.send(a,b)})},_listen:function(a){var b=this;e.each(j,function(c){a.on(c,b.trigger.bind(b,c))})}},j);c.exports=l}),define("lib/channels/null",["require","exports","module","underscore","lib/channels/base"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("lib/channels/base");e.extend(d.prototype,new f),c.exports=d}),define("lib/oauth-client",["require","exports","module","lib/oauth-errors","lib/xhr"],function(a,b,c){"use strict";function d(a){throw f.normalizeXHRError(a)}function e(a){a=a||{},this._oAuthUrl=a.oAuthUrl,this._xhr=a.xhr||g}var f=a("lib/oauth-errors"),g=a("lib/xhr");e.prototype={_request:function(a,b,c){return this._xhr[a](this._oAuthUrl+b,c||null).fail(d)},getCode:function(a){return this._request("post","/v1/authorization",a)},getClientInfo:function(a){return this._request("get","/v1/client/"+a)},fetchOAuthApps:function(a){var b={accessToken:a,type:"get",url:this._oAuthUrl+"/v1/client-tokens"};return this._xhr.oauthAjax(b).fail(d)},destroyOAuthApp:function(a,b){var c={accessToken:a,type:"delete",url:this._oAuthUrl+"/v1/client-tokens/"+b};return this._xhr.oauthAjax(c).fail(d)},getToken:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.ttl=a.ttl||"300",a.response_type="token",this.getCode(a)},destroyToken:function(a){var b={token:a};return this._request("post","/v1/destroy",b)}},c.exports=e}),define("models/reliers/base",["require","exports","module","backbone","lib/promise"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/promise"),f=d.Model.extend({defaults:{context:null},fetch:function(){return e(!0)},isOAuth:function(){return!1},isSync:function(){return!1},isCustomizeSyncChecked:function(){return!1},wantsKeys:function(){return!1},pickResumeTokenInfo:function(){return{}},allowCachedCredentials:function(){return!0},isTrusted:function(){return!0},accountNeedsPermissions:function(){return!1}});c.exports=f}),define("models/reliers/relier",["require","exports","module","underscore","lib/auth-errors","models/reliers/base","cocktail","lib/constants","lib/promise","models/mixins/resume-token","models/mixins/search-param","lib/vat"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("models/reliers/base"),g=a("cocktail"),h=a("lib/constants"),i=a("lib/promise"),j=a("models/mixins/resume-token"),k=a("models/mixins/search-param"),l=a("lib/vat"),m=["entrypoint","resetPasswordConfirm","utmCampaign","utmContent","utmMedium","utmSource","utmTerm"],n={email:l.email().allow(h.DISALLOW_CACHED_CREDENTIALS),entryPoint:l.string(),entrypoint:l.string(),migration:l.string().valid(h.AMO_MIGRATION,h.SYNC11_MIGRATION),reset_password_confirm:l.boolean().renameTo("resetPasswordConfirm"),setting:l.string(),uid:l.uid(),utm_campaign:l.string().renameTo("utmCampaign"),utm_content:l.string().renameTo("utmContent"),utm_medium:l.string().renameTo("utmMedium"),utm_source:l.string().renameTo("utmSource"),utm_term:l.string().renameTo("utmTerm")},o=d.extend({},n,{email:l.string().allow(h.DISALLOW_CACHED_CREDENTIALS),uid:l.string()}),p=f.extend({defaults:{allowCachedCredentials:!0,context:h.CONTENT_SERVER_CONTEXT,email:null,entrypoint:null,migration:null,resetPasswordConfirm:!0,setting:null,uid:null,utmCampaign:null,utmContent:null,utmMedium:null,utmSource:null,utmTerm:null},initialize:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._queryParameterSchema=b.isVerification?o:n,this.sentryMetrics=b.sentryMetrics,this.window=b.window||window},fetch:function(){var a=this;return i().then(function(){a.populateFromStringifiedResumeToken(a.getSearchParam("resume")),a.importSearchParamsUsingSchema(a._queryParameterSchema,e),a.has("entryPoint")&&!a.has("entrypoint")&&a.set("entrypoint",a.get("entryPoint")),a.get("email")===h.DISALLOW_CACHED_CREDENTIALS&&(a.unset("email"),a.set("allowCachedCredentials",!1))})},allowCachedCredentials:function(){return this.get("allowCachedCredentials")},resumeTokenFields:m});g.mixin(p,j,k),c.exports=p}),define("models/reliers/oauth",["require","exports","module","underscore","lib/constants","lib/oauth-errors","models/reliers/relier","lib/transform","lib/vat"],function(a,b,c){"use strict";function d(a,b,c){var d=g.without(a,b);return d.length!==a.length?g.union(d,c):a}function e(a){return g.isString&&a.trim().length?g.uniq(a.split(/\s+/g)):[]}function f(a){return g.intersection(a,h.OAUTH_UNTRUSTED_ALLOWED_PERMISSIONS)}var g=a("underscore"),h=a("lib/constants"),i=a("lib/oauth-errors"),j=a("models/reliers/relier"),k=a("lib/transform"),l=a("lib/vat"),m={id:l.hex().required().renameTo("clientId"),image_uri:l.url().allow("").renameTo("imageUri"),name:l.string().required().min(1).renameTo("serviceName"),redirect_uri:l.url().required().renameTo("redirectUri"),trusted:l.boolean().required()},n={access_type:l.accessType().renameTo("accessType"),client_id:l.clientId().required().renameTo("clientId"),prompt:l.prompt(),redirectTo:l.url(),redirect_uri:l.url().renameTo("redirectUri"),scope:l.string().required().min(1),state:l.string()},o={access_type:l.accessType().renameTo("accessType"),action:l.string().min(1),client_id:l.clientId().required().renameTo("clientId"),prompt:l.prompt(),redirect_uri:l.url().renameTo("redirectUri"),scope:l.string().min(1),service:l.clientId(),state:l.string().min(1)},p=j.extend({defaults:g.extend({},j.prototype.defaults,{accessType:null,clientId:null,context:h.OAUTH_CONTEXT,permissions:null,prompt:null,redirectTo:null,redirectUri:null,scope:null,state:null}),initialize:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};j.prototype.initialize.call(this,a,b),this._session=b.session,this._oAuthClient=b.oAuthClient},fetch:function(){var a=this;return j.prototype.fetch.call(this).then(function(){return a._isVerificationFlow()?a._setupVerificationFlow():a._setupSignInSignUpFlow(),a.has("service")||a.set("service",a.get("clientId")),a._setupOAuthRPInfo()}).then(function(){a.has("scope")&&a._normalizeScopesAndPermissions()})},_normalizeScopesAndPermissions:function(){var a=e(this.get("scope"));if(this.isTrusted()?this.wantsConsent()&&(a=d(a,h.OAUTH_TRUSTED_PROFILE_SCOPE,h.OAUTH_TRUSTED_PROFILE_SCOPE_EXPANSION)):a=f(a),!a.length)throw i.toInvalidParameterError("scope");this.set("scope",a.join(" ")),this.set("permissions",a)},isOAuth:function(){return!0},_isVerificationFlow:function(){return!!this.getSearchParam("code")},_setupVerificationFlow:function(){var a=this._session.oauth;a||(a={client_id:this.getSearchParam("service"),service:this.getSearchParam("service")});var b=k.transformUsingSchema(a,o,i);this.set(b)},_setupSignInSignUpFlow:function(){if(this.importSearchParamsUsingSchema(n,i),this.getSearchParam("service"))throw i.toInvalidParameterError("service")},_setupOAuthRPInfo:function(){var a=this,b=this.get("clientId");return this._oAuthClient.getClientInfo(b).then(function(b){var c=k.transformUsingSchema(b,m,i);a.set(c)},function(a){throw i.is(a,"INVALID_PARAMETER")&&a.validation&&a.validation.keys&&"client_id"===a.validation.keys[0]&&(a=i.toError("UNKNOWN_CLIENT"),a.client_id=b),a})},isTrusted:function(){return this.get("trusted")},wantsConsent:function(){return this.get("prompt")===h.OAUTH_PROMPT_CONSENT},accountNeedsPermissions:function(a){if(this.isTrusted()&&!this.wantsConsent())return!1;var b=a.getPermissionsWithValues(this.get("permissions"));return!a.hasSeenPermissions(this.get("clientId"),b)}});c.exports=p}),define("lib/profile-errors",["require","exports","module","underscore","lib/errors"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/errors"),f=function(a){return a},g={UNAUTHORIZED:{errno:100,message:f("Unauthorized")},INVALID_TOKEN:{errno:110,message:f("Invalid Token")},INVALID_PARAMETER:{errno:101,message:f("Invalid parameter in request body: %(param)s")},UNSUPPORTED_PROVIDER:{errno:102,message:f("Unsupported image provider")},IMAGE_PROCESSING_ERROR:{errno:103,message:f("Image processing error")},IMAGE_LOAD_ERROR:{errno:997,message:f("Unexpected error")},SERVICE_UNAVAILABLE:{errno:998,message:f("System unavailable, try again soon")},UNEXPECTED_ERROR:{errno:999,message:f("Unexpected error")}};c.exports=d.extend({},e,{ERRORS:g,NAMESPACE:"profile"})}),define("lib/profile-client",["require","exports","module","lib/profile-errors","lib/xhr"],function(a,b,c){"use strict";function d(a){a=a||{},this.profileUrl=a.profileUrl}var e=a("lib/profile-errors"),f=a("lib/xhr");d.prototype._request=function(a,b,c,d,g){var h={accessToken:c,data:d,headers:g,type:b,url:this.profileUrl+a};return f.oauthAjax(h).then(function(a){if(a.error)throw e.toError(a);return a},function(a){throw e.normalizeXHRError(a)})},d.prototype.getProfile=function(a){return this._request("/v1/profile","get",a)},d.prototype.getAvatar=function(a){return this._request("/v1/avatar","get",a)},d.prototype.deleteAvatar=function(a,b){return this._request("/v1/avatar/"+b,"delete",a)},d.prototype.uploadAvatar=function(a,b){return this._request("/v1/avatar/upload","post",a,b,{"Content-type":b.type})},d.prototype.getDisplayName=function(a){return this._request("/v1/display_name","get",a)},d.prototype.postDisplayName=function(a,b){return this._request("/v1/display_name","post",a,{displayName:b})},d.Errors=e,c.exports=d}),define("models/refresh-observer",["require","exports","module","backbone","lib/storage"],function(a,b,c){"use strict";function d(a,b){return a&&a.view===b}var e=a("backbone"),f=a("lib/storage");c.exports=e.Model.extend({initialize:function(a){a=a||{},this._metrics=a.metrics,this._notifier=a.notifier,this._window=a.window||window,this._storage=f.factory("sessionStorage",this._window),this._notifier.on("show-view",this._onShowView.bind(this)),this._notifier.on("show-child-view",this._onShowChildView.bind(this))},_onShowView:function(a,b){this.logIfRefresh(b.viewName)},_onShowChildView:function(a,b,c){this.logIfRefresh(c.viewName)},logIfRefresh:function(a){var b=this._storage.get("last_page_loaded");d(b,a)&&this._metrics.logViewEvent(a,"refresh"),b={timestamp:Date.now(),view:a},this._storage.set("last_page_loaded",b)}})}),define("lib/image-loader",["require","exports","module","underscore","lib/promise"],function(a,b,c){"use strict";function d(a){var b=f.defer(),c=new Image;return c.onerror=b.reject,c.onload=e.partial(b.resolve,c),c.src=a,b.promise}var e=a("underscore"),f=a("lib/promise");c.exports={load:d}}),define("models/profile-image",["require","exports","module","backbone","lib/image-loader","lib/promise","lib/profile-errors"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/image-loader"),f=a("lib/promise"),g=a("lib/profile-errors"),h=d.Model.extend({defaults:{id:void 0,img:void 0,url:void 0},fetch:function(){var a=this;return this.has("url")?e.load(this.get("url")).then(function(b){return a.set("img",b)},function(){var b=g.toError("IMAGE_LOAD_ERROR");return b.context=a.get("url"),f.reject(b)}):f()},isDefault:function(){return!(this.has("url")&&this.has("id")&&this.has("img"))}});c.exports=h}),define("views/mixins/avatar-mixin",["require","exports","module","underscore","lib/auth-errors","lib/channels/notifier","lib/promise","lib/profile-errors","models/profile-image"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("lib/channels/notifier"),g=a("lib/promise"),h=a("lib/profile-errors"),i=a("models/profile-image"),j={notifications:{},onProfileUpdate:function(){},displayAccountProfileImage:function(a,b){var c=this;b=b||{};var d,f=this.$(b.wrapperClass||".avatar-wrapper");return this._shouldShowDefaultProfileImage(a)?this.setDefaultPlaceholderAvatar(f):b.spinner&&(d=this._addLoadingSpinner(f)),a.fetchCurrentProfileImage().then(function(b){return c._updateCachedProfileImage(b,a),b},function(a){return h.is(a,"UNAUTHORIZED")||e.is(a,"UNVERIFIED_ACCOUNT")||c.logError(a),new i}).fin(function(){return c._completeLoadingSpinner(d)}).then(function(a){f.find(":not(.avatar-spinner)").remove(),a.isDefault()?(f.addClass("with-default").append("<span></span>"),c.logViewEvent("profile_image_not_shown")):(f.removeClass("with-default").append($(a.get("img")).addClass("profile-image")),c.logViewEvent("profile_image_shown"))})},setDefaultPlaceholderAvatar:function(a){a=a||$(".avatar-wrapper"),a.addClass("with-default")},_updateCachedProfileImage:function(a,b){b.isDefault()||(b.setProfileImage(a),this.user.setAccount(b))},_shouldShowDefaultProfileImage:function(a){return!a.has("profileImageUrl")},_addLoadingSpinner:function(a){if(a)return $('<span class="avatar-spinner"></span>').appendTo(a.addClass("with-spinner"))},_completeLoadingSpinner:function(a){if(d.isUndefined(a))return g();var b=g.defer();return a.addClass("completed").on("transitionend",function(c){b.resolve(),c.originalEvent&&"::after"===c.originalEvent.pseudoElement&&a.remove()}),this.setTimeout(function(){b.resolve(),a.remove()},400),b.promise},logAccountImageChange:function(a){a.get("hadProfileImageSetBefore")?this.logViewEvent("submit.change"):this.logViewEvent("submit.new")},updateProfileImage:function(a,b){return b.setProfileImage(a),this.user.setAccount(b).then(d.bind(this._notifyProfileUpdate,this,b.get("uid")))},deleteDisplayedAccountProfileImage:function(a){var b=this;return g().then(function(){if(!a.get("profileImageId"))return a.fetchCurrentProfileImage().then(function(c){return b._updateCachedProfileImage(c,a),c})}).then(function(b){return a.deleteAvatar(a.get("profileImageId"))}).then(function(){b.updateProfileImage(new i,a)})},updateDisplayName:function(a){var b=this.getSignedInAccount();return b.set("displayName",a),this.user.setAccount(b).then(d.bind(this._notifyProfileUpdate,this,b.get("uid")))},_notifyProfileUpdate:function(a){this.notifier.triggerAll(f.PROFILE_CHANGE,{uid:a})}};j.notifications[f.PROFILE_CHANGE]="onProfileUpdate",c.exports=j}),function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f),h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):(j=new e,j.append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){a(d&&b.toDataURL&&f?f(this.toDataURL(c,d)):this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),"function"==typeof define&&define.amd?define("canvasToBlob",[],function(){return f}):a.dataURLtoBlob=f}(this),define("views/elements/checkbox-input",["require","exports","module"],function(a,b,c){"use strict";return{match:function(a){return"checkbox"===a.attr("type")},val:function(a){return!!this.is(":checked")},validate:function(){}}}),define("views/elements/default",["require","exports","module"],function(a,b,c){"use strict";return{match:function(){return!0},validate:function(){}}}),define("views/elements/email-input",["require","exports","module","lib/auth-errors","lib/vat"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("lib/vat");return{match:function(a){return"email"===a.attr("type")},val:function(a){return 1===arguments.length?this.__val(a):this.__val().trim()},validate:function(){var a=this.val();if(!a)throw d.toError("EMAIL_REQUIRED");if(e.email().validate(a).error)throw d.toError("INVALID_EMAIL")}}}),define("views/elements/password-input",["require","exports","module","lib/auth-errors","lib/vat"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("lib/vat");return{match:function(a){var b=a.attr("type");return"password"===b||"text"===b&&a.hasClass("password")},validate:function(){var a=this.val();if(!a)throw d.toError("PASSWORD_REQUIRED");if(e.password().validate(a).error)throw d.toError("PASSWORD_TOO_SHORT")}}}),define("lib/country-telephone-info",["require","exports","module"],function(a,b,c){"use strict";c.exports={GB:{format:function(a){return a.slice(0,3)+" "+a.slice(3,7)+" "+a.slice(7,14)},normalize:function(a){return/^\+44/.test(a)?a:"+44"+a},pattern:/^(?:\+44)?\d{10,10}$/,prefix:"+44"},RO:{format:function(a){return a.slice(0,3)+" "+a.slice(3,6)+" "+a.slice(6,12)},normalize:function(a){var b=/^(\+40)?0?/;return b.test(a)&&(a=a.replace(b,"")),"+40"+a},pattern:/^(?:\+40)?0?7\d{8,8}$/,prefix:"+407"},US:{format:function(a){return a.slice(2,5)+"-"+a.slice(5,8)+"-"+a.slice(8)},normalize:function(a){return/^\+1/.test(a)?a:/^1/.test(a)&&11===a.length?"+"+a:"+1"+a},pattern:/^(\+?1)?[2-9]\d{9,9}$/,prefix:"+1"}},c.exports.CA=c.exports.US}),define("views/elements/text-input",["require","exports","module","lib/auth-errors"],function(a,b,c){"use strict";var d=a("lib/auth-errors");return{match:function(a){return"text"===a.attr("type")},validate:function(){var a=void 0!==this.attr("required"),b=this.val();if(a&&!b.length)throw d.toError("INPUT_REQUIRED")}}}),define("views/elements/tel-input",["require","exports","module","lib/auth-errors","lib/country-telephone-info","views/elements/text-input"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("lib/country-telephone-info"),f=a("views/elements/text-input"),g=Object.create(f);g.match=function(a){return"tel"===a.attr("type")},g.val=function(a){return 1===arguments.length?this.__val(a):this.__val().replace(/[.,()\s-]/g,"")},g.validate=function(){var a=void 0!==this.attr("required"),b=this.val(),c=b.length,f=this.data("country")||"US",g=e[f].pattern;if(!c&&a)throw d.toError("PHONE_NUMBER_REQUIRED");if(c&&!g.test(b))throw d.toError("INVALID_PHONE_NUMBER")},c.exports=g}),define("views/elements/unblock-code-input",["require","exports","module","lib/auth-errors","views/elements/text-input","lib/vat"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/elements/text-input"),f=a("lib/vat"),g=Object.create(e);g.match=function(a){return"text"===a.attr("type")&&a.hasClass("unblock-code")},g.val=function(a){return 1===arguments.length?this.__val(a):this.__val().trim()},g.validate=function(){var a=void 0!==this.attr("required"),b=this.val();if(a&&!b.length)throw d.toError("UNBLOCK_CODE_REQUIRED");if(f.unblockCode().validate(b).error)throw d.toError("INVALID_UNBLOCK_CODE")},c.exports=g}),define("views/elements/jquery-plugin",["require","exports","module","jquery","underscore","views/elements/checkbox-input","views/elements/default","views/elements/email-input","views/elements/password-input","views/elements/tel-input","views/elements/text-input","views/elements/unblock-code-input"],function(a,b,c){"use strict";function d(a){return f.find(n,function(b){return b.match(a)})}var e=a("jquery"),f=a("underscore"),g=a("views/elements/checkbox-input"),h=a("views/elements/default"),i=a("views/elements/email-input"),j=a("views/elements/password-input"),k=a("views/elements/tel-input"),l=a("views/elements/text-input"),m=a("views/elements/unblock-code-input"),n=[g,i,j,m,k,l,h];e.fn.validate=function(){return d(this).validate.call(this)},e.fn.__val=e.fn.val,e.fn.val=function(){var a=d(this);return a.val?a.val.apply(this,arguments):e.fn.__val.apply(this,arguments)}}),define("views/decorators/allow_only_one_submit",["require","exports","module","lib/promise"],function(a,b,c){"use strict";function d(a){return function(){var b=this,c=arguments;return this._isSubmitting?e().then(function(){throw new Error("submit already in progress")}):(this._isSubmitting=!0,e().then(function(){return b.invokeHandler(a,c)}).then(function(a){return b._isSubmitting=!1,a},function(a){throw b._isSubmitting=!1,a}))}}var e=a("lib/promise");c.exports=d}),define("views/decorators/notify_delayed_request",["require","exports","module","lib/auth-errors","lib/promise"],function(a,b,c){"use strict";function d(a){return function(){var b,c=this,d=arguments;return this.clearTimeout(this._workingTimeout),this._workingTimeout=this.setTimeout(function(){
var a=e.toError("WORKING");b=c.displayError(a)},this.LONGER_THAN_EXPECTED),f().then(function(){return c.invokeHandler(a,d)}).then(function(a){return c.clearTimeout(c._workingTimeout),b===c.$(".error").text()&&c.hideError(),a},function(a){throw c.clearTimeout(c._workingTimeout),a})}}var e=a("lib/auth-errors"),f=a("lib/promise");c.exports=d}),define("views/progress_indicator",["require","exports","module","jquery","backbone","cocktail","views/mixins/timer-mixin"],function(a,b,c){"use strict";var d=a("jquery"),e=a("backbone"),f=a("cocktail"),g=a("views/mixins/timer-mixin"),h=e.View.extend({tagName:"div",className:"spinner",_count:0,start:function(a){var b=this;if(!(++this._count>1))return this._removeIndicatorTimeout?(this.clearTimeout(this._removeIndicatorTimeout),void(this._removeIndicatorTimeout=null)):void(this._showIndicatorTimeout=setTimeout(function(){b._showIndicatorTimeout=null,b.showIndicator(a)},100))},destroy:function(){this.done(),this.trigger("destroy"),this.remove()},done:function(){var a=this;if(this._count&&!--this._count)return this._showIndicatorTimeout?(this.clearTimeout(this._showIndicatorTimeout),this._showIndicatorTimeout=null,void this.removeIndicator()):void(this._removeIndicatorTimeout=this.setTimeout(function(){a._removeIndicatorTimeout=null,a.removeIndicator()},100))},showIndicator:function(a){a=d(a),a.length&&(this._progressEl=a,this._progressHTML=a.html(),a.prop("disabled",!0).html(this.$el))},removeIndicator:function(a){(a=this._progressEl)&&a.length&&a.prop("disabled",!1).html(this._progressHTML)},isVisible:function(){return!!this._count}});f.mixin(h,g),c.exports=h}),define("views/decorators/progress_indicator",["require","exports","module","lib/promise","views/progress_indicator"],function(a,b,c){"use strict";function d(a,b){var c=g.defer();return a.setTimeout(c.resolve,b),c.promise}function e(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"button[type=submit]",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(){for(var e=this,g=arguments.length,h=Array(g),i=0;i<g;i++)h[i]=arguments[i];var j=this.$(b),k=parseInt(j.data("minProgressIndicatorMs")||0,10),l=f(this,j);l.start(j);var m=Date.now();return d(l,c).then(function(){return e.invokeHandler(a,h)}).then(function(a){var b=Date.now()-m,c=Math.max(k-b,0);return d(l,c).then(function(){return a&&a.halt||l.done(),a})},function(a){throw l.done(),a})}}function f(a,b){var c=b.data("progressIndicator");return c||(c=new h,a.trackChildView(c),b.data("progressIndicator",c)),c}var g=a("lib/promise"),h=a("views/progress_indicator");c.exports=e}),define("views/tooltip",["require","exports","module","jquery","underscore","views/base","lib/key-codes"],function(a,b,c){"use strict";var d,e=a("jquery"),f=a("underscore"),g=a("views/base"),h=a("lib/key-codes"),i=g.prototype,j=g.extend({tagName:"aside",className:"tooltip",type:"generic",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.message=a.message||"",this.unsafeMessage=a.unsafeMessage||"",this.dismissible=a.dismissible||!1,this.extraClassNames=a.extraClassNames||"",this.invalidEl=e(a.invalidEl)},template:function(){return this.message?this.translate(this.message):this.unsafeMessage?this.unsafeTranslate(this.unsafeMessage):""},afterRender:function(){d&&d.destroy(!0),d=this;var a=this.invalidEl.closest(".input-row,.select-row-wrapper");return this.$el.addClass(this.extraClassNames),this.$el.appendTo(a),this.setPosition(),this.dismissible&&this.$el.append('<span class="dismiss" tabindex="2">&#10005;</span>'),this.bindDOMEvents(),i.afterRender.call(this)},beforeDestroy:function(){d=null;var a=this.invalidEl;a.off("keyup change",this._destroy),a.find("option").off("click",this._destroy)},setPosition:function(){var a=this.$el,b=this.invalidEl;b.hasClass("tooltip-below")?(a.addClass("tooltip-below fade-up-tt"),a.css({top:b.outerHeight()+4})):(a.css({top:-a.outerHeight()-2}),a.addClass("fade-down-tt"))},bindDOMEvents:function(){var a=this.invalidEl;this._destroy=f.bind(this.destroy,this,!0),a.one("change",this._destroy);var b=e(a).val().trim(),c=function(){e(a).val().trim()!==b?this._destroy():a.one("keyup",c)}.bind(this);a.one("keyup",c),a.find("option").one("click",this._destroy),this.$el.find(".dismiss").one("click keypress",function(a){if("click"===a.type||a.which===h.ENTER){var b="tooltip."+this.type+"-dismissed";this.logEvent(b),this._destroy()}}.bind(this))}});c.exports=j}),define("views/form",["require","exports","module","views/elements/jquery-plugin","jquery","underscore","views/decorators/allow_only_one_submit","lib/auth-errors","views/base","duration","views/decorators/notify_delayed_request","lib/promise","views/decorators/progress_indicator","views/tooltip"],function(a,b,c){"use strict";function d(a){return function(){if(this.updateFormValueChanges())return this.invokeHandler(a,arguments)}}a("views/elements/jquery-plugin");var e=a("jquery"),f=a("underscore"),g=a("views/decorators/allow_only_one_submit"),h=a("lib/auth-errors"),i=a("views/base"),j=a("duration"),k=a("views/decorators/notify_delayed_request"),l=a("lib/promise"),m=a("views/decorators/progress_indicator"),n=a("views/tooltip"),o=i.cancelEventThen,p=i.preventDefaultThen,q=i.prototype,r=i.extend({LONGER_THAN_EXPECTED:new j("10s").milliseconds(),constructor:function(a){i.call(this,a),this.delegateEvents(f.extend({},r.prototype.events,this.events))},events:{"change form":d(o("onFormChange")),"input form":d(o("onFormChange")),"keyup form":d(o("onFormChange")),"submit form":p("validateAndSubmit")},_notifiedOfEngaged:!1,onFormChange:function(){this.isSubmitting()||this.isHalted()||(this.hideError(),this.hideSuccess(),this.enableSubmitIfValid(),this._notifiedOfEngaged||(this._notifiedOfEngaged=!0,this.notifier.trigger("form.engaged")))},afterRender:function(){return this.updateFormValueChanges(),this.model.has("error")||this.enableSubmitIfValid(),q.afterRender.call(this)},getFormValues:function(){for(var a={},b=this.$("input,textarea,select"),c=0,d=b.length;c<d;++c){var f=e(b[c]);if(void 0===f.attr("data-novalue")){a[f.attr("name")||f.attr("id")]=this.getElementValue(f)}}return a},enableSubmitIfValid:function(){this.isValid()?this.enableForm():this.disableForm()},disableForm:function(){this.isFormEnabled()&&(this.$("button[type=submit]").addClass("disabled"),this.notifier.trigger("form.disabled"))},enableForm:function(){this.isFormEnabled()||(this.$("button[type=submit]").removeClass("disabled"),this.notifier.trigger("form.enabled"))},isFormEnabled:function(){return!this.$("button[type=submit]").hasClass("disabled")},validateAndSubmit:g(function(a){var b=this;return a&&a.stopImmediatePropagation(),this.trigger("submitStart"),l().then(function(){if(!b.isHalted()){if(!b.isValid())throw b.showValidationErrors();if(b.isFormEnabled())return b.logViewEvent("submit"),b._submitForm().then(function(){return b.afterSubmit()})}})}),_submitForm:k(m(function(){var a=this;return l().then(f.bind(this.beforeSubmit,this)).then(function(b){if(!1!==b)return a.submit()}).fail(function(b){throw a.displayError(b),b})})),isValid:function(){if(!this.isValidStart())return!1;for(var a=this.$("input"),b=0,c=a.length;b<c;++b){var d=this.$(a[b]);try{d.validate()}catch(a){return!1}}return this.isValidEnd()},isValidStart:function(){return!0},isValidEnd:function(){return!0},showValidationErrors:function(){if(this.hideError(),!this.showValidationErrorsStart()){for(var a=this.$("input"),b=0,c=a.length;b<c;++b){var d=a[b],e=this.$(d);try{e.validate()}catch(a){return void this.showValidationError(d,a)}}this.showValidationErrorsEnd()}},getElementValue:function(a){return this.$(a).val()},showValidationErrorsStart:function(){},showValidationErrorsEnd:function(){},showValidationError:function(a,b){var c=this;this.logError(b);var d=this.$(a),e=h.toMessage(b),f=new n({invalidEl:d,message:e});return f.on("destroyed",function(){d.removeClass("invalid"),c.trigger("validation_error_removed",a)}).render().then(function(){try{d.addClass("invalid").get(0).focus()}catch(a){}c.trigger("validation_error",a,e)}),this.trackChildView(f),e},beforeSubmit:function(){return this.disableForm()},submit:function(){},afterSubmit:function(a){var b=this;return l().then(function(){return a&&a.halt?b.halt():b.isErrorVisible()||b.enableForm(),a})},isSubmitting:function(){return this._isSubmitting},halt:function(){this.$("input,textarea,button").attr("disabled","disabled").blur(),this._isHalted=!0},isHalted:function(){return this._isHalted},detectFormValueChanges:function(){var a=this._previousFormValues,b=this.getFormValues();return f.isEqual(a,b)?null:b},updateFormValueChanges:function(){var a=this.detectFormValueChanges();return a&&(this._previousFormValues=a),a}});c.exports=r}),define("views/mixins/modal-panel-mixin",["require","exports","module","jquery","lib/environment"],function(a,b,c){"use strict";var d=a("jquery"),e=a("lib/environment");c.exports={isModal:!0,notifications:{navigate:"closePanel","navigate-back":"closePanel"},openPanel:function(){var a=this;this.$el.modal({clickClose:!1,escapeClose:!1,opacity:.75,showClose:!1,zIndex:999}),this.$el.on(d.modal.AFTER_CLOSE,function(){return a.onAfterClose()}),this._needsToSetBodyMinHeight()&&this._setBodyMinHeight(),this._boundBlockerClick=this.onBlockerClick.bind(this),d(".blocker").on("click",this._boundBlockerClick)},closePanel:function(){d.modal.isActive()&&d.modal.close()},onBlockerClick:function(a){a.target===a.currentTarget&&(this.closePanel(),this.trigger("modal-cancel"))},onAfterClose:function(){this.destroy(!0),this.trigger("modal-cancel"),d(".blocker").off("click",this._boundBlockerClick)},destroy:function(){this.closePanel(),this._needsToSetBodyMinHeight()&&this.model.has("origMinHeight")&&(d("body").css("min-height",this.model.get("origMinHeight")),this.model.unset("origMinHeight"))},_needsToSetBodyMinHeight:function(){return new e(this.window).isFramed()},_setBodyMinHeight:function(){var a=d("body").css("min-height"),b=parseInt(a||0,10),c=d(".modal").outerHeight();c>b&&(this.model.set("origMinHeight",a),d("body").css("min-height",c+"px"))}}}),define("views/mixins/modal-settings-panel-mixin",["require","exports","module","underscore","views/base","views/mixins/modal-panel-mixin"],function(a,b,c){"use strict";var d=a("underscore"),e=a("views/base"),f=a("views/mixins/modal-panel-mixin"),g=e.preventDefaultThen,h=d.extend({},f,{initialize:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.parentView=b.parentView,this.on("modal-cancel",function(){return a.onModalCancel()})},events:{"click .cancel":g("_returnToSettings"),"click .modal-panel #back":g("_returnToAvatarChange")},_returnToAvatarChange:function(){this.navigate("settings/avatar/change")},_returnToClients:function(){this.navigate("settings/clients")},_returnToSettings:function(){this.navigate("settings")},onModalCancel:function(){"settings/clients/disconnect"===this.currentPage?this._returnToClients():this._returnToSettings()},displaySuccess:function(a){this.parentView.displaySuccess(a)}});c.exports=h}),define("stache!templates/settings/avatar_camera",["mustache"],function(a){return a.compile('<div id="avatar-camera">\n  <section class="modal-panel">\n    <div class="avatar-wrapper">\n      <div class="progress-container">\n      </div>\n      <div id="avatar-camera-wrapper">\n        <video id="video" class="hidden"></video>\n      </div>\n    </div>\n\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <canvas id="canvas"></canvas>\n\n    <form novalidate>\n      <div class="button-row">\n        <button type="submit" id="submit-btn" class="settings-button primary disabled">{{#t}}Take picture{{/t}}</button>\n        <button class="settings-button secondary" id="back">{{#t}}Cancel{{/t}}</button>\n      </div>\n    </form>\n  </section>\n</div>\n')});var i=null,j=null,k=null,l=null,m=null,n=null,o={log:function(){"undefined"!=typeof module||"function"==typeof require&&"function"==typeof define||console.log.apply(console,arguments)},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c])}};if("object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(a){"mozSrcObject"in this?this.mozSrcObject=a:(this._srcObject=a,this.src=URL.createObjectURL(a))}}),i=window.navigator&&window.navigator.getUserMedia),j=function(a,b){a.srcObject=b},k=function(a,b){a.srcObject=b.srcObject},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){if(o.log("This appears to be Firefox"),l="firefox",m=o.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),n=31,window.RTCPeerConnection=function(a,b){if(m<38&&a&&a.iceServers){for(var c=[],d=0;d<a.iceServers.length;d++){var e=a.iceServers[d];if(e.hasOwnProperty("urls"))for(var f=0;f<e.urls.length;f++){var g={url:e.urls[f]};0===e.urls[f].indexOf("turn")&&(g.username=e.username,g.credential=e.credential),c.push(g)}else c.push(a.iceServers[d])}a.iceServers=c}return new mozRTCPeerConnection(a,b)},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),i=function(a,b,c){var d=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return m<38&&(o.log("spec: "+JSON.stringify(a)),a.audio&&(a.audio=d(a.audio)),a.video&&(a.video=d(a.video)),o.log("ff37: "+JSON.stringify(a))),navigator.mozGetUserMedia(a,b,c)},navigator.getUserMedia=i,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},m<41){var p=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return p().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){o.log("This appears to be Chrome"),l="chrome",m=o.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),n=38,window.RTCPeerConnection=function(a,b){a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var c=new webkitRTCPeerConnection(a,b),d=c.getStats.bind(c);return c.getStats=function(a,b,c){var e=this,f=arguments;if(arguments.length>0&&"function"==typeof a)return d(a,b);var g=function(a){var b={};return a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b};if(arguments.length>=2){var h=function(a){f[1](g(a))};return d.apply(this,[h,arguments[0]])}return new Promise(function(b,c){1===f.length&&null===a?d.apply(e,[function(a){b.apply(null,[g(a)])},c]):d.apply(e,[b,c])})},c},["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){b.apply(a,[d,e,c])})}return b.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,c=this;return new Promise(function(d,e){b.apply(c,[a[0],function(){d(),a.length>=2&&a[1].apply(null,[])},function(b){e(b),a.length>=3&&a[2].apply(null,[b])}])})}});var q=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b};if(i=function(a,b,c){return a.audio&&(a.audio=q(a.audio)),a.video&&(a.video=q(a.video)),o.log("chrome: "+JSON.stringify(a)),navigator.webkitGetUserMedia(a,b,c)},navigator.getUserMedia=i,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var r=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return o.log("spec:   "+JSON.stringify(a)),a.audio=q(a.audio),a.video=q(a.video),o.log("chrome: "+JSON.stringify(a)),r(a)}}else navigator.mediaDevices.getUserMedia=function(b){return a(b)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){o.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){o.log("Dummy mediaDevices.removeEventListener called.")}),j=function(a,b){m>=43?a.srcObject=b:void 0!==a.src?a.src=URL.createObjectURL(b):o.log("Error attaching stream to element.")},k=function(a,b){m>=43?a.srcObject=b.srcObject:a.src=b.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(o.log("This appears to be Edge"),l="edge",m=o.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),n=12):o.log("Browser does not appear to be WebRTC-capable");else o.log("This does not appear to be a browser"),l="not a browser";var s={};try{Object.defineProperty(s,"version",{set:function(a){m=a}})}catch(a){}if("undefined"!=typeof module){var t;"undefined"!=typeof window&&(t=window.RTCPeerConnection),module.exports={RTCPeerConnection:t,getUserMedia:i,attachMediaStream:j,reattachMediaStream:k,webrtcDetectedBrowser:l,webrtcDetectedVersion:m,webrtcMinimumVersion:n,webrtcTesting:s,webrtcUtils:o}}else"function"==typeof require&&"function"==typeof define&&define("webrtc",[],function(){return{RTCPeerConnection:window.RTCPeerConnection,getUserMedia:i,attachMediaStream:j,reattachMediaStream:k,webrtcDetectedBrowser:l,webrtcDetectedVersion:m,webrtcMinimumVersion:n,webrtcTesting:s,webrtcUtils:o}});define("views/settings/avatar_camera",["require","exports","module","underscore","lib/auth-errors","views/mixins/avatar-mixin","canvasToBlob","cocktail","lib/constants","duration","lib/environment","views/form","views/mixins/modal-settings-panel-mixin","lib/promise","models/profile-image","views/progress_indicator","stache!templates/settings/avatar_camera","webrtc"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("views/mixins/avatar-mixin"),g=(a("canvasToBlob"),a("cocktail")),h=a("lib/constants"),i=a("duration"),j=a("lib/environment"),k=a("views/form"),l=a("views/mixins/modal-settings-panel-mixin"),m=a("lib/promise"),n=a("models/profile-image"),o=a("views/progress_indicator"),p=a("stache!templates/settings/avatar_camera"),q=a("webrtc"),r=h.PROFILE_IMAGE_EXPORT_SIZE,s=h.PROFILE_IMAGE_DISPLAY_SIZE,t=h.PROFILE_IMAGE_JPEG_QUALITY,u=h.DEFAULT_PROFILE_IMAGE_MIME_TYPE,v=k.prototype,w=k.extend({template:p,className:"avatar-camera",viewName:"settings.avatar.camera",context:function(){return{streaming:this.streaming}},initialize:function(a){if(this.exportLength=a.exportLength||r,this.displayLength=a.displayLength||s,this.streaming=!1,this.broker.isAutomatedBrowser()){var b=new i("3s").milliseconds();this.streaming=!0,this.startStream=function(){this.enableSubmitIfValid()},this.stream={stop:function(){}},this.window.setTimeout(d.bind(this.onLoadedMetaData,this),b)}},startStream:function(){var a=this,b={audio:!1,video:!0};return this.window.navigator.mediaDevices.getUserMedia(b).then(function(b){a.stream=b,q.attachMediaStream(a.video,b),a.video.play()},function(){a._avatarProgressIndicator.done(),a.displayError(e.toError("NO_CAMERA"))})},stopAndDestroyStream:function(){if(this.stream){var a=this.stream,b=this.video;a.getTracks?a.getTracks().forEach(function(a){a.stop()}):a.stop?a.stop():b.pause&&"mozSrcObject"in b&&(b.pause(),b.mozSrcObject=null),delete this.stream}},beforeRender:function(){new j(this.window).hasGetUserMedia()||this.navigate("settings/avatar/change",{error:e.toError("NO_CAMERA")})},afterRender:function(){return this.startStream(),this._avatarProgressIndicator=new o,this.wrapper=this.$("#avatar-camera-wrapper"),this.video=this.$("#video")[0],this._avatarProgressIndicator.start(this.$(".progress-container")),this.canvas=this.$("#canvas")[0],this.video.addEventListener("loadedmetadata",d.bind(this.onLoadedMetaData,this),!1),v.afterRender.call(this)},onLoadedMetaData:function(){if(this.streaming)this._avatarProgressIndicator.done();else{var a=this.video.videoWidth,b=this.video.videoHeight;0!==b&&0!==a||this.logError(e.toError("INVALID_CAMERA_DIMENSIONS")),b>a?(this.width=this.displayLength,this.height=b/(a/this.width)):(this.height=this.displayLength,this.width=a/(b/this.height));var c=this.centeredPos(this.width,this.height,this.displayLength);this.wrapper.css({marginLeft:c.left,marginTop:c.top}),this.canvas.width=this.width,this.canvas.height=this.height,this._avatarProgressIndicator.done(),this.$(".progress-container").addClass("hidden"),this.$("#video").height(this.height).removeClass("hidden"),this.streaming=!0,this.enableSubmitIfValid()}},isValidEnd:function(){return this.streaming},submit:function(){var a=this,b=this.getSignedInAccount();return this.logAccountImageChange(b),this.takePicture().then(function(a){return b.uploadAvatar(a)}).then(function(c){return a.stopAndDestroyStream(),a.updateProfileImage(new n(c),b),a.navigate("settings"),c})},beforeDestroy:function(){this.stopAndDestroyStream()},takePicture:function(){var a=m.defer(),b=this.video.videoWidth,c=this.video.videoHeight,d=Math.min(c,b);this.canvas.width=this.exportLength,this.canvas.height=this.exportLength;var e=this.centeredPos(b,c,d),f=this.video;return this.broker.isAutomatedBrowser()&&(f=new Image,f.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQYV2P4DwABAQEAWk1v8QAAAABJRU5ErkJggg=="),this.canvas.getContext("2d").drawImage(f,Math.abs(e.left),Math.abs(e.top),d,d,0,0,this.exportLength,this.exportLength),this.canvas.toBlob(function(b){a.resolve(b)},u,t),a.promise},centeredPos:function(a,b,c){return a>b?{left:(c-a)/2,top:0}:{left:0,top:(c-b)/2}}});g.mixin(w,f,l),c.exports=w}),define("models/cropper-image",["require","exports","module","lib/auth-errors","backbone","lib/constants"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("backbone"),f=a("lib/constants"),g=e.Model.extend({defaults:{height:1,src:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9/KKKKAP/2Q==",type:"image/jpeg",width:1},initialize:function(a){if(a&&(a.width<f.PROFILE_IMAGE_MIN_HEIGHT||a.height<f.PROFILE_IMAGE_MIN_WIDTH))throw d.toError("INVALID_IMAGE_SIZE")}});c.exports=g}),define("stache!templates/settings/avatar_change",["mustache"],function(a){return a.compile('<div id="avatar-change">\n  <section class="modal-panel">\n    <div class="main-avatar">\n      <p class="avatar-wrapper">\n      </p>\n    </div>\n\n    <div class="error"></div>\n\n    <nav id="avatar-options">\n      <input type="file" id="imageLoader" name="imageLoader" accept="image/png, image/jpeg"/>\n      <a href="#" id="file">{{#t}}Upload{{/t}}</a>\n      <a href="/settings/avatar/camera" id="camera">{{#t}}Camera{{/t}}</a>\n      {{#hasProfileImage}}\n      <a href="#" class="remove">{{#t}}Clear{{/t}}</a>\n      {{/hasProfileImage}}\n    </nav>\n\n    <div class="button-row">\n      <button id="done" class="settings-button secondary cancel">{{#t}}Done{{/t}}</button>\n    </div>\n  </section>\n</div>\n')}),function(a){"function"==typeof define&&define.amd?define("draggable/core",["jquery"],a):a(jQuery)}(function(a){function b(b,d){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(!!(g=a("img[usemap=#"+f+"]")[0])&&c(g))):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||d:d)&&c(b)}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.11.0",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({scrollParent:function(){var b=this.css("position"),c="absolute"===b,d=this.parents().filter(function(){var b=a(this);return(!c||"static"!==b.css("position"))&&/(auto|scroll)/.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return"fixed"!==b&&d.length?d:a(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(c){return b(c,!isNaN(a.attr(c,"tabindex")))},tabbable:function(c){var d=a.attr(c,"tabindex"),e=isNaN(d);return(e||d>=0)&&b(c,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(b,c){function d(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),f&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var e="Width"===c?["Left","Right"]:["Top","Bottom"],f=c.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+c]=function(b){return void 0===b?g["inner"+c].call(this):this.each(function(){a(this).css(f,d(this,b)+"px")})},a.fn["outer"+c]=function(b,e){return"number"!=typeof b?g["outer"+c].call(this,b):this.each(function(){a(this).css(f,d(this,b,!0,e)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(b){if(void 0!==b)return this.css("zIndex",b);if(this.length)for(var c,d,e=a(this[0]);e.length&&e[0]!==document;){if(("absolute"===(c=e.css("position"))||"relative"===c||"fixed"===c)&&(d=parseInt(e.css("zIndex"),10),!isNaN(d)&&0!==d))return d;e=e.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<f.length;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}}}),function(a){"function"==typeof define&&define.amd?define("draggable/widget",["jquery"],a):a(jQuery)}(function(a){var b=0,c=Array.prototype.slice;return a.cleanData=function(b){return function(c){for(var d,e=0;null!=(d=c[e]);e++)try{a(d).triggerHandler("remove")}catch(a){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){if(!this._createWidget)return new g(a,b);arguments.length&&this._createWidget(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){if(!a.isFunction(d))return void(i[b]=d);i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(b){for(var d,e,f=c.call(arguments,1),g=0,h=f.length;g<h;g++)for(d in f[g])e=f[g][d],f[g].hasOwnProperty(d)&&void 0!==e&&(a.isPlainObject(e)?b[d]=a.isPlainObject(b[d])?a.widget.extend({},b[d],e):a.widget.extend({},e):b[d]=e);return b},a.widget.bridge=function(b,d){var e=d.prototype.widgetFullName||b;a.fn[b]=function(f){var g="string"==typeof f,h=c.call(arguments,1),i=this;return f=!g&&h.length?a.widget.extend.apply(null,[f].concat(h)):f,g?this.each(function(){var c,d=a.data(this,e);return"instance"===f?(i=d,!1):d?a.isFunction(d[f])&&"_"!==f.charAt(0)?(c=d[f].apply(d,h),c!==d&&void 0!==c?(i=c&&c.jquery?i.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+f+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+f+"'")}):this.each(function(){var b=a.data(this,e);b?(b.option(f||{}),b._init&&b._init()):a.data(this,e,new d(f,this))}),i}},a.Widget=function(){},
a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(c,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=b++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),c),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;f<d.length-1;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),b&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||!0!==f.options.disabled&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&!1===g.apply(this.element[0],[c].concat(d))||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?!0===e||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}}),a.widget}),function(a){"function"==typeof define&&define.amd?define("draggable/mouse",["jquery","./widget"],a):a(jQuery)}(function(a){var b=!1;return a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{version:"1.11.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f=!("string"!=typeof this.options.cancel||!c.target.nodeName)&&a(c.target).closest(this.options.cancel).length;return!(e&&!f&&this._mouseCapture(c))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=!1!==this._mouseStart(c),!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0))}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):b.which?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,b),this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(c){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,c.target===this._mouseDownEvent.target&&a.data(c.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(c)),b=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}),function(a){"function"==typeof define&&define.amd?define("draggable/draggable",["jquery","./core","./mouse","./widget"],a):a(jQuery)}(function(a){return a.widget("ui.draggable",a.ui.mouse,{version:"1.11.0",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(a,b){this._super(a,b),"handle"===a&&this._setHandleClassName()},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging"))return void(this.destroyOnClear=!0);this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy()},_mouseCapture:function(b){var c=this.document[0],d=this.options;try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()&&a(c.activeElement).blur()}catch(a){}return!(this.helper||d.disabled||a(b.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(b),!!this.handle&&(a(!0===d.iframeFix?"iframe":d.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0))},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b,!1),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),!1===this._trigger("start",b)?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b,!0),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(!1===this._trigger("drag",b,d))return this._mouseUp({}),!1;this.position=d.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||!0===this.options.revert||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==c._trigger("stop",b)&&c._clear()}):!1!==this._trigger("stop",b)&&this._clear(),!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),this.element.focus(),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return!this.options.handle||!!a(b.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this._removeHandleClassName(),a(this.options.handle||this.element).addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.element.find(".ui-draggable-handle").addBack().removeClass("ui-draggable-handle")},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),c=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var a=this.element.position(),b=this._isRootNode(this.scrollParent[0]);return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+(b?0:this.scrollParent.scrollTop()),left:a.left-(parseInt(this.helper.css("left"),10)||0)+(b?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options,f=this.document[0];return this.relative_container=null,e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(f).width()-this.helperProportions.width-this.margins.left,(a(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),void((d=c[0])&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*c}},_generatePosition:function(a,b){var c,d,e,f,g=this.options,h=this._isRootNode(this.scrollParent[0]),i=a.pageX,j=a.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),b&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,a.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),a.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),a.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),a.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f),"y"===g.axis&&(i=this.originalPageX),"x"===g.axis&&(j=this.originalPageY)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d,this],!0),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,d){var e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a(this).sortable("instance");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c,d){var e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c,d){var e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c,d){var e=a("body"),f=d.options;e.css("cursor")&&(f._cursor=e.css("cursor")),e.css("cursor",f.cursor)},stop:function(b,c,d){var e=d.options;e._cursor&&a("body").css("cursor",e._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("opacity")&&(f._opacity=e.css("opacity")),e.css("opacity",f.opacity)},stop:function(b,c,d){var e=d.options;e._opacity&&a(c.helper).css("opacity",e._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(a,b,c){c.scrollParent[0]!==c.document[0]&&"HTML"!==c.scrollParent[0].tagName&&(c.overflowOffset=c.scrollParent.offset())},drag:function(b,c,d){var e=d.options,f=!1,g=d.document[0];d.scrollParent[0]!==g&&"HTML"!==d.scrollParent[0].tagName?(e.axis&&"x"===e.axis||(d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(b.pageY-a(g).scrollTop()<e.scrollSensitivity?f=a(g).scrollTop(a(g).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(g).scrollTop())<e.scrollSensitivity&&(f=a(g).scrollTop(a(g).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(b.pageX-a(g).scrollLeft()<e.scrollSensitivity?f=a(g).scrollLeft(a(g).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(g).scrollLeft())<e.scrollSensitivity&&(f=a(g).scrollLeft(a(g).scrollLeft()+e.scrollSpeed)))),!1!==f&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c,d){var e=d.options;d.snapElements=[],a(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!==d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=d.options,p=o.snapTolerance,q=c.offset.left,r=q+d.helperProportions.width,s=c.offset.top,t=s+d.helperProportions.height;for(m=d.snapElements.length-1;m>=0;m--)i=d.snapElements[m].left,j=i+d.snapElements[m].width,k=d.snapElements[m].top,l=k+d.snapElements[m].height,r<i-p||q>j+p||t<k-p||s>l+p||!a.contains(d.snapElements[m].item.ownerDocument,d.snapElements[m].item)?(d.snapElements[m].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=!1):("inner"!==o.snapMode&&(e=Math.abs(k-t)<=p,f=Math.abs(l-s)<=p,g=Math.abs(i-r)<=p,h=Math.abs(j-q)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k-d.helperProportions.height,left:0}).top-d.margins.top),f&&(c.position.top=d._convertPositionTo("relative",{top:l,left:0}).top-d.margins.top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i-d.helperProportions.width}).left-d.margins.left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j}).left-d.margins.left)),n=e||f||g||h,"outer"!==o.snapMode&&(e=Math.abs(k-s)<=p,f=Math.abs(l-t)<=p,g=Math.abs(i-q)<=p,h=Math.abs(j-r)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k,left:0}).top-d.margins.top),f&&(c.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top-d.margins.top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i}).left-d.margins.left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j-d.helperProportions.width}).left-d.margins.left)),!d.snapElements[m].snapping&&(e||f||g||h||n)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=e||f||g||h||n)}}),a.ui.plugin.add("draggable","stack",{start:function(b,c,d){var e,f=d.options,g=a.makeArray(a(f.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});g.length&&(e=parseInt(a(g[0]).css("zIndex"),10)||0,a(g).each(function(b){a(this).css("zIndex",e+b)}),this.css("zIndex",e+g.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("zIndex")&&(f._zIndex=e.css("zIndex")),e.css("zIndex",f.zIndex)},stop:function(b,c,d){var e=d.options;e._zIndex&&a(c.helper).css("zIndex",e._zIndex)}}),a.ui.draggable}),define("draggable",["draggable/draggable"],function(a){return a}),function(a){"function"==typeof define&&define.amd?define("touch-punch/jquery.ui.touch-punch",["jquery","draggable"],a):a(jQuery)}(function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit,f=d._mouseDestroy;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),e.call(b)},d._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),f.call(b)}}}),define("touch-punch",["touch-punch/jquery.ui.touch-punch"],function(a){return a}),define("views/settings/avatar_change",["require","exports","module","jquery","lib/auth-errors","views/mixins/avatar-mixin","cocktail","models/cropper-image","views/form","lib/image-loader","views/mixins/modal-settings-panel-mixin","lib/promise","stache!templates/settings/avatar_change"],function(a,b,c){"use strict";var d=a("jquery"),e=a("lib/auth-errors"),f=a("views/mixins/avatar-mixin"),g=a("cocktail"),h=a("models/cropper-image"),i=a("views/form"),j=a("lib/image-loader"),k=a("views/mixins/modal-settings-panel-mixin"),l=a("lib/promise"),m=a("stache!templates/settings/avatar_change"),n=i.prototype,o=i.extend({template:m,className:"avatar-change",viewName:"settings.avatar.change",events:{"change #imageLoader":"fileSet","click #file":"filePicker","click .remove":"removeAvatar"},initialize:function(){this.FileReader=FileReader},getAccount:function(){return this._account||(this._account=this.getSignedInAccount()),this._account},beforeRender:function(){"avatar"===this.relier.get("setting")&&this.relier.unset("setting")},context:function(){return{hasProfileImage:this.getSignedInAccount().has("profileImageUrl")}},afterVisible:function(){var a=this;return n.afterVisible.call(this).then(function(){return a.displayAccountProfileImage(a.getAccount())})},afterRender:function(){var a=d("<div/>").css({height:1,opacity:0,overflow:"hidden",width:1});return this.$(":file").wrap(a),n.afterRender.call(this)},removeAvatar:function(){var a=this,b=this.getAccount();return this.deleteDisplayedAccountProfileImage(b).then(function(){a.navigate("settings")},function(b){throw a.displayError(b),b})},filePicker:function(){this.$("#imageLoader").click()},fileSet:function(b){var c=this,d=l.defer(),f=b.target.files[0],g=this.getAccount();this.logAccountImageChange(g);var i=function(a){var b=a&&a.errno?a:"UNUSABLE_IMAGE",f=e.toMessage(b);c.displayError(f),d.reject(f)};if(f.type.match("image.*")){var k=new this.FileReader;k.onload=function(b){var e=b.target.result;j.load(e).then(function(b){var g=new h({height:b.height,src:e,type:f.type,width:b.width});a(["draggable","touch-punch"],function(){c.navigate("settings/avatar/crop",{cropImg:g})}),d.resolve()}).fail(i)},k.readAsDataURL(f)}else i();return d.promise}});g.mixin(o,f,k),c.exports=o}),define("lib/cropper",["require","exports","module","underscore"],function(a,b,c){"use strict";function d(a){if(this.displayLength=a.displayLength||f,this.exportLength=a.exportLength||g,this.top=0,this.left=0,this.yCenter=0,this.xCenter=0,this.verticalGutter=e.result(a,"verticalGutter",h),this.horizontalGutter=e.result(a,"horizontalGutter",h),this.onRotate=a.onRotate||e.noop,this.onTranslate=a.onTranslate||e.noop,this.onZoomIn=a.onZoomIn||e.noop,this.onZoomOut=a.onZoomOut||e.noop,this.onZoomRangeChange=a.onZoomRangeChange||e.noop,!a.container)throw new Error("A container element is required");if(this._setupElements(a.container),a.src){var b=a,c=2*this.exportLength;if(b.width>c||b.height>c){var d=c/Math.max(b.width,b.height);b=this.resize(b,d)}this.setImageSrc(b.src,b.width,b.height)}}var e=a("underscore"),f=240,g=480,h=40;d.prototype._setupElements=function(a){var b=this;this.container=a,this.img=a.find("img"),this.wrapper=a.find(".wrapper"),this.canvas=a.find("canvas")[0],this.draggable=a.find(".drag-overlay"),this.draggable.draggable({drag:function(a,c){var d=b.getBoundedPosition(b.top+c.position.top,b.left+c.position.left);b.img.css(d)},stop:function(a,c){var d=b.img.position();b.updatePosition(d),c.helper.css({left:0,top:0}),b.onTranslate()}});var c=this.slider=a.find("[type=range]");c.on("input",function(){b.zoom(parseInt(c.val(),10))}),c.on("change",function(){b.onZoomRangeChange()}),this.scale=parseInt(c.val()||0,10),this.rotator=a.find(".rotate"),this.rotator.on("click",function(){var a=b.rotate(90);b.setImageSrc(a,b._originalHeight,b._originalWidth),b.onRotate()}),a.find(".zoom-out").on("click",function(){b.zoom(b.scale-10),c.val(b.scale),b.onZoomOut()}),a.find(".zoom-in").on("click",function(){b.zoom(b.scale+10),c.val(b.scale),b.onZoomIn()}),this._wrapperHeight=this.wrapper.height(),this._wrapperWidth=this.wrapper.width()},d.prototype.updatePosition=function(a){this.yCenter=a.top+this._height/2,this.xCenter=a.left+this._width/2,this.top=a.top,this.left=a.left},d.prototype.setImageSrc=function(a,b,c){var d=this.img;if(this.src=a,d.css({height:"",left:0,top:0,width:""}),this.slider.val(this.scale),d.attr("src",this.src),this.yCenter=this._wrapperHeight/2,this.xCenter=this._wrapperWidth/2,"number"!=typeof b||"number"!=typeof c||b<=0||c<=0)throw new Error("Height and width must be > 0.");this._originalWidth=b,this._originalHeight=c,this.isLandscape=this._originalHeight<this._originalWidth,this.zoom(this.scale)},d.prototype.updateSize=function(a){this.isLandscape?(this._height=a,this._width=a*this._originalWidth/this._originalHeight):(this._width=a,this._height=a*this._originalHeight/this._originalWidth),this.img.height(this._height),this.img.width(this._width)},d.prototype.getBoundedPosition=function(a,b){var c=this._width,d=this._height,e=this._wrapperHeight,f=this._wrapperWidth;return b>this.horizontalGutter&&(b=this.horizontalGutter),b+c<f-this.horizontalGutter&&(b=f-this.horizontalGutter-c),
a>this.verticalGutter&&(a=this.verticalGutter),a+d<e-this.verticalGutter&&(a=e-this.verticalGutter-d),{left:b,top:a}},d.prototype.resize=function(a,b){var c=this.canvas,d=c.getContext("2d");c.width=a.width*b,c.height=a.height*b,this.img.attr("src",a.src),d.drawImage(this.img[0],0,0,c.width,c.height);var e=c.toDataURL();return{height:c.height,src:e,width:c.width}},d.prototype.zoom=function(a){a<0&&(a=0),a>100&&(a=100);var b=1+a/100,c=this.displayLength*b;this.scale=a,this.updateSize(c);var d=this.getBoundedPosition(this.yCenter-this._height/2,this.xCenter-this._width/2);this.updatePosition(d),this.img.css(d)},d.prototype.rotate=function(a){var b=this.canvas,c=b.getContext("2d");return b.width=this._originalHeight,b.height=this._originalWidth,c.translate(b.width/2,b.height/2),c.rotate(a*Math.PI/180),c.drawImage(this.img[0],-this._originalWidth/2,-this._originalHeight/2),b.toDataURL("image/png")},d.prototype.cropPosition=function(){var a=this.isLandscape?this._originalHeight/this.displayLength:this._originalWidth/this.displayLength,b=1+this.scale/100,c=this.displayLength/b*a;return c=this.isLandscape?Math.min(c,this._originalHeight):Math.min(c,this._originalWidth),{left:(-this.left+this.horizontalGutter)/b*a,length:c,top:(-this.top+this.verticalGutter)/b*a}},d.prototype._export=function(){var a=this.canvas.getContext("2d"),b=this.cropPosition(),c=this.exportLength;this.canvas.width=c,this.canvas.height=c,a.drawImage(this.img[0],b.left,b.top,b.length,b.length,0,0,c,c)},d.prototype.toDataURL=function(a,b){return this._export(),this.canvas.toDataURL(a,b)},d.prototype.toBlob=function(a,b,c){return this._export(),this.canvas.toBlob(a,b,c)},c.exports=d}),define("stache!templates/settings/avatar_crop",["mustache"],function(a){return a.compile('<div id="avatar-crop">\n  <section class="modal-panel">\n    <div class="error"></div>\n\n    <div class="cropper">\n      <div class="wrapper">\n        <div class="mask"></div>\n        <div class="drag-overlay"></div>\n        <img src="" class="avatar" alt="Avatar" />\n      </div>\n\n      <p class="notice">{{#t}}Position and rotate your picture as needed{{/t}}</p>\n\n      <div class="controls">\n        <span class="zoom-out icon-zoom-out"></span>\n        <input class="slider" type="range" min="0" max="100" step="1" value="0" />\n        <span class="zoom-in icon-zoom-in"></span>\n        <button class="rotate icon-cw"></button>\n      </div>\n\n      <canvas id="imageCanvas"></canvas>\n    </div>\n\n    <form novalidate>\n      <div class="button-row">\n        <button type="submit" id="submit-btn" class="settings-button primary disabled">{{#t}}Change{{/t}}</button>\n        <button class="settings-button secondary" id="back">{{#t}}Cancel{{/t}}</button>\n      </div>\n    </form>\n\n  </section>\n</div>\n')}),define("views/settings/avatar_crop",["require","exports","module","lib/auth-errors","views/mixins/avatar-mixin","cocktail","lib/constants","lib/cropper","models/cropper-image","views/form","views/mixins/modal-settings-panel-mixin","p-promise","models/profile-image","stache!templates/settings/avatar_crop"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/mixins/avatar-mixin"),f=a("cocktail"),g=a("lib/constants"),h=a("lib/cropper"),i=a("models/cropper-image"),j=a("views/form"),k=a("views/mixins/modal-settings-panel-mixin"),l=a("p-promise"),m=a("models/profile-image"),n=a("stache!templates/settings/avatar_crop"),o=j.prototype,p=j.extend({template:n,className:"avatar-crop",viewName:"settings.avatar.crop",initialize:function(a){a=a||{},this._cropImg=this.model.get("cropImg"),!this._cropImg&&this.broker.isAutomatedBrowser()&&(this._cropImg=new i)},beforeRender:function(){this._cropImg||this.navigate("settings/avatar/change",{error:d.toMessage("UNUSABLE_IMAGE")})},afterRender:function(){return this.canvas=this.$("canvas")[0],o.afterRender.call(this)},afterVisible:function(){var a=this._cropImg.get("width"),b=this._cropImg.get("height"),c=this._cropImg.get("src");try{this.cropper=new h({container:this.$(".cropper"),displayLength:g.PROFILE_IMAGE_DISPLAY_SIZE,exportLength:g.PROFILE_IMAGE_EXPORT_SIZE,height:b,horizontalGutter:90,onRotate:this._onRotate.bind(this),onTranslate:this._onTranslate.bind(this),onZoomIn:this._onZoomIn.bind(this),onZoomOut:this._onZoomOut.bind(this),onZoomRangeChange:this._onZoomRangeChange.bind(this),src:c,verticalGutter:0,width:a})}catch(a){if(this.broker.isAutomatedBrowser()&&-1!==a.message.indexOf("draggable"))return;this.navigate("settings/avatar/change",{error:d.toMessage("UNUSABLE_IMAGE")})}return o.afterVisible.call(this)},toBlob:function(){var a=l.defer();return this.cropper.toBlob(function(b){a.resolve(b)},this._cropImg.get("type"),g.PROFILE_IMAGE_JPEG_QUALITY),a.promise},submit:function(){var a=this,b=this.getSignedInAccount();return this.logAccountImageChange(b),this.toBlob().then(function(a){return b.uploadAvatar(a)}).then(function(c){return a.updateProfileImage(new m(c),b),a.navigate("settings"),c})},_onRotate:function(){this.logViewEvent("rotate.cw")},_onTranslate:function(){this.logViewEvent("translate")},_onZoomIn:function(){this.logViewEvent("zoom.in")},_onZoomOut:function(){this.logViewEvent("zoom.out")},_onZoomRangeChange:function(){this.logViewEvent("zoom.range")}});f.mixin(p,e,k),c.exports=p}),define("stache!templates/cannot_create_account",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-cannot-create-account-header">{{#t}}Cannot create account{{/t}}</h1>\n  </header>\n\n  <section class="cannot-create-account-content">\n    <p>\n      <strong>{{#unsafeTranslate}}You must meet certain age requirements to create a Firefox&nbsp;Account.{{/unsafeTranslate}}</strong>\n    </p>\n    <p class="links">\n      <a class="ftc" href="http://www.ftc.gov/news-events/media-resources/protecting-consumer-privacy/kids-privacy-coppa" {{#isSync}} target="_blank"{{/isSync}}>{{#t}}Learn more.{{/t}}</a>\n    </p>\n\n  </section>\n</div>\n')}),define("views/cannot_create_account",["require","exports","module","views/base","stache!templates/cannot_create_account"],function(a,b,c){"use strict";var d=a("views/base"),e=a("stache!templates/cannot_create_account"),f=d.extend({template:e,className:"cannot-create-account",context:function(){return{isSync:this.relier.isSync()}}});c.exports=f}),define("views/mixins/back-mixin",["require","exports","module","views/base","lib/key-codes"],function(a,b,c){"use strict";var d=a("views/base"),e=a("lib/key-codes");c.exports={_canGoBack:!1,initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._canGoBack=a.canGoBack},events:{"click #back":"back","keyup #back":d.preventDefaultThen("backOnEnter")},getContext:function(){var a=d.prototype.getContext.call(this);return"canGoBack"in a||(a.canGoBack=this.canGoBack()),a},back:function(a){this.canGoBack()&&(this._canGoBack=!1,this.logViewEvent("back"),this.notifier.trigger("navigate-back",{nextViewData:a}))},backOnEnter:function(a){a.which===e.ENTER&&this.back()},canGoBack:function(){return!!this._canGoBack}}}),define("views/mixins/floating-placeholder-mixin",["require","exports","module","jquery"],function(a,b,c){"use strict";var d=a("jquery");c.exports={events:{"blur input":"onInputBlur","change .select-row":"floatingPlaceholderMixinOnSelect","focus input":"onInputFocus","input input[placeholder]":"floatingPlaceholderMixinOnInput"},afterRender:function(){this.updateFormValueChanges()},showFloatingPlaceholder:function(a,b){var c=this.$el.find(a),d=c.prev(".label-helper"),e=b||c.attr("placeholder")||"";e.length&&d.length&&(c.removeAttr("placeholder"),d.text(e).css({top:"-17px"}))},hideFloatingPlaceholder:function(a){var b=this.$el.find(a),c=b.prev(".label-helper"),d=c.text()||"";d&&(b.attr("placeholder",d),c.removeClass("focused").text("").css({top:"0px"}))},focusLabelHelper:function(a){this.$el.find(a).prev(".label-helper").addClass("focused")},unfocusLabelHelper:function(a){this.$el.find(a).prev(".label-helper").removeClass("focused")},floatingPlaceholderMixinOnInput:function(a){var b=d(a.currentTarget);this.detectFormValueChanges()&&(this.showFloatingPlaceholder(b),this.focusLabelHelper(b))},floatingPlaceholderMixinOnSelect:function(a){var b=d(a.currentTarget);this.showFloatingPlaceholder(b,b.find("option:first").text()),this.focusLabelHelper(b)},onInputFocus:function(a){this.focusLabelHelper(d(a.currentTarget))},onInputBlur:function(a){this.unfocusLabelHelper(d(a.currentTarget))}}}),define("lib/experiments/base",["require","exports","module","underscore","backbone","lib/channels/notifier-mixin","lib/storage"],function(a,b,c){"use strict";function d(){}var e=a("underscore"),f=a("backbone"),g=a("lib/channels/notifier-mixin"),h=a("lib/storage");e.extend(d.prototype,f.Events,{constructor:d,_name:null,notifications:{},_groupType:null,initialize:function(a,b){return this._initialized=!1,!!(a&&b&&b.groupType&&b.metrics&&b.notifier)&&(this._groupType=b.groupType,this.metrics=b.metrics,this._name=a,this._notifier=b.notifier,this.storage=b.storage||h.factory("localStorage"),this._loggingNamespace="experiment."+this._groupType+"."+this._name+".",this._storageNamespace="experiment."+this._name,this._initialized=!0,this.metrics.logExperiment(a,b.groupType),this.saveState("enrolled"),g.initialize.call(this,{notifier:b.notifier}),!0)},destroy:function(){this.stopListening()},logEvent:function(a){this._initialized&&a&&this.metrics.logEvent(this._loggingNamespace+a)},saveState:function(a){if(!a)return!1;var b={};try{b=JSON.parse(this.storage.get(this._storageNamespace))||{}}catch(a){}b[a]||this.logEvent(a),b[a]=!0,this.storage.set(this._storageNamespace,JSON.stringify(b))},hasState:function(a){if(!a)return null;var b={};try{b=JSON.parse(this.storage.get(this._storageNamespace))||{}}catch(a){}return!0===b[a]}}),d.createSaveStateDelegate=function(a){return function(){this.saveState(a)}},d.extend=f.Model.extend,c.exports=d}),define("lib/experiment",["require","exports","module","underscore","lib/experiments/base","lib/url"],function(a,b,c){"use strict";function d(a){if(!(a&&a.able&&a.metrics&&a.notifier&&a.user&&a.window))return void(this.initialized=!1);this.window=a.window;var b=this.window.location.search;if(this.forceExperiment=g.searchParam(h,b),this.forceExperimentGroup=g.searchParam(i,b),this._activeExperiments={},this.able=a.able,this.account=a.account,this.metrics=a.metrics,this.notifier=a.notifier,this.translator=a.translator,this.user=a.user,this.window.navigator.userAgent.indexOf(j)>=0&&!this.forceExperiment)return void(this.initialized=!1);this.initialized=!0}var e=a("underscore"),f=a("lib/experiments/base"),g=a("lib/url"),h="forceExperiment",i="forceExperimentGroup",j="FxATester",k={},l={sendSms:f},m=e.extend({},k,l);e.extend(d.prototype,{},{_activeExperiments:{},_startupExperiments:k,_allExperiments:m,destroy:function(){for(var a in this._activeExperiments){this._activeExperiments[a].destroy(),this._activeExperiments[a]=null,delete this._activeExperiments[a]}},isInExperiment:function(a,b){return!!this.getExperimentGroup(a,b)},isInExperimentGroup:function(a,b,c){return this.getExperimentGroup(a,c)===b},chooseExperiments:function(){if(this.initialized)for(var a in this._startupExperiments){var b=this.getExperimentGroup(a);b&&this.createExperiment(a,b)}},createExperiment:function(a,b){if(this._activeExperiments[a])return this._activeExperiments[a];var c=this._allExperiments[a];if(e.isFunction(c)){var d=new c;if(d.initialize(a,{groupType:b,metrics:this.metrics,notifier:this.notifier}))return this._activeExperiments[a]=d,d}},getExperimentGroup:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!this.initialized&&this.able.choose(a,e.extend({able:this.able,account:this.account,forceExperiment:this.forceExperiment,forceExperimentGroup:this.forceExperimentGroup,isMetricsEnabledValue:this.metrics.isCollectionEnabled(),uniqueUserId:this.user.get("uniqueUserId")},b))}}),c.exports=d}),define("views/mixins/experiment-mixin",["require","exports","module","lib/experiment"],function(a,b,c){"use strict";var d=a("lib/experiment");c.exports={initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.experiments=a.experiments||new d({able:a.able,account:this._account,metrics:this.metrics,notifier:a.notifier,translator:this.translator,user:a.user,window:this.window}),this.experiments.chooseExperiments()},destroy:function(){this.experiments&&(this.experiments.destroy(),this.experiments=null)},createExperiment:function(){var a;return this.notifier.trigger("flow.initialize"),(a=this.experiments).createExperiment.apply(a,arguments)}},["getExperimentGroup","isInExperiment","isInExperimentGroup"].forEach(function(a){c.exports[a]=function(){var b;return(b=this.experiments)[a].apply(b,arguments)}})}),define("stache!templates/partial/show-password",["mustache"],function(a){return a.compile('<input id="{{ id }}" type="checkbox" class="show-password" aria-controls="{{ targetId }}" tabindex="-1" data-novalue data-synchronize-show="{{ synchronizeShow }}"/>\n<label for="{{ id }}" class="show-password-label">\n  {{#t}}Show{{/t}}\n</label>\n')}),define("views/mixins/password-mixin",["require","exports","module","jquery","lib/auth-errors","lib/constants","stache!templates/partial/show-password"],function(a,b,c){"use strict";var d=a("jquery"),e=a("lib/auth-errors"),f=a("lib/constants"),g=a("stache!templates/partial/show-password");c.exports={events:{"change input.password":"onPasswordChanged","keyup input.password":"onPasswordChanged","mousedown .show-password-label":"onShowPasswordMouseDown","touchstart .show-password-label":"onShowPasswordMouseDown"},initialize:function(){var a=this;this.on("submitStart",function(){return a.hideVisiblePasswords()})},afterRender:function(){this._addShowPasswordLabel(this.$("input[type=password]"))},_updateShowPasswordLabel:function(a){var b=this.$(a);this._addShowPasswordLabel(b),0===b.val().length?b.addClass("empty"):b.removeClass("empty")},_addShowPasswordLabel:function(a){var b=this;this.$(a).each(function(a,c){var d=b.$(c);b._shouldCreateShowPasswordLabel(d)&&b._createShowPasswordLabelLabel(d)})},_shouldCreateShowPasswordLabel:function(a){return a.val().length&&!this.$("#show-"+a.attr("id")).length},_createShowPasswordLabelLabel:function(a){var b=a.attr("id"),c={id:"show-"+b,synchronizeShow:!!a.data("synchronize-show"),targetId:b},d=this.renderTemplate(g,c);a.after(d)},onShowPasswordMouseDown:function(a){var b=this,c=this.$(a.target).siblings(".show-password"),e=this.getAffectedPasswordInputs(c);this.showPassword(e);var f=function a(){d(b.window).off("mouseup",a),d(b.window).off("touchend",a),b.hideVisiblePasswords()};d(this.window).one("mouseup",f),d(this.window).one("touchend",f)},getAffectedPasswordInputs:function(a){var b=this.$(a).siblings(".password");return this.$(a).data("synchronizeShow")&&(b=this.$(".password")),b},showPassword:function(a){var b=this.$(a);try{b.attr("type","text").attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off")}catch(a){this._logErrorConvertingPasswordType(b)}b.siblings(".show-password").attr("checked",!0),this.logViewEvent("password.visible")},hidePassword:function(a){var b=this.$(a);try{b.attr("type","password").removeAttr("autocomplete").removeAttr("autocorrect").removeAttr("autocapitalize")}catch(a){this._logErrorConvertingPasswordType(b)}b.siblings(".show-password").removeAttr("checked"),this.logViewEvent("password.hidden"),this.focus(b)},_logErrorConvertingPasswordType:function(a){var b=e.toError("CANNOT_CHANGE_INPUT_TYPE");b.type=a.attr("type"),this.logError(b)},hideVisiblePasswords:function(){var a=this;this.$el.find(".password[type=text]").each(function(b,c){a.hidePassword(c)})},onPasswordChanged:function(a){this._updateShowPasswordLabel(a.target);var b=[];this.$(".password").each(function(a,c){b.push(d(c).val().length)}),Math.min.apply(Math,b)<f.PASSWORD_MIN_LENGTH?this.showPasswordHelper():this.hidePasswordHelper()},showPasswordHelper:function(){this.$(".input-help").css("opacity","1")},hidePasswordHelper:function(){this.$(".input-help:not(.input-help-forgot-pw)").css("opacity","0")}}}),define("views/mixins/service-mixin",["require","exports","module","views/base","jquery"],function(a,b,c){"use strict";var d=a("views/base"),e=a("jquery");c.exports={afterRender:function(){this.transformLinks()},transformLinks:function(){var a=this;this.$('a[href^="/signin"],a[href^="/signup"],a[href^="/reset_password"]').each(function(b,c){var d=e(c);d.attr("href",a.broker.transformLink(d.attr("href")))})},unsafeDisplayError:function(a){var b=d.prototype.unsafeDisplayError.call(this,a);return this.transformLinks(),b}}}),define("views/mixins/settings-panel-mixin",["require","exports","module","jquery","views/base"],function(a,b,c){"use strict";var d=a("jquery"),e=a("views/base");c.exports={initialize:function(a){this.parentView=a.parentView},events:{"click .cancel":e.preventDefaultThen("_closePanelReturnToSettings"),"click .settings-unit-toggle":e.preventDefaultThen("_triggerPanel")},afterRender:function(){this.$("[autofocus]").attr("data-autofocus-on-panel-open",!0).removeAttr("autofocus")},_triggerPanel:function(a){var b=a&&d(a.currentTarget).data("href");b&&this.navigate(b)},openPanel:function(){this.closeAllPanels(),this.$(".settings-unit").addClass("open"),this.focus(this.$("[data-autofocus-on-panel-open]"))},hidePanel:function(){this._closePanelReturnToSettings()},isPanelOpen:function(){return this.$(".settings-unit").hasClass("open")},_closePanelReturnToSettings:function(){this.navigate("settings"),this.clearInput(),this.closePanel()},clearInput:function(){var a=this;this.$("input").each(function(b,c){a.hideFloatingPlaceholder&&a.hideFloatingPlaceholder(c)});var b=this.$("form")[0];b&&b.reset(),this.enableSubmitIfValid&&this.enableSubmitIfValid()},closePanel:function(){this.$(".settings-unit").removeClass("open")},closeAllPanels:function(){d(".settings-unit").removeClass("open")},displaySuccess:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{closePanel:!0};this.parentView&&(this.parentView.displaySuccess(a),b.closePanel&&this.closePanel())}}}),define("stache!templates/settings/change_password",["mustache"],function(a){return a.compile('<div id="change-password" class="settings-unit">\n  <div class="settings-unit-stub">\n    <header class="settings-unit-summary">\n      <h2 class="settings-unit-title">{{#t}}Password{{/t}}</h2>\n    </header>\n    <button class="settings-button secondary settings-unit-toggle hidden"\n      data-href="settings/change_password">{{#t}}Change{{/t}}</button>\n  </div>\n\n  <div class="settings-unit-details">\n    <div class="error"></div>\n\n    <form novalidate>\n      <p>\n        {{#t}}Once you\'re finished, use your new password to sign in on all of your devices.{{/t}}\n      </p>\n      \x3c!-- hidden email field is to allow Fx password manager\n           to correctly save the updated password. Without it,\n           the password manager saves the old_password\n           as the username. --\x3e\n      <input type="email" value="{{email}}" class="hidden" />\n      <div class="input-row password-row">\n        <label class="label-helper"></label>\n        <input type="password" class="password" id="old_password" placeholder="{{#t}}Old password{{/t}}" required pattern=".{8,}" autofocus />\n\n        <div class="input-help input-help-forgot-pw links"><a href="/reset_password" class="reset-password">{{#t}}Forgot password?{{/t}}</a></div>\n      </div>\n\n      <div class="input-row password-row">\n        <label class="label-helper"></label>\n        <input type="password" class="password check-password tooltip-below" id="new_password" placeholder="{{#t}}New password{{/t}}" required pattern=".{8,}" />\n\n        <div class="input-help">{{#t}}Must be at least 8 characters{{/t}}</div>\n      </div>\n\n      <div class="button-row">\n        <button type="submit" class="settings-button primary disabled">{{#t}}Change{{/t}}</button>\n        <button class="settings-button secondary cancel">{{#t}}Cancel{{/t}}</button>\n      </div>\n    </form>\n  </div>\n</div>\n\n')}),define("views/settings/change_password",["require","exports","module","lib/auth-errors","views/mixins/back-mixin","views/base","cocktail","views/mixins/floating-placeholder-mixin","views/form","views/mixins/experiment-mixin","views/mixins/password-mixin","views/mixins/service-mixin","views/mixins/settings-panel-mixin","stache!templates/settings/change_password"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/mixins/back-mixin"),f=a("views/base"),g=a("cocktail"),h=a("views/mixins/floating-placeholder-mixin"),i=a("views/form"),j=a("views/mixins/experiment-mixin"),k=a("views/mixins/password-mixin"),l=a("views/mixins/service-mixin"),m=a("views/mixins/settings-panel-mixin"),n=a("stache!templates/settings/change_password"),o=f.t,p=i.extend({template:n,className:"change-password",viewName:"settings.change-password",context:function(){return{email:this.getSignedInAccount().get("email")}},submit:function(){var a=this,b=this.getSignedInAccount(),c=this.$("#old_password").val(),e=this.$("#new_password").val();return this.hideError(),this.user.changeAccountPassword(b,c,e,this.relier).then(function(){return a.logViewEvent("success"),a.invokeBrokerMethod("afterChangePassword",b)}).then(function(){return a.displaySuccess(o("Password changed successfully")),a.navigate("settings"),a.render()}).fail(function(b){if(d.is(b,"INCORRECT_PASSWORD"))return a.showValidationError(a.$("#old_password"),b);if(d.is(b,"PASSWORDS_MUST_BE_DIFFERENT"))return a.showValidationError(a.$("#new_password"),b);throw b})}});g.mixin(p,j,k,h,m,l,e),c.exports=p}),define("fxaCheckbox",[],function(){"use strict";var a=function(a){this.element_=a};return a.prototype.Constant_={TINY_TIMEOUT:.001},a.prototype.CssClasses_={INPUT:"input",BOX_OUTLINE:"fxa-checkbox__box-outline",FOCUS_HELPER:"fxa-checkbox__focus-helper",TICK_OUTLINE:"fxa-checkbox__tick-outline",RIPPLE_EFFECT:"fxa-js-ripple-effect",RIPPLE_IGNORE_EVENTS:"fxa-js-ripple-effect--ignore-events",RIPPLE_CONTAINER:"fxa-checkbox__ripple-container",RIPPLE_CENTER:"fxa-ripple--center",RIPPLE:"fxa-ripple",IS_FOCUSED:"is-focused",IS_DISABLED:"is-disabled",IS_CHECKED:"is-checked",IS_UPGRADED:"is-upgraded"},a.prototype.onChange_=function(a){this.updateClasses_()},a.prototype.onFocus_=function(a){this.element_.classList.add(this.CssClasses_.IS_FOCUSED)},a.prototype.onBlur_=function(a){this.element_.classList.remove(this.CssClasses_.IS_FOCUSED)},a.prototype.onMouseUp_=function(a){this.blur_()},a.prototype.updateClasses_=function(){this.checkDisabled(),this.checkToggleState()},a.prototype.blur_=function(){window.setTimeout(function(){this.inputElement_.blur()}.bind(this),this.Constant_.TINY_TIMEOUT)},a.prototype.checkToggleState=function(){this.inputElement_.checked?this.element_.classList.add(this.CssClasses_.IS_CHECKED):this.element_.classList.remove(this.CssClasses_.IS_CHECKED)},a.prototype.checkToggleState=a.prototype.checkToggleState,a.prototype.checkDisabled=function(){this.inputElement_.disabled?this.element_.classList.add(this.CssClasses_.IS_DISABLED):this.element_.classList.remove(this.CssClasses_.IS_DISABLED)},a.prototype.checkDisabled=a.prototype.checkDisabled,a.prototype.disable=function(){this.inputElement_.disabled=!0,this.updateClasses_()},a.prototype.disable=a.prototype.disable,a.prototype.enable=function(){this.inputElement_.disabled=!1,this.updateClasses_()},a.prototype.enable=a.prototype.enable,a.prototype.check=function(){this.inputElement_.checked=!0,this.updateClasses_()},a.prototype.check=a.prototype.check,a.prototype.uncheck=function(){this.inputElement_.checked=!1,this.updateClasses_()},a.prototype.uncheck=a.prototype.uncheck,a.prototype.init=function(){if(!(!1 in document.createElement("div")||!1 in document||!1 in window)&&Array.prototype.forEach&&this.element_){this.inputElement_=this.element_.querySelector(this.CssClasses_.INPUT);var a=document.createElement("span");a.classList.add(this.CssClasses_.BOX_OUTLINE);var b=document.createElement("span");b.classList.add(this.CssClasses_.FOCUS_HELPER);var c=document.createElement("span");c.classList.add(this.CssClasses_.TICK_OUTLINE),a.appendChild(c);var d=this.element_.firstChild;if(this.element_.insertBefore(b,d),this.element_.insertBefore(a,d),this.element_.classList.contains(this.CssClasses_.RIPPLE_EFFECT)){this.element_.classList.add(this.CssClasses_.RIPPLE_IGNORE_EVENTS),this.rippleContainerElement_=document.createElement("span"),this.rippleContainerElement_.classList.add(this.CssClasses_.RIPPLE_CONTAINER),this.rippleContainerElement_.classList.add(this.CssClasses_.RIPPLE_EFFECT),this.rippleContainerElement_.classList.add(this.CssClasses_.RIPPLE_CENTER),this.boundRippleMouseUp=this.onMouseUp_.bind(this),this.rippleContainerElement_.addEventListener("mouseup",this.boundRippleMouseUp);var e=document.createElement("span");e.classList.add(this.CssClasses_.RIPPLE),this.rippleContainerElement_.appendChild(e),this.element_.appendChild(this.rippleContainerElement_)}this.boundInputOnChange=this.onChange_.bind(this),this.boundInputOnFocus=this.onFocus_.bind(this),this.boundInputOnBlur=this.onBlur_.bind(this),this.boundElementMouseUp=this.onMouseUp_.bind(this),this.inputElement_.addEventListener("change",this.boundInputOnChange),this.inputElement_.addEventListener("focus",this.boundInputOnFocus),this.inputElement_.addEventListener("blur",this.boundInputOnBlur),this.element_.addEventListener("mouseup",this.boundElementMouseUp),this.updateClasses_(),this.element_.classList.add(this.CssClasses_.IS_UPGRADED)}},a.prototype.mdlDowngrade_=function(){this.rippleContainerElement_&&this.rippleContainerElement_.removeEventListener("mouseup",this.boundRippleMouseUp),this.inputElement_.removeEventListener("change",this.boundInputOnChange),this.inputElement_.removeEventListener("focus",this.boundInputOnFocus),this.inputElement_.removeEventListener("blur",this.boundInputOnBlur),this.element_.removeEventListener("mouseup",this.boundElementMouseUp)},a}),define("views/mixins/checkbox-mixin",["require","exports","module","jquery","fxaCheckbox","lib/strings"],function(a,b,c){"use strict";var d=a("jquery"),e=a("fxaCheckbox"),f=a("lib/strings");c.exports={events:{"change input[type=checkbox]":"logCheckboxChange"},afterRender:function(){this.$el.find(".fxa-checkbox").get().forEach(function(a){new e(a).init()})},logCheckboxChange:function(a){var b=d(a.currentTarget),c=b.is(":checked"),e=c?"checked":"unchecked",g=b.attr("id")||b.attr("name");g&&this.logViewEvent(f.interpolate("checkbox.change.%s.%s",[g,e]))}}}),define("stache!templates/choose_what_to_sync",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <div class="success visible success-email-created">{{#t}}%(email)s created{{/t}}</div>\n  <div id="choose-what-to-sync-graphic"></div>\n\n  <header>\n    <h1 id="fxa-choose-what-to-sync-header">\n      {{#t}}Choose what to sync{{/t}}\n    </h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <form id="choose-what-to-sync" novalidate>\n        <div class="two-col-items">\n          <div class="two-col-block">\n            {{#hasTabSupport}}\n              <div class="input-row choose-what-to-sync-row">\n                <label class="fxa-checkbox">\n                  <input name="sync-content" type="checkbox" class="customize-sync" checked="checked" value="tabs" tabindex="5">\n              <span class="fxa-checkbox__label">\n                {{#t}}Open tabs{{/t}}\n              </span>\n                </label>\n              </div>\n            {{/hasTabSupport}}\n\n            {{#hasBookmarkSupport}}\n              <div class="input-row choose-what-to-sync-row">\n                <label class="fxa-checkbox">\n                  <input name="sync-content" type="checkbox" class="customize-sync" checked="checked" value="bookmarks" tabindex="10">\n              <span class="fxa-checkbox__label">\n                {{#t}}Bookmarks{{/t}}\n              </span>\n                </label>\n              </div>\n            {{/hasBookmarkSupport}}\n\n            {{#hasDesktopAddonSupport}}\n              <div class="input-row choose-what-to-sync-row">\n                <label class="fxa-checkbox">\n                  <input name="sync-content" type="checkbox" class="customize-sync" checked="checked" value="addons" tabindex="15">\n                <span class="fxa-checkbox__label">\n                  {{#t}}Add-ons{{/t}}\n                </span>\n                </label>\n              </div>\n            {{/hasDesktopAddonSupport}}\n          </div>\n          <div class="two-col-block">\n            {{#hasPasswordSupport}}\n              <div class="input-row choose-what-to-sync-row">\n                <label class="fxa-checkbox">\n                  <input name="sync-content" type="checkbox" class="customize-sync" checked="checked" value="passwords" tabindex="20">\n              <span class="fxa-checkbox__label">\n                {{#t}}Passwords{{/t}}\n              </span>\n                </label>\n              </div>\n            {{/hasPasswordSupport}}\n\n            {{#hasHistorySupport}}\n              <div class="input-row choose-what-to-sync-row">\n                <label class="fxa-checkbox">\n                  <input name="sync-content" type="checkbox" class="customize-sync" checked="checked" value="history" tabindex="25">\n              <span class="fxa-checkbox__label">\n                {{#t}}History{{/t}}\n              </span>\n                </label>\n              </div>\n            {{/hasHistorySupport}}\n\n            {{#hasDesktopPreferencesSupport}}\n              <div class="input-row choose-what-to-sync-row">\n                <label class="fxa-checkbox">\n                  <input name="sync-content" type="checkbox" class="customize-sync" checked="checked" value="prefs" tabindex="30">\n                <span class="fxa-checkbox__label">\n                  {{#t}}Preferences{{/t}}\n                </span>\n                </label>\n              </div>\n            {{/hasDesktopPreferencesSupport}}\n          </div>\n        </div>\n        <div class="extra-links extra-links-choose-what-to-sync">{{#t}}Add-ons and Preferences do not currently sync on mobile devices.{{/t}}</div>\n        <div class="button-row">\n          <button id="submit-btn" type="submit" tabindex="1" autofocus>{{#t}}Save settings{{/t}}</button>\n        </div>\n    </form>\n\n    <div class="links">\n      <a href="#" id="back">{{#t}}Back{{/t}}</a>\n    </div>\n\n  </section>\n</div>\n')}),define("views/choose_what_to_sync",["require","exports","module","underscore","views/mixins/back-mixin","views/mixins/checkbox-mixin","cocktail","views/form","stache!templates/choose_what_to_sync"],function(a,b,c){"use strict";var d=a("underscore"),e=a("views/mixins/back-mixin"),f=a("views/mixins/checkbox-mixin"),g=a("cocktail"),h=a("views/form"),i=a("stache!templates/choose_what_to_sync"),j="screen-choose-what-to-sync",k=h.prototype,l=h.extend({template:i,className:"choose-what-to-sync",initialize:function(){this._account=this.user.initAccount(this.model.get("account")),this.onSubmitComplete=this.model.get("onSubmitComplete")},getAccount:function(){return this._account},beforeRender:function(){this.getAccount().get("sessionToken")||this.navigate("signup")},afterRender:function(){$("body").addClass(j)},destroy:function(){var a;$("body").removeClass(j);for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return(a=k.destroy).call.apply(a,[this].concat(c))},context:function(){return{email:this.getAccount().get("email"),hasBookmarkSupport:this._isEngineSupported("bookmarks"),hasDesktopAddonSupport:this._isEngineSupported("desktop-addons"),hasDesktopPreferencesSupport:this._isEngineSupported("desktop-preferences"),hasHistorySupport:this._isEngineSupported("history"),
hasPasswordSupport:this._isEngineSupported("passwords"),hasTabSupport:this._isEngineSupported("tabs")}},submit:function(){var a=this.getAccount(),b=this._getDeclinedEngines();return this._trackUncheckedEngines(b),a.set({customizeSync:!0,declinedSyncEngines:b}),this.user.setAccount(a).then(this.onSubmitComplete)},_isEngineSupported:function(a){return this.broker.getCapability("chooseWhatToSyncWebV1").engines.indexOf(a)>-1},_getDeclinedEngines:function(){return this.$el.find("input[name=sync-content]").not(":checked").map(function(){return this.value}).get()},_trackUncheckedEngines:function(a){var b=this;d.isArray(a)&&a.forEach(function(a){b.logViewEvent("engine-unchecked."+a)})}},{SCREEN_CLASS:j});g.mixin(l,e,f),c.exports=l}),define("stache!templates/clear_storage",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    \x3c!-- this is only shown for selenium tests \n         and does not need to be localized --\x3e\n    <h1 id="fxa-clear-storage-header">Browser storage is cleared</h1>\n  </header>\n</div>\n')}),define("views/clear_storage",["require","exports","module","views/base","stache!templates/clear_storage"],function(a,b,c){"use strict";var d=a("views/base"),e=a("stache!templates/clear_storage"),f=d.extend({template:e,beforeRender:function(){try{localStorage.clear(),sessionStorage.clear(),document.cookie="tooyoung=1; expires=Thu, 01-Jan-1970 00:00:01 GMT"}catch(a){}}});c.exports=f}),define("views/mixins/signed-out-notification-mixin",["require","exports","module","lib/channels/notifier","lib/session","lib/url"],function(a,b,c){"use strict";var d=a("lib/channels/notifier"),e=a("lib/session"),f=a("lib/url"),g={notifications:{},clearSessionAndNavigateToSignIn:function(){this.user.clearSignedInAccountUid(),e.clear(),this.navigateToSignIn()},navigateToSignIn:function(){var a=f.objToSearchString({context:this.relier.get("context"),entrypoint:this.relier.get("entrypoint"),service:this.relier.get("service"),utm_campaign:this.relier.get("utmCampaign"),utm_content:this.relier.get("utmContent"),utm_medium:this.relier.get("utmMedium"),utm_source:this.relier.get("utmSource"),utm_term:this.relier.get("utmTerm")});this.navigateAway("/signin"+a)}};g.notifications[d.SIGNED_OUT]="clearSessionAndNavigateToSignIn",c.exports=g}),define("stache!templates/settings/client_disconnect",["mustache"],function(a){return a.compile('<div id="client-disconnect">\n  <section class="modal-panel">\n    {{^hasDisconnected}}\n      <h2>{{#t}}Disconnect from Sync?{{/t}}</h2>\n      <div class="error"></div>\n\n      <p class="intro">\n      {{#t}}Your browsing data will remain on %(deviceName)s, but it will no longer sync with your account.{{/t}}\n      </p>\n\n      <form novalidate>\n          <p class="disconnect-reasons fxa-radio">\n            <label>\n              <input type="radio" name="disconnect-reasons" value="suspicious"/>\n              {{#t}}Suspicious device{{/t}}\n            </label>\n            <label>\n              <input type="radio" name="disconnect-reasons" value="lost"/>\n              {{#t}}Lost or stolen device{{/t}}\n            </label>\n            <label>\n              <input type="radio" name="disconnect-reasons" value="old"/>\n              {{#t}}Old or replaced device{{/t}}\n            </label>\n            <label>\n              <input type="radio" name="disconnect-reasons" value="duplicate"/>\n              {{#t}}Duplicate device{{/t}}\n            </label>\n            <label>\n              <input type="radio" name="disconnect-reasons" value="no"/>\n              {{#t}}Rather not say{{/t}}\n            </label>\n          </p>\n\n        <div class="button-row">\n          <button type="submit" id="submit-btn" class="settings-button warning disabled">{{#t}}Disconnect{{/t}}</button>\n          <button class="settings-button secondary cancel-disconnect">{{#t}}Cancel{{/t}}</button>\n        </div>\n      </form>\n\n    {{/hasDisconnected}}\n    {{#hasDisconnected}}\n      <h2>{{#t}}Disconnection Successful{{/t}}</h2>\n      <p class=\'reason-help\'>\n      {{reasonHelp}}\n      </p>\n      <div class="button-row">\n        <button id="submit-btn" type="submit">{{#t}}Got it{{/t}}</button>\n      </div>\n    {{/hasDisconnected}}\n  </section>\n</div>\n')}),define("views/settings/client_disconnect",["require","exports","module","cocktail","views/mixins/floating-placeholder-mixin","views/form","views/mixins/modal-settings-panel-mixin","views/mixins/signed-out-notification-mixin","views/base","stache!templates/settings/client_disconnect"],function(a,b,c){"use strict";var d=a("cocktail"),e=a("views/mixins/floating-placeholder-mixin"),f=a("views/form"),g=a("views/mixins/modal-settings-panel-mixin"),h=a("views/mixins/signed-out-notification-mixin"),i=a("views/base").t,j=a("stache!templates/settings/client_disconnect"),k={lost:i("We're sorry to hear about this. You should change your Firefox Account password, and look for information from your device manufacturer about erasing your data remotely."),suspicious:i("We're sorry to hear about this. If this was a device you really don't trust, you should change your Firefox Account password, and change any passwords saved in Firefox.")},l=f.extend({template:j,className:"clients-disconnect",viewName:"settings.clients.disconnect",events:{"change .disconnect-reasons":"onChangeRadioButton",click:"_returnToClientListAfterDisconnect","click .cancel-disconnect":f.preventDefaultThen("_returnToClientList"),"click button[type=submit]":"_returnToConnectAnotherDevice"},initialize:function(){var a=this;this.hasDisconnected=!1,this.on("modal-cancel",function(){return a._returnToClientList()})},beforeRender:function(){var a=this.model.get("clients"),b=this.model.get("clientId");if(!a||!b)return this._returnToClientList();this.client=a.get(b)},context:function(){var a={hasDisconnected:this.hasDisconnected,reasonHelp:this.reasonHelp};return this.hasDisconnected||(a.deviceName=this.client.get("name")),a},onChangeRadioButton:function(){this.enableSubmitIfValid()},isValidStart:function(){return!!this.hasDisconnected||this.$("input[name=disconnect-reasons]:checked").length>0},submit:function(){var a=this,b=this.client,c=this.$("input[name=disconnect-reasons]:checked").val();return this.logViewEvent("submit."+c),this.user.destroyAccountClient(this.user.getSignedInAccount(),b).then(function(){a.hasDisconnected=!0,a.reasonHelp=k[c],b.get("isCurrentDevice")?a.navigateToSignIn():a.reasonHelp?a.render():a._returnToClientListAfterDisconnect()})},_returnToClientListAfterDisconnect:function(){this.hasDisconnected&&this._returnToClientList()},_returnToClientList:function(){this.navigate("settings/clients")}});d.mixin(l,g,e,h),c.exports=l}),define("models/device",["require","exports","module","backbone","lib/constants"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/constants"),f=d.Model.extend({defaults:{clientType:e.CLIENT_TYPE_DEVICE,genericOS:null,id:null,isCurrentDevice:null,isDevice:!0,lastAccessTime:null,lastAccessTimeFormatted:null,name:"Firefox",type:null},destroy:function(){this.trigger("destroy",this)}});c.exports=f}),define("models/oauth-app",["require","exports","module","backbone","lib/constants"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/constants");c.exports=d.Model.extend({defaults:{clientType:e.CLIENT_TYPE_OAUTH_APP,id:null,lastAccessTime:null,lastAccessTimeFormatted:null,name:null,scope:null},destroy:function(){this.trigger("destroy",this)}})}),define("models/web-session",["require","exports","module","backbone","lib/constants"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/constants");c.exports=d.Model.extend({defaults:{clientType:e.CLIENT_TYPE_WEB_SESSION,genericOS:null,id:null,lastAccessTime:null,lastAccessTimeFormatted:null,name:null,userAgent:null},destroy:function(){this.trigger("destroy",this)}})}),define("models/attached-clients",["require","exports","module","backbone","lib/constants","models/device","models/oauth-app","models/web-session","lib/promise"],function(a,b,c){"use strict";var d=a("backbone"),e=a("lib/constants"),f=a("models/device"),g=a("models/oauth-app"),h=a("models/web-session"),i=a("lib/promise"),j=d.Collection.extend({model:function(a,b){return a.clientType===e.CLIENT_TYPE_DEVICE?new f(a,b):a.clientType===e.CLIENT_TYPE_OAUTH_APP?new g(a,b):a.clientType===e.CLIENT_TYPE_WEB_SESSION?new h(a,b):void 0},fetchClients:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments[1],d=c.getSignedInAccount(),e=[];return b.devices&&e.push(c.fetchAccountDevices(d)),b.oAuthApps&&e.push(c.fetchAccountOAuthApps(d)),b.sessions&&e.push(c.fetchAccountSessions(d)),i.all(e).then(function(b){a.reset(),b&&b.forEach(function(b){a.add(b,{merge:!0})})})},comparator:function(a,b){if(a.get("isCurrentDevice"))return-1;if(b.get("isCurrentDevice"))return 1;var c=a.get("lastAccessTime"),d=b.get("lastAccessTime");if(c&&d&&c!==d)return d-c;if(c&&!d)return-1;if(!c&&d)return 1;var e=(a.get("name")||"").trim().toLowerCase(),f=(b.get("name")||"").trim().toLowerCase();return e<f?-1:e>f?1:0}});c.exports=j}),define("stache!templates/settings/clients",["mustache"],function(a){return a.compile('<div id="clients" class="settings-unit {{#isPanelOpen}}open{{/isPanelOpen}}">\n  <div class="settings-unit-stub">\n    <header class="settings-unit-summary">\n      <h2 class="settings-unit-title">{{#t}}Devices & apps{{/t}}</h2>\n    </header>\n    <button class="settings-button secondary settings-unit-toggle hidden"\n      data-href="settings/clients">\n      {{#t}}Show{{/t}}\n    </button>\n  </div>\n\n  <div class="settings-unit-details">\n    <div class="error"></div>\n\n    <form novalidate>\n      <ul class="client-list button-row">\n        {{#clients}}\n\n            {{#isDevice}}\n              <li class="client {{type}} client-device {{#isCurrentDevice}}client-current{{/isCurrentDevice}}"\n                {{#genericOS}}data-os="{{genericOS}}"{{/genericOS}}\n                data-name="{{name}}"\n                id="{{id}}">\n                <div class="client-name" title="{{title}}">{{name}}</div>\n                {{#isCurrentDevice}}\n                    <div class="device-current">{{#t}}current device{{/t}}</div>\n                {{/isCurrentDevice}}\n                {{^isCurrentDevice}}\n                    <div class="last-connected">{{lastAccessTimeFormatted}}</div>\n                {{/isCurrentDevice}}\n                <button class="settings-button warning client-disconnect" data-id="{{id}}" data-type="{{clientType}}">{{#t}}Disconnect{{/t}}</button>\n              </li>\n            {{/isDevice}}\n\n            {{#areWebSessionsVisible}}\n            {{#isWebSession}}\n                <li class="client {{type}} client-webSession"\n                    {{#genericOS}}data-os="{{genericOS}}"{{/genericOS}}\n                    data-name="{{name}}"\n                    id="{{id}}">\n                    <div class="client-name" title="{{title}}">{{title}}</div>\n                  {{#isCurrentDevice}}\n                    <div class="device-current">{{#t}}current session{{/t}}</div>\n                  {{/isCurrentDevice}}\n                  {{^isCurrentDevice}}\n                    <div class="last-connected">{{lastAccessTimeFormatted}}</div>\n                  {{/isCurrentDevice}}\n                    <button class="settings-button warning client-disconnect" data-id="{{id}}" data-type="{{clientType}}">{{#t}}Disconnect{{/t}}</button>\n                </li>\n            {{/isWebSession}}\n            {{/areWebSessionsVisible}}\n\n            {{#isOAuthApp}}\n                <li class="client {{type}} client-oAuthApp" data-name="{{name}}" id="{{id}}">\n                  <div class="client-name" title="{{title}}">{{name}}</div>\n                    <div class="last-connected">{{userAgent}} {{lastAccessTimeFormatted}}</div>\n                  <button class="settings-button warning client-disconnect" data-id="{{id}}" data-type="{{clientType}}">{{#t}}Disconnect{{/t}}</button>\n                </li>\n            {{/isOAuthApp}}\n\n        {{/clients}}\n        {{#showMobileApps}}\n          <li class="client mobile" data-os="iOS">\n            <div class="client-name">{{#t}}Firefox for iOS{{/t}}</div>\n            <div class="last-connected">{{#t}}none connected{{/t}}</div>\n            <a target="_blank" href="{{ linkIOS }}" class="settings-button secondary" data-get-app="ios">{{#t}}Download{{/t}}</a>\n          </li>\n          <li class="client mobile" data-os="Android">\n            <div class="client-name">{{#t}}Firefox for Android{{/t}}</div>\n            <div class="last-connected">{{#t}}none connected{{/t}}</div>\n            <a target="_blank" href="{{ linkAndroid }}" class="settings-button secondary" data-get-app="android">{{#t}}Download{{/t}}</a>\n          </li>\n        {{/showMobileApps}}\n        <a href="{{devicesSupportUrl}}" target="_blank" class="device-support">{{#t}}Missing or duplicate items?{{/t}}</a>\n      </ul>\n\n      <div class="button-row">\n        <button type="submit" class="settings-button primary clients-refresh">{{#t}}Refresh{{/t}}</button>\n        <button class="settings-button secondary cancel">{{#t}}Done{{/t}}</button>\n      </div>\n    </form>\n  </div>\n</div>\n')}),define("views/settings/clients",["require","exports","module","underscore","jquery","models/attached-clients","cocktail","lib/constants","views/form","views/base","views/mixins/settings-panel-mixin","views/mixins/signed-out-notification-mixin","lib/strings","views/base","stache!templates/settings/clients","lib/user-agent-mixin"],function(a,b,c){"use strict";var d=a("underscore"),e=a("jquery"),f=a("models/attached-clients"),g=a("cocktail"),h=a("lib/constants"),i=a("views/form"),j=a("views/base").preventDefaultThen,k=a("views/mixins/settings-panel-mixin"),l=a("views/mixins/signed-out-notification-mixin"),m=a("lib/strings"),n=a("views/base"),o=n.t,p=a("stache!templates/settings/clients"),q=a("lib/user-agent-mixin"),r=m.interpolate(h.DOWNLOAD_LINK_TEMPLATE_ANDROID,{campaign:"fxa-devices-page",creative:"button"}),s=m.interpolate(h.DOWNLOAD_LINK_TEMPLATE_IOS,{campaign:"fxa-devices-page",creative:"button"}),t=i.prototype,u=i.extend({template:p,className:"clients",viewName:"settings.clients",initialize:function(a){this._able=a.able,this._attachedClients=a.attachedClients,this._attachedClients||(this._attachedClients=new f([],{notifier:a.notifier})),this.listenTo(this._attachedClients,"remove",this._onItemRemoved)},_formatAccessTimeAndScope:function(a){var b=this;return d.map(a,function(a){return a.title=a.name,a.scope&&(a.title+=" - "+a.scope),a.lastAccessTimeFormatted?(a.isWebSession&&(a.title=b.translate(o("Web Session, %(userAgent)s"),{userAgent:a.userAgent}),a.lastAccessTimeFormatted=b.translate(o("%(translatedTimeAgo)s"),{translatedTimeAgo:a.lastAccessTimeFormatted})),a.isDevice&&(a.lastAccessTimeFormatted=b.translate(o("started syncing %(translatedTimeAgo)s"),{translatedTimeAgo:a.lastAccessTimeFormatted})),a.clientType===h.CLIENT_TYPE_OAUTH_APP&&(a.lastAccessTimeFormatted=b.translate(o("last active %(translatedTimeAgo)s"),{translatedTimeAgo:a.lastAccessTimeFormatted}))):a.lastAccessTimeFormatted="",a})},context:function(){var a=this._attachedClients.toJSON();return{areWebSessionsVisible:this._areWebSessionsVisible(),clients:this._formatAccessTimeAndScope(a),devicesSupportUrl:"https://support.mozilla.org/kb/fxa-managing-devices?utm_source=accounts.firefox.com&utm_medium=referral&utm_campaign=fxa-devices",isPanelOpen:this.isPanelOpen(),linkAndroid:r,linkIOS:s,showMobileApps:this._showMobileApps(a)}},events:{"click .client-disconnect":j("_onDisconnectClient"),"click .clients-refresh":"startRefresh","click [data-get-app]":"_onGetApp"},_areWebSessionsVisible:function(){return!!this.getSearchParam("sessionsListVisible")},_showMobileApps:function(a){return!this.broker.hasCapability("convertExternalLinksToText")&&!d.some(a,function(a){return"mobile"===a.type||"tablet"===a.type})},_onItemRemoved:function(a){var b=this,c=a.get("id");e("#"+c).slideUp(150,function(){b.render()})},_onDisconnectClient:function(a){var b=this,c=this._attachedClients.get(e(a.currentTarget).data("id")),d=c.get("clientType");this.logViewEvent(d+".disconnect"),d===h.CLIENT_TYPE_DEVICE?this.navigate("settings/clients/disconnect",{clientId:c.get("id"),clients:this._attachedClients}):this.user.destroyAccountClient(this.user.getSignedInAccount(),c).then(function(){if(d===h.CLIENT_TYPE_WEB_SESSION)return b.user.sessionStatus().then(null,function(){b.clearSessionAndNavigateToSignIn()})})},_onGetApp:function(a){var b=this.$el.find(a.currentTarget).data("get-app");this.logViewEvent("get."+b)},openPanel:function(){return this.logViewEvent("open"),this.validateAndSubmit()},_fetchAttachedClients:function(){var a=this;return this._attachedClients.fetchClients({oAuthApps:!0,sessions:!0},this.user).then(function(){var b=a._attachedClients.length,c="settings.clients.items";0===b?a.logEventOnce(c+".zero"):1===b?a.logEventOnce(c+".one"):2===b?a.logEventOnce(c+".two"):a.logEventOnce(c+".many")})},startRefresh:function(){this.$(".clients-refresh").data("minProgressIndicatorMs",u.MIN_REFRESH_INDICATOR_MS),this.logViewEvent("refresh")},submit:function(){if(this.isPanelOpen())return this._fetchAttachedClients()},afterSubmit:function(){var a=this;return t.afterSubmit.call(this).then(function(){return a.render()})}},{MIN_REFRESH_INDICATOR_MS:1600});g.mixin(u,k,l,q),c.exports=u}),define("stache!templates/settings/communication_preferences",["mustache"],function(a){return a.compile('<div id="communication-preferences" class="settings-unit{{#isPanelOpen}} open{{/isPanelOpen}} {{#isBasketReady}}basket-ready{{/isBasketReady}}">\n  <div class="settings-unit-stub">\n    <header class="settings-unit-summary">\n      <h2 class="settings-unit-title">{{#t}}Communication preferences{{/t}}</h2>\n    </header>\n    <button class="settings-button secondary settings-unit-toggle hidden"\n      data-href="settings/communication_preferences">{{#t}}Change{{/t}}</button>\n  </div>\n\n  <div class="settings-unit-details">\n  {{#error}}\n    <div class="error visible nudge">\n      {{error}}\n    </div>\n    <form novalidate>\n      <div class="button-row">\n        <button class="settings-button secondary cancel unpaired">{{#t}}Cancel{{/t}}</button>\n      </div>\n    </form>\n  {{/error}}\n  {{^error}}\n    <div class="error"></div>\n\n    <form novalidate>\n      <p>\n        {{#t}}Receive the monthly Firefox newsletter.{{/t}}\n        {{#preferencesUrl}}\n          <a href="{{preferencesUrl}}" id="preferences-url" class="right" target="_blank">{{#t}}Email preferences{{/t}}</a>\n        {{/preferencesUrl}}\n      </p>\n\n      <div class="button-row">\n        <button type="submit" id="marketing-email-optin" class="marketing-email-optin settings-button primary" autofocus>\n          {{#isOptedIn}}\n            {{#t}}Unsubscribe{{/t}}\n          {{/isOptedIn}}\n          {{^isOptedIn}}\n            {{#t}}Subscribe{{/t}}\n          {{/isOptedIn}}\n        </button>\n        <button class="settings-button secondary cancel">{{#t}}Cancel{{/t}}</button>\n\n      </div>\n    </form>\n  {{/error}}\n  </div>\n</div>\n')}),define("lib/xss",["require","exports","module","underscore","lib/constants"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants");c.exports={href:function(a){if(d.isString(a)&&/^https?:\/\//.test(a)){var b=encodeURI(a);if(!(b.length>e.URL_MAX_LENGTH))return b}}}}),define("views/settings/communication_preferences",["require","exports","module","views/base","cocktail","lib/constants","views/form","lib/marketing-email-errors","lib/metrics","views/mixins/settings-panel-mixin","stache!templates/settings/communication_preferences","lib/xss"],function(a,b,c){"use strict";var d=a("views/base"),e=a("cocktail"),f=a("lib/constants"),g=a("views/form"),h=a("lib/marketing-email-errors"),i=a("lib/metrics"),j=a("views/mixins/settings-panel-mixin"),k=a("stache!templates/settings/communication_preferences"),l=a("lib/xss"),m=f.MARKETING_EMAIL_NEWSLETTER_ID,n=d.t,o=g.extend({template:k,className:"communication-preferences",viewName:"settings.communication-preferences",getMarketingEmailPrefs:function(){return this._marketingEmailPrefs||(this._marketingEmailPrefs=this.getSignedInAccount().getMarketingEmailPrefs()),this._marketingEmailPrefs},_isBasketReady:!1,afterVisible:function(){var a=this;return this.getMarketingEmailPrefs().fetch().fail(function(b){if(!h.is(b,"UNKNOWN_EMAIL")){h.is(b,"UNKNOWN_ERROR")?a._error=a.translateError(h.toError("SERVICE_UNAVAILABLE")):a._error=a.translateError(b),b=a._normalizeError(b);var c=i.prototype.errorToId(b);b.code=b.code||"unknown",c=c+"."+b.code,a.logEvent(c)}}).then(function(){return a._isBasketReady=!0,a.render()})},context:function(){var a=this.getMarketingEmailPrefs(),b=a.isOptedIn(m);return this.logViewEvent("newsletter.optin."+String(b)),{error:this._error,isBasketReady:!!this._isBasketReady,isOptedIn:b,isPanelOpen:this.isPanelOpen(),preferencesUrl:l.href(a.get("preferencesUrl"))}},submit:function(){var a=this.getMarketingEmailPrefs();return this.setOptInStatus(m,!a.isOptedIn(m))},setOptInStatus:function(a,b){var c=this,d=b?"optIn":"optOut";return this.logViewEvent(d),this.getMarketingEmailPrefs()[d](a).then(function(){c.logViewEvent(d+".success");var a=n(b?"Subscribed successfully":"Unsubscribed successfully");return c.displaySuccess(a),c.navigate("settings"),c.render()},function(a){return c.displayError(a)})}});e.mixin(o,j),c.exports=o}),define("views/mixins/flow-events-mixin",["require","exports","module","jquery","lib/key-codes"],function(a,b,c){"use strict";var d=a("jquery"),e=a("lib/key-codes");c.exports={afterRender:function(){this.notifier.trigger("flow.initialize")},events:{"click a":"_clickFlowEventsLink","click input":"_engageFlowEventsForm","input input":"_engageFlowEventsForm","keyup input":"_keyupFlowEventsInput",submit:"_submitFlowEventsForm"},_clickFlowEventsLink:function(a){if(a&&a.currentTarget){var b=d(a.currentTarget).data("flowEvent");b&&this.logFlowEvent(b,this.viewName)}},_engageFlowEventsForm:function(){this.logFlowEventOnce("engage",this.viewName)},_keyupFlowEventsInput:function(a){a.which!==e.TAB||a.metaKey||a.ctrlKey||a.altKey||this._engageFlowEventsForm()},_submitFlowEventsForm:function(){this.isFormEnabled()&&this.logFlowEvent("submit",this.viewName)}}}),define("views/mixins/resume-token-mixin",["require","exports","module","underscore","models/resume-token"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/resume-token");c.exports={getResumeToken:function(a){var b=a.pickResumeTokenInfo(),c=this.relier.pickResumeTokenInfo(),f=this.user.pickResumeTokenInfo(),g=void 0,h=this.metrics.getFlowModel();h&&(g=h.pickResumeTokenInfo());var i=d.extend({},g,c,f,b);return new e(i)},getStringifiedResumeToken:function(a){return this.getResumeToken(a).stringify()}}}),define("views/mixins/password-reset-mixin",["require","exports","module","underscore","views/mixins/resume-token-mixin"],function(a,b,c){"use strict";var d=a("underscore"),e=a("views/mixins/resume-token-mixin");c.exports=d.extend({resetPassword:function(a){var b=this,c=this.user.initAccount({email:a});return c.resetPassword(this.relier,{resume:this.getStringifiedResumeToken(c)}).then(function(c){return b.navigate("confirm_reset_password",{email:a,passwordForgotToken:c.passwordForgotToken},{clearQueryParams:!0}),c})},retryResetPassword:function(a,b){var c=this.user.initAccount({email:a});return c.retryResetPassword(b,this.relier,{resume:this.getStringifiedResumeToken(c)})}},e)}),define("models/email-resend",["require","exports","module","backbone","lib/constants"],function(a,b,c){"use strict";function d(a,b){return a<=b}var e=a("backbone"),f=a("lib/constants"),g=e.Model.extend({defaults:{tries:0},initialize:function(a){a=a||{},this.maxTries=a.maxTries||f.EMAIL_RESEND_MAX_TRIES},incrementRequestCount:function(){var a=this.get("tries")+1;this.set("tries",a),a>=this.maxTries&&this.trigger("maxTriesReached")},shouldResend:function(){return d(this.get("tries"),this.maxTries)},reset:function(){this.set("tries",0)}});c.exports=g}),define("views/mixins/resend-mixin",["require","exports","module","underscore","duration","models/email-resend","lib/promise","views/base"],function(a,b,c){"use strict";var d=a("underscore"),e=a("duration"),f=a("models/email-resend"),g=a("lib/promise"),h=a("views/base"),i=h.preventDefaultThen,j=h.t,k=new e("5m").milliseconds();c.exports=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=d.defaults(a,{successMessage:j("Email resent")}),c=b.successMessage;return{initialize:function(){this._emailResend=new f,this.listenTo(this._emailResend,"maxTriesReached",this._onMaxTriesReached)},events:{"click #resend":i("_resend")},_resend:function(){var a=this;return g().then(function(){if(a.logViewEvent("resend"),a._updateSuccessMessage(),a._emailResend.incrementRequestCount(),a._emailResend.shouldResend())return a.resend().then(function(){c&&a.displaySuccess(c)}).fail(function(b){return a.displayError(b)})})},_updateSuccessMessage:function(){var a=this.$(".success:visible");a&&a.one("animationend",function(){a.removeClass("shake")}).addClass("shake")},_onMaxTriesReached:function(){var a=this;this.logViewEvent("too_many_attempts"),this.$("#resend").hide(),this.setTimeout(function(){a._emailResend.reset(),a.$("#resend").show()},k)}}}}),define("stache!templates/complete_reset_password",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  {{#isLinkExpired}}\n  <header>\n    <h1 id="fxa-reset-link-expired-header">{{#t}}Reset password link expired{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <p>\n      {{#t}}The link you clicked to reset your password is expired.{{/t}}\n    </p>\n\n    <div class="links">\n      <a id="resend" class="resend-email" href="#">{{#t}}Click here to receive a new reset link{{/t}}</a>\n    </div>\n  </section>\n  {{/isLinkExpired}}\n\n  {{#isLinkDamaged}}\n  <header>\n    <h1 id="fxa-reset-link-damaged-header">{{#t}}Reset password link damaged{{/t}}</h1>\n  </header>\n\n  <section>\n    <p>\n      {{#t}}The link you clicked was missing characters, and may have been broken by your email client. Copy the address carefully, and try again.{{/t}}\n    </p>\n  </section>\n  {{/isLinkDamaged}}\n\n  {{#isLinkValid}}\n  <header>\n    <h1 id="fxa-complete-reset-password-header">{{#t}}Enter new password{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n\n    <form novalidate>\n      {{#showSyncWarning}}\n      <p class="reset-warning reset-warning-complete-password">\n        {{#t}}Once you submit your new password, you will lose any Sync data that is not on one of your devices.{{/t}}\n        <a href="https://support.mozilla.org/products/firefox/sync" target="_blank">{{#t}}Learn how Sync works.{{/t}}</a>\n      </p>\n      {{/showSyncWarning}}\n\n      \x3c!-- hidden email field is to allow Fx password manager\n           to correctly save the updated password. Without it,\n           the password manager tries to save the old password\n           as the username. --\x3e\n      <input type="email" value="{{email}}" class="hidden" />\n\n      <div class="input-row password-row">\n        <label class="label-helper"></label>\n        <input type="password" class="password check-password tooltip-below" id="password" placeholder="{{#t}}New password{{/t}}" pattern=".{8,}" required autofocus data-synchronize-show="true"/>\n\n        <div class="input-help input-help-complete-password">{{#t}}Must be at least 8 characters{{/t}}</div>\n      </div>\n\n\n      <div class="input-row password-row">\n        <label class="label-helper"></label>\n        <input type="password" class="password tooltip-below" id="vpassword" placeholder="{{#t}}Repeat password{{/t}}" required pattern=".{8,}" data-synchronize-show="true"/>\n      </div>\n\n      <div class="button-row">\n        <button type="submit" class="disabled">{{#t}}Submit new password{{/t}}</button>\n      </div>\n    </form>\n  </section>\n  {{/isLinkValid}}\n</div>\n')}),define("models/verification/base",["require","exports","module","underscore","backbone","lib/vat"],function(a,b,c){"use strict";var d=a("underscore"),e=a("backbone"),f=a("lib/vat"),g=e.Model.prototype,h=e.Model.extend({initialize:function(a){g.initialize.call(this,a),d.each(this.defaults,function(a,b){if(this.has(b)){var c=this.get(b).replace(/ /g,"");c?this.set(b,c):this.unset(b)}},this)},defaults:{},validation:{},isValid:function(){var a;if(this.isDamaged())return!1;try{a=g.isValid.call(this)}catch(b){a=!1}return a},validate:function(a){var b=f.validate(a,this.validation,{allowUnknown:!0});if(b.error)throw b.error},markExpired:function(){this._isExpired=!0},isExpired:function(){return!!this._isExpired},markUsed:function(){this._isUsed=!0},isUsed:function(){return!!this._isUsed},markDamaged:function(){this._isDamaged=!0},isDamaged:function(){return!!this._isDamaged}});c.exports=h}),define("models/verification/reset-password",["require","exports","module","lib/vat","./base"],function(a,b,c){"use strict";var d=a("lib/vat"),e=a("./base");c.exports=e.extend({defaults:{code:null,email:null,token:null},validation:{code:d.verificationCode().required(),email:d.email().required(),token:d.token().required()}})}),define("views/complete_reset_password",["require","exports","module","lib/auth-errors","cocktail","views/mixins/floating-placeholder-mixin","views/form","views/mixins/flow-events-mixin","lib/channels/notifier","views/mixins/password-mixin","views/mixins/password-reset-mixin","views/mixins/resend-mixin","views/mixins/service-mixin","stache!templates/complete_reset_password","lib/url","models/verification/reset-password"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("cocktail"),f=a("views/mixins/floating-placeholder-mixin"),g=a("views/form"),h=a("views/mixins/flow-events-mixin"),i=a("lib/channels/notifier"),j=a("views/mixins/password-mixin"),k=a("views/mixins/password-reset-mixin"),l=a("views/mixins/resend-mixin")(),m=a("views/mixins/service-mixin"),n=a("stache!templates/complete_reset_password"),o=a("lib/url"),p=a("models/verification/reset-password"),q=g.prototype,r=g.extend({template:n,className:"complete-reset-password",initialize:function(a){a=a||{};var b=o.searchParams(this.window.location.search);this._verificationInfo=new p(b)},getAccount:function(){var a=this._verificationInfo.get("email");return this.user.initAccount({email:a})},beforeRender:function(){var a=this,b=this._verificationInfo;if(!b.isValid())return void this.logError(d.toError("DAMAGED_VERIFICATION_LINK"));var c=this.getAccount(),e=b.get("token");return c.isPasswordResetComplete(e).then(function(c){c&&(b.markExpired(),a.logError(d.toError("EXPIRED_VERIFICATION_LINK")))})},afterVisible:function(){return this.notifier.triggerRemote(i.COMPLETE_RESET_PASSWORD_TAB_OPEN),q.afterVisible.call(this)},context:function(){var a=this._verificationInfo,b=a.isValid(),c=a.isExpired(),d=this.relier.get("resetPasswordConfirm");return{email:a.get("email"),isLinkDamaged:!b,isLinkExpired:c,isLinkValid:b&&!c,showSyncWarning:d}},isValidEnd:function(){return this._getPassword()===this._getVPassword()},showValidationErrorsEnd:function(){if(this._getPassword()!==this._getVPassword()){var a=d.toError("PASSWORDS_DO_NOT_MATCH");this.displayError(a)}},submit:function(){var a=this,b=this._verificationInfo,c=this._getPassword(),e=b.get("token"),f=b.get("code"),g=this.getAccount();return this.user.completeAccountPasswordReset(g,c,e,f,this.relier).then(function(b){return a.relier.set("resetPasswordConfirm",!0),a.logViewEvent("verification.success"),a.invokeBrokerMethod("afterCompleteResetPassword",b)}).then(function(){a.navigate("reset_password_verified")}).fail(function(b){if(d.is(b,"INVALID_TOKEN"))return a.logError(b),a.render();throw b})},_getPassword:function(){
return this.$("#password").val()},_getVPassword:function(){return this.$("#vpassword").val()},resend:function(){return this.resetPassword(this._verificationInfo.get("email"))}});e.mixin(r,f,h,j,k,l,m),c.exports=r}),define("stache!templates/complete_sign_up",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  {{#isLinkUsed}}\n  <header>\n    <h1 id="fxa-verification-link-reused-header">{{#t}}Sign-in already confirmed{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <p>\n      {{#t}}That confirmation link was already used, and can only be used once.{{/t}}\n    </p>\n\n  </section>\n  {{/isLinkUsed}}\n  \n  {{#isLinkExpired}}\n  <header>\n    <h1 id="fxa-verification-link-expired-header">{{#t}}Verification link expired{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <p>\n      {{#t}}The link you clicked to verify your email is expired.{{/t}}\n    </p>\n\n    {{#canResend}}\n    <div class="links">\n      <a id="resend" class="resend-email" href="#">{{#t}}Click here to receive a new verification link{{/t}}</a>\n    </div>\n    {{/canResend}}\n  </section>\n  {{/isLinkExpired}}\n\n  {{#isLinkDamaged}}\n  <header>\n    <h1 id="fxa-verification-link-damaged-header">{{#t}}Verification link damaged{{/t}}</h1>\n  </header>\n\n  <section>\n    <p>\n      {{#t}}The link you clicked was missing characters, and may have been broken by your email client. Copy the address carefully, and try again.{{/t}}\n    </p>\n  </section>\n  {{/isLinkDamaged}}\n\n  {{#error}}\n  <header>\n    <h1 id="fxa-verification-error-header">{{#t}}Verification error{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n  </section>\n  {{/error}}\n</div>\n')}),define("views/mixins/connect-another-device-mixin",["require","exports","module","lib/promise"],function(a,b,c){"use strict";var d=a("lib/promise");return{isEligibleForConnectAnotherDevice:function(a){return this.isSignUp()&&!this.user.isAnotherAccountSignedIn(a)},navigateToConnectAnotherDeviceScreen:function(a){var b=this;return this.isEligibleForConnectAnotherDevice(a)?this._isEligibleForSms(a).then(function(c){var d=c.ok,e=c.country;if(d){var f=b.getExperimentGroup("sendSms",{account:a});b.createExperiment("sendSms",f),"treatment"===f?b.navigate("sms",{account:a,country:e}):b.navigate("connect_another_device",{account:a})}else b.navigate("connect_another_device",{account:a})}):d.reject(new Error("chooseConnectAnotherDeviceScreen can only be called if user is eligible to connect another device"))},_isEligibleForSms:function(a){return d(this._areSmsRequirementsMet(a)&&this._smsCountry(a)).then(function(a){return{country:a,ok:!!a}})},_areSmsRequirementsMet:function(a){return this.isSignUp()&&!this.getUserAgent().isAndroid()&&!this.getUserAgent().isIos()&&!this.user.isAnotherAccountSignedIn(a)&&this.isInExperiment("sendSms",{account:a})},_smsCountry:function(a){var b=this;return a.smsStatus(this.relier.pick("country")).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=a.country||"US";if(a.ok&&b.isInExperiment("sendSmsEnabledForCountry",{country:c}))return c},function(a){a.context=b.getViewName()+".smsStatus",b.logError(a)})}}}),define("models/verification/sign-up",["require","exports","module","lib/vat","./base"],function(a,b,c){"use strict";var d=a("lib/vat"),e=a("./base");c.exports=e.extend({defaults:{code:null,reminder:null,type:null,uid:null},validation:{code:d.verificationCode().required(),uid:d.uid().required()}})}),define("views/mixins/verification-reason-mixin",["require","exports","module","underscore","lib/verification-reasons"],function(a,b,c){"use strict";function d(a,b){return e.findKey(a,function(a){return a===b})}var e=a("underscore"),f=a("lib/verification-reasons");c.exports={initialize:function(a){this.model.has("type")||this.model.set("type",a.type||f.SIGN_UP)},isSignIn:function(){return this.model.get("type")===f.SIGN_IN},isSignUp:function(){return this.model.get("type")===f.SIGN_UP},keyOfVerificationReason:function(a){return d(f,a)}}}),define("views/complete_sign_up",["require","exports","module","lib/auth-errors","views/base","cocktail","stache!templates/complete_sign_up","views/mixins/connect-another-device-mixin","views/mixins/experiment-mixin","lib/marketing-email-errors","lib/promise","views/mixins/resend-mixin","views/mixins/resume-token-mixin","lib/user-agent-mixin","models/verification/sign-up","views/mixins/verification-reason-mixin"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/base"),f=a("cocktail"),g=a("stache!templates/complete_sign_up"),h=a("views/mixins/connect-another-device-mixin"),i=a("views/mixins/experiment-mixin"),j=a("lib/marketing-email-errors"),k=a("lib/promise"),l=a("views/mixins/resend-mixin")(),m=a("views/mixins/resume-token-mixin"),n=e.t,o=a("lib/user-agent-mixin"),p=a("models/verification/sign-up"),q=a("views/mixins/verification-reason-mixin"),r=e.extend({template:g,className:"complete_sign_up",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._verificationInfo=new p(this.getSearchParams());var b=this._verificationInfo.get("uid"),c=a.account||this.user.getAccountByUid(b);c.isDefault()&&c.set("uid",b),this._account=c,this._email=this._account.get("email")},getAccount:function(){return this._account},beforeRender:function(){var a=this,b=this._verificationInfo;if(!b.isValid())return this.logError(d.toError("DAMAGED_VERIFICATION_LINK")),!0;var c=this.getAccount();c.populateFromStringifiedResumeToken(this.getSearchParam("resume"));var e=b.get("code"),f={reminder:b.get("reminder"),secondaryEmailVerified:this.getSearchParam("secondary_email_verified")||null,serverVerificationStatus:this.getSearchParam("server_verification")||null,service:this.relier.get("service")||null,type:b.get("type")};return this.user.completeAccountSignUp(c,e,f).fail(function(b){return a._logAndAbsorbMarketingClientErrors(b)}).then(function(){return a._notifyBrokerAndComplete(c)}).fail(function(b){return a._handleVerificationErrors(b)})},context:function(){var a=this._verificationInfo;return{canResend:this._canResend(),error:this.model.get("error"),isLinkDamaged:!a.isValid(),isLinkExpired:a.isExpired(),isLinkUsed:a.isUsed()}},_logAndAbsorbMarketingClientErrors:function(a){if(!j.created(a))throw a;this.logError(a)},_notifyBrokerAndComplete:function(a){var b=this;return this.logViewEvent("verification.success"),this.notifier.trigger("verification.success"),this.isSignIn()&&this.logEvent("signin.success"),this.user.setAccount(a),this.invokeBrokerMethod("afterCompleteSignUp",a).then(function(){return b._navigateToNextScreen()})},_navigateToNextScreen:function(){var a=this,b=this.getAccount(),c=this.relier;return k().then(function(){if(c.isSync()){if(a.isEligibleForConnectAnotherDevice(b))return a.navigateToConnectAnotherDeviceScreen(b);a._navigateToVerifiedScreen()}else{if(!c.isOAuth())return b.isSignedIn().then(function(b){b?a.navigate("settings",{success:n("Account verified successfully")}):a._navigateToVerifiedScreen()});a._navigateToVerifiedScreen()}})},_navigateToVerifiedScreen:function(){this.getSearchParam("secondary_email_verified")?this.navigate("secondary_email_verified"):this.isSignUp()?this.navigate("signup_verified"):this.navigate("signin_verified")},_handleVerificationErrors:function(a){var b=this._verificationInfo;d.is(a,"UNKNOWN_ACCOUNT")?(b.markExpired(),a=d.toError("UNKNOWN_ACCOUNT_VERIFICATION")):d.is(a,"INVALID_VERIFICATION_CODE")||d.is(a,"INVALID_PARAMETER")?this.isSignIn()?(b.markUsed(),a=d.toError("REUSED_SIGNIN_VERIFICATION_CODE")):(b.markDamaged(),a=d.toError("DAMAGED_VERIFICATION_LINK")):this.model.set("error",a),this.logError(a)},_canResend:function(){return!!this._hasResendSessionToken()&&this.isSignUp()},_hasResendSessionToken:function(){return!!this.user.getAccountByEmail(this._email).get("sessionToken")},resend:function(){var a=this,b=this.user.getAccountByEmail(this._email);return b.retrySignUp(this.relier,{resume:this.getStringifiedResumeToken(b)}).fail(function(b){if(d.is(b,"INVALID_TOKEN"))return a.navigate("signup",{error:b});throw b})}});f.mixin(r,h,i,l,m,o,q),c.exports=r}),define("models/marketing-email-prefs",["require","exports","module","underscore","backbone","lib/promise"],function(a,b,c){"use strict";var d=a("underscore"),e=a("backbone"),f=a("lib/promise"),g=e.Model.extend({defaults:{newsletters:[],preferencesUrl:null,token:null},initialize:function(a){a=a||{},this._marketingEmailClient=a.marketingEmailClient,this._account=a.account},_withMarketingEmailClient:function(a){var b=this,c=this._marketingEmailClient,d=[].slice.call(arguments,1);return f().then(function(){return b._account.createOAuthToken("basket:write profile:email")}).then(function(e){return b._accessToken=e,d.unshift(e.get("token")),c[a].apply(c,d)}).fin(function(){b._accessToken&&b._accessToken.destroy(),b._accessToken=null})},fetch:function(){var a=this;return this._withMarketingEmailClient("fetch").then(function(b){if(b){b.newsletters=b.newsletters||[];for(var c in b)a.set(c,b[c])}})},optIn:function(a){var b=this;return this.isOptedIn(a)?f():this._withMarketingEmailClient("optIn",a).then(function(){var c=b.get("newsletters");c.push(a),b.set("newsletters",c)})},optOut:function(a){var b=this;return this.isOptedIn(a)?this._withMarketingEmailClient("optOut",a).then(function(){var c=d.without(b.get("newsletters"),a);b.set("newsletters",c)}):f()},isOptedIn:function(a){return-1!==this.get("newsletters").indexOf(a)}});c.exports=g}),define("models/oauth-token",["require","exports","module","backbone"],function(a,b,c){"use strict";var d=a("backbone"),e=d.Model.extend({defaults:{token:void 0},initialize:function(a){a=a||{},this._oAuthClient=a.oAuthClient,this.set("token",a.token)},destroy:function(){return this._oAuthClient.destroyToken(this.get("token"))}});c.exports=e}),define("models/account",["require","exports","module","underscore","lib/auth-errors","backbone","cocktail","lib/constants","models/marketing-email-prefs","lib/oauth-errors","models/oauth-token","lib/promise","lib/profile-errors","models/profile-image","models/mixins/resume-token","lib/sign-in-reasons","lib/user-agent","lib/vat"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("backbone"),g=a("cocktail"),h=a("lib/constants"),i=a("models/marketing-email-prefs"),j=a("lib/oauth-errors"),k=a("models/oauth-token"),l=a("lib/promise"),m=a("lib/profile-errors"),n=a("models/profile-image"),o=a("models/mixins/resume-token"),p=a("lib/sign-in-reasons"),q=a("lib/user-agent"),r=a("lib/vat"),s=h.MARKETING_EMAIL_NEWSLETTER_ID,t={displayName:void 0,email:void 0,grantedPermissions:void 0,hadProfileImageSetBefore:void 0,lastLogin:void 0,needsOptedInToMarketingEmail:void 0,permissions:void 0,profileImageId:void 0,profileImageUrl:void 0,sessionToken:void 0,sessionTokenContext:void 0,uid:void 0,verified:void 0},u=d.extend({accessToken:void 0,customizeSync:void 0,declinedSyncEngines:void 0,keyFetchToken:void 0,unwrapBKey:void 0,verificationMethod:void 0,verificationReason:void 0},t),v=Object.keys(u),w=Object.keys(t),x={"profile:avatar":"profileImageUrl","profile:display_name":"displayName","profile:email":"email","profile:uid":"uid"},y=f.Model.extend({defaults:u,initialize:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._oAuthClientId=b.oAuthClientId,this._oAuthClient=b.oAuthClient,this._assertion=b.assertion,this._profileClient=b.profileClient,this._fxaClient=b.fxaClient,this._marketingEmailClient=b.marketingEmailClient,this._metrics=b.metrics,this._sentryMetrics=b.sentryMetrics,this._assertionPromises={},this._upgradeGrantedPermissions(),this._boundOnChange=this.onChange.bind(this),this.on("change",this._boundOnChange)},resumeTokenFields:["email"],resumeTokenSchema:{email:r.email()},fetch:function(){var a=this;return!this.get("sessionToken")||this.get("verified")?l():this.sessionStatus().fail(function(b){if(e.is(b,"INVALID_TOKEN"))return a._invalidateSession();!e.is(b,"UNAUTHORIZED")&&a._sentryMetrics&&a._sentryMetrics.captureException(b)})},_invalidateSession:function(){this.set({accessToken:null,sessionToken:null,sessionTokenContext:null})},_fetchProfileOAuthToken:function(){var a=this;return this.createOAuthToken("profile profile:write clients:write").then(function(b){a.set("accessToken",b.get("token"))})},profileClient:function(){var a=this;return this.fetch().then(function(){if(!a.get("verified"))throw e.toError("UNVERIFIED_ACCOUNT");if(a._needsAccessToken())return a._fetchProfileOAuthToken()}).then(function(){return a._profileClient})},isFromSync:function(){return this.get("sessionTokenContext")===h.SESSION_TOKEN_USED_FOR_SYNC},isDefault:function(){var a=this;return!d.find(v,function(b){return a.get(b)!==u[b]})},_needsAccessToken:function(){return this.get("verified")&&!this.get("accessToken")},_generateAssertion:function(){var a=this.get("sessionToken");if(!a)return l.reject(e.toError("INVALID_TOKEN"));var b=this._assertionPromises[a];if(b)return b;var c=this._assertion.generate(a);return this._assertionPromises[a]=c,c},createOAuthToken:function(a){var b=this;return this._generateAssertion().then(function(c){var d={assertion:c,client_id:b._oAuthClientId,scope:a};return b._oAuthClient.getToken(d)}).then(function(a){return new k({oAuthClient:b._oAuthClient,token:a.access_token})})},sessionStatus:function(){var a=this,b=this.get("sessionToken");return b?this._fxaClient.recoveryEmailStatus(b).then(function(b){return a.set(b),b},function(b){throw e.is(b,"INVALID_TOKEN")&&a.unset("sessionToken"),b}):l.reject(e.toError("INVALID_TOKEN"))},sessionVerificationStatus:function(){var a=this,b=this.get("sessionToken");return b?this._fxaClient.sessionVerificationStatus(b).then(function(a){return a},function(b){throw e.is(b,"INVALID_TOKEN")&&a.unset("sessionToken"),b}):l.reject(e.toError("INVALID_TOKEN"))},waitForSessionVerification:function(a){var b=this;return this.sessionStatus().then(function(c){if(!c.verified)return l().delay(a).then(function(){return b.waitForSessionVerification(a)})}).fail(function(a){if(e.is(a,"INVALID_TOKEN")&&b.has("uid"))return b.checkUidExists().then(function(b){if(!b)throw e.toError("SIGNUP_EMAIL_BOUNCE");throw a});throw a})},isSignedIn:function(){return this._fxaClient.isSignedIn(this.get("sessionToken"))},toJSON:function(){throw new Error("toJSON is explicitly disabled, use `.pick` instead")},toPersistentJSON:function(){return this.pick(w)},setProfileImage:function(a){this.set({profileImageId:a.get("id"),profileImageUrl:a.get("url")}),this.get("profileImageUrl")&&this.set("hadProfileImageSetBefore",!0)},onChange:function(){delete this._profileFetchPromise},_profileFetchPromise:null,fetchProfile:function(){var a=this;return this._profileFetchPromise?this._profileFetchPromise:(this.off("change",this._boundOnChange),this._profileFetchPromise=this.getProfile().then(function(b){var c=new n({url:b.avatar});a.setProfileImage(c),a.set("displayName",b.displayName),a.on("change",a._boundOnChange)}),this._profileFetchPromise)},fetchCurrentProfileImage:function(){var a=this,b=new n;return this.getAvatar().then(function(c){return b=new n({id:c.id,url:c.avatar}),a.setProfileImage(b),b.fetch()}).then(function(){return b})},signIn:function(a,b){var c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l().then(function(){var f=c.get("email"),g=c.get("sessionToken");if(a)return c._fxaClient.signIn(f,a,b,{metricsContext:c._metrics.getFlowEventMetadata(),reason:d.reason||p.SIGN_IN,resume:d.resume,skipCaseError:!0,unblockCode:d.unblockCode});if(g)return c._fxaClient.recoveryEmailStatus(g);throw e.toError("UNEXPECTED_ERROR")}).then(function(a){return c.set(a),a}).fail(function(f){if(e.is(f,"INCORRECT_EMAIL_CASE"))return c.set("email",f.email),c.signIn(a,b,d);throw f})},signUp:function(a,b){var c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._fxaClient.signUp(this.get("email"),a,b,{customizeSync:this.get("customizeSync"),metricsContext:this._metrics.getFlowEventMetadata(),resume:d.resume}).then(function(a){c.set(a)})},retrySignUp:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._fxaClient.signUpResend(a,this.get("sessionToken"),{resume:b.resume})},verifySignUp:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l().then(function(){if("verified"!==c.serverVerificationStatus)return b._fxaClient.verifyCode(b.get("uid"),a,c)}).then(function(){if(b.set("verified",!0),b.get("needsOptedInToMarketingEmail")){b.unset("needsOptedInToMarketingEmail");return b.getMarketingEmailPrefs().optIn(s)}})},checkEmailExists:function(){return this._fxaClient.checkAccountExistsByEmail(this.get("email"))},checkUidExists:function(){return this._fxaClient.checkAccountExists(this.get("uid"))},signOut:function(){return this._fxaClient.sessionDestroy(this.get("sessionToken"))},destroy:function(a){var b=this;return this._fxaClient.deleteAccount(this.get("email"),a).then(function(){b.trigger("destroy",b)})},_upgradeGrantedPermissions:function(){if(this.has("grantedPermissions")){var a=this.get("grantedPermissions");for(var b in a){var c={};a[b].forEach(function(a){c[a]=!0}),this.setClientPermissions(b,c)}this.unset("grantedPermissions")}},getClientPermissions:function(a){return(this.get("permissions")||{})[a]||{}},getClientPermission:function(a,b){return this.getClientPermissions(a)[b]},setClientPermissions:function(a,b){var c=this.get("permissions")||{};c[a]=b,this.set("permissions",c)},hasSeenPermissions:function(a,b){var c=Object.keys(this.getClientPermissions(a)),e=[b].concat(c);return 0===d.without.apply(d,e).length},getPermissionsWithValues:function(a){var b=this;return a.map(function(a){var c=x[a];return c&&b.has(c)?a:null}).filter(function(a){return null!==a})},getMarketingEmailPrefs:function(){return new i({account:this,marketingEmailClient:this._marketingEmailClient})},changePassword:function(a,b,c){var d=this,f=this._fxaClient,g=this.get("email");return f.checkPassword(g,a).then(function(){if(a===b)throw e.toError("PASSWORDS_MUST_BE_DIFFERENT");return f.changePassword(g,a,b,d.get("sessionToken"),d.get("sessionTokenContext"),c)}).then(this.set.bind(this))},set:d.wrap(f.Model.prototype.set,function(a,b,c,e){var f;d.isObject(b)?f=b:(f={},f[b]=c);for(var g in f)if(!d.contains(v,g))throw new Error(g+" cannot be set on an Account");return a.call(this,b,c,e)}),completePasswordReset:function(a,b,c,d){return this._fxaClient.completePasswordReset(this.get("email"),a,b,c,d,{metricsContext:this._metrics.getFlowEventMetadata()}).then(this.set.bind(this))},fetchDevices:function(){return this._fxaClient.deviceList(this.get("sessionToken")).then(function(a){return a.map(function(a){a.clientType=h.CLIENT_TYPE_DEVICE}),a})},fetchOAuthApps:function(){var a=this;return this._oAuthClient.fetchOAuthApps(this.get("accessToken")).fail(function(b){if(j.is(b,"UNAUTHORIZED"))return a._fetchProfileOAuthToken().then(function(){return a._oAuthClient.fetchOAuthApps(a.get("accessToken"))});throw b}).then(function(a){return a.map(function(a){a.clientType=h.CLIENT_TYPE_OAUTH_APP,a.isOAuthApp=!0}),a})},fetchSessions:function(){return this._fxaClient.sessions(this.get("sessionToken")).then(function(a){return a.map(function(a){a.isDevice?(a.clientType=h.CLIENT_TYPE_DEVICE,a.id=a.deviceId,a.name=a.deviceName,a.type=a.deviceType):(a.clientType=h.CLIENT_TYPE_WEB_SESSION,a.isWebSession=!0),a.genericOS=q.toGenericOSName(a.os)}),a})},destroyDevice:function(a){var b=a.get("id"),c=this.get("sessionToken");return this._fxaClient.deviceDestroy(c,b).then(function(){a.destroy()})},destroySession:function(a){var b=a.get("id"),c=this.get("sessionToken");return this._fxaClient.sessionDestroy(c,{customSessionToken:b}).then(function(){a.destroy()})},destroyOAuthApp:function(a){var b=this,c=a.get("id"),d=this.get("accessToken");return this._oAuthClient.destroyOAuthApp(d,c).fail(function(a){if(j.is(a,"UNAUTHORIZED"))return b._fetchProfileOAuthToken().then(function(){return b._oAuthClient.destroyOAuthApp(d,c)});throw a}).then(function(){a.destroy()})},resetPassword:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._fxaClient.passwordReset(this.get("email"),a,{metricsContext:this._metrics.getFlowEventMetadata(),resume:b.resume})},retryResetPassword:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._fxaClient.passwordResetResend(this.get("email"),a,b,{metricsContext:this._metrics.getFlowEventMetadata(),resume:c.resume})},accountKeys:function(){return this.has("keyFetchToken")&&this.has("unwrapBKey")?this._fxaClient.accountKeys(this.get("keyFetchToken"),this.get("unwrapBKey")):l(null)},relierKeys:function(a){var b=this;return this.accountKeys().then(function(c){return c?a.deriveRelierKeys(c,b.get("uid")):null})},isPasswordResetComplete:function(a){return this._fxaClient.isPasswordResetComplete(a)},sendUnblockEmail:function(){return this._fxaClient.sendUnblockEmail(this.get("email"),{metricsContext:this._metrics.getFlowEventMetadata()})},rejectUnblockCode:function(a){return this._fxaClient.rejectUnblockCode(this.get("uid"),a)},sendSms:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._fxaClient.sendSms(this.get("sessionToken"),a,b,{features:c.features||[],metricsContext:this._metrics.getFlowEventMetadata()})},smsStatus:function(a){var b=this.get("sessionToken");return b?this._fxaClient.smsStatus(b,a):l({ok:!1})},recoveryEmails:function(){return this._fxaClient.recoveryEmails(this.get("sessionToken"))},recoveryEmailCreate:function(a){return this._fxaClient.recoveryEmailCreate(this.get("sessionToken"),a)},recoveryEmailDestroy:function(a){return this._fxaClient.recoveryEmailDestroy(this.get("sessionToken"),a)},resendEmailCode:function(a){return this._fxaClient.resendEmailCode(this.get("sessionToken"),a)},getEmails:function(){return this._fxaClient.getEmails(this.get("sessionToken"))},createEmail:function(a){return this._fxaClient.createEmail(this.get("sessionToken"),a)},deleteEmail:function(a){return this._fxaClient.deleteEmail(this.get("sessionToken"),a)}},{ALLOWED_KEYS:v,PERMISSIONS_TO_KEYS:x});["getProfile","getAvatar","deleteAvatar","uploadAvatar","postDisplayName"].forEach(function(a){y.prototype[a]=function(){for(var b=this,c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];var f=void 0;return this.profileClient().then(function(c){var e;f=c;var g=b.get("accessToken");return(e=f[a]).call.apply(e,[f,g].concat(d))}).fail(function(c){if(m.is(c,"INVALID_TOKEN"))b._invalidateSession();else if(m.is(c,"UNAUTHORIZED"))return b._fetchProfileOAuthToken().then(function(){var c,e=b.get("accessToken");return(c=f[a]).call.apply(c,[f,e].concat(d))}).fail(function(a){throw m.is(a,"UNAUTHORIZED")&&b.unset("accessToken"),a});throw c})}}),g.mixin(y,o),c.exports=y}),define("views/mixins/open-webmail-mixin",["require","exports","module","underscore","views/base"],function(a,b,c){"use strict";var d=a("underscore"),e=a("views/base"),f=e.t,g=[{buttonName:f("Open Gmail"),link:"https://mail.google.com/mail/u/?authuser=",regex:/@gmail\.com$/,webmailType:"gmail"},{buttonName:f("Open Hotmail"),link:"https://outlook.live.com/",regex:/@hotmail\.com$/,webmailType:"hotmail"},{buttonName:f("Open Yahoo"),link:"https://mail.yahoo.com",regex:/@yahoo\.com$/,webmailType:"yahoo"},{buttonName:f("Open Outlook"),link:"https://outlook.live.com/",regex:/@outlook\.com$/,webmailType:"outlook"},{buttonName:f("Open Restmail"),link:"http://restmail.net/mail/",regex:/@restmail\.net/,webmailType:"restmail"}];return{events:{"click #open-webmail":"_webmailTabOpened"},addUserInfo:function(a,b){var c=this.getWebmailType(b);return"gmail"!==c&&"restmail"!==c||(a=a.concat(encodeURIComponent(b))),a},_getService:function(a){return d.find(g,function(b){return b.regex.test(a)})},getContext:function(){var a=e.prototype.getContext.call(this),b=a.email,c=this.isOpenWebmailButtonVisible(b);return a.isOpenWebmailButtonVisible=c,b&&c&&d.extend(a,{escapedWebmailLink:encodeURI(this.getWebmailLink(b)),webmailButtonText:this.getWebmailButtonText.bind(this,b),webmailType:this.getWebmailType(b)}),a},getWebmailLink:function(a){var b=this._getService(a).link;return this.addUserInfo(b,a)},isOpenWebmailButtonVisible:function(a){return this.broker.hasCapability("openWebmailButtonVisible")&&!!this._getService(a)},getWebmailButtonText:function(a){return this.translate(this._getService(a).buttonName)},getWebmailType:function(a){return this._getService(a).webmailType},_webmailTabOpened:function(a){var b=this.$el.find(a.target).data("webmailType");this.logViewEvent(b+"_clicked")}}}),define("stache!templates/confirm_reset_password",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-confirm-reset-password-header">{{#t}}Reset email sent{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <div class="graphic graphic-mail">{{#t}}Email Sent{{/t}}</div>\n\n    <p class="verification-email-message">{{#t}}Click on the link we\'ve emailed you at %(email)s within the next hour to create a new password.{{/t}}</p>\n\n    {{#isOpenWebmailButtonVisible}}\n      <div class="button-row">\n        <a href="{{{ escapedWebmailLink }}}" data-webmail-type="{{webmailType}}" class="button" target="_blank" id="open-webmail" type="button">{{webmailButtonText}}</a>\n      </div>\n    {{/isOpenWebmailButtonVisible}}\n\n    <ul class="links">\n      {{#isSignInEnabled}}\n        {{#forceAuth}}\n        <li>\n          <a href="/force_auth?email={{ encodedEmail }}" class="sign-in">{{#t}}Remember password? Sign in{{/t}}</a>\n        </li>\n        {{/forceAuth}}\n\n        {{^forceAuth}}\n        <li>\n          <a href="/signin" class="sign-in">{{#t}}Remember password? Sign in{{/t}}</a>\n        </li>\n        {{/forceAuth}}\n      {{/isSignInEnabled}}\n\n      <li>\n        <a id="resend" class="resend-email" href="#">{{#t}}Didn\'t arrive and not in spam folder? Resend{{/t}}</a>\n      </li>\n    </ul>\n\n  </section>\n</div>\n')}),define("views/confirm_reset_password",["require","exports","module","underscore","models/account","lib/auth-errors","views/base","cocktail","lib/channels/notifier","lib/promise","views/mixins/password-reset-mixin","views/mixins/open-webmail-mixin","views/mixins/resend-mixin","views/mixins/service-mixin","lib/session","stache!templates/confirm_reset_password","lib/constants"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/account"),f=a("lib/auth-errors"),g=a("views/base"),h=a("cocktail"),i=a("lib/channels/notifier"),j=a("lib/promise"),k=a("views/mixins/password-reset-mixin"),l=a("views/mixins/open-webmail-mixin"),m=a("views/mixins/resend-mixin")(),n=a("views/mixins/service-mixin"),o=a("lib/session"),p=a("stache!templates/confirm_reset_password"),q=a("lib/constants"),r=q.VERIFICATION_POLL_IN_MS,s=g.t,t=g.extend({template:p,className:"confirm-reset-password",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._verificationPollMS=a.verificationPollMS||r},context:function(){var a=this.model.get("email"),b=this.relier.get("resetPasswordConfirm");return{email:a,encodedEmail:encodeURIComponent(a),forceAuth:this.broker.isForceAuth(),isSignInEnabled:b}},beforeRender:function(){this.model.has("passwordForgotToken")||this.navigate("reset_password")},afterVisible:function(){var a=this,b=this.user.initAccount({email:this.model.get("email")});return this.broker.persistVerificationData(b).then(function(){return a._waitForConfirmation().then(function(b){return a.logViewEvent("verification.success"),a.relier.set("resetPasswordConfirm",!0),b?a._finishPasswordResetSameBrowser(b):a._finishPasswordResetDifferentBrowser()}).fail(a.displayError.bind(a))})},_waitForConfirmation:function(){var a=this,b=this._confirmationDeferred=j.defer(),c=this._confirmationPromise=b.promise,d=function(b){a._stopWaiting(),a._confirmationDeferred.resolve(b)},e=function(b){a._stopWaiting(),a._confirmationDeferred.reject(b)};return this.notifier.on(i.COMPLETE_RESET_PASSWORD_TAB_OPEN,function(){a._isWaitingForLoginMessage||(a._waitForLoginMessage().then(d,e),a._stopWaitingForServerConfirmation())}),this._waitForServerConfirmation().then(d,e),c},_finishPasswordResetSameBrowser:function(a){var b=this,c=this.user.getAccountByUid(a.uid);return c.set(d.pick(a,e.ALLOWED_KEYS)),c.isDefault()?j.reject(f.toError("UNEXPECTED_ERROR")):this.user.setSignedInAccount(c).then(function(){return b.displaySuccess(s("Password reset")),b.invokeBrokerMethod("afterResetPasswordConfirmationPoll",c)}).then(function(){b.navigate("reset_password_confirmed")})},_getSignInRoute:function(){return this.broker.transformLink("/signin").replace(/^\//,"")},_finishPasswordResetDifferentBrowser:function(){o.clear(),this.navigate(this._getSignInRoute(),{success:s("Password reset successfully. Sign in to continue.")})},_isWaitingForServerConfirmation:!1,_waitForServerConfirmation:function(){var a=this;this._isWaitingForServerConfirmation=!0;var b=this.model.get("email"),c=this.user.initAccount({email:b}),d=this.model.get("passwordForgotToken");return c.isPasswordResetComplete(d).then(function(b){if(!a._isWaitingForServerConfirmation)return j.defer().promise;if(b)return null;var c=j.defer();return a._waitForServerConfirmationTimeout=a.setTimeout(function(){a._isWaitingForServerConfirmation&&c.resolve(a._waitForServerConfirmation())},a._verificationPollMS),c.promise})},_stopWaitingForServerConfirmation:function(){this._waitForServerConfirmationTimeout&&this.clearTimeout(this._waitForServerConfirmationTimeout),this._isWaitingForServerConfirmation=!1},_isWaitingForLoginMessage:!1,_waitForLoginMessage:function(){var a=j.defer();return this._isWaitingForLoginMessage=!0,this.notifier.on(i.SIGNED_IN,a.resolve.bind(a)),a.promise},_stopListeningForInterTabMessages:function(){this._isWaitingForLoginMessage=!1,this.notifier.off()},_stopWaiting:function(){this._stopWaitingForServerConfirmation(),this._stopListeningForInterTabMessages()},resend:function(){var a=this;return this.retryResetPassword(this.model.get("email"),this.model.get("passwordForgotToken")).fail(function(b){if(f.is(b,"INVALID_TOKEN"))return a.navigate("reset_password",{error:b});throw b})}});h.mixin(t,k,l,m,n),c.exports=t}),define("views/mixins/pulse-graphic-mixin",["require","exports","module"],function(a,b,c){"use strict";return{afterRender:function(){this.$(".graphic").addClass("pulse")}}}),define("stache!templates/confirm",["mustache"],function(a){
return a.compile('<div id="main-content" class="card">\n  <header>\n    {{#isSignUp}}\n    <h1 id="fxa-confirm-header">{{#t}}Confirm your account{{/t}}</h1>\n    {{/isSignUp}}\n    {{#isSignIn}}\n    <h1 id="fxa-confirm-signin-header">{{#t}}Confirm this sign-in{{/t}}</h1>\n    {{/isSignIn}}\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <div class="graphic graphic-mail">{{#t}}Email Sent{{/t}}</div>\n\n    {{#isSignUp}}\n    <p class="verification-email-message">{{#unsafeTranslate}}A verification link has been sent&nbsp;to %(escapedEmail)s{{/unsafeTranslate}}</p>\n    {{/isSignUp}}\n    {{#isSignIn}}\n    <p class="verification-email-message">{{#t}}To better protect your Firefox data, we\'ve emailed a confirmation link to %(email)s{{/t}}</p>\n    {{/isSignIn}}\n\n    {{#isOpenWebmailButtonVisible}}\n      <div class="button-row">\n        <a href="{{{ escapedWebmailLink }}}" data-webmail-type="{{webmailType}}" class="button" target="_blank" id="open-webmail" type="button">{{webmailButtonText}}</a>\n      </div>\n    {{/isOpenWebmailButtonVisible}}\n\n    <div class="links">\n      {{^canGoBack}}\n        <a id="resend" class="delayed-fadein" href="#">{{#t}}Didn\'t arrive and not in spam folder? Resend{{/t}}</a>\n      {{/canGoBack}}\n      {{#canGoBack}}\n        <a id="back" class="left delayed-fadein" href="#">{{#t}}Back{{/t}}</a>\n        <a id="resend" class="right delayed-fadein" href="#">{{#t}}Didn\'t arrive and not in spam folder? Resend{{/t}}</a>\n      {{/canGoBack}}\n    </div>\n  </section>\n</div>\n')}),define("views/confirm",["require","exports","module","underscore","lib/auth-errors","views/mixins/back-mixin","views/base","cocktail","views/mixins/connect-another-device-mixin","lib/constants","views/mixins/experiment-mixin","views/mixins/open-webmail-mixin","lib/promise","views/mixins/pulse-graphic-mixin","views/mixins/resend-mixin","views/mixins/resume-token-mixin","views/mixins/service-mixin","stache!templates/confirm","lib/user-agent-mixin","views/mixins/verification-reason-mixin"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("views/mixins/back-mixin"),g=a("views/base"),h=a("cocktail"),i=a("views/mixins/connect-another-device-mixin"),j=a("lib/constants"),k=a("views/mixins/experiment-mixin"),l=a("views/mixins/open-webmail-mixin"),m=a("lib/promise"),n=a("views/mixins/pulse-graphic-mixin"),o=a("views/mixins/resend-mixin")(),p=a("views/mixins/resume-token-mixin"),q=a("views/mixins/service-mixin"),r=a("stache!templates/confirm"),s=a("lib/user-agent-mixin"),t=a("views/mixins/verification-reason-mixin"),u=g.prototype,v=g.extend({template:r,className:"confirm",VERIFICATION_POLL_IN_MS:j.VERIFICATION_POLL_IN_MS,initialize:function(){this._account=this.user.initAccount(this.model.get("account"))},getAccount:function(){return this._account},context:function(){var a=this.getAccount().get("email"),b=this.isSignIn(),c=this.isSignUp();return{canGoBack:b&&this.canGoBack(),email:a,escapedEmail:d.escape(a),isSignIn:b,isSignUp:c}},_bouncedEmailSignup:function(){this.navigate("signup",{bouncedEmail:this.getAccount().get("email")})},_getMissingSessionTokenScreen:function(){var a=this.isSignUp()?"signup":"signin";return this.broker.transformLink(a)},beforeRender:function(){this.getAccount().get("sessionToken")||this.navigate(this._getMissingSessionTokenScreen())},afterVisible:function(){var a=this,b=this.getAccount();return u.afterVisible.call(this).then(function(){return a.broker.persistVerificationData(b)}).then(function(){return a.invokeBrokerMethod("beforeSignUpConfirmationPoll",b)}).then(function(){return a._startPolling()})},_startPolling:function(){var a=this;return this._waitForConfirmation().then(function(){a.logViewEvent("verification.success"),a.notifier.trigger("verification.success");var b=a.isSignUp()?"afterSignUpConfirmationPoll":"afterSignInConfirmationPoll";return a.invokeBrokerMethod(b,a.getAccount())}).fail(function(b){return a._onConfirmationError(b)})},_waitForConfirmation:function(){var a=this,b=this.getAccount();return b.waitForSessionVerification(this.VERIFICATION_POLL_IN_MS).then(function(){a.user.setAccount(b)})},_onConfirmationError:function(a){var b=this;if(e.is(a,"SIGNUP_EMAIL_BOUNCE"))this._bouncedEmailSignup();else{if(e.is(a,"UNEXPECTED_ERROR")){this.logError(e.toError("POLLING_FAILED"));var c=m.defer();return this.setTimeout(function(){c.resolve(b._startPolling())},this.VERIFICATION_POLL_IN_MS),c.promise}this.displayError(a)}},resend:function(){var a=this,b=this.getAccount();return b.retrySignUp(this.relier,{resume:this.getStringifiedResumeToken(b)}).fail(function(b){if(e.is(b,"INVALID_TOKEN"))return a.navigate("signup",{error:b});throw b})}});h.mixin(v,f,i,k,l,n,o,p,q,s,t),c.exports=v}),define("stache!templates/marketing_snippet",["mustache"],function(a){return a.compile('{{#showSignUpMarketing}}\n  {{#isSpring2015}}\n    <aside class="marketing-ios">\n      {{#isIos}}\n        <p>\n          {{#t}}Get the full Sync experience.{{/t}}\n          <br>\n          {{#t}}Download Firefox for iOS!{{/t}}\n        </p>\n        <a target="_blank" class="marketing-link marketing-link-ios" href="{{ downloadLinkIos }}" data-flow-event="link.app-store.ios" data-marketing-id="{{ marketingId }}" data-marketing-type="ios"><img width="152" height="53" src="{{ appStoreImage }}" alt="{{#t}}Download Firefox for iOS!{{/t}}" /></a>\n      {{/isIos}}\n\n      {{#isAndroid}}\n        <p>\n          {{#t}}Get the full Sync experience.{{/t}}\n          <br>\n          {{#t}}Download Firefox for Android.{{/t}}\n        </p>\n        <a target="_blank" class="marketing-link marketing-link-android" href="{{ downloadLinkAndroid }}" data-flow-event="link.app-store.android" data-marketing-id="{{ marketingId }}" data-marketing-type="android"><img width="152" height="45" src="{{ playStoreImage }}" alt="{{#t}}Download Firefox for Android.{{/t}}"></a>\n      {{/isAndroid}}\n\n      {{#isOther}}\n        <div class="os-general">\n          <p>\n            {{#t}}Get the full Sync experience.{{/t}}\n            <br>\n            <span class="download-firefox-mobile">{{#t}}Download Firefox for mobile devices.{{/t}}</span>\n          </p>\n\n          <ul>\n            <li>\n              <a target="_blank" class="marketing-link marketing-link-ios" href="{{ downloadLinkIos }}" data-flow-event="link.app-store.ios" data-marketing-id="{{ marketingId }}" data-marketing-type="ios"><img width="152" height="45" src="{{ appStoreImage }}" alt="{{#t}}Download Firefox for iOS!{{/t}}" /></a>\n            </li>\n            <li>\n              <a target="_blank" class="marketing-link marketing-link-android" href="{{ downloadLinkAndroid }}" data-flow-event="link.app-store.android" data-marketing-id="{{ marketingId }}" data-marketing-type="android"><img width="152" height="45"  src="{{ playStoreImage }}" alt="{{#t}}Download Firefox for Android.{{/t}}" /></a>\n            </li>\n          </ul>\n        </div>\n      {{/isOther}}\n    </aside>\n  {{/isSpring2015}}\n  {{#isAutumn2016}}\n    {{#isIos}}\n      <a target="_blank" class="marketing-link marketing-link-ios" href="{{ downloadLinkIos }}" data-flow-event="link.app-store.ios" data-marketing-id="{{ marketingId }}" data-marketing-type="ios"><img width="152" height="53" src="{{ appStoreImage }}" alt="{{#t}}Download Firefox for iOS!{{/t}}" /></a>\n    {{/isIos}}\n\n    {{#isAndroid}}\n      <a target="_blank" class="marketing-link marketing-link-android" href="{{ downloadLinkAndroid }}" data-flow-event="link.app-store.android" data-marketing-id="{{ marketingId }}" data-marketing-type="android"><img width="152" height="45" src="{{ playStoreImage }}" alt="{{#t}}Download Firefox for Android.{{/t}}" /></a>\n    {{/isAndroid}}\n\n    {{#isOther}}\n      <div class="links clearfix">\n        <a target="_blank" class="marketing-link marketing-link-ios left" href="{{ downloadLinkIos }}" data-flow-event="link.app-store.ios" data-marketing-id="{{ marketingId }}" data-marketing-type="ios"><img width="152" height="45" src="{{ appStoreImage }}" alt="{{#t}}Download Firefox for iOS!{{/t}}" /></a>\n        <a target="_blank" class="marketing-link marketing-link-android right" href="{{ downloadLinkAndroid }}" data-flow-event="link.app-store.android" data-marketing-id="{{ marketingId }}" data-marketing-type="android"><img width="152" height="45"  src="{{ playStoreImage }}" alt="{{#t}}Download Firefox for Android.{{/t}}" /></a>\n      </div>\n    {{/isOther}}\n  {{/isAutumn2016}}\n{{/showSignUpMarketing}}\n')}),define("views/marketing_snippet",["require","exports","module","underscore","jquery","views/base","cocktail","lib/constants","lib/strings","stache!templates/marketing_snippet","lib/user-agent-mixin","views/mixins/verification-reason-mixin"],function(a,c,d){"use strict";var e,f=a("underscore"),g=a("jquery"),h=a("views/base"),i=a("cocktail"),j=a("lib/constants"),k=a("lib/strings"),l=a("stache!templates/marketing_snippet"),m=a("lib/user-agent-mixin"),n=a("views/mixins/verification-reason-mixin"),o=["ca","cs","da","de","en","es","et","fr","hu","id","it","ja","ko","lt","nb-NO","nl","pl","pt-BR","pt","ru","sk","sl","sv","tr","uk","zh-CN","zh-TW"],p=h.extend({template:l,initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._marketingId=a.marketingId||j.MARKETING_ID_SPRING_2015,this._service=a.service,this._which=a.which},events:{"click .marketing-link":"_onMarketingClick"},context:function(){var a=this._shouldShowSignUpMarketing(),b=this._isIos(),c=this._isAndroid(),d=this._isOther(),e=this._storeLink(j.DOWNLOAD_LINK_TEMPLATE_ANDROID),f=this._storeImage("google_play_store_button","png"),g=this._storeLink(j.DOWNLOAD_LINK_TEMPLATE_IOS),h=this._storeImage("apple_app_store_button","svg"),i=this._marketingId;return{appStoreImage:h,downloadLinkAndroid:e,downloadLinkIos:g,isAndroid:c,isAutumn2016:i===j.MARKETING_ID_AUTUMN_2016,isIos:b,isOther:d,isSpring2015:i===j.MARKETING_ID_SPRING_2015,marketingId:i,playStoreImage:f,showSignUpMarketing:a}},afterRender:function(){var a=this;this.$(".marketing-link").each(function(b,c){a._logMarketingImpression(c)}),this.$el.addClass(this._marketingId)},_shouldShowSignUpMarketing:function(){var a=this.broker.hasCapability("emailVerificationMarketingSnippet"),b=this._isFirefoxMobile(),c=this.isSignIn(),d=this.isSignUp(),e=this._service===j.SYNC_SERVICE;return!!this._which||a&&(d||c)&&e&&!b},_isFirefoxMobile:function(){var a=this.getUserAgent();return a.isFirefoxIos()||a.isFirefoxAndroid()},_isIos:function(){return!this._which&&this.getUserAgent().isIos()||this._which===p.WHICH.IOS},_isAndroid:function(){return!this._which&&this.getUserAgent().isAndroid()||this._which===p.WHICH.ANDROID},_isOther:function(){return!this._isIos()&&!this._isAndroid()||this._which===p.WHICH.BOTH},_storeLink:function(a){return k.interpolate(a,{campaign:"fxa-conf-page",creative:p.BUTTON_IDS[this._marketingId]})},_storeImage:function(a,b){var c=f.contains(o,this.lang)?this.lang:"en";return this._isHighRes()&&"png"===b&&(c+="@2x"),"/images/"+a+"/"+c+"."+b},_isHighRes:function(){var a=this.window;return!(!a.matchMedia||!a.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 1.5dppx), (min-resolution: 144dpi)"))},_logMarketingImpression:function(a){var b=this._getMarketingLinkInfo(a),c=b.id,d=b.type,e=b.url;this.metrics.logMarketingImpression(c,e),this.notifier.trigger("marketing.impression",{id:c,type:d,url:e})},_onMarketingClick:function(a){this._logMarketingClick(a.currentTarget)},_logMarketingClick:function(a){var b=this._getMarketingLinkInfo(a),c=b.id,d=b.type,e=b.url;this.metrics.logMarketingClick(c,e),this.notifier.trigger("marketing.clicked",{id:c,type:d,url:e})},_getMarketingLinkInfo:function(a){var b=g(a);return{id:b.data("marketing-id"),type:b.data("marketing-type"),url:b.attr("href")}}},{BUTTON_IDS:(e={},b(e,j.MARKETING_ID_AUTUMN_2016,"button-autumn-2016-connect-another-device"),b(e,j.MARKETING_ID_SPRING_2015,"button"),e),WHICH:{ANDROID:"android",BOTH:"both",IOS:"ios"}});i.mixin(p,m,n),d.exports=p}),define("views/mixins/marketing-mixin",["require","exports","module","underscore","views/marketing_snippet"],function(a,b,c){"use strict";var d=a("underscore"),e=a("views/marketing_snippet"),f=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{createMarketingSnippet:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=d.extend({broker:this.broker,el:this.$(".marketing-area"),lang:this.lang,metrics:this.metrics,notifier:this.notifier,service:this.relier.get("service"),type:this.model.get("type"),window:this.window},a,b),f=new e(c);return this.trackChildView(f),f.render()},afterRender:function(){if(!1!==a.autocreate)return this.createMarketingSnippet()}}};c.exports=f}),define("views/mixins/sync-auth-mixin",["require","exports","module","underscore","lib/constants","lib/url"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/constants"),f=a("lib/url");c.exports={_hasWebChannelSupport:function(){var a=this.getUserAgent(),b=a.browser.version;return a.isFirefoxDesktop()&&b>=40||a.isFirefoxAndroid()&&b>=43},isSyncAuthSupported:function(){return!!this._hasWebChannelSupport()},_getSyncContext:function(){var a=this.getUserAgent();return a.isFirefoxAndroid()?e.FX_FENNEC_V1_CONTEXT:a.isFirefoxDesktop()?e.FX_DESKTOP_V3_CONTEXT:void 0},getEscapedSyncUrl:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},g=this.window.location.origin,h=this.relier,i=d.extend({context:this._getSyncContext(),entrypoint:b,service:e.SYNC_SERVICE,utm_campaign:h.get("utmCampaign"),utm_content:h.get("utmContent"),utm_medium:h.get("utmMedium"),utm_source:h.get("utmSource"),utm_term:h.get("utmTerm")},c);return g+"/"+a+f.objToSearchString(i)}}}),define("stache!templates/connect_another_device",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header class="hidden" id="fxa-connect-another-device-header"><h1>{{#t}}Connect another device{{/t}}</h1></header>\n  {{#isSignedIn}}\n    <div class="success success-authenticated visible">{{#t}}This Firefox is connected{{/t}}</div>\n  {{/isSignedIn}}\n  {{^isSignedIn}}\n    <div class="success success-not-authenticated visible">{{#t}}Email verified{{/t}}</div>\n  {{/isSignedIn}}\n  <section>\n    <div class="graphic graphic-connect-another-device">{{#t}}Success{{/t}}</div>\n\n    {{#canSignIn}}\n      <p>\n        {{#t}}Sign in to this Firefox to complete set-up{{/t}}\n      </p>\n\n      <form novalidate>\n        <div class="button-row">\n          <a data-flow-event="link.signin" id="signin" class="button" href="{{{ escapedSignInUrl }}}">{{#unsafeTranslate}}Sign in &rarr;{{/unsafeTranslate}}</a>\n        </div>\n      </form>\n    {{/canSignIn}}\n    {{^canSignIn}}\n      {{#isFirefoxAndroid}}\n        \x3c!-- User verified in Fx for Android - they are using an old Fennec\n        or are already signed in. Ignore old browsers, assume already signed in.\n        Encourage installation on another device. --\x3e\n        <p id="connect-other-firefox-from-android">\n          {{#t}}Sign in to Firefox on another device to complete set-up{{/t}}\n        </p>\n      {{/isFirefoxAndroid}}\n      {{#isFirefoxDesktop}}\n        <p id="install-mobile-firefox-desktop">\n          {{#t}}Sign in to Firefox on another device to complete set-up{{/t}}\n        </p>\n      {{/isFirefoxDesktop}}\n      {{#isFirefoxIos}}\n        \x3c!-- user verifies in Fx for iOS, assume they are not signed in --\x3e\n        <p id="signin-fxios">\n          {{#t}}Open settings and select Sign in to Firefox to complete set-up{{/t}}\n        </p>\n      {{/isFirefoxIos}}\n      {{#isOtherAndroid}}\n        \x3c!-- Another android browser, encourage Fx for Android installation --\x3e\n        <p id="install-mobile-firefox-android">\n          {{#t}}Sign in to Firefox for Android to complete set-up{{/t}}\n        </p>\n      {{/isOtherAndroid}}\n      {{#isOtherIos}}\n        \x3c!-- Safari or Chrome for iOS, encourage installation of Fx --\x3e\n        <p id="install-mobile-firefox-ios">\n          {{#t}}Sign in to Firefox for iOS to complete set-up{{/t}}\n        </p>\n      {{/isOtherIos}}\n      {{#isOther}}\n        \x3c!-- probably some desktop browser --\x3e\n        <p id="install-mobile-firefox-other">\n          {{#t}}Sign in to Firefox on another device to complete set-up{{/t}}\n        </p>\n      {{/isOther}}\n\n      {{^isFirefoxIos}}\n        <div class="marketing-area"></div>\n      {{/isFirefoxIos}}\n    {{/canSignIn}}\n    <div class="links">\n      <a data-flow-event="link.why" href="/connect_another_device/why">{{#t}}Why is this required?{{/t}}</a>\n    </div>\n    <aside class="child-view"></aside>\n  </section>\n\n</div>\n')}),define("views/connect_another_device",["require","exports","module","cocktail","views/mixins/experiment-mixin","views/mixins/flow-events-mixin","views/form","lib/constants","views/mixins/marketing-mixin","views/marketing_snippet","views/mixins/sync-auth-mixin","stache!templates/connect_another_device","lib/user-agent-mixin"],function(a,b,c){"use strict";var d=a("cocktail"),e=a("views/mixins/experiment-mixin"),f=a("views/mixins/flow-events-mixin"),g=a("views/form"),h=a("lib/constants"),i=h.MARKETING_ID_AUTUMN_2016,j=h.SYNC_SERVICE,k=a("views/mixins/marketing-mixin"),l=a("views/marketing_snippet"),m=a("views/mixins/sync-auth-mixin"),n=a("stache!templates/connect_another_device"),o=a("lib/user-agent-mixin"),p=g.prototype,q=g.extend({template:n,initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._createView=a.createView,p.initialize.call(this,a)},showChildView:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$(".child-view").append("<div>"),c.el=this.$(".child-view > div");var d=this._createView(a,c);return d.render().then(function(){return b.trackChildView(d)})},afterRender:function(){var a={marketingId:i};return this._isSignedIn()&&this.getUserAgent().isFirefoxAndroid()&&(a.which=l.WHICH.BOTH),this.createMarketingSnippet(a)},afterVisible:function(){return this._logViewMetrics(),p.afterVisible.call(this)},getAccount:function(){return this.model.get("account")||this.model.set("account",this.user.getSignedInAccount()),this.model.get("account")},_logViewMetrics:function(){var a=this._isSignedIn();this.logFlowEvent("signedin."+a);var b=this.getContext(),c=b.canSignIn,d=b.isFirefoxAndroid,e=b.isFirefoxDesktop,f=b.isFirefoxIos,g=b.isOther,h=b.isOtherAndroid,i=b.isOtherIos,j=void 0;c?(this.logFlowEvent("signin.eligible"),d?j="signin_from.fx_android":e&&(j="signin_from.fx_desktop")):(this.logFlowEvent("signin.ineligible"),f?j="signin_from.fx_ios":d?j="install_from.fx_android":e?j="install_from.fx_desktop":h?j="install_from.other_android":i?j="install_from.other_ios":g&&(j="install_from.other")),j&&this.logFlowEvent(j)},context:function(){var a=this._isSignedIn(),b=this._canSignIn(),c=this.getAccount().get("email"),d=this._getEscapedSignInUrl(c),e=this.getUserAgent(),f=e.isAndroid(),g=e.isFirefoxAndroid(),h=e.isFirefoxDesktop(),i=e.isFirefoxIos(),j=e.isIos(),k=f&&!g,l=j&&!i;return{canSignIn:b,email:c,escapedSignInUrl:d,isFirefoxAndroid:g,isFirefoxDesktop:h,isFirefoxIos:i,isOther:!f&&!j&&!h,isOtherAndroid:k,isOtherIos:l,isSignedIn:a}},_isSignedIn:function(){return this.user.isSignedInAccount(this.getAccount())},_canSignIn:function(){return!this._isSignedIn()&&this.isSyncAuthSupported()},_getEscapedSignInUrl:function(a){return this.getEscapedSyncUrl("signin",q.ENTRYPOINT,{email:a})}},{ENTRYPOINT:"fxa:connect_another_device"});d.mixin(q,e,f,k({autocreate:!1,service:j}),m,o),c.exports=q}),define("stache!templates/cookies_disabled",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-cookies-disabled-header">{{#t}}Cookies and local storage are required.{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n\n    <p>\n      {{#t}}Please enable cookies and local storage in your browser to access Firefox Accounts. Doing so will enable functionality such as remembering you between sessions.{{/t}}\n    </p>\n\n    <p>\n      <a href="https://support.mozilla.org/kb/cookies-information-websites-store-on-your-computer" target="_blank">{{#t}}Learn more{{/t}}</a>\n    </p>\n\n\n    <div class="button-row">\n      <button id="submit-btn" type="submit">{{#t}}Try again{{/t}}</button>\n    </div>\n\n  </section>\n</div>\n')}),define("views/cookies_disabled",["require","exports","module","lib/auth-errors","views/mixins/back-mixin","views/base","cocktail","lib/storage","stache!templates/cookies_disabled"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/mixins/back-mixin"),f=a("views/base"),g=a("cocktail"),h=a("lib/storage"),i=a("stache!templates/cookies_disabled"),j=f.extend({constructor:function(a){f.call(this,a),this._Storage=a.Storage||h},template:i,className:"cookies-disabled",events:{"click #submit-btn":"backIfLocalStorageEnabled"},backIfLocalStorageEnabled:function(){if(!this._Storage.isLocalStorageEnabled())return this.displayError(d.toError("COOKIES_STILL_DISABLED"));this.back()}});g.mixin(j,e),c.exports=j}),define("stache!templates/settings/delete_account",["mustache"],function(a){return a.compile('<div id="delete-account" class="settings-unit">\n  <div class="settings-unit-stub">\n    <header class="settings-unit-summary">\n      <h2 class="settings-unit-title">{{#t}}Delete account{{/t}}</h2>\n    </header>\n    <button class="settings-button secondary settings-unit-toggle hidden"\n      data-href="settings/delete_account">{{#t}}Delete{{/t}}</button>\n  </div>\n\n  <div class="settings-unit-details">\n    <div class="error"></div>\n\n    <form novalidate>\n      <p>{{#t}}Are you sure you want to delete your account? This action cannot be undone.{{/t}}</p>\n\n      <div class="input-row password-row">\n        <label class="label-helper"></label>\n        \x3c!-- add the autocomplete=off attribute - the user is deleting the account, they most likely don\'t want the password saved. --\x3e\n        <input type="password" class="password tooltip-below" id="password" placeholder="{{#t}}Password{{/t}}" pattern=".{8,}" required autofocus autocomplete="off" />\n      </div>\n\n      <div class="button-row">\n        <button type="submit" class="settings-button warning disabled">{{#t}}Delete account{{/t}}</button>\n        <button class="settings-button secondary cancel">{{#t}}Cancel{{/t}}</button>\n      </div>\n\n    </form>\n  </div>\n</div>\n')}),define("views/settings/delete_account",["require","exports","module","views/base","cocktail","views/mixins/floating-placeholder-mixin","views/form","views/mixins/password-mixin","views/mixins/settings-panel-mixin","lib/session","views/mixins/service-mixin","stache!templates/settings/delete_account"],function(a,b,c){"use strict";var d=a("views/base"),e=a("cocktail"),f=a("views/mixins/floating-placeholder-mixin"),g=a("views/form"),h=a("views/mixins/password-mixin"),i=a("views/mixins/settings-panel-mixin"),j=a("lib/session"),k=a("views/mixins/service-mixin"),l=a("stache!templates/settings/delete_account"),m=d.t,n=g.extend({template:l,className:"delete-account",viewName:"settings.delete-account",context:function(){return{email:this.getSignedInAccount().get("email")}},submit:function(){var a=this,b=this.getSignedInAccount(),c=this.getElementValue(".password");return this.user.deleteAccount(b,c).then(function(){return j.clear(),a.invokeBrokerMethod("afterDeleteAccount",b)}).then(function(){a.logViewEvent("deleted"),a.navigate("signup",{success:m("Account deleted successfully")},{clearQueryParams:!0})})}});e.mixin(n,h,k,i,f),c.exports=n}),define("stache!templates/settings/display_name",["mustache"],function(a){return a.compile('<div id="display-name" class="settings-unit">\n  <div class="settings-unit-stub">\n    <header class="settings-unit-summary">\n      <h2 class="settings-unit-title">{{#t}}Display name{{/t}}</h2>\n    </header>\n    {{#displayName}}\n      <button class="settings-button secondary settings-unit-toggle" data-href="settings/display_name">\n      <span class="change-button">{{#t}}Change{{/t}}</span>\n      </button>\n    {{/displayName}}\n    {{^displayName}}\n      <button class="settings-button primary settings-unit-toggle" data-href="settings/display_name">\n      <span class="add-button">{{#t}}Add{{/t}}</span>\n      </button>\n    {{/displayName}}\n  </div>\n\n  <div class="settings-unit-details">\n    <div class="error"></div>\n\n    <form novalidate>\n      <p>\n        {{#t}}Choose the name you would like to appear in Firefox and when managing your account.{{/t}}\n      </p>\n      <div class="input-row">\n        <label class="label-helper"></label>\n        <input type="text" class="text display-name" placeholder="{{#t}}Display name{{/t}}" value="{{ displayName }}" autofocus  autocomplete="off"/>\n      </div>\n      <div class="button-row">\n        <button type="submit" class="settings-button primary disabled">{{#t}}Change{{/t}}</button>\n        <button class="settings-button secondary cancel">{{#t}}Cancel{{/t}}</button>\n      </div>\n  </div>\n</div>\n')}),define("views/settings/display_name",["require","exports","module","views/mixins/avatar-mixin","views/base","cocktail","views/mixins/floating-placeholder-mixin","views/form","views/mixins/settings-panel-mixin","stache!templates/settings/display_name"],function(a,b,c){"use strict";var d=a("views/mixins/avatar-mixin"),e=a("views/base"),f=a("cocktail"),g=a("views/mixins/floating-placeholder-mixin"),h=a("views/form"),i=a("views/mixins/settings-panel-mixin"),j=a("stache!templates/settings/display_name"),k=e.t,l=h.extend({template:j,className:"display-name",viewName:"settings.display-name",onProfileUpdate:function(){this.render()},context:function(){return{displayName:this._displayName}},events:{"focus input.display-name":"onDisplayNameFocus"},onDisplayNameFocus:function(){this.isValidStart()},beforeRender:function(){var a=this,b=this.getSignedInAccount();return b.fetchProfile().then(function(){a.user.setAccount(b),a._displayName=b.get("displayName")})},isValidStart:function(){return(this.getSignedInAccount().get("displayName")||"")!==this.getElementValue("input.display-name").trim()},submit:function(){var a=this,b=this.getSignedInAccount(),c=this.getElementValue("input.display-name").trim();return b.postDisplayName(c).then(function(){a.logViewEvent("success"),a.updateDisplayName(c),a.displaySuccess(k("Display name updated")),a.navigate("settings")})}});f.mixin(l,d,i,g),c.exports=l}),define("models/email",["require","exports","module","backbone"],function(a,b,c){"use strict";var d=a("backbone"),e=d.Model.extend({defaults:{email:null,isPrimary:!1,verified:!1}});c.exports=e}),define("stache!templates/settings/emails",["mustache"],function(a){return a.compile('<div id="emails" class="settings-unit {{#isPanelOpen}}open{{/isPanelOpen}}">\n    <div class="settings-unit-stub">\n        <header class="settings-unit-summary">\n            <h2 class="settings-unit-title">{{#t}}Secondary email{{/t}}</h2>\n        </header>\n        <button class="settings-button settings-unit-toggle hidden {{buttonClass}}" data-href="/settings/emails">\n            {{#hasSecondaryEmail}}{{#t}}Change{{/t}}{{/hasSecondaryEmail}}\n            {{^hasSecondaryEmail}}{{#t}}Add{{/t}}{{/hasSecondaryEmail}}\n        </button>\n    </div>\n\n    <div class="settings-unit-details">\n        <form novalidate>\n            <p>\n                {{#t}}A secondary email is an additional address for receiving security notices and confirming new Sync devices.{{/t}}\n            </p>\n            {{#hasSecondaryEmail}}\n                <ul class="email-list button-row">\n                    {{#emails}}\n                        {{^isPrimary}}\n                            <li class="email-address">\n                                <div class="address">{{email}}</div>\n                                <div class="details">\n                                    {{#verified}}\n                                        <div class="verified">{{#t}}verified{{/t}}</div>\n                                    {{/verified}}\n                                    {{^verified}}\n                                        <div class="not-verified">{{#t}}verification required{{/t}}</div>\n                                    {{/verified}}\n                                </div>\n                                <button class="settings-button warning email-disconnect" data-id="{{email}}">\n                                    {{#t}}Remove{{/t}}\n                                </button>\n                            </li>\n                            {{^verified}}\n                                <a class="resend" data-id="{{email}}">{{#t}}Didn\'t arrive and not in spam folder? Resend?{{/t}}</a>\n                            {{/verified}}\n                        {{/isPrimary}}\n                    {{/emails}}\n                </ul>\n            {{/hasSecondaryEmail}}\n\n            {{^hasSecondaryEmail}}\n                <div class="input-row">\n                    <label class="label-helper"></label>\n                    <input type="email" class="new-email tooltip-below" placeholder="{{#t}}Secondary email{{/t}}"\n                           value="{{newEmail}}" autofocus autocomplete="off"/>\n                </div>\n            {{/hasSecondaryEmail}}\n\n            <div class="button-row">\n                {{#hasSecondaryEmail}}\n                    <button class="settings-button email-refresh primary enabled">{{#t}}Refresh{{/t}}</button>\n\n                    <button\n                        class="settings-button {{#hasSecondaryVerifiedEmail}}cancel secondary enabled{{/hasSecondaryVerifiedEmail}}\n                            {{^hasSecondaryVerifiedEmail}} secondary-disabled disabled {{/hasSecondaryVerifiedEmail}}">\n                        {{#t}}Done{{/t}}\n                    </button>\n                {{/hasSecondaryEmail}}\n\n                {{^hasSecondaryEmail}}\n                    <button type="submit" class="settings-button email-add primary disabled">{{#t}}Add{{/t}}</button>\n                    <button class="settings-button cancel secondary enabled">{{#t}}Cancel{{/t}}</button>\n                {{/hasSecondaryEmail}}\n            </div>\n        </form>\n    </div>\n</div>\n')}),define("views/settings/emails",["require","exports","module","jquery","views/base","cocktail","models/email","views/mixins/floating-placeholder-mixin","views/form","views/base","views/mixins/settings-panel-mixin","views/decorators/progress_indicator","lib/strings","stache!templates/settings/emails"],function(a,b,c){"use strict";var d=a("jquery"),e=a("views/base"),f=a("cocktail"),g=a("models/email"),h=a("views/mixins/floating-placeholder-mixin"),i=a("views/form"),j=a("views/base").preventDefaultThen,k=a("views/mixins/settings-panel-mixin"),l=a("views/decorators/progress_indicator"),m=a("lib/strings"),n=a("stache!templates/settings/emails"),o=e.t,p=/.+@mozilla\.com$|.+@restmail\.net$|.+@softvisioninc\.eu$|.+@softvision\.(com|ro)$/,q=i.extend({template:n,className:"emails",viewName:"settings.emails",events:{"click .email-disconnect":j("_onDisconnectEmail"),"click .email-refresh.enabled":j("refresh"),"click .resend":j("resend")},initialize:function(a){a.emails?this._emails=a.emails:this._emails=[]},context:function(){return{buttonClass:this._hasSecondaryEmail()?"secondary":"primary",emails:this._emails,hasSecondaryEmail:this._hasSecondaryEmail(),hasSecondaryVerifiedEmail:this._hasSecondaryVerifiedEmail(),isPanelOpen:this.isPanelOpen(),newEmail:this.newEmail}},beforeRender:function(){return this._isSecondaryEmailEnabled()},afterRender:function(){this._hasSecondaryEmail()&&!this._hasSecondaryVerifiedEmail()&&this.openPanel()},_isSecondaryEmailEnabled:function(){var a=this,b=this.getSignedInAccount()
;return p.test(b.get("email"))?b.sessionVerificationStatus().then(function(b){return b.sessionVerified?a._fetchEmails().fail(function(){return a.remove()}):a.remove()}):this.remove()},_hasSecondaryEmail:function(){return this._emails.length>1},_hasSecondaryVerifiedEmail:function(){return!!this._hasSecondaryEmail()&&this._emails[1].verified},_onDisconnectEmail:function(a){var b=this,c=d(a.currentTarget).data("id");return this.getSignedInAccount().recoveryEmailDestroy(c).then(function(){return b.render().then(function(){b.navigate("/settings/emails")})})},_fetchEmails:function(){var a=this;return this.getSignedInAccount().recoveryEmails().then(function(b){a._emails=b.map(function(a){return new g(a).toJSON()})})},refresh:l(function(){return this.render()},"button.settings-button.email-refresh",350),resend:function(a){var b=this,c=d(a.currentTarget).data("id");return this.getSignedInAccount().resendEmailCode(c).then(function(){b.displaySuccess(m.interpolate(o("A verification link has been sent to %(email)s"),{email:c}),{closePanel:!1}),b.navigate("/settings/emails")})},submit:function(){var a=this,b=this.getElementValue("input.new-email");if(this.isPanelOpen()&&b){return this.getSignedInAccount().recoveryEmailCreate(b).then(function(){a.displaySuccess(m.interpolate(o("Verification emailed to %(email)s"),{email:b}),{closePanel:!1}),a.render()}).fail(function(b){return a.showValidationError(a.$("input.new-email"),b)})}}});f.mixin(q,k,h),c.exports=q}),define("views/mixins/account-reset-mixin",["require","exports","module","lib/auth-errors","views/base"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/base"),f=e.t,g={initialize:function(a){a=a||{},this._session=a.session},events:{'click a[href="/confirm_reset_password"]':e.preventDefaultThen("sendAccountResetEmail")},notifyOfResetAccount:function(a){this._resetAccount=a;var b=d.toError("ACCOUNT_RESET");return b.forceMessage=f("Your account has been locked for security reasons")+'<br><a href="/confirm_reset_password">'+f("Reset password")+"</a>",this.unsafeDisplayError(b)},sendAccountResetEmail:function(){var a=this;return this.resetPassword(this._resetAccount.get("email")).fail(function(b){a._session.clear("oauth"),a.displayError(b)})}};c.exports=g}),define("views/mixins/flow-begin-mixin",["require","exports","module"],function(a,b,c){"use strict";c.exports={afterRender:function(){this.logFlowEventOnce("begin")}}}),define("views/mixins/migration-mixin",["require","exports","module","lib/constants"],function(a,b,c){"use strict";var d=a("lib/constants");c.exports={isSyncMigration:function(){return this.relier.get("migration")===d.SYNC11_MIGRATION},isAmoMigration:function(){return this.relier.get("migration")===d.AMO_MIGRATION}}}),define("views/mixins/signed-in-notification-mixin",["require","exports","module","lib/channels/notifier","lib/promise"],function(a,b,c){"use strict";var d=a("lib/channels/notifier"),e=a("lib/promise"),f={notifications:{},_navigateToSignedInView:function(a){return this.broker.hasCapability("handleSignedInNotification")&&(this.user.setSignedInAccountByUid(a.uid),this.navigate(this.model.get("redirectTo")||"settings")),e()}};f.notifications[d.SIGNED_IN]="_navigateToSignedInView",c.exports=f}),define("views/mixins/signin-mixin",["require","exports","module","lib/auth-errors","lib/promise","lib/verification-methods","lib/verification-reasons"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("lib/promise"),f=a("lib/verification-methods"),g=a("lib/verification-reasons");c.exports={signIn:function(a,b){var c=this,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!a||a.isDefault()||!a.has("sessionToken")&&!b?e.reject(d.toError("UNEXPECTED_ERROR")):this.invokeBrokerMethod("beforeSignIn",a).then(function(){return c.logFlowEvent("attempt","signin"),c.user.signInAccount(a,b,c.relier,{resume:c.getStringifiedResumeToken(a),unblockCode:f.unblockCode})}).then(function(a){return c._formPrefill&&c._formPrefill.clear(),c.relier.accountNeedsPermissions(a)?c.navigate("signin_permissions",{account:a,onSubmitComplete:c.onSignInSuccess.bind(c)}):c.onSignInSuccess(a)}).fail(function(e){if(d.is(e,"THROTTLED")||d.is(e,"REQUEST_BLOCKED"))return c.onSignInBlocked(a,b,e);throw e})},onSignInBlocked:function(a,b,c){var d=this;return c.verificationReason===g.SIGN_IN&&c.verificationMethod===f.EMAIL_CAPTCHA?a.sendUnblockEmail().then(function(){return d.navigate("signin_unblock",{account:a,lastPage:d.currentPage,password:b})}):e.reject(c)},onSignInSuccess:function(a){if(!a.get("verified")){var b=a.get("verificationMethod");return a.get("verificationReason")===g.SIGN_IN&&b===f.EMAIL?this.navigate("confirm_signin",{account:a}):this.navigate("confirm",{account:a})}a.get("uid")!==this.relier.get("uid")&&this.broker.hasCapability("allowUidChange")&&this.relier.set("uid",a.get("uid")),this.logEvent("signin.success"),this.logEvent("signin.success.skip-confirm"),this.logViewEvent("signin.success");var c=this.afterSignInBrokerMethod||"afterSignIn",d=this.afterSignInNavigateData||{};return this.invokeBrokerMethod(c,a).then(this.navigate.bind(this,this.model.get("redirectTo")||"settings",{},d))}}}),define("stache!templates/sign_in",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-signin-header">\n      {{#serviceName}}\n        \x3c!-- L10N: For languages structured like English, the second phrase can read "to continue to %(serviceName)s" --\x3e\n        {{ headerSignInText }} <span class="service">{{#t}}Continue to %(serviceName)s{{/t}}</span>\n      {{/serviceName}}\n      {{^serviceName}}\n        {{ headerSignInText }}\n      {{/serviceName}}\n    </h1>\n  </header>\n\n  <section>\n    {{#error}}\n      <div class="error visible">{{ error }}</div>\n    {{/error}}\n\n    {{^error}}\n      <div class="error"></div>\n      <div class="success"></div>\n      {{#isAmoMigration}}\n        <div class="info nudge pad" id="amo-migration">{{#unsafeTranslate}}Looking for your Add-ons data? <a href="/signup">Sign up</a> for a Firefox Account with your old Add-ons account email address.{{/unsafeTranslate}}</div>\n      {{/isAmoMigration}}\n      {{#isSyncMigration}}\n        <div class="info nudge" id="sync-migration">{{#unsafeTranslate}}Migrate your sync data by signing in to your Firefox&nbsp;Account.{{/unsafeTranslate}}</div>\n      {{/isSyncMigration}}\n\n      {{#suggestedAccount}}\n          <div class="avatar-wrapper avatar-view">\n          </div>\n          <p class="prefillEmail">{{ email }}</p>\n\n        {{#chooserAskForPassword}}\n          <form novalidate>\n            <input type="email" class="email hidden" value="{{ email }}" />\n\n            <div class="input-row password-row">\n              <input type="password" class="password tooltip-below" id="password" placeholder="{{#t}}Password{{/t}}" value="{{ password }}" required pattern=".{8,}" autofocus />\n            </div>\n\n            <div class="button-row">\n              <button id="submit-btn" type="submit" class="disabled">{{buttonSignInText}}</button>\n            </div>\n           </form>\n\n           <div class="links">\n             <a href="/reset_password" class="left reset-password" data-flow-event="forgot-password">{{#t}}Forgot password?{{/t}}</a>\n             <a href="/signin?email=blank" class="right use-different" data-flow-event="use-different-account">{{#t}}Use a different account{{/t}}</a><br/>\n           </div>\n        {{/chooserAskForPassword}}\n\n        {{^chooserAskForPassword}}\n          <div class="button-row">\n            <button type="submit" class="use-logged-in">{{buttonSignInText}}</button>\n          </div>\n\n          <div class="links">\n            <a href="/signin?email=blank" class="use-different" data-flow-event="use-different-account">{{#t}}Use a different account{{/t}}</a><br/>\n          </div>\n        {{/chooserAskForPassword}}\n      {{/suggestedAccount}}\n\n      {{^suggestedAccount}}\n        <form novalidate>\n        <div class="input-row">\n          <input type="email" class="email{{#email}} prefilled{{/email}}" placeholder="{{#t}}Email{{/t}}" value="{{ email }}" spellcheck="false" {{^email}}autofocus{{/email}}>\n        </div>\n\n        <div class="input-row password-row">\n          <input type="password" class="password tooltip-below" id="password" placeholder="{{#t}}Password{{/t}}" value="{{ password }}" pattern=".{8,}" required {{#email}}autofocus{{/email}} />\n        </div>\n\n        <div class="button-row">\n          <button id="submit-btn" type="submit" class="disabled">{{buttonSignInText}}</button>\n        </div>\n      </form>\n\n      <div class="links">\n          <a href="/reset_password" class="left reset-password" data-flow-event="forgot-password">{{#t}}Forgot password?{{/t}}</a>\n          <a href="/signup" class="right sign-up" data-flow-event="create-account">{{#t}}Create an account{{/t}}</a>\n      </div>\n\n      <div class="extra-links">\n        {{#unsafeTranslate}}By proceeding, you agree to the <a id="fxa-tos" href="/legal/terms">Terms of Service</a> and <a id="fxa-pp" href="/legal/privacy">Privacy Notice</a> of Firefox cloud services.{{/unsafeTranslate}}\n      </div>\n      {{/suggestedAccount}}\n\n    {{/error}}\n  </section>\n</div>\n')}),define("views/sign_in",["require","exports","module","views/mixins/account-reset-mixin","views/decorators/allow_only_one_submit","lib/auth-errors","views/mixins/avatar-mixin","cocktail","views/mixins/experiment-mixin","views/mixins/flow-begin-mixin","views/mixins/flow-events-mixin","views/form","views/mixins/migration-mixin","views/mixins/password-mixin","views/mixins/password-reset-mixin","views/base","views/mixins/resume-token-mixin","views/mixins/service-mixin","lib/session","views/decorators/progress_indicator","views/mixins/signed-in-notification-mixin","views/mixins/signin-mixin","stache!templates/sign_in"],function(a,b,c){"use strict";var d=a("views/mixins/account-reset-mixin"),e=a("views/decorators/allow_only_one_submit"),f=a("lib/auth-errors"),g=a("views/mixins/avatar-mixin"),h=a("cocktail"),i=a("views/mixins/experiment-mixin"),j=a("views/mixins/flow-begin-mixin"),k=a("views/mixins/flow-events-mixin"),l=a("views/form"),m=a("views/mixins/migration-mixin"),n=a("views/mixins/password-mixin"),o=a("views/mixins/password-reset-mixin"),p=a("views/base"),q=p.preventDefaultThen,r=p.t,s=a("views/mixins/resume-token-mixin"),t=a("views/mixins/service-mixin"),u=a("lib/session"),v=a("views/decorators/progress_indicator"),w=a("views/mixins/signed-in-notification-mixin"),x=a("views/mixins/signin-mixin"),y=a("stache!templates/sign_in"),z=l.prototype,A=l.extend({template:y,className:"sign-in",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._formPrefill=a.formPrefill,this.user.logNumStoredAccounts()},beforeRender:function(){this._account=this._suggestedAccount()},afterVisible:function(){var a=this;z.afterVisible.call(this);var b=this.getAccount();return this.listenTo(b,"change:accessToken",function(){if(!b.has("accessToken")&&a.$(".password").is(":hidden"))return a.chooserAskForPassword=!0,a.render().then(function(){return a.setDefaultPlaceholderAvatar()})}),this.displayAccountProfileImage(b,{spinner:!0})},getAccount:function(){return this._account},getPrefillEmail:function(){return this._formPrefill.get("email")||this.relier.get("email")},getEmail:function(){var a=this.getAccount();return a.get("email")?a.get("email"):this.getPrefillEmail()},context:function(){var a=this.getAccount(),b=a.get("email"),c=this.getEmail(),d=this.translate(r("Sign in"),{msgctxt:"submit button"}),e=this.translate(r("Sign in"),{msgctxt:"header text"});return{buttonSignInText:d,chooserAskForPassword:this._suggestedAccountAskPassword(a),email:c,error:this.error,headerSignInText:e,isAmoMigration:this.isAmoMigration(),isSyncMigration:this.isSyncMigration(),password:this._formPrefill.get("password"),serviceName:this.relier.get("serviceName"),suggestedAccount:b}},events:{"click .use-different":"useDifferentAccount","click .use-logged-in":"useLoggedInAccount"},beforeDestroy:function(){this._formPrefill.set("email",this.getElementValue(".email")),this._formPrefill.set("password",this.getElementValue(".password"))},submit:function(){var a=this.user.initAccount({email:this.getElementValue(".email")}),b=this.getElementValue(".password");return this._signIn(a,b)},_signIn:function(a,b){return this.signIn(a,b).fail(this.onSignInError.bind(this,a,b))},onSignInError:function(a,b,c){if(f.is(c,"UNKNOWN_ACCOUNT"))return this._suggestSignUp(c);if(f.is(c,"USER_CANCELED_LOGIN"))return void this.logViewEvent("canceled");if(f.is(c,"ACCOUNT_RESET"))return this.notifyOfResetAccount(a);if(f.is(c,"INCORRECT_PASSWORD"))return this.showValidationError(this.$("#password"),c);throw c},_suggestSignUp:function(a){return this.isAmoMigration()?(a.forceMessage=r('Unknown Firefox Account. <a href="/signup">Sign up</a> using your previous Add-ons account email address to access your Add-ons data.'),this.$("#amo-migration").hide()):a.forceMessage=r('Unknown account. <a href="/signup">Sign up</a>'),this.unsafeDisplayError(a)},useLoggedInAccount:e(v(function(){var a=this,b=this.getAccount();return this._signIn(b,null).fail(function(){return a.chooserAskForPassword=!0,a.render().then(function(){return a.user.removeAccount(b),a.displayError(f.toError("SESSION_EXPIRED"))})})})),useDifferentAccount:q(function(){return this.user.removeAllAccounts(),u.clear(),this._formPrefill.clear(),this.logViewEvent("use-different-account"),this.render()}),_suggestedAccount:function(){var a=this.user,b=a.getChooserAccount();return this._allowSuggestedAccount(b)?b:a.initAccount({})},_allowSuggestedAccount:function(a){var b=this.getPrefillEmail();return!(!this.relier.allowCachedCredentials()||b!==a.get("email")&&b)},_suggestedAccountAskPassword:function(a){if(!a.get("email"))return this.logViewEvent("ask-password.shown.account-unknown"),!0;if(this.relier.wantsKeys())return this.logViewEvent("ask-password.shown.keys-required"),!0;if(!this.user.isSyncAccount(a))return this.logViewEvent("ask-password.shown.session-from-web"),!0;if(!0===this.chooserAskForPassword)return this.logViewEvent("ask-password.shown.session-expired"),!0;var b=this.getPrefillEmail();return b&&b!==a.get("email")?(this.logViewEvent("ask-password.shown.email-mismatch"),!0):(this.logViewEvent("ask-password.skipped"),!1)}});h.mixin(A,d,g,i,k,j,m,n,o,s,t,x,w),c.exports=A}),define("stache!templates/force_auth",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-force-auth-header">{{#t}}Sign in to continue{{/t}}</h1>\n  </header>\n\n  <section>\n    {{#fatalError}}\n      <div class="error visible"></div>\n    {{/fatalError}}\n    {{^fatalError}}\n\n    <div class="error"></div>\n    <div class="avatar-wrapper avatar-view">\n    </div>\n    <form novalidate>\n      <p class="prefillEmail">{{ email }}</p>\n      <input type="email" class="email hidden" value="{{ email }}" disabled />\n      <div class="input-row password-row">\n        <input type="password" class="password tooltip-below" id="password" placeholder="{{#t}}Password{{/t}}" required pattern=".{8,}" value="{{ password }}" required {{#email}}autofocus{{/email}} />\n      </div>\n\n      <div class="button-row">\n        <button id="submit-btn" type="submit" class="disabled">{{buttonSignInText}}</button>\n      </div>\n    </form>\n\n    <div class="links">\n      <a href="/reset_password" class="reset-password" data-flow-event="forgot-password">{{#t}}Forgot password?{{/t}}</a>\n    </div>\n\n    <div class="extra-links">\n      {{#unsafeTranslate}}By proceeding, you agree to the <a id="fxa-tos" href="/legal/terms">Terms of Service</a> and <a id="fxa-pp" href="/legal/privacy">Privacy Notice</a> of Firefox cloud services.{{/unsafeTranslate}}\n    </div>\n    {{/fatalError}}\n  </section>\n</div>\n')}),define("views/force_auth",["require","exports","module","underscore","lib/auth-errors","views/base","cocktail","views/form","views/behaviors/null","lib/promise","views/mixins/password-reset-mixin","views/sign_in","stache!templates/force_auth","lib/transform","lib/vat"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/auth-errors"),f=a("views/base"),g=f.cancelEventThen,h=f.t,i=a("cocktail"),j=a("views/form"),k=a("views/behaviors/null"),l=a("lib/promise"),m=a("views/mixins/password-reset-mixin"),n=a("views/sign_in"),o=a("stache!templates/force_auth"),p=a("lib/transform"),q=a("lib/vat"),r={email:q.email().required(),uid:q.uid().allow(null)},s=n.prototype,t=n.extend({template:o,className:"force-auth",afterSignInBrokerMethod:"afterForceAuth",afterSignInNavigateData:{clearQueryParams:!0},_getAndValidateAccountData:function(){var a=["email","uid"],b={},c=this.relier;return a.forEach(function(a){c.has(a)&&(b[a]=c.get(a))}),p.transformUsingSchema(b,r,e)},beforeRender:function(){var a,b=this;try{a=this._getAndValidateAccountData()}catch(a){return this.fatalError(a),!1}var c=this.user.initAccount({email:a.email,uid:a.uid});return a.uid?l.all([this.user.checkAccountEmailExists(c),this.user.checkAccountUidExists(c)]).spread(function(a,d){return a?d?void 0:b._signInIfUidChangeSupported(c):b._signUpIfUidChangeSupported(c)}):this.user.checkAccountEmailExists(c).then(function(a){if(!a)return b._navigateToForceSignUp(c)})},_signUpIfUidChangeSupported:function(a){if(this.broker.hasCapability("allowUidChange"))return this._navigateToForceSignUp(a);this.model.set("error",e.toError("DELETED_ACCOUNT"))},_signInIfUidChangeSupported:function(a){this.broker.hasCapability("allowUidChange")||this.model.set("error",e.toError("DELETED_ACCOUNT"))},_navigateToForceSignUp:function(a){return this.broker.setBehavior("beforeSignUpConfirmationPoll",new k),this.navigate(this.broker.transformLink("signup"),{error:e.toError("DELETED_ACCOUNT"),forceEmail:a.get("email")})},_navigateToForceResetPassword:function(){return this.navigate(this.broker.transformLink("reset_password"),{forceEmail:this.relier.get("email")})},context:function(){return{buttonSignInText:this.translate(h("Sign in"),{msgctxt:"submit button"}),email:this.relier.get("email"),password:this._formPrefill.get("password")}},events:d.extend({},n.prototype.events,{'click a[href="/reset_password"]':g("_navigateToForceResetPassword")}),beforeDestroy:function(){this._formPrefill.set("password",this.getElementValue(".password"))},onSignInError:function(a,b,c){if(e.is(c,"UNKNOWN_ACCOUNT")){if(!this.relier.has("uid"))return this._navigateToForceSignUp(a);if(this.broker.hasCapability("allowUidChange"))return this._navigateToForceSignUp(a);this.displayError(e.toError("DELETED_ACCOUNT"))}return s.onSignInError.call(this,a,b,c)},afterVisible:function(){var a=this.relier.get("email"),b=this.user.getAccountByEmail(a);return j.prototype.afterVisible.call(this),this.displayAccountProfileImage(b,{spinner:!0})}});i.mixin(t,m),c.exports=t}),define("views/index",["require","exports","module","views/base"],function(a,b,c){"use strict";var d=a("views/base");c.exports=d.extend({beforeRender:function(){var a=void 0;a=this.user.getSignedInAccount().get("sessionToken")?"settings":"signup",this.navigate(a,{},{replace:!0,trigger:!0})}})}),define("stache!templates/legal",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header id="legal-header">\n    <h3>{{#t}}Firefox cloud services{{/t}}</h3>\n    <h1 id="fxa-legal-header">{{#t}}Legal{{/t}}</h1>\n  </header>\n\n  <section class="links">\n    <a href="/legal/terms" class="left">{{#t}}Terms of Service{{/t}}</a>\n    <a href="/legal/privacy" class="right">{{#t}}Privacy Notice{{/t}}</a>\n  </section>\n</div>\n')}),define("views/legal",["require","exports","module","views/base","stache!templates/legal"],function(a,b,c){"use strict";var d=a("views/base"),e=a("stache!templates/legal"),f=d.extend({className:"legal",template:e});c.exports=f}),define("views/oauth_index",["require","exports","module","views/base","lib/promise"],function(a,b,c){"use strict";var d=a("views/base"),e=a("lib/promise");c.exports=d.extend({beforeRender:function(){var a=this,b=this.relier.get("email");return e().then(function(){if(b){var c=a.user.initAccount({email:b});return a.user.checkAccountEmailExists(c).then(function(a){return a?"oauth/signin":"oauth/signup"},function(b){a.logError(b)})}}).then(function(b){b||(b=a.user.getChooserAccount().isDefault()?"oauth/signup":"oauth/signin"),a.navigate(b,{},{replace:!0,trigger:!0})})}})}),define("stache!templates/partial/permission",["mustache"],function(a){return a.compile('<fieldset class="checkbox-row {{^visible}}hidden{{/visible}}" {{#required}}disabled{{/required}}>\n  <label class="fxa-checkbox">\n    <input class="permission" name="{{ name }}" type="checkbox" checked="checked" value="{{ name }}" {{#required}}disabled{{/required}}/>\n\n    {{#valueVisible}}\n      <span class="fxa-checkbox__value">{{ value }}</span>\n      <div class="fxa-checkbox__label">{{ label }}</div>\n    {{/valueVisible}}\n\n    {{^valueVisible}}\n      <span class="fxa-checkbox__value">{{ label }}</span>\n    {{/valueVisible}}\n  </label>\n</fieldset>\n\n')}),define("stache!templates/permissions",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-permissions-header">{{#t}}Request for permission{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <p id="permission-request">{{#t}}%(serviceName)s wants the following information from your account:{{/t}}</p>\n\n    <form id="permissions" novalidate>\n      {{{ unsafePermissionsHTML }}}\n\n      <div class="button-row">\n        <button id="accept" type="submit">{{#t}}Accept{{/t}}</button>\n      </div>\n    </form>\n\n    <ul class="links permission-links">\n      <li><a href="#" id="back">{{#t}}Cancel{{/t}}</a></li>\n    </ul>\n\n  </section>\n</div>\n')}),define("views/permissions",["require","exports","module","underscore","models/account","views/mixins/back-mixin","views/base","views/mixins/checkbox-mixin","cocktail","views/form","lib/oauth-errors","stache!templates/partial/permission","views/mixins/service-mixin","lib/strings","stache!templates/permissions","views/mixins/verification-reason-mixin"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/account"),f=a("views/mixins/back-mixin"),g=a("views/base"),h=a("views/mixins/checkbox-mixin"),i=a("cocktail"),j=a("views/form"),k=a("lib/oauth-errors"),l=a("stache!templates/partial/permission"),m=a("views/mixins/service-mixin"),n=a("lib/strings"),o=a("stache!templates/permissions"),p=a("views/mixins/verification-reason-mixin"),q=g.t,r=q("%(permissionName)s (required)"),s=[{label:q("Email address"),name:"profile:email",required:!0},{label:q("Display name"),name:"profile:display_name"},{label:q("Account picture"),name:"profile:avatar",valueVisible:!1},{label:"uid",name:"profile:uid",required:!0,visible:!1}],t=j.extend({template:o,className:"permissions",initialize:function(a){this._account=this.user.initAccount(this.model.get("account")),this.type=a.type,this.onSubmitComplete=this.model.get("onSubmitComplete"),this._validatePermissions(this.relier.get("permissions")||[])},getAccount:function(){return this._account},context:function(){var a=this.getAccount(),b=this.relier.get("permissions"),c=this._getApplicablePermissions(a,b);return{serviceName:this.relier.get("serviceName"),unsafePermissionsHTML:this._getPermissionsHTML(a,c)}},_validatePermissions:function(a){a.forEach(function(a){this._getPermissionConfig(a)||this.logError(k.toError("INVALID_SCOPES",a))},this)},_getPermissionConfig:function(a){var b=d.findWhere(s,{name:a});return b?d.clone(b):null},_getApplicablePermissions:function(a,b){var c=this;return a.getPermissionsWithValues(b).map(function(a){return c._getPermissionConfig(a)?a:null}).filter(function(a){return null!==a})},_getPermissionIndex:function(a){return d.findIndex(s,function(b){return b.name===a})},_sortPermissions:function(a){var b=this;return[].concat(a).sort(function(a,c){return b._getPermissionIndex(a)-b._getPermissionIndex(c)})},_getPermissionsHTML:function(a,b){var c=this;return this._sortPermissions(b).map(function(b){var d=c._getPermissionConfig(b);!0!==d.required&&(d.required=!1),d.required&&(d.label=n.interpolate(r,{permissionName:d.label})),!1!==d.valueVisible&&(d.valueVisible=!0),!1!==d.visible&&(d.visible=!0);var f=e.PERMISSIONS_TO_KEYS[b];return d.value=a.get(f),d}).map(l).join("\n")},_getFormPermissions:function(){var a=this.$(".permission"),b={};return a.each(function(a,c){b[c.name]=!!c.checked}),b},beforeRender:function(){if(!this.getAccount().get("sessionToken"))return void this.navigate(this._previousView());var a=this.getAccount();return a.get("verified")?a.fetchProfile():void 0},submit:function(){var a=this.getAccount();return this.logViewEvent("accept"),a.setClientPermissions(this.relier.get("clientId"),this._getFormPermissions()),this.user.setAccount(a).then(this.onSubmitComplete)},_previousView:function(){var a=this.isSignUp()?"/signup":"/signin";return this.broker.transformLink(a)}},{PERMISSIONS:s});i.mixin(t,f,h,m,p),c.exports=t}),define("views/legal_copy",["require","exports","module","views/mixins/back-mixin","views/base","cocktail","lib/xhr"],function(a,b,c){"use strict";var d=a("views/mixins/back-mixin"),e=a("views/base"),f=a("cocktail"),g=a("lib/xhr"),h=e.prototype,i=e.extend({initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._xhr=a.xhr||g},afterRender:function(){var a=this;return this._xhr.ajax({accepts:{text:"text/partial"},dataType:"text",url:this.copyUrl}).then(function(b){return a.$("#legal-copy").html(b),a.$(".hidden").removeClass("hidden"),a.window.document.cookie="canGoBack=1; path="+a.window.location.pathname,h.afterRender.call(a)}).fail(function(){a.displayError(a.fetchError),a.$(".hidden").removeClass("hidden")})},afterVisible:function(){return this.$(".hidden").removeClass("hidden"),this.$("#legal-copy").attr("data-shown","true"),h.afterVisible.call(this)}});f.mixin(i,d),c.exports=i}),define("stache!templates/pp",["mustache"],function(a){return a.compile('<div id="main-content" class="panel">\n  <header id="legal-header">\n    <h3>{{#t}}Firefox cloud services{{/t}}</h3>\n    <h1 id="fxa-pp-header">{{#t}}Privacy Notice{{/t}}</h1>\n  </header>\n\n  <section class="hidden">\n    <div class="error"></div>\n\n    <article id="legal-copy">\n    </article>\n\n    {{#canGoBack}}\n      <div class="button-row">\n        <button id="fxa-pp-back" class="back">{{#t}}Back{{/t}}</button>\n      </div>\n    {{/canGoBack}}\n  </section>\n</div>\n')}),define("views/pp",["require","exports","module","lib/auth-errors","views/legal_copy","stache!templates/pp"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/legal_copy"),f=a("stache!templates/pp"),g=e.extend({className:"pp",copyUrl:"/legal/privacy",events:{"click #fxa-pp-back":"back","keyup #fxa-pp-back":"backOnEnter"},fetchError:d.toError("COULD_NOT_GET_PP"),template:f});c.exports=g}),define("stache!templates/ready",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="{{headerId}}">{{headerTitle}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n\n    <div class="graphic graphic-checkbox">{{#t}}Success{{/t}}</div>\n\n    {{#isSync}}\n      <p class="account-ready-service">{{readyToSyncText}}</p>\n    {{/isSync}}\n\n    {{^isSync}}\n      {{#serviceName}}\n        <p class="account-ready-service">{{#t}}You are now ready to use %(serviceName)s{{/t}}</p>\n      {{/serviceName}}\n      {{^serviceName}}\n          {{#secondaryEmailVerified}}\n              <p class="account-ready-service">{{#t}}Account notifications will now also be sent to %(secondaryEmailVerified)s{{/t}}</p>\n          {{/secondaryEmailVerified}}\n          {{^secondaryEmailVerified}}\n              <p class="account-ready-generic">{{#t}}Your account is ready!{{/t}}</p>\n          {{/secondaryEmailVerified}}\n      {{/serviceName}}\n    {{/isSync}}\n\n    <div class="marketing-area"></div>\n  </section>\n</div>\n\n')}),define("views/ready",["require","exports","module","cocktail","lib/constants","views/mixins/experiment-mixin","views/mixins/flow-events-mixin","views/form","views/mixins/marketing-mixin","views/mixins/pulse-graphic-mixin","views/mixins/service-mixin","stache!templates/ready","views/mixins/verification-reason-mixin"],function(a,b,c){"use strict";var d=a("cocktail"),e=a("lib/constants"),f=a("views/mixins/experiment-mixin"),g=a("views/mixins/flow-events-mixin"),h=a("views/form"),i=a("views/mixins/marketing-mixin"),j=a("views/mixins/pulse-graphic-mixin"),k=a("views/mixins/service-mixin"),l=a("stache!templates/ready"),m=a("views/mixins/verification-reason-mixin"),n=function(a){return a},o={FORCE_AUTH:{headerId:"fxa-force-auth-complete-header",headerTitle:n("Welcome back"),readyToSyncText:n("Firefox Sync will resume momentarily")},PASSWORD_RESET:{headerId:"fxa-reset-password-complete-header",headerTitle:n("Password reset"),readyToSyncText:n("Complete set-up by entering the new password on your other Firefox devices.")},SECONDARY_EMAIL_VERIFIED:{headerId:"fxa-sign-up-complete-header",headerTitle:n("Email verified")},SIGN_IN:{headerId:"fxa-sign-in-complete-header",headerTitle:n("Sign-in confirmed"),readyToSyncText:n("You are now ready to use %(serviceName)s")},SIGN_UP:{headerId:"fxa-sign-up-complete-header",headerTitle:n("Account verified"),readyToSyncText:n("You are now ready to use %(serviceName)s")}},p=h.extend({template:l,className:"ready",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._templateInfo=o[this.keyOfVerificationReason(a.type)]},context:function(){return{headerId:this._getHeaderId(),headerTitle:this._getHeaderTitle(),isSync:this.relier.isSync(),readyToSyncText:this._getReadyToSyncText(),redirectUri:this.relier.get("redirectUri"),secondaryEmailVerified:this.getSearchParam("secondary_email_verified")||null,service:this.relier.get("service"),serviceName:this.relier.get("serviceName")}},_getHeaderId:function(){return this._templateInfo.headerId},_getHeaderTitle:function(){var a=this._templateInfo.headerTitle;return this.translateInTemplate(a)},_getReadyToSyncText:function(){var a=this._templateInfo.readyToSyncText;return this.translateInTemplate(a)}});d.mixin(p,f,g,i({marketingId:e.MARKETING_ID_SPRING_2015}),j,k,m),c.exports=p}),define("stache!templates/report_sign_in",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  {{#isLinkDamaged}}\n    <header>\n      <h1 id="fxa-report-sign-in-link-damaged-header">{{#t}}Link damaged{{/t}}</h1>\n    </header>\n\n    <section>\n      <p>\n        {{#t}}The link you clicked was missing characters, and may have been broken by your email client. Copy the address carefully, and try again.{{/t}}\n      </p>\n    </section>\n  {{/isLinkDamaged}}\n\n  {{#isLinkValid}}\n    <header>\n      <h1 id="fxa-report-sign-in-header">{{#t}}Report unauthorized sign-in?{{/t}}</h1>\n    </header>\n\n    <section>\n      <div class="success"></div>\n      <div class="error"></div>\n\n      <p>\n        {{#t}}You received an email about attempted access to your account. Would you like to report this activity as suspicious?{{/t}}\n      </p>\n\n      <form novalidate>\n        <div class="button-row">\n          <button id="submit-btn" type="submit">{{#t}}Report activity{{/t}}</button>\n        </div>\n      </form>\n    </section>\n\n    {{#hasSupportLink}}\n      <div class="links">\n        <a href="{{{ escapedSupportLink }}}" id="support-link" target="_blank">{{#t}}Why is this happening?{{/t}}</a>\n      </div>\n    {{/hasSupportLink}}\n  {{/isLinkValid}}\n</div>\n')}),define("models/verification/report-sign-in",["require","exports","module","lib/vat","./base"],function(a,b,c){"use strict";var d=a("lib/vat"),e=a("./base");c.exports=e.extend({defaults:{
uid:null,unblockCode:null},validation:{uid:d.uid().required(),unblockCode:d.unblockCode().required()}})}),define("views/report_sign_in",["require","exports","module","lib/auth-errors","lib/constants","views/form","stache!templates/report_sign_in","models/verification/report-sign-in"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("lib/constants"),f=a("views/form"),g=a("stache!templates/report_sign_in"),h=a("models/verification/report-sign-in"),i=f.extend({className:"report-sign-in",template:g,initialize:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._signInToReport=new h(this.getSearchParams())},beforeRender:function(){this._signInToReport.isValid()||this.logError(d.toError("DAMAGED_REJECT_UNBLOCK_LINK"))},submit:function(){var a=this,b=this._signInToReport,c=this.user.initAccount({uid:b.get("uid")}),d=b.get("unblockCode");return this.user.rejectAccountUnblockCode(c,d).then(function(){return a.navigate("signin_reported")})},context:function(){var a=!this._signInToReport.isValid(),b=!a,c=this._getSupportLink();return{escapedSupportLink:encodeURI(c),hasSupportLink:!!c,isLinkDamaged:a,isLinkValid:b}},_getSupportLink:function(){return e.BLOCKED_SIGNIN_SUPPORT_URL}});c.exports=i}),define("stache!templates/reset_password",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-reset-password-header">\n      {{#serviceName}}\n        \x3c!-- L10N: For languages structured like English, the second phrase can read "to continue to %(serviceName)s" --\x3e\n        {{#t}}Reset account{{/t}} <span class="service">{{#t}}Continue to %(serviceName)s{{/t}}</span>\n      {{/serviceName}}\n      {{^serviceName}}\n        {{#t}}Reset account{{/t}}\n      {{/serviceName}}\n    </h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n\n    <form novalidate>\n      <p class="reset-warning">\n        {{#t}}When you reset your password, you will lose any Sync data that is not on one of your devices.{{/t}}\n        <a href="https://support.mozilla.org/products/firefox/sync" target="_blank">{{#t}}Learn how Sync works.{{/t}}</a>\n      </p>\n      <div class="input-row">\n        {{#forceEmail}}\n          <p class="prefillEmail">{{ forceEmail }}</p>\n          <input type="email" class="email hidden" value="{{ forceEmail }}" disabled />\n        {{/forceEmail}}\n        {{^forceEmail}}\n          <input name="email" type="email" class="email" placeholder="{{#t}}Email{{/t}}" spellcheck="false" autofocus required>\n        {{/forceEmail}}\n      </div>\n\n      <div class="button-row">\n        <button id="submit-btn" type="submit" class="disabled">{{#t}}Begin reset{{/t}}</button>\n      </div>\n    </form>\n\n    <div class="links">\n      {{#forceEmail}}\n        <a href="/force_auth" class="sign-in">{{#t}}Remember password? Sign in.{{/t}}</a>\n      {{/forceEmail}}\n      {{^forceEmail}}\n        <a href="/signin" class="sign-in">{{#t}}Remember password? Sign in.{{/t}}</a>\n      {{/forceEmail}}\n    </div>\n\n  </section>\n</div>\n')}),define("views/reset_password",["require","exports","module","lib/auth-errors","views/base","cocktail","views/form","views/mixins/flow-events-mixin","views/mixins/password-reset-mixin","views/mixins/service-mixin","lib/session","stache!templates/reset_password"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/base"),f=a("cocktail"),g=a("views/form"),h=a("views/mixins/flow-events-mixin"),i=a("views/mixins/password-reset-mixin"),j=a("views/mixins/service-mixin"),k=a("lib/session"),l=a("stache!templates/reset_password"),m=e.t,n=g.extend({template:l,className:"reset_password",initialize:function(a){a=a||{},this._formPrefill=a.formPrefill},context:function(){return{forceEmail:this.model.get("forceEmail"),serviceName:this.relier.get("serviceName")}},beforeRender:function(){var a=this,b=this.relier.get("email");return!1===this.relier.get("resetPasswordConfirm")&&b?this._resetPassword(b).then(function(){return!1}).fail(function(b){a.model.set("error",b)}):g.prototype.beforeRender.call(this)},beforeDestroy:function(){this._formPrefill.set("email",this.getElementValue(".email"))},submit:function(){return this._resetPassword(this.getElementValue(".email"))},_resetPassword:function(a){var b=this;return this.resetPassword(a).fail(function(a){if(k.clear("oauth"),d.is(a,"UNKNOWN_ACCOUNT"))return a.forceMessage=m('Unknown account. <a href="/signup">Sign up</a>'),b.unsafeDisplayError(a);if(d.is(a,"USER_CANCELED_LOGIN"))return void b.logEvent("login.canceled");throw a})}});f.mixin(n,h,i,j),c.exports=n}),define("stache!templates/settings/avatar",["mustache"],function(a){return a.compile('<div id="change-avatar" class="settings-unit">\n  <div class="settings-unit-stub">\n    <header class="settings-unit-summary">\n      <h2 class="settings-unit-title">{{#t}}Account picture{{/t}}</h2>\n    </header>\n    {{#avatar}}\n      <button class="settings-button secondary settings-unit-toggle" data-href="settings/avatar/change">\n      <span class="change-button">{{#t}}Change{{/t}}</span>\n      </button>\n    {{/avatar}}\n    {{^avatar}}\n      <button class="settings-button primary settings-unit-toggle" data-href="settings/avatar/change">\n      <span class="add-button">{{#t}}Add{{/t}}</span>\n      </button>\n    {{/avatar}}\n  </div>\n</div>\n')}),define("views/settings/avatar",["require","exports","module","views/mixins/avatar-mixin","cocktail","views/form","views/mixins/settings-panel-mixin","stache!templates/settings/avatar"],function(a,b,c){"use strict";var d=a("views/mixins/avatar-mixin"),e=a("cocktail"),f=a("views/form"),g=a("views/mixins/settings-panel-mixin"),h=a("stache!templates/settings/avatar"),i=f.extend({template:h,className:"avatar",viewName:"settings.avatar",onProfileUpdate:function(){this.render()},context:function(){return{avatar:this.getSignedInAccount().has("profileImageUrl")}}});e.mixin(i,d,g),c.exports=i}),function(a){"object"==typeof module&&"object"==typeof module.exports?a(require("jquery"),window,document):a(jQuery,window,document)}(function(a,b,c,d){var e=[],f=function(){return e.length?e[e.length-1]:null},g=function(){var a,b=!1;for(a=e.length-1;a>=0;a--)e[a].$blocker&&(e[a].$blocker.toggleClass("current",!b).toggleClass("behind",b),b=!0)};a.modal=function(b,c){var d,g;if(this.$body=a("body"),this.options=a.extend({},a.modal.defaults,c),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),this.$blocker=null,this.options.closeExisting)for(;a.modal.isActive();)a.modal.close();if(e.push(this),b.is("a"))if(g=b.attr("href"),/^#/.test(g)){if(this.$elm=a(g),1!==this.$elm.length)return null;this.$body.append(this.$elm),this.open()}else this.$elm=a("<div>"),this.$body.append(this.$elm),d=function(a,b){b.elm.remove()},this.showSpinner(),b.trigger(a.modal.AJAX_SEND),a.get(g).done(function(c){if(a.modal.isActive()){b.trigger(a.modal.AJAX_SUCCESS);var e=f();e.$elm.empty().append(c).on(a.modal.CLOSE,d),e.hideSpinner(),e.open(),b.trigger(a.modal.AJAX_COMPLETE)}}).fail(function(){b.trigger(a.modal.AJAX_FAIL),f().hideSpinner(),e.pop(),b.trigger(a.modal.AJAX_COMPLETE)});else this.$elm=b,this.$body.append(this.$elm),this.open()},a.modal.prototype={constructor:a.modal,open:function(){var b=this;this.block(),this.options.doFade?setTimeout(function(){b.show()},this.options.fadeDuration*this.options.fadeDelay):this.show(),a(c).off("keydown.modal").on("keydown.modal",function(a){var b=f();27==a.which&&b.options.escapeClose&&b.close()}),this.options.clickClose&&this.$blocker.click(function(b){b.target==this&&a.modal.close()})},close:function(){e.pop(),this.unblock(),this.hide(),a.modal.isActive()||a(c).off("keydown.modal")},block:function(){this.$elm.trigger(a.modal.BEFORE_BLOCK,[this._ctx()]),this.$body.css("overflow","hidden"),this.$blocker=a('<div class="jquery-modal blocker current"></div>').appendTo(this.$body),g(),this.options.doFade&&this.$blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger(a.modal.BLOCK,[this._ctx()])},unblock:function(b){!b&&this.options.doFade?this.$blocker.fadeOut(this.options.fadeDuration,this.unblock.bind(this,!0)):(this.$blocker.children().appendTo(this.$body),this.$blocker.remove(),this.$blocker=null,g(),a.modal.isActive()||this.$body.css("overflow",""))},show:function(){this.$elm.trigger(a.modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=a('<a href="#close-modal" rel="modal:close" class="close-modal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass).appendTo(this.$blocker),this.options.doFade?this.$elm.css("opacity",0).show().animate({opacity:1},this.options.fadeDuration):this.$elm.show(),this.$elm.trigger(a.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(a.modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove();var b=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){b.$elm.trigger(a.modal.AFTER_CLOSE,[b._ctx()])}):this.$elm.hide(0,function(){b.$elm.trigger(a.modal.AFTER_CLOSE,[b._ctx()])}),this.$elm.trigger(a.modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||a('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,$blocker:this.$blocker,options:this.options}}},a.modal.close=function(b){if(a.modal.isActive()){b&&b.preventDefault();var c=f();return c.close(),c.$elm}},a.modal.isActive=function(){return e.length>0},a.modal.defaults={closeExisting:!0,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",modalClass:"modal",spinnerHtml:null,showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},a.modal.BEFORE_BLOCK="modal:before-block",a.modal.BLOCK="modal:block",a.modal.BEFORE_OPEN="modal:before-open",a.modal.OPEN="modal:open",a.modal.BEFORE_CLOSE="modal:before-close",a.modal.CLOSE="modal:close",a.modal.AFTER_CLOSE="modal:after-close",a.modal.AJAX_SEND="modal:ajax:send",a.modal.AJAX_SUCCESS="modal:ajax:success",a.modal.AJAX_FAIL="modal:ajax:fail",a.modal.AJAX_COMPLETE="modal:ajax:complete",a.fn.modal=function(b){return 1===this.length&&new a.modal(this,b),this},a(c).on("click.modal",'a[rel="modal:close"]',a.modal.close),a(c).on("click.modal",'a[rel="modal:open"]',function(b){b.preventDefault(),a(this).modal()})}),define("modal",["jquery"],function(a){return function(){return a.modal}}(this)),define("stache!templates/partial/settings-header",["mustache"],function(a){return a.compile('{{#displayName}}\n  <h1 class="card-header">{{displayName}}</h1>\n  <h2 class="card-subheader">{{email}}</h2>\n{{/displayName}}\n{{^displayName}}\n  <h1 class="card-header">{{email}}</h1>\n  <h2 class="card-subheader"></h2>\n{{/displayName}}\n')}),define("stache!templates/sub_panels",["mustache"],function(a){return a.compile('<div class="child-views"></div>\n')}),define("views/sub_panels",["require","exports","module","backbone","views/base","lib/logger","lib/promise","stache!templates/sub_panels"],function(a,b,c){"use strict";var d=a("backbone"),e=a("views/base"),f=a("lib/logger"),g=a("lib/promise"),h=a("stache!templates/sub_panels"),i=e.prototype,j=e.extend({template:h,className:"sub-panels",initialize:function(a){a=a||{},this._panelViews=a.panelViews||[],this._parent=a.parent,this._createView=a.createView,this._logger=new f},showChildView:function(a,b){var c=this;return-1===this._panelViews.indexOf(a)?(this._logger.warn("Tried to show a view that is not a subpanel"),g(null)):this._createChildViewIfNeeded(a,b).then(function(a){if(a)return c._currentChildView=a,a.openPanel(),a})},_childViewInstanceFromClass:function(a){return this.childViews.filter(function(b){if(b instanceof a)return!0})[0]},_isModalView:function(a){return!!a.prototype.isModal},_childViewClassName:function(a){return a.prototype.className},_createChildViewIfNeeded:function(a,b){b=b||{};var c=this._childViewInstanceFromClass(a);if(c)return g(c);var e=this._childViewClassName(a),f="."+e;this.$(".child-views").append('<div class="settings-child-view '+e+'"></div>');var h=new d.Model;b.model&&h.set(b.model.toJSON());var i=this._createView(a,{el:this.$(f),model:h,parentView:this._parent});return this.trackChildView(i),this.renderChildView(i)},renderChildView:function(a){return a.render().then(function(b){return b?(a.afterVisible(),a):void a.destroy(!0)})},afterRender:function(){var a=this,b=this._panelViews.filter(function(b){return!a._isModalView(b)});return g.all(b.map(function(b){return a._createChildViewIfNeeded(b)})).then(i.afterRender.bind(this))}});c.exports=j}),define("stache!templates/settings",["mustache"],function(a){return a.compile('<div id="fxa-settings-header-wrapper">\n  <header id="fxa-settings-header">\n    <h1 id="fxa-manage-account">{{#t}}Firefox Accounts{{/t}}</h1>\n    {{#showSignOut}}\n      <button id="signout" class="settings-button secondary">{{#t}}Sign out{{/t}}</button>\n    {{/showSignOut}}\n  </header>\n\n  <div class="settings-success-wrapper">\n    <div class="success settings-success"></div>\n  </div>\n</div>\n\n<div class="avatar-wrapper avatar-settings-view"></div>\n<div id="fxa-settings-content" class="card">\n  <header id="fxa-settings-profile-header">\n    {{{ unsafeHeaderHTML }}}\n  </header>\n  <div id="sub-panels"></div>\n</div>\n\n<footer id="legal-footer"><a class="terms" href="/legal/terms">{{#t}}Terms of Service{{/t}}</a><a class="privacy" href="/legal/privacy">{{#t}}Privacy Notice{{/t}}</a></footer>\n')}),define("views/settings",["require","exports","module","jquery","views/decorators/allow_only_one_submit","views/settings/avatar_camera","views/settings/avatar_change","views/settings/avatar_crop","views/mixins/avatar-mixin","views/settings/avatar","views/base","views/settings/change_password","cocktail","views/settings/communication_preferences","views/settings/delete_account","views/settings/clients","views/settings/client_disconnect","views/settings/display_name","views/settings/emails","duration","views/mixins/loading-mixin","modal","lib/session","stache!templates/partial/settings-header","views/mixins/signed-out-notification-mixin","views/sub_panels","stache!templates/settings"],function(a,b,c){"use strict";var d=a("jquery"),e=a("views/decorators/allow_only_one_submit"),f=a("views/settings/avatar_camera"),g=a("views/settings/avatar_change"),h=a("views/settings/avatar_crop"),i=a("views/mixins/avatar-mixin"),j=a("views/settings/avatar"),k=a("views/base"),l=a("views/settings/change_password"),m=a("cocktail"),n=a("views/settings/communication_preferences"),o=a("views/settings/delete_account"),p=a("views/settings/clients"),q=a("views/settings/client_disconnect"),r=a("views/settings/display_name"),s=a("views/settings/emails"),t=a("duration"),u=a("views/mixins/loading-mixin"),v=(a("modal"),a("lib/session")),w=a("stache!templates/partial/settings-header"),x=a("views/mixins/signed-out-notification-mixin"),y=a("views/sub_panels"),z=a("stache!templates/settings"),A=[s,j,p,q,r,n,l,o,g,h,f],B=k.prototype,C=k.extend({template:z,className:"settings",layoutClassName:"settings",viewName:"settings",mustVerify:!0,initialize:function(a){a=a||{},this._able=a.able,this._subPanels=a.subPanels||this._initializeSubPanels(a),this._formPrefill=a.formPrefill;var b=this.relier.get("uid");this.user.getAccountByUid(b).isDefault()?b&&(v.clear(),this.user.clearSignedInAccount()):this.user.setSignedInAccountByUid(b)},notifications:{"navigate-from-child-view":"_onNavigateFromChildView"},_initializeSubPanels:function(a){var b=!1,c=a.panelViews||A;return-1!==c.indexOf(n)&&(b=this._areCommunicationPrefsVisible(),c=c.filter(function(a){return a!==n||b})),this.logViewEvent("communication-prefs-link.visible."+String(b)),new y({createView:a.createView,initialChildView:a.childView,panelViews:c,parent:this})},context:function(){var a=this.getSignedInAccount();return{showSignOut:!a.isFromSync(),unsafeHeaderHTML:this._getHeaderHTML(a)}},events:{"click #signout":k.preventDefaultThen("signOut")},onProfileUpdate:function(){this._showAvatar()},showChildView:function(a,b){return this._subPanels.showChildView(a,b)},_onNavigateFromChildView:function(){d.modal.isActive()&&d.modal.close(),this.displayStatusMessages(),this.logView()},beforeRender:function(){var a=this,b=this.getSignedInAccount();return b.fetchProfile().then(function(){return a.user.setAccount(b)})},_onAccountUpdate:function(a){this.$("#fxa-settings-profile-header").html(this._getHeaderHTML(a))},_getHeaderHTML:function(a){return w(a.pick("displayName","email"))},afterRender:function(){var a=this.getSignedInAccount();return this.listenTo(a,"change:displayName",this._onAccountUpdate),this.listenTo(a,"change:email",this._onAccountUpdate),this._subPanels.setElement(this.$("#sub-panels")[0]),this._subPanels.render().then(B.afterRender.bind(this))},afterVisible:function(){return"avatar"===this.relier.get("setting")&&(this.relier.set("setting",null),this.navigate("settings/avatar/change")),B.afterVisible.call(this).then(this._showAvatar.bind(this))},_setupAvatarChangeLinks:function(){this.$(".avatar-wrapper > *").wrap('<a href="/settings/avatar/change" class="change-avatar"></a>')},_showAvatar:function(){var a=this,b=this.getSignedInAccount();return this.displayAccountProfileImage(b).then(function(){return a._setupAvatarChangeLinks()})},_areCommunicationPrefsVisible:function(){return!!this._able.choose("communicationPrefsVisible",{lang:this.navigator.language})},signOut:e(function(){var a=this,b=this.getSignedInAccount();return this.logViewEvent("signout.submit"),this.user.signOutAccount(b).fail(function(){a.logViewEvent("signout.error")}).fin(function(){a.logViewEvent("signout.success"),a.clearSessionAndNavigateToSignIn()})}),SUCCESS_MESSAGE_DELAY_MS:new t("5s").milliseconds(),displaySuccess:function(){var a=this;return this.clearTimeout(this._successTimeout),this._successTimeout=this.setTimeout(function(){a.hideSuccess()},this.SUCCESS_MESSAGE_DELAY_MS),k.prototype.displaySuccess.apply(this,arguments)},unsafeDisplaySuccess:function(){var a=this;return this.clearTimeout(this._successTimeout),this._successTimeout=this.setTimeout(function(){a.hideSuccess()},this.SUCCESS_MESSAGE_DELAY_MS),k.prototype.unsafeDisplaySuccess.apply(this,arguments)}});m.mixin(C,i,u,x),c.exports=C}),define("stache!templates/sign_in_reported",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n    <header>\n      <h1 id="fxa-sign-in-reported-header">{{#t}}Thank you for your vigilance{{/t}}</h1>\n    </header>\n\n    <section>\n      <p>\n        {{#t}}Our team has been notified. Reports like this help us fend off intruders.{{/t}}\n      </p>\n    </section>\n</div>\n')}),define("views/sign_in_reported",["require","exports","module","views/base","stache!templates/sign_in_reported"],function(a,b,c){"use strict";var d=a("views/base"),e=a("stache!templates/sign_in_reported");c.exports=d.extend({template:e})}),define("stache!templates/sign_in_unblock",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-signin-unblock-header">{{#t}}Authorize this sign-in{{/t}}</h1>\n  </header>\n\n  <section>\n    <div class="error"></div>\n    <div class="success"></div>\n\n    <div class="graphic graphic-mail">{{#t}}Authorize this sign-in{{/t}}</div>\n\n    <p class="verification-email-message">\n    {{#t}}To better protect your Firefox data, there is an authorization code waiting for you at %(email)s.{{/t}}\n    </p>\n\n    <form novalidate>\n      <div class="input-row unblock-code-row">\n        <input type="text" class="tooltip-below unblock-code" id="unblock_code" placeholder="{{#t}}Enter authorization code{{/t}}" required autofocus />\n      </div>\n\n      <div class="button-row">\n        <button type="submit" class="use-logged-in">{{#t}}Continue{{/t}}</button>\n      </div>\n\n    </form>\n\n    <div class="links">\n      {{#hasSupportLink}}\n        <a id="resend" class="delayed-fadein left" href="#">{{#t}}Didn\'t arrive and not in spam folder? Resend{{/t}}</a>\n        <a href="{{{ escapedSupportLink }}}" id="support-link" class="delayed-fadein right" target="_blank">{{#t}}Why is this happening?{{/t}}</a>\n      {{/hasSupportLink}}\n      {{^hasSupportLink}}\n        <a id="resend" class="delayed-fadein" href="#">{{#t}}Didn\'t arrive and not in spam folder? Resend{{/t}}</a>\n      {{/hasSupportLink}}\n    </div>\n  </section>\n</div>\n')}),define("views/sign_in_unblock",["require","exports","module","lib/auth-errors","cocktail","lib/constants","views/form","views/mixins/resend-mixin","views/mixins/resume-token-mixin","views/mixins/signin-mixin","stache!templates/sign_in_unblock"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("cocktail"),f=a("lib/constants"),g=a("views/form"),h=a("views/mixins/resend-mixin")(),i=a("views/mixins/resume-token-mixin"),j=a("views/mixins/signin-mixin"),k=a("stache!templates/sign_in_unblock"),l=g.extend({template:k,className:"sign-in-unblock",getAccount:function(){return this.model.get("account")},beforeRender:function(){this.model.get("account")||this.navigate(this._getAuthPage())},context:function(){var a=this.getAccount().get("email"),b=this._getSupportLink();return{email:a,escapedSupportLink:encodeURI(b),hasSupportLink:!!b,unblockCodeLength:f.UNBLOCK_CODE_LENGTH}},submit:function(){var a=this,b=this.getAccount(),c=this.model.get("password"),d=this.getElementValue("#unblock_code");return this.signIn(b,c,{unblockCode:d}).fail(function(d){return a.onSignInError(b,c,d)})},onSignInError:function(a,b,c){if(!d.is(c,"INCORRECT_PASSWORD"))throw c;this.navigate(this._getAuthPage(),{email:a.get("email"),error:c})},resend:function(){return this._sendUnblockEmail()},_sendUnblockEmail:function(){var a=this;return this.getAccount().sendUnblockEmail().fail(function(b){return a.displayError(b)})},_getAuthPage:function(){var a="force_auth"===this.model.get("lastPage")?"force_auth":"signin";return this.broker.transformLink(a)},_getSupportLink:function(){return f.BLOCKED_SIGNIN_SUPPORT_URL}});e.mixin(l,h,i,j),c.exports=l}),define("stache!templates/partial/coppa-age-input",["mustache"],function(a){return a.compile('<div class="input-row input-row-age">\n  <label class="label-helper"></label>\n  <input type="number" id="age" placeholder="{{#t}}How old are you?{{/t}}" min="0" max="999" value="{{ age }}" {{#shouldFocusAge}}autofocus{{/shouldFocusAge}} />\n</div>\n')}),define("views/coppa/coppa-age-input",["require","exports","module","lib/auth-errors","cocktail","views/mixins/floating-placeholder-mixin","views/form","lib/key-codes","stache!templates/partial/coppa-age-input"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("cocktail"),f=a("views/mixins/floating-placeholder-mixin"),g=a("views/form"),h=a("lib/key-codes"),i=a("stache!templates/partial/coppa-age-input"),j=g.prototype,k=g.extend({template:i,className:"coppa-age-input",initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._formPrefill=a.formPrefill},events:{input:"onInput",keydown:"onKeyDown",keyup:"onInput"},isUserOldEnough:function(){return this._getAge()>=13},hasValue:function(){return!!this.getElementValue("#age")},onInput:function(){var a=this.$("#age");a.val().length>3&&a.val(a.val().substr(0,3))},onKeyDown:function(a){a.which===h.ENTER?this.trigger("submit"):function(a){return a===h.BACKSPACE||a===h.TAB||a===h.LEFT_ARROW||a===h.RIGHT_ARROW||a>=h.NUM_0&&a<=h.NUM_9||a>=h.NUMPAD_0&&a<=h.NUMPAD_9}(a.which)||a.preventDefault()},afterRender:function(){return this._selectPrefillAge("age"),j.afterRender.call(this)},showValidationErrorsEnd:function(){this._validateAge()||this.showValidationError("#age",d.toError("AGE_REQUIRED"))},isValid:function(){return this._validateAge()},_validateAge:function(){return!isNaN(this._getAge())},_getAge:function(){return parseInt(this.$("#age").val(),10)},_selectPrefillAge:function(a){var b=this._formPrefill.get(a);if(b){var c=this.$("#age");c.val(b),this.showFloatingPlaceholder(c)}},beforeDestroy:function(){this._formPrefill.set("age",this.$("#age").val())}});e.mixin(k,f),c.exports=k});var u={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu"],run:function(a){a.domains=a.domains||u.defaultDomains,a.secondLevelDomains=a.secondLevelDomains||u.defaultSecondLevelDomains,a.topLevelDomains=a.topLevelDomains||u.defaultTopLevelDomains,a.distanceFunction=a.distanceFunction||u.sift3Distance;var b=function(a){return a},c=a.suggested||b,d=a.empty||b,e=u.suggest(u.encodeEmail(a.email),a.domains,a.secondLevelDomains,a.topLevelDomains,a.distanceFunction);return e?c(e):d()},suggest:function(a,b,c,d,e){a=a.toLowerCase();var f=this.splitEmail(a);if(c&&d&&-1!==c.indexOf(f.secondLevelDomain)&&-1!==d.indexOf(f.topLevelDomain))return!1;var g=this.findClosestDomain(f.domain,b,e,this.domainThreshold);if(g)return g!=f.domain&&{address:f.address,domain:g,full:f.address+"@"+g};var h=this.findClosestDomain(f.secondLevelDomain,c,e,this.secondLevelThreshold),i=this.findClosestDomain(f.topLevelDomain,d,e,this.topLevelThreshold);if(f.domain){var g=f.domain,j=!1;if(h&&h!=f.secondLevelDomain&&(g=g.replace(f.secondLevelDomain,h),j=!0),i&&i!=f.topLevelDomain&&(g=g.replace(f.topLevelDomain,i),j=!0),1==j)return{address:f.address,domain:g,full:f.address+"@"+g}}return!1},findClosestDomain:function(a,b,c,d){d=d||this.topLevelThreshold;var e,f=99,g=null;if(!a||!b)return!1;c||(c=this.sift3Distance);for(var h=0;h<b.length;h++){if(a===b[h])return a;e=c(a,b[h]),e<f&&(f=e,g=b[h])}return f<=d&&null!==g&&g},sift3Distance:function(a,b){if(null==a||0===a.length)return null==b||0===b.length?0:b.length;if(null==b||0===b.length)return a.length;for(var c=0,d=0,e=0,f=0;c+d<a.length&&c+e<b.length;){if(a.charAt(c+d)==b.charAt(c+e))f++;else{d=0,e=0;for(var g=0;g<5;g++){if(c+g<a.length&&a.charAt(c+g)==b.charAt(c)){d=g;break}if(c+g<b.length&&a.charAt(c)==b.charAt(c+g)){e=g;break}}}c++}return(a.length+b.length)/2-f},splitEmail:function(a){var b=a.trim().split("@");if(b.length<2)return!1;for(var c=0;c<b.length;c++)if(""===b[c])return!1;var d=b.pop(),e=d.split("."),f="",g="";if(0==e.length)return!1;if(1==e.length)g=e[0];else{f=e[0];for(var c=1;c<e.length;c++)g+=e[c]+".";g=g.substring(0,g.length-1)}return{topLevelDomain:g,secondLevelDomain:f,domain:d,address:b.join("@")}},encodeEmail:function(a){var b=encodeURI(a);return b=b.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};"undefined"!=typeof module&&module.exports&&(module.exports=u),"function"==typeof define&&define.amd&&define("mailcheck",[],function(){return u}),"undefined"!=typeof window&&window.jQuery&&function(a){a.fn.mailcheck=function(a){var b=this;if(a.suggested){var c=a.suggested;a.suggested=function(a){c(b,a)}}if(a.empty){var d=a.empty;a.empty=function(){d.call(null,b)}}a.email=this.val(),u.run(a)}}(jQuery),define("lib/mailcheck",["require","exports","module","underscore","lib/key-codes","mailcheck","views/tooltip"],function(a,b,c){"use strict";var d=a("underscore"),e=a("lib/key-codes"),f=(a("mailcheck"),a("views/tooltip")),g=[],h=["gmail","qq","yandex","o2","rambler","googlemail","t-online","mail","web","sbcglobal","msn","hotmail","me","aol","seznam","comcast","orange","gmx","ymail","outlook","live","yahoo"],i=[],j=function(a){return a}('Did you mean <span tabindex="1">%(escapedDomain)s</span>?');c.exports=function(a,b){var c=$(a);c.length&&b&&(c.data("previousValue")!==c.val()&&c.val().length>5&&(b.logEvent("mailcheck.triggered"),c.mailcheck({domains:g,secondLevelDomains:h,topLevelDomains:i,suggested:function(c,g){if(g&&g.domain&&-1!==g.domain.indexOf(".")){b.logEvent("mailcheck.suggested");var h=b.unsafeTranslate(j,{escapedDomain:d.escape(g.domain)}),i=new f({dismissible:!0,extraClassNames:"tooltip-suggest tooltip-error",invalidEl:a,type:"mailcheck",unsafeMessage:h});i.render(),c.data("mailcheckValue",g.full),i.$el.on("click keypress","span",function(a){"click"!==a.type&&a.which!==e.ENTER||(c.val(g.full),b.logEvent("mailcheck.clicked"),i._destroy(),i=null)})}}})),c.data("previousValue",c.val()))}}),define("views/mixins/signup-mixin",["require","exports","module"],function(a,b,c){"use strict";c.exports={events:{"click #suggest-sync a":"onSuggestSyncClick"},isSyncSuggestionEnabled:function(){return!this.relier.get("service")&&(this.logViewEvent("sync-suggest.visible"),!0)},signUp:function(a,b){var c=this;return this.invokeBrokerMethod("beforeSignIn",a).then(function(){return c.logFlowEvent("attempt","signup"),c.user.signUpAccount(a,b,c.relier,{resume:c.getStringifiedResumeToken(a)})}).then(function(a){c._formPrefill&&c._formPrefill.clear();var b=c.onSignUpSuccess.bind(c);return c.relier.accountNeedsPermissions(a)?c.navigate("signup_permissions",{account:a,onSubmitComplete:b}):c.broker.hasCapability("chooseWhatToSyncWebV1")?c.navigate("choose_what_to_sync",{account:a,onSubmitComplete:b}):c.onSignUpSuccess(a)})},onSignUpSuccess:function(a){var b=this;return this.logViewEvent("success"),this.logViewEvent("signup.success"),a.get("verified")?(this.logViewEvent("preverified.success"),this.invokeBrokerMethod("afterSignIn",a).then(function(){b.navigate("signup_confirmed")})):this.invokeBrokerMethod("afterSignUp",a).then(function(){b.navigate("confirm",{account:a})})},onSuggestSyncClick:function(){this.logViewEvent("sync-suggest.clicked")}}}),define("stache!templates/sign_up",["mustache"],function(a){
return a.compile('<div id="main-content" class="card">\n  <header>\n    <h1 id="fxa-signup-header">\n      {{#serviceName}}\n        \x3c!-- L10N: For languages structured like English, the second phrase can read "to continue to %(serviceName)s" --\x3e\n        {{#t}}Create a Firefox Account{{/t}} <span class="service">{{#t}}Continue to %(serviceName)s{{/t}}</span>\n      {{/serviceName}}\n      {{^serviceName}}\n        {{#t}}Create a Firefox Account{{/t}}\n      {{/serviceName}}\n    </h1>\n  </header>\n\n  <section>\n    {{#error}}\n      <div class="error visible">{{ error }}</div>\n    {{/error}}\n\n    {{^error}}\n    <div class="error"></div>\n    <div class="success"></div>\n\n    {{#showSyncSuggestion}}\n      <div class="info nudge" id="suggest-sync">\n          {{#unsafeTranslate}}Looking for Firefox Sync? <a %(escapedSyncSuggestionAttrs)s>Get started here</a>{{/unsafeTranslate}}\n          <span class="dismiss" tabindex="-1">&#10005;</span>\n      </div>\n    {{/showSyncSuggestion}}\n\n    {{#isSyncMigration}}\n      <div class="info nudge" id="sync-migration">{{#unsafeTranslate}}Migrate your sync data by creating a new Firefox&nbsp;Account.{{/unsafeTranslate}}</div>\n    {{/isSyncMigration}}\n\n    {{#isAmoMigration}}\n        <div class="info nudge pad" id="amo-migration">{{#t}}Looking for your Add-ons data? Sign up for a Firefox Account with your old Add-ons account email address.{{/t}}</div>\n    {{/isAmoMigration}}\n\n    <form novalidate>\n      <div class="input-row">\n        {{#forceEmail}}\n          <p class="prefillEmail">{{ forceEmail }}</p>\n          <input type="email" class="email hidden tooltip-below" value="{{ forceEmail }}" disabled />\n        {{/forceEmail}}\n        {{^forceEmail}}\n          <input type="email" class="email tooltip-below" placeholder="{{#t}}Email{{/t}}" value="{{ email }}" spellcheck="false" {{#shouldFocusEmail}}autofocus{{/shouldFocusEmail}} required />\n        {{/forceEmail}}\n      </div>\n\n      <div class="input-row password-row">\n        <input id="password" type="password" class="password check-password tooltip-below" placeholder="{{#t}}Password{{/t}}" value="{{ password }}" pattern=".{8,}" required {{#shouldFocusPassword}}autofocus{{/shouldFocusPassword}} />\n        <div class="input-help input-help-focused input-help-signup">{{#t}}A strong, unique password will keep your Firefox data safe from intruders.{{/t}}</div>\n      </div>\n\n      <div id="coppa">\n      </div>\n\n      <div class="extra-links">\n        {{#unsafeTranslate}}By proceeding, you agree to the <a id="fxa-tos" href="/legal/terms">Terms of Service</a> and <a id="fxa-pp" href="/legal/privacy">Privacy Notice</a> of Firefox cloud services.{{/unsafeTranslate}}\n      </div>\n\n      {{#isEmailOptInVisible}}\n      <div class="input-row marketing-email-optin-row">\n          <label class="fxa-checkbox"><input id="marketing-email-optin" type="checkbox" class="marketing-email-optin"><span>{{#t}}Receive the monthly Firefox newsletter{{/t}}</span></label>\n      </div>\n      {{/isEmailOptInVisible}}\n\n      <div class="button-row">\n        <button id="submit-btn" type="submit" class="disabled">{{#t}}Create account{{/t}}</button>\n      </div>\n\n      {{#isSync}}\n      {{#chooseWhatToSyncCheckbox}}\n        <div class="input-row customize-sync-row">\n          <label class="fxa-checkbox">\n            <input id="customize-sync" type="checkbox" class="customize-sync customize-sync-bottom" {{#isCustomizeSyncChecked}}checked="checked"{{/isCustomizeSyncChecked}}>\n            <span>{{#t}}Choose what to sync{{/t}}</span>\n          </label>\n        </div>\n      {{/chooseWhatToSyncCheckbox}}\n      {{/isSync}}\n    </form>\n\n    <div class="links">\n      {{#isSignInEnabled}}\n        <a href="/signin" id="have-account" data-flow-event="have-account" class="sign-in">{{#t}}Have an account? Sign in{{/t}}</a>\n      {{/isSignInEnabled}}\n    </div>\n\n    {{/error}}\n  </section>\n</div>\n')}),define("views/sign_up",["require","exports","module","views/mixins/account-reset-mixin","lib/auth-errors","views/base","views/mixins/checkbox-mixin","cocktail","views/coppa/coppa-age-input","views/mixins/experiment-mixin","views/mixins/flow-begin-mixin","views/mixins/flow-events-mixin","views/form","lib/mailcheck","views/mixins/migration-mixin","lib/promise","views/mixins/password-mixin","views/mixins/resume-token-mixin","views/mixins/service-mixin","views/mixins/signed-in-notification-mixin","views/mixins/signin-mixin","views/mixins/signup-mixin","views/mixins/sync-auth-mixin","stache!templates/sign_up","lib/user-agent-mixin"],function(a,b,c){"use strict";function d(a,b,c){return a?"email":b?c?null:"password":"email"}var e=a("views/mixins/account-reset-mixin"),f=a("lib/auth-errors"),g=a("views/base"),h=a("views/mixins/checkbox-mixin"),i=a("cocktail"),j=a("views/coppa/coppa-age-input"),k=a("views/mixins/experiment-mixin"),l=a("views/mixins/flow-begin-mixin"),m=a("views/mixins/flow-events-mixin"),n=a("views/form"),o=a("lib/mailcheck"),p=a("views/mixins/migration-mixin"),q=a("lib/promise"),r=a("views/mixins/password-mixin"),s=a("views/mixins/resume-token-mixin"),t=a("views/mixins/service-mixin"),u=a("views/mixins/signed-in-notification-mixin"),v=a("views/mixins/signin-mixin"),w=a("views/mixins/signup-mixin"),x=a("views/mixins/sync-auth-mixin"),y=a("stache!templates/sign_up"),z=a("lib/user-agent-mixin"),A=g.t,B=n.extend({template:y,className:"sign-up",initialize:function(a){a=a||{},this._formPrefill=a.formPrefill,this._coppa=a.coppa,this._able=a.able},beforeRender:function(){if(document.cookie.indexOf("tooyoung")>-1)return this.navigate("cannot_create_account"),q(!1);var a=this.model.get("error");return a&&f.is(a,"DELETED_ACCOUNT")&&(a.forceMessage=A("Account no longer exists. Recreate it?")),n.prototype.beforeRender.call(this)},_createCoppaView:function(){var a=this;if(this._coppa)return q();var b=this._selectAutoFocusEl(),c={el:this.$("#coppa"),formPrefill:this._formPrefill,metrics:this.metrics,notifier:this.notifier,shouldFocus:null===b,viewName:this.getViewName()},d=new j(c);return d.render().then(function(){a.trackChildView(d),d.on("submit",function(){return a.trigger("submit")}),a._coppa=d})},afterRender:function(){var a=this;return this.logViewEvent("email-optin.visible."+String(this._isEmailOptInEnabled())),this._createCoppaView().then(function(){return n.prototype.afterRender.call(a)})},afterVisible:function(){return this.model.get("bouncedEmail")&&this.showValidationError("input[type=email]",f.toError("SIGNUP_EMAIL_BOUNCE")),this.broker.isAutomatedBrowser()&&this.$el.find("input[type=password]").click(function(){this.onEmailBlur()}.bind(this)),n.prototype.afterVisible.call(this)},events:{"blur input.email":"onEmailBlur","click #amo-migration a":"onAmoSignIn","click #suggest-sync .dismiss":"onSuggestSyncDismiss"},getPrefillEmail:function(){return this._formPrefill.get("email")||this.relier.get("email")},_selectAutoFocusEl:function(){var a=this.model.get("forceEmail")||this.getPrefillEmail(),b=this._formPrefill.get("password");return d(this.model.get("bouncedEmail"),a,b)},context:function(){var a=this._selectAutoFocusEl(),b=this.model.get("forceEmail"),c=this.getPrefillEmail(),d=this._formPrefill.get("password"),e=this.relier,f=e.isSync(),g={chooseWhatToSyncCheckbox:this.broker.hasCapability("chooseWhatToSyncCheckbox"),email:c,error:this.error,forceEmail:b,isAmoMigration:this.isAmoMigration(),isCustomizeSyncChecked:e.isCustomizeSyncChecked(),isEmailOptInVisible:this._isEmailOptInEnabled(),isSignInEnabled:!b,isSync:f,isSyncMigration:this.isSyncMigration(),password:d,serviceName:e.get("serviceName"),shouldFocusEmail:"email"===a,shouldFocusPassword:"password"===a,showSyncSuggestion:this.isSyncSuggestionEnabled()},h=void 0;return h=this.isSyncAuthSupported()?this.getEscapedSyncUrl("signup",B.ENTRYPOINT):encodeURI("https://mozilla.org/firefox/sync?utm_source=fx-website&utm_medium=fx-accounts&utm_campaign=fx-signup&utm_content=fx-sync-get-started"),g.escapedSyncSuggestionAttrs='data-flow-event="link.signin" href="'+h+'"',g},beforeDestroy:function(){var a=this._formPrefill;a.set("email",this.getElementValue(".email")),a.set("password",this.getElementValue(".password"))},isValidEnd:function(){return!this._isEmailSameAsBouncedEmail()&&(!this._isEmailFirefoxDomain()&&n.prototype.isValidEnd.call(this))},showValidationErrorsEnd:function(){this._isEmailSameAsBouncedEmail()?this.showValidationError("input[type=email]",f.toError("DIFFERENT_EMAIL_REQUIRED")):this._isEmailFirefoxDomain()&&this.showValidationError("input[type=email]",f.toError("DIFFERENT_EMAIL_REQUIRED_FIREFOX_DOMAIN"))},submit:function(){var a=this;return this.notifier.trigger("signup.submit"),q().then(function(){var b=a._initAccount(),c=a.getElementValue(".password");return a._isUserOldEnough()?a._signUp(b,c):a._signIn(b,c)}).fail(function(b){if(f.is(b,"USER_CANCELED_LOGIN"))return void a.logEvent("login.canceled");throw b})},_checkMailcheckResult:function(){var a=this.$el.find(".email"),b=a.val(),c=a.data("mailcheckValue");b.length>0&&c===b&&this.logEvent("mailcheck.corrected")},_signUp:function(a,b){return this._checkMailcheckResult(this),this.signUp(a,b).fail(this.onSignUpError.bind(this,a,b))},onSignUpError:function(a,b,c){if(f.is(c,"ACCOUNT_ALREADY_EXISTS"))return this._signIn(a,b);throw c},_signIn:function(a,b){return this.signIn(a,b).fail(this.onSignInError.bind(this,a,b))},onSignInError:function(a,b,c){if(f.is(c,"INCORRECT_PASSWORD"))return this._suggestSignIn(c);if(f.is(c,"UNKNOWN_ACCOUNT"))return this._coppa.hasValue()?(this.notifier.trigger("signup.tooyoung"),this._cannotCreateAccount()):void this.showValidationError(this.$("#age"),f.toError("AGE_REQUIRED"));if(f.is(c,"ACCOUNT_RESET"))return this.notifyOfResetAccount(a);throw c},onEmailBlur:function(){o(this.$el.find(".email"),this)},onSuggestSyncDismiss:function(){this.$("#suggest-sync").hide()},onAmoSignIn:function(){this.relier.unset("email"),this.$("input[type=email]").val("")},_isEmailSameAsBouncedEmail:function(){var a=this.model.get("bouncedEmail");return a&&a===this.getElementValue("input[type=email]")},_isUserOldEnough:function(){return this._coppa.isUserOldEnough()},_isEmailFirefoxDomain:function(){return/@firefox(\.com)?$/.test(this.getElementValue(".email"))},_cannotCreateAccount:function(){document.cookie="tooyoung=1;",this.navigate("cannot_create_account")},_initAccount:function(){var a=this.user.initAccount({customizeSync:this.$(".customize-sync").is(":checked"),email:this.getElementValue(".email"),needsOptedInToMarketingEmail:this.$(".marketing-email-optin").is(":checked")});if(this.relier.isSync()){var b=a.get("customizeSync");this.logViewEvent("customizeSync."+String(b))}return a},_suggestSignIn:function(a){return a.forceMessage=A('Account already exists. <a href="/signin">Sign in</a>'),this.unsafeDisplayError(a)},_isEmailOptInEnabled:function(){return!!this._able.choose("communicationPrefsVisible",{lang:this.navigator.language})}},{ENTRYPOINT:"fxa:signup"});i.mixin(B,e,h,k,m,l,p,r,s,t,v,w,u,x,z),c.exports=B}),define("lib/sms-message-ids",["require","exports","module"],function(a,b,c){"use strict";c.exports={FIREFOX_MOBILE_INSTALL:1}}),define("views/mixins/sms-mixin",["require","exports","module"],function(a,b,c){"use strict";c.exports={getSmsFeatures:function(){var a=[];return this.relier.get("enableSigninCodes")&&a.push("signinCodes"),a}}}),define("stache!templates/sms_send",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n    <header class="hidden" id="fxa-send-sms-header"><h1>{{#t}}Send Firefox directly to your smartphone and sign in to complete set-up{{/t}}</h1></header>\n    <div class="success visible">{{#t}}This Firefox is connected{{/t}}</div>\n    <div class="error"></div>\n\n    <section>\n      <div class="graphic graphic-connect-another-device">{{#t}}Success{{/t}}</div>\n\n      <p>{{#t}}Send Firefox directly to your smartphone and sign in to complete set-up{{/t}}</p>\n\n      <form novalidate>\n        <div class="input-row sms-row">\n          <input class="phone-number" type="tel" data-country="{{country}}" value="{{phoneNumber}}" placeholder="{{#t}}Mobile phone number{{/t}}" required autofocus="autofocus" />\n          <button type="submit" class="sms-send disabled">{{#t}}Send{{/t}}</button>\n        </div>\n      </form>\n    </section>\n    <div class="marketing-area"></div>\n    <div class="sms-disclaimer">\n      {{#unsafeTranslate}}SMS service only available in certain countries. SMS &amp; data rates may apply. The intended recipient of the email or SMS must have consented. <a %(escapedLearnMoreAttributes)s>Learn more</a>{{/unsafeTranslate}}\n    </div>\n    <div class="links">\n      <a href="/sms/why" data-flow-event="link.why" class="left">{{#t}}Why is this required?{{/t}}</a>\n      <a id="maybe-later" href="/connect_another_device" data-flow-event="link.maybe_later" class="right">{{#t}}Maybe later{{/t}}</a>\n    </div>\n    <aside class="child-view"></aside>\n</div>\n')}),define("views/sms_send",["require","exports","module","lib/auth-errors","cocktail","lib/country-telephone-info","lib/sms-message-ids","views/mixins/flow-events-mixin","views/form","lib/constants","views/mixins/marketing-mixin","views/mixins/pulse-graphic-mixin","lib/sms-errors","views/mixins/sms-mixin","stache!templates/sms_send"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("cocktail"),f=a("lib/country-telephone-info"),g=a("lib/sms-message-ids"),h=g.FIREFOX_MOBILE_INSTALL,i=a("views/mixins/flow-events-mixin"),j=a("views/form"),k=a("lib/constants"),l=k.MARKETING_ID_AUTUMN_2016,m=k.SYNC_SERVICE,n=a("views/mixins/marketing-mixin"),o=a("views/mixins/pulse-graphic-mixin"),p=a("lib/sms-errors"),q=a("views/mixins/sms-mixin"),r=a("stache!templates/sms_send"),s=j.prototype,t=j.extend({template:r,mustAuth:!0,initialize:function(a){s.initialize.call(this,a),this._createView=a.createView,this._formPrefill=a.formPrefill},beforeDestroy:function(){this._formPrefill.set("phoneNumber",this.$("input[type=tel]").__val())},getAccount:function(){return this.model.get("account")||this.user.getSignedInAccount()},context:function(){var a='id="learn-more" href="'+encodeURI(t.LEARN_MORE_LINK)+'" target="_learn-more" data-flow-event="link.learn_more"',b=this._formPrefill.get("phoneNumber"),c=this._getCountry();f[c]||(c="US");var d=f[c].prefix;return b||d===f.US.prefix||(b=d),{country:c,escapedLearnMoreAttributes:a,phoneNumber:b}},showChildView:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$(".child-view").append("<div>"),c.el=this.$(".child-view > div");var d=this._createView(a,c);return d.render().then(function(){return b.trackChildView(d)})},submit:function(){return this._sendSms(this._getNormalizedPhoneNumber(),h)},_getCountry:function(){return this.relier.get("country")||this.model.get("country")||"US"},_sendSms:function(a,b){var c=this;return this.getAccount().sendSms(a,b,{features:this.getSmsFeatures()}).then(function(){return c._onSendSmsSuccess()}).fail(function(a){return c._onSendSmsError(a)})},_getNormalizedPhoneNumber:function(){var a=this._getCountry(),b=this.getElementValue("input[type=tel]");return f[a].normalize(b)},_onSendSmsSuccess:function(){this.navigate("sms/sent",{account:this.getAccount(),country:this._getCountry(),normalizedPhoneNumber:this._getNormalizedPhoneNumber()})},_onSendSmsError:function(a){if(d.is(a,"INVALID_PHONE_NUMBER")||p.is(a,"INVALID_PHONE_NUMBER")||p.is(a,"UNROUTABLE_MESSAGE")||p.is(a,"NUMBER_BLOCKED"))return void this.showValidationError(this.$("input[type=tel]"),a);throw a}},{LEARN_MORE_LINK:"https://www.mozilla.org/en-US/privacy/websites/#campaigns"});e.mixin(t,i,n({marketingId:l,service:m}),o,q),c.exports=t}),define("stache!templates/sms_sent",["mustache"],function(a){return a.compile('<div id="main-content" class="card">\n  <header class="hidden" id="fxa-sms-sent-header"><h1>{{#t}}Install Firefox on your smartphone and sign in to complete set-up{{/t}}</h1></header>\n  <section>\n    <div class="success visible">\n      {{#unsafeTranslate}}App link sent to %(escapedPhoneNumber)s. <a %(escapedBackLinkAttrs)s>Mistyped number?</a>{{/unsafeTranslate}}\n\n    </div>\n    <div class="error"></div>\n\n    <div class="graphic graphic-sms-sent">{{#t}}Success{{/t}}</div>\n\n    <p id="sms-sent-to">\n      {{#t}}Install Firefox on your smartphone and sign in to complete set-up{{/t}}\n    </p>\n\n    <div class="faint">\n      {{#t}}If you are not receiving the text message, you can also download the apps manually.{{/t}}\n    </div>\n\n    <div class="marketing-area"></div>\n    <div class="links">\n      <a id="resend" class="delayed-fadein" href="#">{{#t}}Didn\'t arrive? Resend{{/t}}</a>\n    </div>\n  </section>\n</div>\n')}),define("views/sms_sent",["require","exports","module","underscore","views/mixins/back-mixin","views/base","cocktail","lib/country-telephone-info","lib/sms-message-ids","views/mixins/flow-events-mixin","lib/constants","views/mixins/marketing-mixin","views/mixins/resend-mixin","views/mixins/sms-mixin","stache!templates/sms_sent"],function(a,b,c){"use strict";var d=a("underscore"),e=a("views/mixins/back-mixin"),f=a("views/base"),g=a("cocktail"),h=a("lib/country-telephone-info"),i=a("lib/sms-message-ids"),j=i.FIREFOX_MOBILE_INSTALL,k=a("views/mixins/flow-events-mixin"),l=a("lib/constants"),m=l.MARKETING_ID_AUTUMN_2016,n=a("views/mixins/marketing-mixin")({marketingId:m}),o=a("views/mixins/resend-mixin")({successMessage:!1}),p=a("views/mixins/sms-mixin"),q=a("stache!templates/sms_sent"),r=function(a){return a}("App link resent to %(phoneNumber)s"),s=f.extend({template:q,mustAuth:!0,beforeRender:function(){this.model.get("normalizedPhoneNumber")&&this.model.get("country")||this.navigate("sms")},context:function(){return{escapedBackLinkAttrs:d.escape("id=back href=#"),escapedPhoneNumber:d.escape(this._getFormattedPhoneNumber())}},resend:function(){var a=this,b=this.model.get("account"),c=this.model.get("normalizedPhoneNumber");return b.sendSms(c,j,{features:this.getSmsFeatures()}).then(function(){a.displaySuccess(a.translate(r,{phoneNumber:a._getFormattedPhoneNumber()}))})},_getFormattedPhoneNumber:function(){var a=this.model.toJSON(),b=a.country,c=a.normalizedPhoneNumber;return h[b].format(c)}});g.mixin(s,e,k,n,o,p),c.exports=s}),define("stache!templates/tos",["mustache"],function(a){return a.compile('<div id="main-content" class="panel">\n  <header id="legal-header">\n    <h3>{{#t}}Firefox cloud services{{/t}}</h3>\n    <h1 id="fxa-tos-header">{{#t}}Terms of Service{{/t}}</h1>\n  </header>\n\n  <section class="hidden">\n    <div class="error"></div>\n\n    <article id="legal-copy">\n    </article>\n\n    {{#canGoBack}}\n      <div class="button-row">\n        <button id="fxa-tos-back" class="back">{{#t}}Back{{/t}}</button>\n      </div>\n    {{/canGoBack}}\n  </section>\n</div>\n')}),define("views/tos",["require","exports","module","lib/auth-errors","views/legal_copy","stache!templates/tos"],function(a,b,c){"use strict";var d=a("lib/auth-errors"),e=a("views/legal_copy"),f=a("stache!templates/tos"),g=e.extend({className:"tos",copyUrl:"/legal/terms",events:{"click #fxa-tos-back":"back","keyup #fxa-tos-back":"backOnEnter"},fetchError:d.toError("COULD_NOT_GET_TOS"),template:f});c.exports=g}),define("stache!templates/why_connect_another_device",["mustache"],function(a){return a.compile('<aside class="modal-panel connect-another-device">\n  <header>\n    <h1 id="fxa-why-connect-another-device-header">{{#t}}Why Sync two (or more!) devices?{{/t}}</h1>\n  </header>\n\n  <p>\n    {{#t}}Sync lets you share the bookmarks, history and passwords you save to Firefox on one device with Firefox on other devices. Sign in to Firefox on your phone or tablet and everything you\'ve saved to Firefox for desktop will appear.{{/t}}\n  </p>\n  <p>\n    {{#t}}Sync isn\'t designed as a permanent backup  it\'s just sharing what is saved locally. If you reset your password and your data isn\'t stored on at least one other device, you could lose all the information associated with the old password. That\'s why you\'ll want to install Firefox and use Sync on more than one device.{{/t}}\n  </p>\n  <div class="button-row">\n    <button id="back" type="submit">{{#t}}Got it{{/t}}</button>\n  </div>\n</aside>\n')}),define("views/why_connect_another_device",["require","exports","module","views/mixins/back-mixin","views/base","cocktail","views/mixins/modal-panel-mixin","stache!templates/why_connect_another_device"],function(a,b,c){"use strict";var d=a("views/mixins/back-mixin"),e=a("views/base"),f=a("cocktail"),g=a("views/mixins/modal-panel-mixin"),h=a("stache!templates/why_connect_another_device"),i=e.extend({template:h,initialize:function(){var a=this;this.once("modal-cancel",function(){return a.back()})},afterRender:function(){this.openPanel()}});f.mixin(i,d,g),c.exports=i}),define("lib/router",["require","exports","module","underscore","../views/settings/avatar_camera","../views/settings/avatar_change","../views/settings/avatar_crop","backbone","../views/cannot_create_account","../views/settings/change_password","../views/choose_what_to_sync","../views/clear_storage","../views/settings/client_disconnect","../views/settings/clients","../views/settings/communication_preferences","../views/complete_reset_password","../views/complete_sign_up","../views/confirm_reset_password","../views/confirm","../views/connect_another_device","../views/cookies_disabled","../views/settings/delete_account","../views/settings/display_name","../views/settings/emails","../views/force_auth","../views/index","../views/legal","../views/oauth_index","../views/permissions","../views/pp","../views/ready","views/report_sign_in","../views/reset_password","../views/settings","views/sign_in_reported","../views/sign_in_unblock","../views/sign_in","../views/sign_up","../views/sms_send","../views/sms_sent","./storage","../views/tos","lib/verification-reasons","../views/why_connect_another_device"],function(a,b,c){"use strict";function d(a,b){return function(){return this.showView(a,b)}}function e(a,b,c){return function(){return this.showChildView(a,b,c)}}function f(a){return new k.Model(a||{})}var g=a("underscore"),h=a("../views/settings/avatar_camera"),i=a("../views/settings/avatar_change"),j=a("../views/settings/avatar_crop"),k=a("backbone"),l=a("../views/cannot_create_account"),m=a("../views/settings/change_password"),n=a("../views/choose_what_to_sync"),o=a("../views/clear_storage"),p=a("../views/settings/client_disconnect"),q=a("../views/settings/clients"),r=a("../views/settings/communication_preferences"),s=a("../views/complete_reset_password"),t=a("../views/complete_sign_up"),u=a("../views/confirm_reset_password"),v=a("../views/confirm"),w=a("../views/connect_another_device"),x=a("../views/cookies_disabled"),y=a("../views/settings/delete_account"),z=a("../views/settings/display_name"),A=a("../views/settings/emails"),B=a("../views/force_auth"),C=a("../views/index"),D=a("../views/legal"),E=a("../views/oauth_index"),F=a("../views/permissions"),G=a("../views/pp"),H=a("../views/ready"),I=a("views/report_sign_in"),J=a("../views/reset_password"),K=a("../views/settings"),L=a("views/sign_in_reported"),M=a("../views/sign_in_unblock"),N=a("../views/sign_in"),O=a("../views/sign_up"),P=a("../views/sms_send"),Q=a("../views/sms_sent"),R=a("./storage"),S=a("../views/tos"),T=a("lib/verification-reasons"),U=a("../views/why_connect_another_device"),V=k.Router.extend({routes:{"(/)":d(C),"cannot_create_account(/)":d(l),"choose_what_to_sync(/)":d(n),"clear(/)":d(o),"complete_reset_password(/)":d(s),"complete_signin(/)":d(t,{type:T.SIGN_IN}),"confirm(/)":d(v,{type:T.SIGN_UP}),"confirm_reset_password(/)":d(u),"confirm_signin(/)":d(v,{type:T.SIGN_IN}),"connect_another_device(/)":d(w),"connect_another_device/why(/)":e(U,w),"cookies_disabled(/)":d(x),"force_auth(/)":d(B),"legal(/)":d(D),"legal/privacy(/)":d(G),"legal/terms(/)":d(S),"oauth(/)":d(E),"oauth/force_auth(/)":d(B),"oauth/signin(/)":d(N),"oauth/signup(/)":d(O),"report_signin(/)":d(I),"reset_password(/)":d(J),"reset_password_confirmed(/)":d(H,{type:T.PASSWORD_RESET}),"reset_password_verified(/)":d(H,{type:T.PASSWORD_RESET}),"secondary_email_verified(/)":d(H,{type:T.SECONDARY_EMAIL_VERIFIED}),"settings(/)":d(K),"settings/avatar/camera(/)":e(h,K),"settings/avatar/change(/)":e(i,K),"settings/avatar/crop(/)":e(j,K),"settings/change_password(/)":e(m,K),"settings/clients(/)":e(q,K),"settings/clients/disconnect(/)":e(p,K),"settings/communication_preferences(/)":e(r,K),"settings/delete_account(/)":e(y,K),"settings/display_name(/)":e(z,K),"settings/emails(/)":e(A,K),"signin(/)":d(N),"signin_confirmed(/)":d(H,{type:T.SIGN_IN}),"signin_permissions(/)":d(F,{type:T.SIGN_IN}),"signin_reported(/)":d(L),"signin_unblock(/)":d(M),"signin_verified(/)":d(H,{type:T.SIGN_IN}),"signup(/)":d(O),"signup_confirmed(/)":d(H,{type:T.SIGN_UP}),"signup_permissions(/)":d(F,{type:T.SIGN_UP}),"signup_verified(/)":d(H,{type:T.SIGN_UP}),"sms(/)":d(P),"sms/sent(/)":d(Q),"sms/why(/)":e(U,P),"verify_email(/)":d(t,{type:T.SIGN_UP}),"verify_secondary_email(/)":d(t,{type:T.SECONDARY_EMAIL_VERIFIED})},initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.metrics=a.metrics,this.notifier=a.notifier,this.relier=a.relier,this.user=a.user,this.window=a.window||window,this.notifier.once("view-shown",this._afterFirstViewHasRendered.bind(this)),this.notifier.on("navigate",this.onNavigate.bind(this)),this.notifier.on("navigate-back",this.onNavigateBack.bind(this)),this.storage=R.factory("sessionStorage",this.window)},onNavigate:function(a){if(a.server)return this.navigateAway(a.url);this._nextViewModel=f(a.nextViewData),this.navigate(a.url,a.routerOptions)},onNavigateBack:function(a){this._nextViewModel=f(a.nextViewData),this.navigateBack()},navigate:function(a,b){return b=b||{},b.hasOwnProperty("trigger")||(b.trigger=!0),b.clearQueryParams||/\?/.test(a)||(a+=this.window.location.search),k.Router.prototype.navigate.call(this,a,b)},navigateAway:function(a){var b=this;return this.metrics.flush().then(function(){b.window.location.href=a})},navigateBack:function(){this.window.history.back()},getViewOptions:function(a){return g.extend({canGoBack:this.canGoBack(),currentPage:this.getCurrentPage(),model:this._nextViewModel,viewName:this.getCurrentViewName()},a)},canGoBack:function(){return!!this.storage.get("canGoBack")},getCurrentPage:function(){return(k.history.fragment||"").replace(/^\//,"").replace(/\/$/,"").replace(/\?.*/,"")},getCurrentViewName:function(){return this.fragmentToViewName(this.getCurrentPage())},_afterFirstViewHasRendered:function(){this.storage.set("canGoBack",!0)},fragmentToViewName:function(a){return a=a||"",a.replace(/^\//,"").replace(/\/$/,"").replace(/\//g,".").replace(/\?.*/,"").replace(/_/g,"-")},showView:function(a,b){this.notifier.trigger("show-view",a,this.getViewOptions(b))},showChildView:function(a,b,c){this.notifier.trigger("show-child-view",a,b,this.getViewOptions(c))},createViewHandler:d,createChildViewHandler:e});c.exports=V}),define("lib/screen-info",["require","exports","module"],function(a,b,c){"use strict";function d(a){var b=a.document.documentElement||{},c=a.screen||{};this.clientHeight=b.clientHeight||e,this.clientWidth=b.clientWidth||e,this.devicePixelRatio=a.devicePixelRatio||e,this.screenHeight=c.height||e,this.screenWidth=c.width||e}var e="none";c.exports=d}),define("lib/sentry",["require","exports","module","underscore","lib/logger","raven","lib/url"],function(a,b,c){"use strict";function d(a){return a&&a.request&&(a.request.url&&(a.request.url=f(a.request.url)),a.tags&&a.tags.errno&&(a.fingerprint=["errno"+a.tags.errno],a.level="info"),a.exception&&a.exception.values&&h.each(a.exception.values,function(a){a.stacktrace&&a.stacktrace.frames&&h.each(a.stacktrace.frames,function(a){a.abs_path&&(a.abs_path=f(a.abs_path))})}),a.request.headers&&a.request.headers.Referer&&(a.request.headers.Referer=f(a.request.headers.Referer))),a}function e(a){if(a&&a.message){return a.message===o?n++:n=0,m===n?!1:(o=a.message,!0)}return!0}function f(){var a,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=b.indexOf("?"),d=b;return-1===c?d:(a=k.searchParams(b.substring(c+1)),d=b.substring(0,c),h.isObject(a)&&(Object.keys(a).forEach(function(b){h.contains(l,b)||(a[b]="VALUE")}),d+=k.objToSearchString(a)),d)}function g(a,b){if(this._logger=new i,this._release=b,!a)return void this._logger.error("No Sentry host provided");this._endpoint="//__API_KEY__@"+a+"/metrics-errors";try{j.config(this._endpoint,this._ravenOpts).install(),j.debug=!1}catch(a){j.uninstall(),this._logger.error(a)}}var h=a("underscore"),i=a("lib/logger"),j=a("raven"),k=a("lib/url"),l=["automatedBrowser","client_id","context","customizeSync","entrypoint","keys","migration","redirect_uri","scope","service","setting","style"],m=10,n=0,o=null;g.prototype={_endpoint:null,_ravenOpts:{dataCallback:d,shouldSendCallback:e},_exceptionTags:["code","context","errno","namespace","status"],captureException:function(a){var b={};this._exceptionTags.forEach(function(c){c in a&&(b[c]=a[c])});var c={tags:b};this._release&&(c.release=this._release),j.captureException(a,c)},remove:function(){j.uninstall()},__beforeSend:d,__cleanUpQueryParam:f,__shouldSendCallback:e},c.exports=g}),define("lib/storage-metrics",["require","exports","module","underscore","lib/metrics","lib/promise","lib/storage"],function(a,b,c){"use strict";function d(a){f.call(this,a)}var e=a("underscore"),f=a("lib/metrics"),g=a("lib/promise"),h=a("lib/storage"),i=h.factory("localStorage");e.extend(d.prototype,f.prototype,{_send:function(a){var b=i.get("metrics_all");return Array.isArray(b)||(b=[]),b.push(a),i.set("metrics_all",b),g(a)},isMetricsCollectionEnabled:function(){return!1}}),c.exports=d}),define("models/reliers/sync",["require","exports","module","underscore","lib/auth-errors","lib/country-telephone-info","models/reliers/relier","lib/vat"],function(a,b,d){"use strict";var e,f=a("underscore"),g=a("lib/auth-errors"),h=Object.keys(a("lib/country-telephone-info")),i=a("models/reliers/relier"),j=a("lib/vat"),k=function(a){return a},l={context:j.string().min(1),country:(e=j.string()).valid.apply(e,c(h)),customizeSync:j.boolean(),service:j.string(),signin:j.string().empty("").renameTo("signinCode"),signinCodes:j.boolean().renameTo("enableSigninCodes")};d.exports=i.extend({defaults:f.extend({},i.prototype.defaults,{customizeSync:!1,enableSigninCodes:!1,signinCode:void 0}),initialize:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._translator=b.translator,i.prototype.initialize.call(this,a,b)},fetch:function(){var a=this;return i.prototype.fetch.call(this).then(function(){a.importSearchParamsUsingSchema(l,g),a.get("service")&&a.set("serviceName",k("Firefox Sync"))})},isSync:function(){return!0},wantsKeys:function(){return!0},isCustomizeSyncChecked:function(){return!!this.get("customizeSync")}})}),define("lib/translator",["require","exports","module","jquery","underscore","lib/strings"],function(a,b,c){"use strict";var d=a("jquery"),e=a("underscore"),f=a("lib/strings"),g=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).forceEnglish&&(this.__translations__={})};g.prototype={__translations__:{"":{"project-id-version":"PACKAGE VERSION","report-msgid-bugs-to":"","pot-creation-date":"2017-06-09 20:00+0000","po-revision-date":"2014-09-03 08:41+0000","last-translator":"Zachary <zcarter@mozilla.com>","language-team":"LANGUAGE <LL@li.org>","language":"en","mime-version":"1.0","content-type":"text/plain; charset=UTF-8","content-transfer-encoding":"8bit","plural-forms":"nplurals=2; plural=(n != 1);","x-generator":"Pootle 2.5.0","x-pootle-mtime":"1409733678.0"},"Account verified successfully":"","Password reset":"","Password reset successfully. Sign in to continue.":"","%(permissionName)s (required)":"","Email address":"","Display name":"","Account picture":"","Welcome back":"","Firefox Sync will resume momentarily":"","Complete set-up by entering the new password on your other Firefox devices.":"","Email verified":"","Sign-in confirmed":"","You are now ready to use %(serviceName)s":"","Account verified":"","Unknown account. <a href=\"/signup\">Sign up</a>":"","Unknown Firefox Account. <a href=\"/signup\">Sign up</a> using your previous Add-ons account email address to access your Add-ons data.":"","Account no longer exists. Recreate it?":"","Account already exists. <a href=\"/signin\">Sign in</a>":"","App link resent to %(phoneNumber)s":"","Password changed successfully":"","We're sorry to hear about this. You should change your Firefox Account password, and look for information from your device manufacturer about erasing your data remotely.":"","We're sorry to hear about this. If this was a device you really don't trust, you should change your Firefox Account password, and change any passwords saved in Firefox.":"","Web Session, %(userAgent)s":"","%(translatedTimeAgo)s":"","started syncing %(translatedTimeAgo)s":"","last active %(translatedTimeAgo)s":"","Subscribed successfully":"","Unsubscribed successfully":"","Account deleted successfully":"","Display name updated":"","A verification link has been sent to %(email)s":"","Verification emailed to %(email)s":"","Your account has been locked for security reasons":"","Reset password":"","Open Gmail":"","Open Hotmail":"","Open Yahoo":"","Open Outlook":"","Open Restmail":"","Email resent":"","Firefox Sync":"","Unexpected error":"","The link you clicked to verify your email is expired.":"","You've tried too many times. Try again later.":"","You've tried too many times. Try again %(retryAfterLocalized)s.":"","Invalid token":"","Invalid timestamp in request signature":"","Invalid nonce in request signature":"","Account already exists":"","Unknown account":"","Incorrect email case":"","Incorrect password":"","Unverified account":"","Invalid verification code":"","Invalid JSON in request body":"","Invalid parameter: %(param)s":"","Missing parameter: %(param)s":"","Invalid request signature":"","Missing content-length header":"","Request body too large":"","The request was blocked for security reasons":"","Invalid authorization code":"","Invalid phone number":"","Cannot send to this country":"","Could not send a message to this number":"","Your email was just returned":"","Your email was just returned. Mistyped email?":"","Unable to deliver email":"","This email was already verified by another user":"","Secondary email must be different than your account email":"","Primary account email required for sign-in":"","Address in use by another account":"","Primary account email required for reset":"","Invalid signin code":"","Server busy, try again soon":"","This endpoint is no longer supported":"","System unavailable, try again soon":"","Login attempt cancelled":"","Session expired. Sign in to continue.":"","Cookies are still disabled":"","Passwords do not match":"","Working":"","Could not get Privacy Notice":"","Could not get Terms of Service":"","Your new password must be different":"","Must be at least 8 characters":"","Valid password required":"","Valid email required":"","A usable image was not found":"","Could not initialize camera":"","Valid URL required":"","Your verification email was just returned. Mistyped email?":"","Enter a valid email address. firefox.com does not offer email.":"","Firefox Accounts can only be placed into an IFRAME on approved sites":"","Verification link damaged":"","The image dimensions must be at least 100x100px":"","Signup is coming soon to Firefox for iOS":"","You must enter your age to sign up":"","Account no longer exists.":"","Invalid property in resume token: %(property)s":"","Missing property in resume token: %(property)s":"","Invalid data attribute: %(property)s":"","Missing data attribute: %(property)s":"","That confirmation link was already used, and can only be used once.":"","This is a required field":"","Authorization code required":"","Link damaged":"","Phone number required":"","Missing configuration":"","Invalid configuration":"","Did you mean <span tabindex=\"1\">%(escapedDomain)s</span>?":"","Please try again later":"","Unknown client":"","Incorrect redirect_uri":"","Invalid assertion":"","Unknown code":"","Incorrect code":"","Expired code":"","Invalid OAuth parameter: %(param)s":"","Unauthorized":"","Forbidden":"","Something went wrong. Please close this tab and try again.":"","no message":"","Missing OAuth parameter: %(param)s":"","Invalid Token":"","Invalid parameter in request body: %(param)s":"","Unsupported image provider":"","Image processing error":"","Resources failed to load":"","Unexpected resource error":"","Script error":"","SMS sent":"","Your number has been blocked":"","SMS not sent, please try again":"","By proceeding, you agree to the <a id=\"service-tos\" href=\"%(termsUri)s\">Terms of Service</a> and<a id=\"service-pp\" href=\"%(privacyUri)s\">Privacy Notice</a> of %(serviceName)s (%(serviceUri)s).":"","<a href=\"https://support.mozilla.org/kb/im-having-problems-with-my-firefox-account\">Help</a>":"","Get the latest news about Mozilla and Firefox.":"","%(city)s, %(country)s (estimated)":"","%(country)s (estimated)":"","IP address: %(ip)s":"","For added security, please confirm this sign-in to begin syncing with this device:":"","Web Session":"","Sign in":"","Bad Request":"","500 Error":"","Oh dear, something went wrong there. We've been notified and will get working on a fix.":"","Cannot create account":"","You must meet certain age requirements to create a Firefox&nbsp;Account.":"","Learn more.":"","%(email)s created":"","Choose what to sync":"","Open tabs":"","Bookmarks":"","Add-ons":"","Passwords":"","History":"","Preferences":"","Add-ons and Preferences do not currently sync on mobile devices.":"","Save settings":"","Back":"","Reset password link expired":"","The link you clicked to reset your password is expired.":"","Click here to receive a new reset link":"","Reset password link damaged":"","The link you clicked was missing characters, and may have been broken by your email client. Copy the address carefully, and try again.":"","Enter new password":"","Once you submit your new password, you will lose any Sync data that is not on one of your devices.":"","Learn how Sync works.":"","New password":"","Repeat password":"","Submit new password":"","Sign-in already confirmed":"","Verification link expired":"","Click here to receive a new verification link":"","Verification error":"","Confirm your account":"","Confirm this sign-in":"","Email Sent":"","A verification link has been sent&nbsp;to %(escapedEmail)s":"","To better protect your Firefox data, we've emailed a confirmation link to %(email)s":"","Didn't arrive and not in spam folder? Resend":"","Reset email sent":"","Click on the link we've emailed you at %(email)s within the next hour to create a new password.":"","Remember password? Sign in":"","Connect another device":"","This Firefox is connected":"","Success":"","Sign in to this Firefox to complete set-up":"","Sign in &rarr;":"","Sign in to Firefox on another device to complete set-up":"","Open settings and select Sign in to Firefox to complete set-up":"","Sign in to Firefox for Android to complete set-up":"","Sign in to Firefox for iOS to complete set-up":"","Why is this required?":"","Cookies and local storage are required.":"","Please enable cookies and local storage in your browser to access Firefox Accounts. Doing so will enable functionality such as remembering you between sessions.":"","Learn more":"","Try again":"","Sign in to continue":"","Password":"","Forgot password?":"","By proceeding, you agree to the <a id=\"fxa-tos\" href=\"/legal/terms\">Terms of Service</a> and <a id=\"fxa-pp\" href=\"/legal/privacy\">Privacy Notice</a> of Firefox cloud services.":"","Firefox cloud services":"","Legal":"","Terms of Service":"","Privacy Notice":"","Get the full Sync experience.":"","Download Firefox for iOS!":"","Download Firefox for Android.":"","Download Firefox for mobile devices.":"","Request for permission":"","%(serviceName)s wants the following information from your account:":"","Accept":"","Cancel":"","Account notifications will now also be sent to %(secondaryEmailVerified)s":"","Your account is ready!":"","Report unauthorized sign-in?":"","You received an email about attempted access to your account. Would you like to report this activity as suspicious?":"","Report activity":"","Why is this happening?":"","Reset account":"","Continue to %(serviceName)s":"to continue to %(serviceName)s","When you reset your password, you will lose any Sync data that is not on one of your devices.":"","Email":"","Begin reset":"","Remember password? Sign in.":"","Firefox Accounts":"","Sign out":"","Looking for your Add-ons data? <a href=\"/signup\">Sign up</a> for a Firefox Account with your old Add-ons account email address.":"","Migrate your sync data by signing in to your Firefox&nbsp;Account.":"","Use a different account":"","Create an account":"","Thank you for your vigilance":"","Our team has been notified. Reports like this help us fend off intruders.":"","Authorize this sign-in":"","To better protect your Firefox data, there is an authorization code waiting for you at %(email)s.":"","Enter authorization code":"","Continue":"","Create a Firefox Account":"","Looking for Firefox Sync? <a %(escapedSyncSuggestionAttrs)s>Get started here</a>":"","Migrate your sync data by creating a new Firefox&nbsp;Account.":"","Looking for your Add-ons data? Sign up for a Firefox Account with your old Add-ons account email address.":"","A strong, unique password will keep your Firefox data safe from intruders.":"","Receive the monthly Firefox newsletter":"","Create account":"","Have an account? Sign in":"","Send Firefox directly to your smartphone and sign in to complete set-up":"","Mobile phone number":"","Send":"","SMS service only available in certain countries. SMS &amp; data rates may apply. The intended recipient of the email or SMS must have consented. <a %(escapedLearnMoreAttributes)s>Learn more</a>":"","Maybe later":"","Install Firefox on your smartphone and sign in to complete set-up":"","App link sent to %(escapedPhoneNumber)s. <a %(escapedBackLinkAttrs)s>Mistyped number?</a>":"","If you are not receiving the text message, you can also download the apps manually.":"","Didn't arrive? Resend":"","Why Sync two (or more!) devices?":"","Sync lets you share the bookmarks, history and passwords you save to Firefox on one device with Firefox on other devices. Sign in to Firefox on your phone or tablet and everything you've saved to Firefox for desktop will appear.":"","Sync isn't designed as a permanent backup  it's just sharing what is saved locally. If you reset your password and your data isn't stored on at least one other device, you could lose all the information associated with the old password. That's why you'll want to install Firefox and use Sync on more than one device.":"","Got it":"","Change":"","Add":"","Take picture":"","Upload":"","Camera":"","Clear":"","Done":"","Position and rotate your picture as needed":"","Change":"","Once you're finished, use your new password to sign in on all of your devices.":"","Old password":"","Disconnect from Sync?":"","Your browsing data will remain on %(deviceName)s, but it will no longer sync with your account.":"","Suspicious device":"","Lost or stolen device":"","Old or replaced device":"","Duplicate device":"","Rather not say":"","Disconnect":"","Disconnection Successful":"","Devices & apps":"","Show":"","current device":"","Disconnect":"","current session":"","Firefox for iOS":"","none connected":"","Download":"","Firefox for Android":"","Missing or duplicate items?":"","Refresh":"","Communication preferences":"","Receive the monthly Firefox newsletter.":"","Email preferences":"","Unsubscribe":"","Subscribe":"","Delete account":"","Delete":"","Are you sure you want to delete your account? This action cannot be undone.":"","Choose the name you would like to appear in Firefox and when managing your account.":"","Secondary email":"","A secondary email is an additional address for receiving security notices and confirming new Sync devices.":"","verified":"","verification required":"","Remove":"","Didn't arrive and not in spam folder? Resend?":"","Add":"","How old are you?":"","Sign in to Sync":"","Choose the account you would like to use to sync your tabs, bookmarks, passwords and more.":"","Use OpenID":"","Use Firefox Account":"","submit button\u0004Sign in":"","header text\u0004Sign in":""},set:function(a){this.__translations__=a},get:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this.__translations__,f=void 0;if(b.msgctxt){f=c[b.msgctxt+""+a]||c[a]}else f=c[a];return e.isArray(f)&&f.length>=2&&(f=f[1]),f=d.trim(f),f||(f=a),this.interpolate(f,b)},interpolate:f.interpolate,translateInTemplate:function(a,b){var c=this;return function(d){return c.get(a||d,b)}}},c.exports=g}),function(){function a(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){e<16&&(b[d+e++]=l[a])});e<16;)b[d+e++]=0;return b}function b(a,b){var c=b||0,d=k
;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function c(a,c,d){var e=c&&d||0,f=c||[];a=a||{};var g=null!=a.clockseq?a.clockseq:p,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:r+1,j=h-q+(i-r)/1e4;if(j<0&&null==a.clockseq&&(g=g+1&16383),(j<0||h>q)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");q=h,r=i,p=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||o,n=0;n<6;n++)f[e+n]=m[n];return c||b(f)}function d(a,c,d){var f=c&&d||0;"string"==typeof a&&(c="binary"==a?new j(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,c)for(var h=0;h<16;h++)c[f+h]=g[h];return c||b(g)}var e,f=this;if("function"==typeof f.require)try{var g=f.require("crypto").randomBytes;e=g&&function(){return g(16)}}catch(a){}if(!e&&f.crypto&&crypto.getRandomValues){var h=new Uint8Array(16);e=function(){return crypto.getRandomValues(h),h}}if(!e){var i=new Array(16);e=function(){for(var a,b=0;b<16;b++)0==(3&b)&&(a=4294967296*Math.random()),i[b]=a>>>((3&b)<<3)&255;return i}}for(var j="function"==typeof f.Buffer?f.Buffer:Array,k=[],l={},m=0;m<256;m++)k[m]=(m+256).toString(16).substr(1),l[k[m]]=m;var n=e(),o=[1|n[0],n[1],n[2],n[3],n[4],n[5]],p=16383&(n[6]<<8|n[7]),q=0,r=0,s=d;if(s.v1=c,s.v4=d,s.parse=a,s.unparse=b,s.BufferClass=j,"undefined"!=typeof module&&module.exports)module.exports=s;else if("function"==typeof define&&define.amd)define("uuid",[],function(){return s});else{var t=f.uuid;s.noConflict=function(){return f.uuid=t,s},f.uuid=s}}.call(this),define("models/unique-user-id",["require","exports","module","backbone","cocktail","models/mixins/resume-token","models/mixins/search-param","lib/storage","uuid"],function(a,b,c){"use strict";var d=a("backbone"),e=a("cocktail"),f=a("models/mixins/resume-token"),g=a("models/mixins/search-param"),h=a("lib/storage"),i=a("uuid"),j=d.Model.extend({initialize:function(a){a=a||{},this.sentryMetrics=a.sentryMetrics,this.window=a.window||window,this.fetch()},defaults:{uniqueUserId:null},fetch:function(){var a=h.factory("localStorage",this.window);this.populateFromStringifiedResumeToken(this.getSearchParam("resume"));var b=this.get("uniqueUserId");b||(a.get("uuid")?(b=a.get("uuid"),a.remove("uuid")):b=a.get("uniqueUserId")?a.get("uniqueUserId"):i.v4()),this.set("uniqueUserId",b),a.set("uniqueUserId",b)},resumeTokenFields:["uniqueUserId"]});e.mixin(j,f,g),c.exports=j}),define("models/user",["require","exports","module","underscore","models/account","lib/auth-errors","backbone","cocktail","lib/constants","lib/marketing-email-errors","lib/promise","models/mixins/resume-token","models/mixins/search-param","lib/storage","lib/vat"],function(a,b,c){"use strict";var d=a("underscore"),e=a("models/account"),f=a("lib/auth-errors"),g=a("backbone"),h=a("cocktail"),i=a("lib/constants"),j=a("lib/marketing-email-errors"),k=a("lib/promise"),l=a("models/mixins/resume-token"),m=a("models/mixins/search-param"),n=a("lib/storage"),o=a("lib/vat"),p=g.Model.extend({initialize:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._oAuthClientId=a.oAuthClientId,this._oAuthClient=a.oAuthClient,this._profileClient=a.profileClient,this._fxaClient=a.fxaClient,this._marketingEmailClient=a.marketingEmailClient,this._metrics=a.metrics,this._assertion=a.assertion,this._notifier=a.notifier,this._storage=a.storage||n.factory(),this.sentryMetrics=a.sentryMetrics,this.set("uniqueUserId",a.uniqueUserId),this._cachedSignedInAccount=null,this.window=a.window||window,this.fetch()},defaults:{uniqueUserId:null},resumeTokenFields:["uniqueUserId"],resumeTokenSchema:{uniqueUserId:o.uuid()},fetch:function(){var a=this;return k().then(function(){a.populateFromStringifiedResumeToken(a.getSearchParam("resume"))})},logNumStoredAccounts:function(){var a=Object.keys(this._accounts()).length;this._metrics.logNumStoredAccounts(a)},_accounts:function(){return this._storage.get("accounts")||{}},_getAccount:function(a){return a?this._accounts()[a]||null:null},_setSignedInAccountUid:function(a){this._storage.set("currentAccountUid",a),this._cachedSignedInAccount&&this._cachedSignedInAccount.get("uid")!==a&&(this._cachedSignedInAccount=null)},clearSignedInAccountUid:function(){this._storage.remove("currentAccountUid"),this._cachedSignedInAccount=null},_getSignedInAccountData:function(){return this._getAccount(this._storage.get("currentAccountUid"))},_persistAccount:function(a){var b=this.initAccount(a),c=this._accounts(),d=b.get("uid");if(!d)return void this._metrics.logError(f.toError("ACCOUNT_HAS_NO_UID","persistAccount"));c[d]=b.toPersistentJSON(),this._storage.set("accounts",c)},initAccount:function(a){return a instanceof e?a:new e(a,{assertion:this._assertion,fxaClient:this._fxaClient,marketingEmailClient:this._marketingEmailClient,metrics:this._metrics,oAuthClient:this._oAuthClient,oAuthClientId:this._oAuthClientId,profileClient:this._profileClient,sentryMetrics:this.sentryMetrics})},isSyncAccount:function(a){return this.initAccount(a).isFromSync()},sessionStatus:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSignedInAccount();return b.sessionStatus().then(function(){return a.setAccount(b),b},function(c){throw f.is(c,"INVALID_TOKEN")&&!b.isDefault()&&a.setAccount(b),c})},getSignedInAccount:function(){return this._cachedSignedInAccount||(this._cachedSignedInAccount=this.initAccount(this._getSignedInAccountData())),this._cachedSignedInAccount},isSignedInAccount:function(a){var b=a.get("uid"),c=this.getSignedInAccount().get("uid");return!(!c||!b)&&b===c},isAnotherAccountSignedIn:function(a){return!this.getSignedInAccount().isDefault()&&!this.isSignedInAccount(a)},setSignedInAccountByUid:function(a){this._accounts()[a]&&this._setSignedInAccountUid(a)},getAccountByUid:function(a){var b=this._accounts()[a];return this.initAccount(b)},getAccountByEmail:function(a){var b=Object.keys(this._accounts()).reverse(),c=this._accounts(),e=d.find(b,function(b){return c[b].email===a});return this.initAccount(c[e])},getChooserAccount:function(){function a(a){return!!(a&&a.get("sessionToken")&&a.get("email"))}var b=this;if(this.has("signinCodeAccount"))return this.get("signinCodeAccount");var c=d.find(this._accounts(),function(c){var d=b.initAccount(c);return b.isSyncAccount(d)&&a(d)}),e=this.getSignedInAccount(),f=a(e)&&e,g={};return c?g=c:f&&(g=f),this.initAccount(g)},clearSignedInAccount:function(){var a=this.getSignedInAccount().get("uid");this.clearSignedInAccountUid(),this._notifier.triggerRemote(this._notifier.COMMANDS.SIGNED_OUT,{uid:a})},removeAllAccounts:function(){this.clearSignedInAccountUid(),this._storage.remove("accounts"),this.unset("signinCodeAccount")},removeAccount:function(a){var b=this.initAccount(a);this.isSignedInAccount(b)&&this.clearSignedInAccount();var c=this._accounts();delete c[b.get("uid")],this._storage.set("accounts",c)},deleteAccount:function(a,b){var c=this,d=this.initAccount(a);return d.destroy(b).then(function(){c.removeAccount(d),c._notifier.triggerAll(c._notifier.COMMANDS.DELETE,{uid:d.get("uid")})})},setSignedInAccount:function(a){var b=this,c=this.initAccount(a);return c.set("lastLogin",Date.now()),this.setAccount(c).then(function(a){return b._cachedSignedInAccount=a,b._setSignedInAccountUid(a.get("uid")),a})},setAccount:function(a){var b=this,c=this.initAccount(a);return c.fetch().then(function(){return b._persistAccount(c),c})},upgradeFromSession:function(a,b){var c=this;return k().then(function(){if(c.getSignedInAccount().isDefault()){var e=k();return a.cachedCredentials&&(e=c.setSignedInAccount({email:a.cachedCredentials.email,sessionToken:a.cachedCredentials.sessionToken,sessionTokenContext:a.cachedCredentials.sessionTokenContext,uid:a.cachedCredentials.uid}),a.clear("cachedCredentials")),c._shouldAddOldSessionAccount(a)&&(e=e.then(d.bind(b.sessionStatus,b,a.sessionToken)).then(function(b){return c.setSignedInAccount({email:a.email,sessionToken:a.sessionToken,sessionTokenContext:a.sessionTokenContext,uid:b.uid}).then(function(){a.clear("email"),a.clear("sessionToken"),a.clear("sessionTokenContext")})},function(){})),e}})},upgradeFromUnfilteredAccountData:function(){var a=this;return k().then(function(){var b=a._accounts();for(var c in b){var f=b[c],g=d.pick(f,e.ALLOWED_KEYS);d.isEqual(f,g)||a._persistAccount(g)}})},_shouldAddOldSessionAccount:function(a){return a.email&&a.sessionToken&&(!a.cachedCredentials||a.cachedCredentials.email!==a.email)},removeAccountsWithInvalidUid:function(){var a=this;return k().then(function(){var b=a._accounts();for(var c in b)c&&"undefined"!==c||(delete b[c],a._storage.set("accounts",b))})},signInAccount:function(a,b,c,e){var f=this;return a.signIn(b,c,e).then(function(){var b=f.getAccountByUid(a.get("uid"));return b.isDefault()||(b.set(d.omit(a.attributes,function(a){return void 0===a})),a=b),f._notifyOfAccountSignIn(a),f.setSignedInAccount(a)})},signUpAccount:function(a,b,c,d){var e=this;return a.signUp(b,c,d).then(function(){return e.setSignedInAccount(a)})},signOutAccount:function(a){var b=this;return a.signOut().fin(function(){return b.removeAccount(a)})},completeAccountSignUp:function(a,b,c){var d=this,e=function(a){a.has("sessionToken")&&d._notifyOfAccountSignIn(a)};return a.verifySignUp(b,c).fail(function(b){throw j.created(b)&&e(a),b}).then(function(){return e(a),a})},changeAccountPassword:function(a,b,c,d){var e=this;return a.changePassword(b,c,d).then(function(){return e.setSignedInAccount(a)}).then(function(){var b=e._notifier,c=b.COMMANDS.CHANGE_PASSWORD,d=a.pick(Object.keys(b.SCHEMATA[c]));return d.verified=!!d.verified,b.triggerRemote(c,d),a})},_notifyOfAccountSignIn:function(a){var b=this._notifier,c=b.COMMANDS.SIGNED_IN;b.triggerRemote(c,a.pick(Object.keys(b.SCHEMATA[c])))},completeAccountPasswordReset:function(a,b,c,d,e){var f=this;return a.completePasswordReset(b,c,d,e).then(function(){return f._notifyOfAccountSignIn(a),f.setSignedInAccount(a)})},destroyAccountClient:function(a,b){return b.get("clientType")===i.CLIENT_TYPE_DEVICE?this.destroyAccountDevice(a,b):b.get("clientType")===i.CLIENT_TYPE_OAUTH_APP?this.destroyAccountApp(a,b):b.get("clientType")===i.CLIENT_TYPE_WEB_SESSION?this.destroyAccountSession(a,b):void 0},fetchAccountDevices:function(a,b){return a.fetchDevices(b)},fetchAccountOAuthApps:function(a,b){return a.fetchOAuthApps(b)},fetchAccountSessions:function(a,b){return a.fetchSessions(b)},destroyAccountDevice:function(a,b){var c=this;return a.destroyDevice(b).then(function(){c.isSignedInAccount(a)&&b.get("isCurrentDevice")&&c.removeAccount(a)})},destroyAccountSession:function(a,b){var c=this;return a.destroySession(b).then(function(){c.isSignedInAccount(a)&&b.get("isCurrentSession")&&c.clearSignedInAccount()})},destroyAccountApp:function(a,b){return a.destroyOAuthApp(b)},checkAccountUidExists:function(a){var b=this;return a.checkUidExists().then(function(c){return c||b.removeAccount(a),c})},checkAccountEmailExists:function(a){var b=this;return a.checkEmailExists().then(function(c){return c||b.removeAccount(a),c})},rejectAccountUnblockCode:function(a,b){return a.rejectUnblockCode(b)},shouldSetSignedInAccountFromBrowser:function(a){return a===i.SYNC_SERVICE||this.getSignedInAccount().isDefault()},setSignedInAccountFromBrowserAccountData:function(a){var b=this;return k().then(function(){if(a){var c=b.initAccount(d.pick(a,"email","sessionToken","uid","verified"));return c.set("sessionTokenContext",i.SESSION_TOKEN_USED_FOR_SYNC),b.setSignedInAccount(c)}})},setSigninCodeAccount:function(a){var b=this;return k().then(function(){var c=b.initAccount(d.pick(a,"email"));b.set("signinCodeAccount",c)})}});h.mixin(p,l,m),c.exports=p}),define("lib/app-start",["require","exports","module","underscore","lib/able","views/app","models/auth_brokers/index","lib/assertion","backbone","lib/config-loader","lib/constants","lib/environment","lib/error-utils","models/form-prefill","lib/fxa-client","lib/height-observer","lib/channels/iframe","lib/channels/inter-tab","lib/marketing-email-client","lib/metrics","lib/channels/notifier","lib/channels/null","lib/oauth-client","models/reliers/oauth","lib/promise","lib/profile-client","models/refresh-observer","models/reliers/relier","lib/require-on-demand","lib/router","models/verification/same-browser","lib/screen-info","lib/sentry","lib/session","lib/storage","lib/storage-metrics","models/reliers/sync","lib/translator","models/unique-user-id","lib/url","models/user","lib/user-agent","lib/channels/web"],function(a,b,c){"use strict";function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._authenticationBroker=a.broker,this._configLoader=new k,this._history=a.history||j.history,this._metrics=a.metrics,this._notifier=a.notifier,this._refreshObserver=a.refreshObserver,this._relier=a.relier,this._requireOnDemand=a.requireOnDemand||D,this._router=a.router,this._sentryMetrics=a.sentryMetrics,this._storage=a.storage||J,this._user=a.user,this._window=a.window||window}var e=a("underscore"),f=a("lib/able"),g=a("views/app"),h=a("models/auth_brokers/index"),i=a("lib/assertion"),j=a("backbone"),k=a("lib/config-loader"),l=a("lib/constants"),m=a("lib/environment"),n=a("lib/error-utils"),o=a("models/form-prefill"),p=a("lib/fxa-client"),q=a("lib/height-observer"),r=a("lib/channels/iframe"),s=a("lib/channels/inter-tab"),t=a("lib/marketing-email-client"),u=a("lib/metrics"),v=a("lib/channels/notifier"),w=a("lib/channels/null"),x=a("lib/oauth-client"),y=a("models/reliers/oauth"),z=a("lib/promise"),A=a("lib/profile-client"),B=a("models/refresh-observer"),C=a("models/reliers/relier"),D=a("lib/require-on-demand"),E=a("lib/router"),F=a("models/verification/same-browser"),G=a("lib/screen-info"),H=a("lib/sentry"),I=a("lib/session"),J=a("lib/storage"),K=a("lib/storage-metrics"),L=a("models/reliers/sync"),M=a("lib/translator"),N=a("models/unique-user-id"),O=a("lib/url"),P=a("models/user"),Q=a("lib/user-agent"),R=a("lib/channels/web");d.prototype={startApp:function(){return z().then(this.initializeDeps.bind(this)).then(this.testLocalStorage.bind(this)).then(this.allResourcesReady.bind(this)).fail(this.fatalError.bind(this))},initializeInterTabChannel:function(){this._interTabChannel=new s},initializeAble:function(){this._able=new f},initializeConfig:function(){return this._configLoader.fetch().then(e.bind(this.useConfig,this))},initializeDeps:function(){return z().then(e.bind(this.initializeConfig,this)).then(e.bind(this.initializeL10n,this)).then(e.bind(this.initializeInterTabChannel,this)).then(e.bind(this.initializeAble,this)).then(e.bind(this.initializeErrorMetrics,this)).then(e.bind(this.initializeOAuthClient,this)).then(e.bind(this.initializeRelier,this)).then(e.bind(this.initializeIframeChannel,this)).then(e.bind(this.initializeFxaClient,this)).then(e.bind(this.initializeNotificationChannel,this)).then(e.bind(this.initializeNotifier,this)).then(e.bind(this.initializeMetrics,this)).then(e.bind(this.initializeAssertionLibrary,this)).then(e.bind(this.initializeProfileClient,this)).then(e.bind(this.initializeMarketingEmailClient,this)).then(e.bind(this.initializeAuthenticationBroker,this)).then(e.bind(this.initializeUser,this)).then(e.bind(this.initializeHeightObserver,this)).then(e.bind(this.initializeFormPrefill,this)).then(e.bind(this.initializeRefreshObserver,this)).then(e.bind(this.initializeRouter,this)).then(e.bind(this.initializeAppView,this))},useConfig:function(a){this._config=a,this._configLoader.useConfig(a)},initializeErrorMetrics:function(){if(this._config&&this._config.env&&this._able){var a={env:this._config.env,uniqueUserId:this._getUniqueUserId()};this._able.choose("sentryEnabled",a)&&this.enableSentryMetrics()}},enableSentryMetrics:function(){var a=void 0;this._config&&this._config.release&&(a=this._config.release),this._sentryMetrics=new H(this._window.location.host,a)},initializeL10n:function(){this._translator=this._window.translator=new M},initializeMetrics:function(){var a=this._able.choose("isSampledUser",{env:this._config.env,uniqueUserId:this._getUniqueUserId()}),b=this._relier,c=new G(this._window);this._metrics=this._createMetrics({able:this._able,clientHeight:c.clientHeight,clientWidth:c.clientWidth,context:b.get("context"),devicePixelRatio:c.devicePixelRatio,entrypoint:b.get("entrypoint"),isSampledUser:a,lang:this._config.lang,migration:b.get("migration"),notifier:this._notifier,screenHeight:c.screenHeight,screenWidth:c.screenWidth,sentryMetrics:this._sentryMetrics,service:b.get("service"),uniqueUserId:this._getUniqueUserId(),utmCampaign:b.get("utmCampaign"),utmContent:b.get("utmContent"),utmMedium:b.get("utmMedium"),utmSource:b.get("utmSource"),utmTerm:b.get("utmTerm")})},initializeIframeChannel:function(){if(this._isInAnIframe()){var a=this._searchParam("origin"),b=new r;b.initialize({origin:a,window:this._window}),this._iframeChannel=b}else this._iframeChannel=new w},initializeFormPrefill:function(){this._formPrefill=new o},initializeOAuthClient:function(){this._oAuthClient=new x({oAuthUrl:this._config.oAuthUrl})},initializeProfileClient:function(){this._profileClient=new A({profileUrl:this._config.profileUrl})},initializeMarketingEmailClient:function(){this._marketingEmailClient=new t({baseUrl:this._config.marketingEmailServerUrl,preferencesUrl:this._config.marketingEmailPreferencesUrl})},initializeRelier:function(){if(!this._relier){var a=void 0,b=this._getContext();return a=this._isOAuth()?new y({context:b},{isVerification:this._isVerification(),oAuthClient:this._oAuthClient,sentryMetrics:this._sentryMetrics,session:I,window:this._window}):this._isServiceSync()?new L({context:b},{isVerification:this._isVerification(),sentryMetrics:this._sentryMetrics,translator:this._translator,window:this._window}):new C({context:b},{isVerification:this._isVerification(),sentryMetrics:this._sentryMetrics,window:this._window}),this._relier=a,a.fetch()}},initializeAssertionLibrary:function(){this._assertionLibrary=new i({audience:this._config.oAuthUrl,fxaClient:this._fxaClient})},initializeAuthenticationBroker:function(){if(!this._authenticationBroker){var a=void 0;a=this._isFxDesktopV2()?this._isIframeContext()?l.FX_FIRSTRUN_V1_CONTEXT:l.FX_DESKTOP_V2_CONTEXT:this._isOAuth()?l.OAUTH_CONTEXT:this._getContext();var b=h.get(a);return this._authenticationBroker=new b({assertionLibrary:this._assertionLibrary,fxaClient:this._fxaClient,iframeChannel:this._iframeChannel,metrics:this._metrics,notificationChannel:this._notificationChannel,notifier:this._notifier,oAuthClient:this._oAuthClient,relier:this._relier,session:I,window:this._window}),this._authenticationBroker.on("error",this.captureError.bind(this)),this._metrics.setBrokerType(this._authenticationBroker.type),this._authenticationBroker.fetch()}},initializeHeightObserver:function(){var a=this;if(this._isInAnIframe()){var b=new q({target:this._window.document.body,window:this._window});b.on("change",function(b){a._iframeChannel.send("resize",{height:b})}),b.start()}},initializeFxaClient:function(){this._fxaClient||(this._fxaClient=new p({authServerUrl:this._config.authServerUrl,interTabChannel:this._interTabChannel}))},initializeUser:function(){var a=this;if(!this._user){var b=this._user=new P({assertion:this._assertionLibrary,fxaClient:this._fxaClient,marketingEmailClient:this._marketingEmailClient,metrics:this._metrics,notifier:this._notifier,oAuthClient:this._oAuthClient,oAuthClientId:this._config.oAuthClientId,profileClient:this._profileClient,sentryMetrics:this._sentryMetrics,storage:this._getUserStorageInstance(),uniqueUserId:this._getUniqueUserId()});return this.upgradeStorageFormats().then(function(){var c=a._authenticationBroker.get("signinCodeAccount");c&&b.setSigninCodeAccount(c);var d=a._authenticationBroker.get("browserSignedInAccount");b.shouldSetSignedInAccountFromBrowser(a._relier.get("service"))&&b.setSignedInAccountFromBrowserAccountData(d)})}},initializeNotificationChannel:function(){this._notificationChannel||(this._notificationChannel=new R(l.ACCOUNT_UPDATES_WEBCHANNEL_ID),this._notificationChannel.initialize({window:this._window}))},initializeNotifier:function(){this._notifier||(this._notifier=new v({iframeChannel:this._iframeChannel,tabChannel:this._interTabChannel,webChannel:this._notificationChannel}))},initializeRefreshObserver:function(){this._refreshObserver||(this._refreshObserver=new B({metrics:this._metrics,notifier:this._notifier,window:this._window}))},_uniqueUserId:null,_getUniqueUserId:function(){return this._uniqueUserId||(this._uniqueUserId=new N({sentryMetrics:this._sentryMetrics,window:this._window}).get("uniqueUserId")),this._uniqueUserId},upgradeStorageFormats:function(){var a=this,b=this._user;return b.upgradeFromUnfilteredAccountData().then(function(){return b.upgradeFromSession(I,a._fxaClient)}).then(function(){return b.removeAccountsWithInvalidUid()})},createView:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new a(e.extend({able:this._able,broker:this._authenticationBroker,createView:this.createView.bind(this),formPrefill:this._formPrefill,interTabChannel:this._interTabChannel,lang:this._config.lang,metrics:this._metrics,notifier:this._notifier,relier:this._relier,sentryMetrics:this._sentryMetrics,session:I,user:this._user,window:this._window},this._router.getViewOptions(b)))},initializeRouter:function(){this._router||(this._router=new E({createView:this.createView.bind(this),metrics:this._metrics,notifier:this._notifier,relier:this._relier,user:this._user,window:this._window})),this._window.router=this._router},initializeAppView:function(){this._appView||(this._appView=new g({createView:this.createView.bind(this),el:"body",environment:new m(this._window),notifier:this._notifier,router:this._router,window:this._window}))},testLocalStorage:function(){var a=this;return z().then(function(){a._isAtCookiesDisabled()||a._storage.testLocalStorage(a._window)}).fail(this.captureError.bind(this))},fatalError:function(a){return this._sentryMetrics||this.enableSentryMetrics(),n.fatalError(a,this._sentryMetrics,this._metrics,this._window,this._translator)},captureError:function(a){return this._sentryMetrics||this.enableSentryMetrics(),n.captureAndFlushError(a,this._sentryMetrics,this._metrics,this._window)},allResourcesReady:function(){this._requireOnDemand("fxaClient");var a=this._selectStartPage(),b=!!a;this._history.start({pushState:this._canUseHistoryAPI(),silent:b}),a&&this._router.navigate(a)},_canUseHistoryAPI:function(){var a=this._window;try{a.history.replaceState({},a.document.title,a.location.href)}catch(a){return!1}return!0},_getUserStorageInstance:function(){var a=this._authenticationBroker.hasCapability("fxaStatus")&&this._relier.isSync(),b=a?void 0:"localStorage";return J.factory(b,this._window)},_isServiceSync:function(){return this._isService(l.SYNC_SERVICE)},_isServiceOAuth:function(){return this._searchParam("service")&&!this._isServiceSync()},_isService:function(a){var b=this._searchParam("service");return!(!b||!a||b!==a)},_isFxDesktopV2:function(){return this._isServiceSync()&&this._isIframeContext()||this._isContext(l.FX_DESKTOP_V2_CONTEXT)},_isContext:function(a){return this._getContext()===a},_getContext:function(){return this._isVerification()?this._getVerificationContext():this._searchParam("context")},_getVerificationContext:function(){var a=this._getSameBrowserVerificationModel("context").get("context");return a||(this._isServiceSync()?l.FX_SYNC_CONTEXT:this._isServiceOAuth()?l.OAUTH_CONTEXT:l.CONTENT_SERVER_CONTEXT)},_getSameBrowserVerificationModel:function(a){var b=O.searchParams(this._window.location.search),c=new F({},{email:b.email,namespace:a,uid:b.uid});return c.load(),c},_isSignUpVerification:function(){return this._searchParam("code")&&this._searchParam("uid")},_isPasswordResetVerification:function(){return this._searchParam("code")&&this._searchParam("token")},_isReportSignIn:function(){return"/report_signin"===this._window.location.pathname},_isVerification:function(){return this._isSignUpVerification()||this._isPasswordResetVerification()||this._isReportSignIn()},_isInAnIframe:function(){return new m(this._window).isFramed()},_isIframeContext:function(){return this._isContext(l.IFRAME_CONTEXT)},_isOAuth:function(){return!(!this._searchParam("client_id")&&!this._isOAuthVerificationSameBrowser())||this._isOAuthVerificationDifferentBrowser()||/oauth/.test(this._window.location.href)},_isAtCookiesDisabled:function(){return"/cookies_disabled"===this._window.location.pathname},_getSavedClientId:function(){return I.oauth&&I.oauth.client_id},_isOAuthVerificationSameBrowser:function(){return this._isVerification()&&this._isService(this._getSavedClientId())},_isOAuthVerificationDifferentBrowser:function(){return this._isVerification()&&this._isServiceOAuth()},_searchParam:function(a){return O.searchParam(a,this._window.location.search)},_selectStartPage:function(){if(!this._isAtCookiesDisabled()&&!this._storage.isLocalStorageEnabled(this._window)&&!this._isVerificationInMobileSafari())return"cookies_disabled"},_createMetrics:function(a){return this._isAutomatedBrowser()?new K(a):new u(a)},_isVerificationInMobileSafari:function(){var a=this._window.location.pathname,b="/complete_signin"===a||"/verify_email"===a,c=new Q(this._window.navigator.userAgent);return b&&c.isMobileSafari()},_isAutomatedBrowser:function(){return"true"===this._searchParam("automatedBrowser")}},c.exports=d}),require(["./require_config"],function(){"use strict";require(["./lib/app-start"],function(a){(new a).startApp()})}),define("main",function(){})}();var easterEgg=function(a){"use strict";function b(){try{!1!==a.shouldShowEasterEgg()&&console.log("\n\n             _.-~-.\n           7''  Q..\\\n        _7         (_\n      _7  _/    _q.  /\n    _7 . ___  /VVvv-'_                                            .\n   7/ / /~- \\_\\\\      '-._     .-'                      /       //\n  ./ ( /-~-/||'=.__  '::. '-~'' {             ___   /  //     ./{\n V   V-~-~| ||   __''_   ':::.   ''~-~.___.-'' _/  // / {_   /  {  /\n  VV/-~-~-|/ \\ .'__'. '.    '::                     _ _ _        ''.\n  / /~~~~||VVV/ /  \\ )  \\        _ __ ___   ___ ___(_) | | __ _   .::'\n / (~-~-~\\\\.-' /    \\'   \\::::. | '_ ` _ \\ / _ \\_  / | | |/ _` | :::'\n/..\\    /..\\__/      '     '::: | | | | | | (_) / /| | | | (_| | ::'\nvVVv    vVVv                 ': |_| |_| |_|\\___/___|_|_|_|\\__,_| ''\n\nHi there, nice to meet you!\n\nInterested in having a direct impact on hundreds of millions of users? Join\nMozilla, and become part of a global community thats helping to build a\nbrighter future for the Web.\n\nVisit https://careers.mozilla.org to learn about our current job openings.\nVisit https://www.mozilla.org/contribute for more ways to get involved and\nhelp support Mozilla.\n\n---\n\nIf you don't want to see this message next time, run this JS statement:\n\n    easterEgg.disableEasterEgg()\n")}catch(a){}}return a.STORAGE_NAMESPACE="__cs_easteregg__",a.enableEasterEgg=function(a){var b=a||window;try{b.localStorage.setItem("__cs_easteregg__","true")}catch(a){}},a.disableEasterEgg=function(a){var b=a||window;try{b.localStorage.setItem("__cs_easteregg__","false")}catch(a){}},a.shouldShowEasterEgg=function(a){var b=a||window;if(b.top!==b.self)return!1;try{return"false"!==b.localStorage.getItem("__cs_easteregg__")}catch(a){return!1}},window.addEventListener?window.addEventListener("load",b,!1):window.attachEvent&&window.attachEvent("onload",b),a}(easterEgg||{});
//# sourceMappingURL=main.js.map