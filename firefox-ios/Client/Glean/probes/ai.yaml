# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# This file defines the metrics that are recorded by the Glean SDK. They are
# automatically converted to Swift code at build time using the `glean_parser`
# PyPI package.

# This file is organized (roughly) alphabetically by metric names
# for easy navigation

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0

$tags:
  - Ai

###############################################################################
# Documentation
###############################################################################

# Add your new metrics and/or events here.

ai.summarize:
  started:
    type: event
    description: |
      Recoded when the user initiates the summarization.
    extra_keys:
      trigger:
        type: string
        description: |
          Describes the action used to trigger summarization.
          Options are listed in the SummarizerTelemetry.TriggerExtra enum.
      length:
        type: quantity
        description: |
          Describes the length of the text to be summarized, in characters.
    bugs:
      - https://github.com/mozilla-mobile/firefox-ios/issues/27783
    #TODO(Issam): Add PR number when available
    data_reviews:
      - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
    notification_emails:
      - fx-ios-data-stewards@mozilla.com
    expires: "2026-01-01"
  completed:
    type: event
    description: |
      Recorded when the result of the summarization is displayed to the user.
    extra_keys:
      outcome:
        #TODO(Issam): Can this be a boolean?
        type: string
        description: |
          Describes the outcome of the summarization task.
          Options are listed in the SummarizerTelemetry.OutcomeExtra enum.
      length:
        type: quantity
        description: |
          Describes the length of the summarized text, in characters.
      connection_type:
        type: string
        description: |
          Describes the type of connection used during summarization.
          Options are listed in the SummarizerTelemetry.ConnectionTypeExtra enum.
      model:
        type: string
        description: |
          Describes the LLM used to summarize the text.
          Options are listed in the SummarizerTelemetry.ModelExtra enum.
      error_message:
        type: string
        description: |
          Describes the error message when summarization fails.
          Options are listed in the SummarizerTelemetry.ErrorMessageExtra enum.
    bugs:
      - https://github.com/mozilla-mobile/firefox-ios/issues/27783
    #TODO(Issam): Add PR number when available
    data_reviews:
      - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
    notification_emails:
      - fx-ios-data-stewards@mozilla.com
    expires: "2026-01-01"
  closed:
      type: event
      description: |
        Recorded when the user cancels or closes the summarization at any point.
      bugs:
      - https://github.com/mozilla-mobile/firefox-ios/issues/27783
      #TODO(Issam): Add PR number when available
      data_reviews:
        - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
      notification_emails:
        - fx-ios-data-stewards@mozilla.com
      expires: "2026-01-01"
  duration:
    type: timing_distribution
    time_unit: millisecond
    description: |
      Records the total duration taken for generating the summary and showing it to the user.
      Starts when the user triggers summarization.
      Ends when user sees the result or an error.
    bugs:
    - https://github.com/mozilla-mobile/firefox-ios/issues/27783
    #TODO(Issam): Add PR number when available
    data_reviews:
      - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
    notification_emails:
      - fx-ios-data-stewards@mozilla.com
    expires: "2026-01-01"
  consent_displayed:
    type: event
    description: |
      Recorded when the user is shown the Terms of Service consent dialogue.
    extra_keys:
      agreed:
        type: boolean
        description: |
          Describes whether the user accepted the summarization terms of service.
    bugs:
    - https://github.com/mozilla-mobile/firefox-ios/issues/27783
    #TODO(Issam): Add PR number when available
    data_reviews:
      - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
    notification_emails:
      - fx-ios-data-stewards@mozilla.com
    expires: "2026-01-01"

user.ai.summarize:
  summarization_enabled:
    type: boolean
    description: |
      Records if the user has summarization enabled.
    bugs:
    - https://github.com/mozilla-mobile/firefox-ios/issues/27783
    #TODO(Issam): Add PR number when available
    data_reviews:
      - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
    notification_emails:
      - fx-ios-data-stewards@mozilla.com
    expires: "2026-01-01"
  shake_gesture_enabled:
    type: boolean
    description: |
      Records if the user has shake to summarize option enabled
    bugs:
    - https://github.com/mozilla-mobile/firefox-ios/issues/27783
    #TODO(Issam): Add PR number when available
    data_reviews:
      - https://github.com/mozilla-mobile/firefox-ios/pull/TODO
    notification_emails:
      - fx-ios-data-stewards@mozilla.com
    expires: "2026-01-01"